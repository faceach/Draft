<!doctype html>
<html>

<head>
    <title>Post Message</title>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
</head>

<body>
    <h2 style="color: blue;">This is main page!</h2>
    <iframe 
    id="myIFrame" 
    src="https://faceach.github.io/Draft/www/postmessage/sub.html" 
    sandbox="allow-same-origin allow-scripts allow-top-navigation"
    style="width: 100%; min-height: 300px;" 
    ></iframe>
    <div id="console"></div>
    <script type="text/javascript">
    /*
                        window.addEventListener("message", function (event) {
                         â€¦
                        }, true);

                        var message = 'ThirdParty:Ping:7';
                        window.postMessage(message, '*');
                        */


    var domain = 'https://faceach.github.io';
    var iframe = document.getElementById('myIFrame').contentWindow;

    function logToPage(msg) {
        if (!msg) {
            return;
        }
        console.log(msg);

        var elConsole = document.getElementById('console');
        var pNode = document.createElement("p");
        pNode.textContent = msg;
        elConsole.appendChild(pNode);
    }

    setInterval(function() {
        var message = 'Hello! The time is: ' + (new Date().getTime());
        logToPage('Sending message: ' + message);
        //send the message and target URI
        iframe.postMessage(message, domain);
    }, 10000);

    window.addEventListener('message', function(event) {
        if (event.origin !== domain) return;
        logToPage('Received response: ' + event.data);
    }, false);
    </script>
</body>

</html>
