<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:Web="http://schemas.live.com/Web/">
<script type="text/javascript">
//<![CDATA[
si_ST = new Date;
//]]>
</script>

<head>
    <!--pc-->
    <title>play lady gaga poker face - Bing</title>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="mobileoptimized" content="0" />
    <link href="/search?format=rss&amp;input=1&amp;formcode=WNSGPH&amp;q=play%20lady%20gaga%20poker%20face&amp;cc=us&amp;setlang=en-us&amp;mkt=en-us&amp;setflight=dialoglaunchspa&amp;uncrunched=1&amp;p1=%5BMustShow%20service=%5C%22CortanaSPA%5C%22%20position=%5C%22Pole%5C%22%5D&amp;addfeaturesnoexpansion=TASKCOMPLETION%2CsupportsSiteNavigation%2Ccufeaturesth2%2clupredeploy&amp;snrtrace=1" rel="alternate" title="XML" type="text/xml" />
    <link href="/search?format=rss&amp;input=1&amp;formcode=WNSGPH&amp;q=play%20lady%20gaga%20poker%20face&amp;cc=us&amp;setlang=en-us&amp;mkt=en-us&amp;setflight=dialoglaunchspa&amp;uncrunched=1&amp;p1=%5BMustShow%20service=%5C%22CortanaSPA%5C%22%20position=%5C%22Pole%5C%22%5D&amp;addfeaturesnoexpansion=TASKCOMPLETION%2CsupportsSiteNavigation%2Ccufeaturesth2%2clupredeploy&amp;snrtrace=1" rel="alternate" title="RSS" type="application/rss+xml" />
    <link href="/sa/simg/bing_p_rr_teal_min.ico" rel="shortcut icon" />
    <script type="text/javascript">
    //<![CDATA[
    _G = {
        ST: (si_ST ? si_ST : new Date),
        Mkt: "en-US",
        RTL: false,
        Ver: "19",
        IG: "f81131fda41d8d55c3464df4c356c1da",
        EventID: "0FD24AC8D32A4DB480F6C516FC781763",
        MN: "SERP",
        V: "web",
        P: "SERP",
        DA: "Co3b",
        SUIH: "_WisfymOP9jZB_i9RTZreg",
        gpUrl: "\/fd\/ls\/GLinkPing.aspx?"
    };
    _G.lsUrl = "/fd/ls/l?IG=" + _G.IG;
    curUrl = "https:\/\/www.bing.com\/search";
    _G.XLS = "\/threshold\/xls.aspx";;
    _G.nclid = '065CE34E763E2C13ADF6791E0EF98621'; ///<reference path="..\..\..\answers\services\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    if (!window.onerror) {
        // Chrome recently started passing in 5th argument as errorObject that contains error stack
        window.onerror = function(message, url, lineNumber, columnNumber, errorObject) {
            var undefined = "undefined";
            var logData;
            if (typeof errorObject === undefined && typeof event !== undefined && event) {
                // on IE and Edge, errorObject argument is not set, but the same data is available in event.error
                errorObject = event["error"];
            }
            if (typeof message === "object" && message.srcElement && message.srcElement.src) {
                //BUGBUG: 628140 -  JS Script Error Inst:  Investigate why we never hit the supposed special error 
                //                  handler for Chrome
                //Chrome passes only a ScriptError Object to the onerror function.
                logData = {
                    ScriptSrc: message.srcElement.src
                };
                if (sj_evt) {
                    sj_evt.fire("ErrorInstrumentation", JSON.stringify(logData));
                }
            } else {
                if (typeof SharedLogHelper !== undefined) {
                    //for others we get a message, url and a line number.
                    SharedLogHelper.LogError(url, message.toString(), errorObject, lineNumber, columnNumber);
                } else {
                    window.addEventListener("load", function() {
                        return SharedLogHelper.LogError(url, message.toString(), errorObject, lineNumber, columnNumber);
                    });
                }
            }
        };
    };
    //]]>
    </script>
    <style type="text/css">
    img,
    .cbtn,
    .sb_meta li,
    .exp_trwr .sc_rc1,
    .topBar .bg,
    .vidr cite.nowrap {
        vertical-align: bottom
    }
    
    img.img_fav,
    img.twss,
    img.twsi,
    img.sa_iconR {
        vertical-align: baseline
    }
    
    img.img_msn_icon,
    td.msn_btn_icon img {
        vertical-align: text-top
    }
    
    #sb_foot {
        margin-top: -3px
    }
    
    div.sb_adsWv2 h2.sb_title {
        display: block
    }
    
    #fbpgbt {
        background: #f2f2f2;
        border: 1px solid #999;
        bottom: 0;
        color: #36b;
        cursor: pointer;
        display: block;
        font-family: Arial, sans-serif;
        font-size: 13px;
        font-weight: bold;
        height: 28px;
        line-height: 28px;
        min-width: 110px;
        padding: 0 5px;
        position: fixed;
        right: 0;
        text-align: center;
        z-index: 1000000
    }
    
    #fbpgbt:hover {
        background: #e5e5e5;
        text-decoration: none
    }
    
    #fbpgbt img {
        border: 0;
        height: 14px;
        margin: 0 5px -4px 0;
        width: 14px;
        vertical-align: baseline
    }
    
    a {
        a: 1
    }
    /* Prevent pinch and zoom and double tap zoom */
    
    html,
    body {
        -ms-content-zooming: none;
    }
    /* set font-faces for Segoe UI typography */
    
    @font-face {
        font-family: Segoe;
        font-weight: 200;
        src: local("Segoe UI Light"), local("Segoe WP Light");
    }
    
    @font-face {
        font-family: Segoe;
        font-weight: 300;
        src: local("Segoe UI Semilight"), local("Segoe WP Semilight");
    }
    
    @font-face {
        font-family: Segoe;
        font-weight: normal;
        src: local("Segoe UI"), local("Segoe WP");
    }
    
    @font-face {
        font-family: Segoe;
        font-weight: 600;
        src: local("Segoe UI Semibold"), local("Segoe WP Semibold");
    }
    
    @font-face {
        font-family: Segoe;
        font-weight: 700;
        src: local("Segoe UI Bold"), local("Segoe WP Bold");
    }
    /* register with SegoeFontFaces as a dependency */
    
    header#b_header:not(:empty) {
        border-bottom/*bingcss-ignore hardcoding a Threshold-specific color */
        : 1px solid #cccccc;
    }
    
    #b_header:not(:empty),
    .peek .b_msg
    /* See more recourse link also needs to be 15px */
    
    {
        font: normal 15px/20px Segoe, Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(am, ti) {
        font-family: Ebrima, Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te) {
        font-family: "Nirmala UI", Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(chr-CHER-US) {
        font-family: Gadugi, Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(ja) {
        font-family: "Yu Gothic UI", Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(ko) {
        font-family: "Malgun Gothic", Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(th, km, lo) {
        font-family: "Leelawadee UI", Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(zh-CN, zh-Hans, zh-SG) {
        font-family: "Microsoft YaHei UI", Arial, sans-serif;
    }
    
    #b_header:not(:empty):-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO) {
        font-family: "Microsoft JhengHei UI", Arial, sans-serif;
    }
    
    #b_header .square_mi,
    .b_msg .square_mi {
        width: 24px;
        font-size: 24px;
        line-height: 24px;
    }
    
    body header:not(:empty):not(.b_hide)#b_header ~ #b_content {
        margin-top: 45px;
    }
    /* Peek pages want no top margin since they've hidden the header */
    
    header.b_hide#b_header ~ #b_content,
    header:empty#b_header ~ #b_content {
        margin-top: 0px;
    }
    
    #b_header .b_scopebar {
        background-color: #eeeeee;
    }
    
    #b_header .b_scopebar,
    #b_header .b_scopebar a,
    #b_header .b_scopebar a:visited,
    #b_header .b_mystuff::before,
    header#b_header .b_symb {
        color/*bingcss-ignore hardcoding a Threshold-specific color */
        : #767676;
    }
    
    #b_header .b_scopebar li.b_active a,
    #b_header .b_scopebar li.b_active a:visited,
    #b_header .b_scopebar span {
        color/*bingcss-ignore hardcoding a Threshold-specific color */
        : black;
        border-color/*bingcss-ignore hardcoding a Threshold-specific color */
        : #f84e29;
    }
    /* This is page-specific CSS in the header bundle that we need to retain */
    
    #b_results a.sb_pagS {
        color/* bingcss-ignore: hardcoded from brand bundle header */
        : #333333;
        border: none;
        font-weight: normal;
    }
    
    #b_results .sb_pag a {
        padding/* bingcss-ignore: hardcoded from brand bundle header */
        : 9px 13px;
    }
    
    .sw_plus,
    .b_cm,
    .sw_up,
    .sw_down,
    .sw_st,
    .sw_sth,
    .sw_ste,
    .idp_wlid,
    .sw_meIc,
    .sw_pref,
    .sw_tpcbk,
    .sw_play,
    .sw_playd,
    /* disabled */
    
    .sw_playa,
    /* active */
    
    .sw_playp,
    /* paused */
    
    .sw_spd,
    .b_fLogo,
    .sb_pagIconN,
    .sb_pagIconP {
        background-image: url(/sa/simg/sw_mg_l_4f_m_w2.png);
        background-repeat: no-repeat;
        background-size: 320px 38px;
    }
    /* Add icon */
    
    .sw_plus {
        background-position: -216px 0;
        height: 10px;
        width: 10px;
    }
    
    .idp_wlid,
    .sw_meIc,
    .sw_pref,
    .sw_play,
    /*Play icon*/
    
    .sw_playa,
    /* active */
    
    .sw_playd,
    /* disabled */
    
    .sw_playp
    /* paused */
    
    {
        height: 16px;
        width: 16px;
    }
    
    .sw_play {
        background-position: -228px 0;
    }
    
    .sw_playa,
    .sw_playd {
        background-position: -246px 0;
    }
    
    .sw_playp {
        background-position: -264px 0;
    }
    
    .b_cm,
    /* Check mark */
    
    .sw_up,
    /* Up (collapse) */
    
    .sw_down
    /* down (expand) */
    
    {
        height: 14px;
        width: 14px;
    }
    
    .sw_down {
        background-position: -184px 0;
    }
    
    .sw_up {
        background-position: -152px 0;
    }
    
    *:active > .sw_up,
    *:focus > .sw_up {
        background-position: -168px 0;
    }
    
    *:active > .sw_down,
    *:focus > .sw_down {
        background-position: -200px 0;
    }
    /* Check mark */
    
    .b_cm {
        background-position: -282px 0;
    }
    /* rating star */
    
    .sw_st,
    /* full gold */
    
    .sw_sth,
    /* left half star */
    
    .sw_ste
    /* empty (light grey) */
    
    {
        height: 14px;
        width: 14px;
        display: inline-block;
    }
    
    .sw_st {
        background-position: -238px -22px;
    }
    
    .sw_sth {
        background-position: -270px -22px;
    }
    
    .sw_ste {
        background-position: -254px -22px;
    }
    /* Rewards */
    
    .sw_meIc {
        background-position: -180px -22px;
    }
    
    #spcv .sw_meIc,
    .rigleamon .sw_meIc {
        background-position: -198px -22px;
    }
    /* Preference */
    
    .sw_pref {
        background-position: -301px -22px;
    }
    /* Windows Live ID Icon */
    
    .idp_wlid {
        background-position: -75px -22px;
    }
    /* default user icon */
    
    .sw_spd {
        background-position: -299px 0;
        height: 20px;
        width: 20px;
    }
    /* Footer logo */
    
    .b_fLogo {
        background-position: -94px -22px;
        height: 16px;
        width: 81px;
    }
    
    .sw_tpcbk {
        background-position: -124px 0px;
    }
    
    .sb_pagIconN {
        background-position: -168px 0;
    }
    
    .sb_pagIconP {
        background-position: -200px 0;
    }
    
    .sb_pagIconN,
    .sb_pagIconP {
        -webkit-transform: rotate(90deg);
        -moz-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        -o-transform: rotate(90deg);
        transform: rotate(90deg);
    }
    /* START COLORS */
    
    html,
    body {
        background-color: #e5e5e5;
    }
    
    #b_results > .b_pag
    /* Task 1249184 : [Mobile 1st][wholepage] Paginiation - Remove legacy style after change ajax pagination */
    
    {
        background-color: #e5e5e5;
    }
    
    body,
    .b_promoteText {
        color: #404040;
    }
    
    input[type="text"] {
        color: #bbbbbb;
        border-color: #bbbbbb;
    }
    
    input[type="text"]:focus {
        color: #404040;
        border-color: #404040;
    }
    
    #b_pole .b_ans {
        background-color: white;
    }
    
    #b_results,
    #b_results .b_defaultText,
    .cbl
    /* label in Factrow */
    
    {
        color: #404040;
    }
    
    #b_results > li a {
        color: #1020d0;
    }
    
    .b_pag a.sb_pagS,
    /* Task 1249184 : [Mobile 1st][wholepage] Paginiation - Remove legacy style after change ajax pagination */
    
    #b_results > li,
    #b_content > .sml
    /* Morepage pagination */
    
    {
        background-color: white;
    }
    
    #b_results > .b_ad {
        color: #303030;
        background-color: #f9fcf7;
    }
    
    #b_results > .b_ad a {
        color: #0a0cd9;
    }
    
    #b_results > .b_ad a:visited {
        color: #600090;
    }
    
    #b_results p {
        color: #333333;
    }
    
    a,
    #b_results .b_no a {
        color: #1020d0;
    }
    
    a:visited,
    #b_results > li a:visited,
    #sb_feedback:visited {
        color: #600090;
    }
    
    cite,
    #b_results cite.sb_crmb a,
    /* Even breadcrumb links in the cite tag need to respect its color */
    
    #b_results cite a.sb_metalink
    /* Even attribution links in the cite tag need to respect its color */
    
    {
        color: #008900;
    }
    
    .b_factrow,
    .b_attribution,
    .b_focusLabel,
    .b_secondaryFocus,
    .b_secondaryText,
    .b_demoteText,
    .b_footnote,
    .b_footnote .cbl,
    .b_entitySubTitle {
        color: #737373;
    }
    
    #b_content .b_imagePair .b_footnote a,
    #b_content .b_imagePair .b_footnote a:visited,
    #b_content .b_floatR_img .b_footnote a,
    #b_content .b_floatR_img .b_footnote a:visited {
        color: #737373;
    }
    /* footer */
    
    footer {
        color: #777777;
        background-color: #e5e5e5;
        /* Task 5408580 [change to transparent]: Need remove when flight mobvertcard ship */
    }
    
    footer a,
    footer a:visited,
    footer span {
        color: #333333;
    }
    /* end of footer */
    /*secondary text styles*/
    
    .sb_meta,
    label {
        color: #737373;
    }
    /* highlighted buttons */
    
    .cbtn input {
        color: #1020d0;
        background-color: white;
    }
    
    .cbtn input:active {
        color: white;
        background-color: #737373;
    }
    
    .s_btn.brd.b_highlighted,
    .cbtn.b_highlighted input {
        background: #1020d0;
        border-color: #1020d0;
    }
    
    .cbtn.b_highlighted input,
    input.b_highlighted:focus,
    #b_results .s_btn.b_highlighted a:visited,
    #b_results .s_btn.b_highlighted a,
    #b_results .s_btn.b_highlighted
    /* #b_results is needed to fix a bug that the button text color remains blue when the background turns blue in highlighted mode, and it is to revert "#b_results>li a { color:blue}" */
    
    {
        color: white;
    }
    
    .cbtn.b_highlighted input:active {
        background: #666666;
        border-color: #666666;
    }
    
    .b_touchable,
    .b_touchable > li {
        border-color: #eeeeee;
    }
    
    select {
        background-color: white;
    }
    
    .b_subModule,
    .b_suppModule {
        border-bottom-color: #e5e5e5;
    }
    /* Primary alteration in spell suggest */
    
    #b_results .b_pAlt {
        color: #d90026;
    }
    
    .b_alert,
    #b_results .b_no .b_alert {
        color: #d90026;
    }
    
    #b_results .b_alert {
        color: #d90026;
    }
    
    .pushpin {
        background: #4499ff;
        color: white;
    }
    
    .b_posText {
        color: #339900;
    }
    
    .b_negText {
        color: #d90026;
    }
    /* END COLORS */
    /*This file is intentionally left empty*/
    
    z {
        a: 1;
    }
    
    h3,
    h4,
    h5 {
        font: inherit;
        font-size: 100%;
    }
    
    body {
        font-family: "-apple-system", HelveticaNeue, Roboto, Arial, sans-serif;
        font-weight: normal;
        font-size: 14px;
        line-height: 18px;
    }
    
    cite {
        font-style: normal;
        white-space: nowrap;
    }
    
    .b_strong,
    strong,
    .b_no h4 {
        font-weight: 700;
        font-family: "-apple-system", HelveticaNeue, Roboto, Arial, sans-serif;
    }
    
    h1,
    h2,
    .b_focusLabel,
    .b_secondaryFocus,
    .b_groupLabel {
        font-size: 18px;
        line-height: 22px;
        font-weight: normal;
    }
    
    .b_anno {
        font-size: 20px;
        line-height: 24px;
        font-weight: normal;
    }
    
    select,
    .cbtn input,
    .s_btn.b_highlighted a,
    input[type="text"] {
        font-size: 14px;
    }
    
    #fti3,
    .sb_count {
        font-size: 12px;
        line-height: 14px;
    }
    
    .ftr_ans,
    #ftrLnks,
    #id_rwds_b {
        font-size: 13px;
        line-height: 16px;
    }
    /* medium text */
    
    .b_mText {
        font-size: 16px;
        line-height: 20px;
    }
    /*Focus text styles*/
    
    .b_xlText {
        font-size: 18px;
    }
    
    .b_secondaryFocus,
    .b_focusTextExtraSmall {
        font-size: 18px;
        line-height: 22px;
    }
    
    .b_focusTextSmall {
        font-size: 23px;
        line-height: 28px;
        font-family: "-apple-system", HelveticaNeue, Roboto, Arial, sans-serif;
    }
    
    .b_focusTextMedium {
        font-size: 32px;
        line-height: 38px;
        font-family: "-apple-system", HelveticaNeue, Roboto, Arial, sans-serif;
    }
    
    .b_focusTextLarge {
        font-size: 44px;
        line-height: 53px;
        font-family: "-apple-system", HelveticaNeue, Roboto, Arial, sans-serif;
    }
    
    .b_footnote {
        font-size: 12px;
        line-height: 15px;
    }
    
    .b_smText {
        font-size: 11px;
    }
    
    .nowrap {
        white-space: nowrap;
    }
    
    a,
    #b_results .b_rs li a {
        text-decoration: none;
    }
    
    #sp_requery a {
        font-style: italic;
    }
    
    th {
        font-weight: normal;
    }
    
    .pushpin {
        font-weight: 700;
        font-size: 12px;
    }
    
    .b_ad {
        line-height: 18px;
    }
    /* begin basic page values */
    
    html,
    body,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    p,
    img,
    ol,
    ul,
    li,
    form,
    table,
    tr,
    th,
    td,
    blockquote {
        border: 0;
        border-collapse: collapse;
        border-spacing: 0;
        list-style: none;
        margin: 0;
        padding/* bingcss-ignore TFS: 641967 - Fix existing whitelist files to be complaint with CSS Cop rules */
        : 0;
    }
    
    html {
        overflow-y: scroll;
    }
    /* This ensures that any words that we will not fit in the width are wrapped */
    /* We first try to hyphenate it, and only if that fails we break the word */
    
    body {
        word-wrap: break-word;
        overflow-x: hidden;
        /* no left and right movement */
        -webkit-text-size-adjust: none;
        /* no text adjustment on phone rotation */
    }
    /* end basic page values */
    
    header#b_header:not(:empty):not(.b_hide) ~ #b_content {
        margin-top: 80px;
    }
    
    .b_footnote {
        padding-bottom: 15px;
    }
    
    .b_imagePair .cico + .b_footnote,
    .b_floatR_img .b_footnote,
    img + .b_footnote {
        padding/* bingcss-ignore: we need to add padding between the image and the footnote */
        : 0 0 0;
    }
    
    .b_hList {
        padding-bottom: 15px;
    }
    
    input[type="text"] {
        -webkit-appearance: none;
        margin: 0 0 15px 0;
        padding: 0 10px;
        height: 38px;
        border-width: 1px;
        border-style: solid;
        border-radius: 0;
        max-width: 100%;
        min-width: 50%;
    }
    
    h2,
    h4,
    label,
    .b_attribution,
    .b_sSpace,
    .b_label,
    .btns,
    .b_poiPair,
    .b_focusLabel,
    .b_secondaryFocus {
        padding-bottom: 0;
    }
    
    h2 a,
    h3 a,
    h4 a,
    h5 a,
    .b_rs a,
    label {
        display: block;
    }
    
    .inline label {
        display: inline;
    }
    
    #sp_requery a {
        display: inline-block;
    }
    
    .b_focusTextLarge,
    .b_focusTextMedium,
    .b_focusTextSmall,
    .b_focusTextExtraSmall {
        padding-bottom: 5px;
    }
    
    .b_lBMargin,
    h2.b_entityTitle {
        padding-bottom: 10px;
    }
    
    .b_focusLabel,
    .b_secondaryFocus {
        padding-bottom: 5px;
    }
    
    .b_rich {
        padding: 12px 0 15px;
    }
    
    .b_rich > *:last-child,
    .b_caption > *:last-child {
        padding-bottom: 0;
        margin-bottom: 0;
    }
    
    .b_caption {
        padding-bottom: 13px;
    }
    
    .b_factrow {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        margin-bottom: 0;
    }
    
    .b_attribution {
        width: 100%;
    }
    
    .cbtn input,
    .b_attribution,
    .b_factrow {
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .b_mBottom {
        padding-bottom: 5px;
    }
    
    .b_lBottom {
        padding-bottom: 10px;
    }
    
    .b_xlBottom {
        padding-bottom: 15px;
    }
    
    .b_xxlBottom {
        padding-bottom: 20px;
    }
    
    .b_xxxlBottom {
        padding-bottom: 25px;
    }
    
    .b_dataList > li > *,
    .b_imagePair .b_attribution > *,
    .b_factrow > * {
        display: inline;
    }
    
    .b_groupLabel {
        padding-bottom: 3px;
    }
    
    .b_anno {
        padding-bottom: 20px;
    }
    
    .b_anno + .b_rich,
    .b_anno + h2 + .b_rich {
        padding-top/* bingcss-ignore: Need to eat the top padding from b_rich */
        : 0;
    }
    
    .b_vPanel > div {
        padding-bottom: 15px;
    }
    
    .b_vList > li {
        padding-bottom: 13px;
    }
    
    #b_results > li.si_pp,
    .sb_hbop,
    .b_hide,
    #fRmsDefer,
    #b_error,
    #b_loadingmsg {
        display: none;
    }
    /* begin vertical lists */
    
    .b_rich > *:last-child,
    .b_rich > .b_vList:not(.b_touchable) > li:last-child,
    .b_rich > .b_vPanel > div:last-child,
    .b_vPanel .b_vList:not(.b_touchable) > li:last-child,
    .b_vList .b_vPanel > div:last-child,
    .b_hList .b_vList > li:last-child,
    .b_hList .b_vPanel > div:last-child,
    .b_vList > li > *:last-child:not(a),
    /* the last non-link child of vertical list items should have no bottom padding */
    
    .b_vPanel > div > *:last-child:not(a),
    /* the last non-link child of vertical stack panel items should have no bottom padding */
    
    .b_subModule > *:last-child,
    .b_subModule .b_vPanel > *:last-child,
    .b_subModule > .b_vList:last-child > *:last-child,
    .b_suppModule > *:last-child,
    .b_suppModule .b_vPanel > *:last-child,
    .b_infocardContent > .b_vList:last-child > *:last-child,
    .b_infocardContent > *:last-child,
    .sa_uc > .b_vList > li:last-child,
    .sa_uc > .b_vList > li:last-child > .b_vList:last-child > li:last-child,
    .b_ans > .b_vList > li:last-child {
        padding-bottom: 0;
    }
    
    .b_vlist2col > ul {
        min-width: 40%;
        display: inline-block;
        word-wrap: break-word;
        vertical-align: top;
    }
    
    .b_vlist2col > ul:first-child {
        padding-right: 30px;
    }
    
    .b_vlist2col li {
        padding-bottom: 15px;
    }
    /* vertical touchable list adds borders and extra space between items */
    
    .b_touchable > li {
        border-bottom-width: 1px;
        border-bottom-style: solid;
        padding-bottom: 13px;
        margin-bottom: 13px;
    }
    
    .b_touchable > li:first-child {
        border-top-width: 1px;
        border-top-style: solid;
        padding-top/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 15px;
    }
    
    .b_rich > .b_touchable:last-child > li:last-child,
    .b_vPanel .b_touchable:last-child > li:last-child {
        margin-bottom: 0;
    }
    /* end vertical lists */
    /* horizontal stack panel */
    
    .b_hPanel > span:not(:last-child),
    .b_hList > li:not(:last-child) {
        padding-right: 10px;
    }
    
    .b_hList > li {
        vertical-align: top;
    }
    
    .b_hPanel.wide > span:not(:last-child) {
        padding-right: 20px;
    }
    
    .b_suffix {
        padding-left: 10px;
        /* intentionally matches horizontal stack panel spacing */
    }
    /* begin image/content horizontal pair */
    
    .b_imagePair {
        padding-bottom: 10px;
    }
    
    .b_imagePair img {
        vertical-align: bottom;
    }
    
    .b_float_img > *:last-child,
    .b_imagePair > *:last-child {
        overflow: hidden;
    }
    
    .b_float_img > *:first-child,
    .b_imagePair > *:first-child {
        margin-right: 10px;
        float: left;
    }
    
    .b_floatR_img {
        float: right;
        padding-left: 10px;
    }
    
    .b_float_img {
        float: left;
        padding-bottom: 10px;
    }
    
    .b_float_img img {
        vertical-align: bottom;
    }
    
    .b_imagePair.reverse {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flexbox;
        display: -webkit-box;
        display: flex;
    }
    
    .b_imagePair.reverse > *:first-child {
        -o-box-flex: 1;
        /* opera */
        -webkit-box-flex: 1;
        /* OLD - iOS 6-, Safari 3.1-6 */
        -moz-box-flex: 1;
        /* OLD - Firefox 19- */
        -webkit-flex: 1;
        /* Chrome */
        -ms-flex: 1;
        /* IE 10 */
        flex: 0 1 100%;
        float: none;
    }
    
    .b_imagePair.reverse > *:last-child {
        -ms-flex: 0 0 auto;
        flex: 0 0 auto;
    }
    
    .b_imagePair.reverse > *:only-child {
        -ms-flex: 1;
        flex: 0 1 100%;
        margin-right: 0;
    }
    /* vm=vertial middle. This can be used in control/component/views to vertically middle align the content of the element who uses this class. */
    
    .b_vmparent {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flexbox;
        display: -webkit-box;
        display: flex;
        -webkit-align-items: center;
        align-items: center;
    }
    /* end image/content horizontal pair */
    
    button,
    .button {
        /* The width and style are intentionally set separate so the color is not overridden */
        border-width: 3px;
        border-style: solid;
        padding/* bingcss-ignore TFS: 641967 - Fix existing whitelist files to be complaint with CSS Cop rules */
        : 8px 18px 12px;
    }
    
    .b_hPanel > span,
    .b_moreLink,
    .b_footnote .cico,
    .b_hList > li,
    .b_title div,
    .csrc
    /*csrc - Mobile Common Star Rating Control*/
    
    {
        display: inline-block;
    }
    
    .b_hPanel > span {
        vertical-align: middle;
    }
    
    .b_title h2
    /* inline title prefix and suffix */
    
    {
        display: inline;
    }
    
    .b_title .b_imagePair .rms_img {
        margin-top: 3px;
        /* align with the title */
    }
    
    .b_relative {
        position: relative;
    }
    
    .b_footnote .cico {
        padding-left: 10px;
    }
    
    #b_error div {
        padding-bottom: 20px;
    }
    /* floats */
    
    .b_mhdr h2,
    .b_float {
        float: left;
    }
    
    .b_floatR {
        float: right;
    }
    /* end floats */
    
    .b_rTxt {
        text-align: right;
    }
    
    .b_cTxt {
        text-align: center;
    }
    
    .b_jTxt {
        text-align: justify;
    }
    
    select::-ms-expand {
        display: none;
    }
    
    select {
        padding-left: 10px;
        margin-bottom: 15px;
        height: 40px;
        border-radius: 0;
        vertical-align: middle;
        border: 1px solid #bbbbbb;
    }
    
    .b_moreLink {
        padding-bottom: 15px;
    }
    
    .b_mhdr .b_floatR {
        margin-top/* bingcss-ignore: vertically align floated text in module header */
        : 4px;
    }
    
    .b_mhdr .b_moreLink {
        padding-bottom: 0;
    }
    
    .b_algo p,
    .b_ans p {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        overflow: hidden;
        -webkit-line-clamp: 3;
    }
    
    .b_factrow:after {
        content: "";
    }
    /* results stack */
    
    #b_results > li,
    #b_pole .b_ans {
        padding/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 13px 10px;
        margin: 0 0 1px;
        border-bottom: 0 solid #e5e5e5;
    }
    
    #b_results > li .b_fullb,
    #b_pole .b_ans .b_fullb {
        margin-left: -10px;
        margin-right: -10px;
    }
    
    #b_results > .b_ans {
        padding-bottom: 13px;
    }
    
    #b_results > .b_algo {
        padding-bottom: 13px;
    }
    
    #b_results > .b_ad {
        padding-bottom: 0;
    }
    /* Task 5408580 : Need remove when flight mobvertcard ship */
    
    #b_results > .b_ad + .b_algo,
    #b_results > .b_ad + .b_ans {
        padding-top/* bingcss-ignore: Top margin is OK between ads+algo and ads+ans */
        : 13px;
    }
    /* Task 5408580 : Need remove when flight mobvertcard ship */
    
    #b_results .b_ans + .b_ad,
    #b_results .b_ans + .b_algo,
    #b_results .b_ans + .b_ans,
    #b_results .b_algo + .b_ans,
    #b_results .b_nav + .b_algo {
        margin-top/* bingcss-ignore:  Top margin is OK between ans+ans and ans+algo and algo+ans */
        : 9px;
        border-top: 0 solid #e5e5e5;
    }
    
    #b_results > li > *:last-child,
    .b_caption > *:last-child,
    .vlist > li:last-child,
    .b_vPanel > li:last-child,
    .lft > *:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
    }
    /* Task 5408580 : Need remove when flight mobvertcard ship */
    
    #b_results > .b_pag
    /* Task 1249184 : [Mobile 1st][wholepage] Paginiation - Remove legacy style after change ajax pagination */
    
    {
        padding/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 10px 10px;
    }
    
    #b_tween
    /* Task 1249184 : [Mobile 1st][wholepage] Paginiation - Remove legacy style after change ajax pagination */
    
    {
        padding/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 8px 10px;
        margin: 0 10px;
    }
    /* end of results stack */
    /* related search and deeplink */
    
    #b_results > li > .b_rs,
    /*override the rule of #b_results > li > *:last-child which default is 0*/
    
    #b_results > li .b_deep
    /*override the rule of #b_results > li > *:last-child which default is 0*/
    
    {
        margin-bottom: -15px;
    }
    
    .b_deep li > a,
    .b_deep li > span > a {
        width: 110px;
        text-overflow: ellipsis;
        display: block;
        white-space: nowrap;
        overflow: hidden;
    }
    
    .b_rs > .b_rich {
        padding-bottom: 0;
    }
    /* end of related search */
    
    .clrfix:after,
    /* Task 1249184 : [Mobile 1st][wholepage] Paginiation - Remove legacy style after change ajax pagination */
    
    .crch:after,
    .b_imagePair:after,
    .b_clearfix:after,
    .sb_vdl:after {
        clear: both;
        content: '.';
        display: block;
        visibility: hidden;
        height: 0;
    }
    /* footer styles */
    
    #ftrLnks li {
        display: inline-block;
        padding: 0 20px 15px 0;
    }
    
    #ftrLnks > *:last-child {
        padding-right: 0;
    }
    
    footer {
        padding/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 15px 0 10px 10px;
    }
    /* begin table */
    
    table {
        width: 100%;
    }
    
    th,
    td {
        vertical-align: top;
        padding: 0 0 15px 15px;
    }
    
    th:first-child,
    td:first-child {
        padding-left: 0;
    }
    
    th {
        text-align: left;
    }
    
    .b_caption > table:last-child tr:last-child td,
    .b_caption > .b_vPanel:last-child > div:last-child > table:last-child tr:last-child td {
        padding-bottom: 0;
    }
    /* end table */
    
    #fti3 {
        margin-bottom: 10px;
    }
    
    #id_rwds_b {
        margin-bottom: 15px;
        display: inline-block;
    }
    /*Label item styles*/
    
    .b_label {
        padding-right: 5px;
    }
    /*Input button styles*/
    
    .cbtn input {
        -webkit-appearance: none;
        border-radius: 0;
        border: 1px solid #bbbbbb;
        min-width: 50px;
        max-width: 100%;
        height: 40px;
        padding: 0 15px;
        margin: 0 0 10px 0;
        white-space: nowrap;
        display: inline-block;
    }
    
    .cbtn input,
    .cbtn input.b_highlighted:focus {
        outline: none;
    }
    /*SubModule and SupplementaryModule*/
    
    .b_subModule,
    .b_suppModule {
        padding/* bingcss-ignore:  Top padding is OK before first element in a container */
        : 13px 0;
        border-bottom-width: 1px;
        border-bottom-style: solid;
    }
    
    .b_subModule h2 {
        padding-bottom: 10px;
    }
    
    .b_subModule h2.b_headerTitle {
        padding-bottom: 5px;
    }
    /*End SubModule and SupplementaryModule*/
    
    .nowrap {
        white-space: nowrap;
    }
    
    .pushpin {
        border-radius: 9px;
        text-align: center;
        width: 16px;
        height: 16px;
        margin-top: 2px;
        padding-bottom: 0;
        /* override label padding */
        line-height: 16px;
    }
    
    #b_results .b_no {
        margin-bottom: 80px;
    }
    
    .b_no h1,
    .b_no h4,
    .b_no li {
        padding-bottom: 10px;
    }
    
    .b_factrow .csrc {
        margin-right: 5px;
    }
    
    .sw_next,
    .sw_prev {
        display: none;
    }
    
    .sb_pagIconN,
    .sb_pagIconP {
        padding/* bingcss-ignore: to enlarge the click area, need top padding to center the icon */
        : 8px;
        margin-top/* bingcss-ignore: make sure next/prev icosn align with other pages */
        : 2px;
    }
    
    .b_entitySubTitle {
        margin-top/* bingcss-ignore: The subtitle needs to be right underneath the title */
        : -9px;
        padding-bottom: 10px;
    }
    
    #sb_dir {
        flex-grow: 1;
    }
    
    .b_clear {
        clear: both;
    }
    
    div#b_pole {
        margin-bottom: 10px;
    }
    
    #b_pole .b_ans + .b_ans {
        margin-top/* bingcss-ignore:  Top margin is OK between ans+ans and ans+algo and algo+ans */
        : 9px;
    }
    /*This file is intentionally left empty*/
    
    z {
        a: 1;
    }
    /*This file is intentionally left empty*/
    
    z {
        a: 1;
    }
    /* header colors for mobile threshold */
    
    .b_scopebar {
        background-color: #e5e5e5;
    }
    
    .b_scopebar,
    .b_scopebar a,
    .b_scopebar a:visited,
    .b_mystuff:before,
    #b_header .b_symb {
        color: #666666;
    }
    
    .b_scopebar li.b_active a,
    .b_scopebar li.b_active a:visited,
    .b_scopebar span {
        border-color: transparent;
        color: black;
    }
    
    .b_scopebar a,
    .b_scopebar span {
        text-decoration: none;
        text-transform: uppercase;
    }
    
    .b_mystuff {
        font-size: 12px;
        line-height: 16px;
        height: 18px;
    }
    
    .b_mystuff:before {
        font-size: 16px;
        vertical-align: middle;
    }
    
    .b_scopebar a {
        text-transform: capitalize;
    }
    /* Scopebar styles */
    
    #b_header:not(:empty) {
        border-bottom: 1px solid #e5e5e5;
        position: fixed;
        top: 0;
        width: 100%;
        z-index/* bingcss-ignore: to keep consistent with legacy mobile */
        : 1000;
    }
    
    #b_header .b_symb {
        float: left;
        margin: 10px 10px 0 10px;
    }
    
    .b_scopebar li {
        margin: 0 10px;
        /* Use margin for sides instead of padding so the active bottom border displays correctly. */
        display: inline-flex;
    }
    
    .b_scopebar li:last-child,
    .b_mystuff {
        margin-right: 12px;
        flex: none;
    }
    
    .b_scopebar li:first-child {
        margin-left: 12px;
    }
    
    .b_scopebar ul {
        overflow-x: auto;
        white-space: nowrap;
        -ms-overflow-style: none;
    }
    
    .b_scopebar a,
    .b_scopebar span,
    .b_mystuff {
        padding/* bingcss-ignore: vertically align with padding */
        : 12px 0;
    }
    
    .b_scopebar li.b_active a,
    .b_scopebar li.b_active span {
        padding-bottom: 10px;
        border-bottom-width: 2px;
        border-bottom-style: solid;
    }
    
    @media screen and (min-width: 641px) {
        #b_header nav li:first-child {
            margin-left: 0;
        }
        #b_header nav li:last-child {
            margin-right: 0;
        }
        #b_header nav,
        header nav {
            padding: 0 24px;
        }
    }
    
    .b_mystuff {
        display: block;
        text-align: right;
    }
    
    .b_mystuff:before {
        padding-right: 12px;
    }
    
    .linkAction {
        padding-bottom: 24px;
    }
    /*This file is intentionally left empty*/
    
    z {
        a: 1;
    }
    
    .b_accentColor,
    .b_accentColor strong,
    strong.b_accentColor,
    strong .b_accentColor,
    .qcard a,
    #sb_feedback,
    .b_anno,
    .appifyCaptionAccent,
    #b_results a.b_accentColor,
    #b_results a.b_accentColor:visited {
        color: #08517b;
    }
    
    .b_accentColorStroke {
        stroke: #08517b;
    }
    
    .b_accentColorFill {
        fill: #08517b;
    }
    
    input[type="text"]:focus {
        border-color: #08517b;
    }
    
    .b_accentColorBackground,
    select:active,
    .cbtn.b_highlighted input.b_accentColorBackground {
        background-color: #08517b;
    }
    
    .b_accentColorBorder {
        border-color: #08517b;
    }
    </style>
    <script type="text/javascript">
    //<![CDATA[
    // Declaring Feature Team ID for Win8App Error Handling
    // <feature  id="8"  />
    var amd;
    (function(amd) {
        var defineMap = {};
        var cache = {};
        var initialized = false;

        function define(moduleName, dependencies, callback) {
            if (!defineMap[moduleName]) {
                defineMap[moduleName] = {
                    dependencies: dependencies,
                    callback: callback
                };
                // Invoke this module as it is registered
                require(moduleName);
            }
        }

        function require(requestedModuleName) {
            if (!requestedModuleName) {
                // Initialize all the modules and return the cache
                if (!initialized) {
                    for (var moduleName in defineMap) {
                        requireModule(moduleName);
                    }
                    initialized = true;
                }
                return cache;
            } else if (requestedModuleName) {
                // Initialize just the module asked for
                return requireModule(requestedModuleName);
            }
        }

        function requireModule(moduleName) {
            // This should break the recursion in case of circular dependency
            if (cache[moduleName]) {
                return cache[moduleName];
            }
            // If the module has a define entry
            if (defineMap.hasOwnProperty(moduleName)) {
                // Create this module
                var moduleDetails = defineMap[moduleName];
                var deps = moduleDetails.dependencies;
                var callback = moduleDetails.callback;
                // add req and exports as first two dependencies
                var req = require;
                var exports = {};
                var dependencies = [req, exports];
                if (deps.length < 2) {
                    throw "invalid usage";
                } else if (deps.length > 2) {
                    // Recursively fetch dependencies
                    var dependentModules = deps.slice(2, deps.length);
                    for (var i = 0; i < dependentModules.length; i++) {
                        dependencies.push(requireModule(dependentModules[i]));
                    }
                }
                // Call the callback -- this should add objects to exports
                // This means we do not support the callback itself returning an object.
                // It should be simple to support that. For now, STRADA generates
                // exports syntax.
                callback.apply(this, dependencies);
                // Cache the module
                cache[moduleName] = exports;
                return exports;
            }
        }
        amd.define = define;
        amd.require = require;
    })(amd || (amd = {}));
    var define = amd.define;
    var require = amd.require;; /// <reference path='../Declarations/Threshold.Utilities.d.ts' />
    /// <reference path="../../../../../Threshold/src/Content/Script/Declarations/SearchAppWrapper.d.ts" />
    // BUGBUG: TFS 780914: TypeScript throws build error when two ts file declare the same variable
    var _w = window,
        _d = document,
        sb_ie = window["ActiveXObject"] !== undefined,
        sb_i6 = sb_ie && !_w["XMLHttpRequest"],
        _ge = function(id) {
            return _d.getElementById(id);
        },
        sb_st = function(code, delay) {
            return setTimeout(code, delay);
        },
        sb_rst = sb_st,
        sb_ct = function(id) {
            clearTimeout(id);
        },
        sb_gt = function() {
            return new Date().getTime();
        },
        sj_gx;
    _w["sj_ce"] = function(tagName) {
        return _d.createElement(tagName);
    };
    // Under certain circumstances the clientCookies script
    // fails to get added from frontdoor. Declaring sk_merge
    // if it isn't already defined.
    if (!_w["sk_merge"]) {
        _w["sk_merge"] = function(cookieHeader) {
            _d.cookie = cookieHeader;
        };
    }
    var AjaxWrapperThreshold = (function() {
        function AjaxWrapperThreshold() {}
        AjaxWrapperThreshold.applyMethodThatRequiresOpened = function(xhrObject, method, originalArguments) {
            /* send and setRequestHeader can only be done on xhr requests that are currently opened: http://www.w3.org/TR/2009/WD-XMLHttpRequest-20090820/#opened-state */
            if (xhrObject.readyState == xhrObject.OPENED) {
                method.apply(xhrObject, originalArguments);
                return true;
            }
            return false;
        };
        AjaxWrapperThreshold.wrapSend = function(originalObject, originalMethod) {
            var wrappedMethod = function() {
                var originalArguments = arguments;
                if (!AjaxWrapperThreshold.isRequestBlocked(originalObject) && originalObject.readyState == originalObject.OPENED) {
                    // If we're sending to bing, we need to append custom client headers.
                    // Some old Threshold app webviews do not have a SearchAppWrapper.  Those can just make the XHR call directly and hope for the best.
                    if (typeof ThresholdUtilities !== "undefined" && SearchAppWrapper && SearchAppWrapper.CortanaApp && AjaxWrapperThreshold.hostIsBing(originalObject.url)) {
                        ThresholdUtilities.getCortanaHeaders(function(headers) {
                            if (headers) {
                                var xhrHeaders = originalObject[AjaxWrapperThreshold.headersLocation];
                                for (var headerName in headers) {
                                    if (headers.hasOwnProperty(headerName) && (headerName.substring(0, 2) === "X-" || AjaxWrapperThreshold.copyableHeaders.indexOf(headerName) >= 0)) {
                                        if (!xhrHeaders[headerName]) {
                                            originalObject.setRequestHeader(headerName, headers[headerName]);
                                        }
                                    }
                                }
                            }
                            AjaxWrapperThreshold.setFlightHeaders(originalObject);
                            AjaxWrapperThreshold.applyMethodThatRequiresOpened(originalObject, originalMethod, originalArguments);
                        });
                    } else {
                        if (AjaxWrapperThreshold.hostIsBing(originalObject.url)) {
                            AjaxWrapperThreshold.setFlightHeaders(originalObject);
                        }
                        AjaxWrapperThreshold.applyMethodThatRequiresOpened(originalObject, originalMethod, originalArguments);
                    }
                } else {
                    // If we need to block the send we simulate that we did it successfully so no retries are triggered.
                    Object.defineProperties(originalObject, {
                        "readyState": {
                            get: function() {
                                return 4;
                            }
                        },
                        "status": {
                            get: function() {
                                return 200;
                            }
                        },
                        "responseText": {
                            get: function() {
                                return "";
                            }
                        },
                        "responseBody": {
                            get: function() {
                                return "";
                            }
                        }
                    });
                    if (originalObject.onreadystatechange) {
                        originalObject.onreadystatechange.apply(originalObject, null);
                    }
                }
            };
            return wrappedMethod;
        };
        AjaxWrapperThreshold.wrapOpen = function(originalObject, originalMethod) {
            var wrappedMethod = function() {
                // We always pass through open calls, but we record the url on the object.
                originalObject.url = arguments[1];
                originalMethod.apply(originalObject, arguments);
            };
            return wrappedMethod;
        };
        AjaxWrapperThreshold.wrapSetRequestHeader = function(originalObject, originalMethod) {
            return function(headerKey, headerValue) {
                var successfulApply = AjaxWrapperThreshold.applyMethodThatRequiresOpened(originalObject, originalMethod, arguments);
                if (successfulApply) {
                    var originalObjectHeaders = originalObject[AjaxWrapperThreshold.headersLocation];
                    if (originalObjectHeaders[headerKey]) {
                        originalObjectHeaders[headerKey].push(headerValue);
                    } else {
                        originalObjectHeaders[headerKey] = [headerValue];
                    }
                }
                return successfulApply;
            };
        };
        AjaxWrapperThreshold.hostIsBing = function(url) {
            // Assume it's Bing if we can't prove otherwise
            var returnValue = true;
            AjaxWrapperThreshold.testAnchor.href = url;
            var hostName = AjaxWrapperThreshold.testAnchor.hostname;
            if (hostName && hostName.indexOf(".") > 0) {
                var matchedAnyHost = false;
                for (var i in this.bingHosts) {
                    if (hostName.indexOf(this.bingHosts[i]) > 0) {
                        matchedAnyHost = true;
                        break;
                    }
                }
                if (!matchedAnyHost) {
                    returnValue = false;
                }
            }
            return returnValue;
        };
        AjaxWrapperThreshold.blockRequestWrapper = function(originalObject) {
            var _this = this;
            return function() {
                return _this.isRequestBlocked(originalObject);
            };
        };
        AjaxWrapperThreshold.isRequestBlocked = function(originalObject) {
            return typeof SearchAppWrapper !== "undefined" && SearchAppWrapper && SearchAppWrapper.CortanaApp && !SearchAppWrapper.CortanaApp.isBingEnabled && AjaxWrapperThreshold.hostIsBing(originalObject.url);
        };
        AjaxWrapperThreshold.createAjaxWrapper = function() {
            var wrappedObject = new XMLHttpRequest();
            wrappedObject[this.headersLocation] = {};
            wrappedObject.send = this.wrapSend(wrappedObject, wrappedObject.send);
            wrappedObject.open = this.wrapOpen(wrappedObject, wrappedObject.open);
            wrappedObject.setRequestHeader = this.wrapSetRequestHeader(wrappedObject, wrappedObject.setRequestHeader);
            wrappedObject.isRequestBlocked = this.blockRequestWrapper(wrappedObject);
            return wrappedObject;
        };
        AjaxWrapperThreshold.setFlightHeaders = function(request) {
            // set http headers for setting external flights
            if (typeof(_CachedFlights) !== "undefined" && _CachedFlights.sort) {
                var headersSet = request[AjaxWrapperThreshold.headersLocation];
                if (!headersSet[AjaxWrapperThreshold.externalExpType]) {
                    request.setRequestHeader(AjaxWrapperThreshold.externalExpType, "JointCoord");
                }
                if (!headersSet[AjaxWrapperThreshold.externalExp]) {
                    request.setRequestHeader(AjaxWrapperThreshold.externalExp, _CachedFlights.sort().join(","));
                }
            }
        };
        AjaxWrapperThreshold.bingHosts = [".bing.com", ".staging-bing-int.com", ".working-bing-int.com", ".bing-int.com", ".bing-exp.com"];
        AjaxWrapperThreshold.testAnchor = document.createElement("a");
        AjaxWrapperThreshold.externalExpType = "X-MSEdge-ExternalExpType";
        AjaxWrapperThreshold.externalExp = "X-MSEdge-ExternalExp";
        AjaxWrapperThreshold.headersLocation = "headers";
        AjaxWrapperThreshold.copyableHeaders = ["Authorization"];
        return AjaxWrapperThreshold;
    })();
    sj_gx = function() {
        return AjaxWrapperThreshold.createAjaxWrapper();
    };; ///<reference path="..\Declarations\Shared.d.ts"/>
    function lb() {
        _w["si_sendCReq"] && sb_st(_w["si_sendCReq"], 800);
        // look for any other scripts that needs to be called/initialized, and call them
        // we need a cleaner way to allow other scripts to register for a callback during onload
        // initialization (Bug 94997)
        _w["lbc"] && _w["lbc"]();
    }; ///<reference path="..\Declarations\Shared.d.ts"/>
    // This files modifies appendChild function to check if a SCRIPT tag is being appended.
    // If yes and the script tag does not have a src attribute i.e. it is an inlined script
    // then a "//@ sourceURL=BingDynamicScriptX.js" comment is added to the script so that
    // modern browsers can parse it and add it to the javascript sources in debug window.
    (function() {
        var scriptCount = 0;
        var scriptPrefix = "//@ sourceURL=BingDynamicScript";
        var scriptSuffix = ".js\n";
        if (window["Element"] && Element.prototype && window.location.pathname.indexOf("/mapspreview") !== 0) {
            var appendChild = Element.prototype.appendChild;
            Element.prototype.appendChild = function(elem) {
                if (elem && elem.tagName === "SCRIPT" && !elem.src && elem.textContent) {
                    // Adding the sourceURL comment to the beginning of the file in case someone already
                    // has this logic for their specific file then the latest one will take effect
                    elem.textContent = scriptPrefix + scriptCount + scriptSuffix + elem.textContent;
                    scriptCount++;
                }
                return appendChild.apply(this, arguments);
            };
        }
    })();;
    //]]>
    </script>
    <script type="text/javascript" src="/rms/BingCore.Bundle/nj/72d90be9/1b141dd6.js?bu=rms+answers+Shared+BingCore%24ClientInstV2%24DuplicateXlsDefaultConfig%2cBingCore%24ClientInstV2%24SharedLocalStorageConfigDefault%2cBingCore%24shared%2cBingCore%24env.override%2cBingCore%24event.custom.fix%2cBingCore%24event.native%2cBingCore%24dom%2cBingCore%24cookies_parser%2cBingCore%24XHRPrefetch%24rmsajax_xhrprefetch%2cBingCore%24ClientInstV2%24InstrumentationConfigDefault%2cBingCore%24ClientInstV2%24LogUploadCapFeatureDisabled%2cBingCore%24ClientInstV2%24ClientInstConfigSeparateOfflineQueue%2cBingCore%24ClientInstV2%24clientinst_xls%2cEmpty%2cBingCore%24CoreUtilities%2cBingCore%24ClientInstV2%24LogHelper%2cBingCore%24ClientInstV2%24VisibilityChangeEventHelper%2cBingCore%24Animation%2cBingCore%24fadeAnimation%2cBingCore%24framework%2cBingCore%24ShowWebView%2cBingCore%24ClientInstV2%24LogOfflineFalseConfig%2cBingCore%24mobile2cortanahooks"></script>
    <script type="text/javascript">
    //<![CDATA[
    var SloppyClickHandler;
    (function(SloppyClickHandler) {
        var listTag = ["LI", "TR"];
        var tableTag = ["TR"];
        var anchorTag = ["A"];
        var inputTag = ["INPUT", "SELECT"];
        var getElementsByTagName = "getElementsByTagName";
        var notTargetElementClass = "b_noTarget";
        var poleContainerClassName = "b_poleContent";
        var space = " ";

        function findCardFromElement(element) {
            var link = getParentContainer(element, anchorTag);
            var returnObject = {
                element: element,
                card: link,
                link: link,
                containsLink: true
            };
            var input = getParentContainer(element, inputTag);
            if (!input) {
                var card = getParentContainer(element, listTag, poleContainerClassName);
                if (card) {
                    // If there's only one viable link in the entire LI then we'll use it by default
                    var viableLink = findLinkInAnchorTags(card);
                    // If the link is not found in the table, try again at levels above it
                    // Won't work for nested tables or lists
                    if (!viableLink && tableTag.indexOf(card.tagName) >= 0) {
                        card = getParentContainer(card.parentNode, listTag, poleContainerClassName);
                        viableLink = findLinkInAnchorTags(card);
                    }
                    // If there's more than one link we still need to see if there's a header common control.  If there's a single
                    // header control we're willing to shift the click to that.
                    if (!viableLink && card && _w['TCH']) {
                        var reservedTags = _w['TCH'].rTags;
                        for (var i = 0; i < reservedTags.length; i++) {
                            viableLink = getViableLinkFromList(card[getElementsByTagName](reservedTags[i]));
                            if (viableLink) {
                                break;
                            }
                        }
                    }
                    if (viableLink && (!link || viableLink === link)) {
                        returnObject = {
                            element: element,
                            card: card,
                            link: viableLink,
                            containsLink: true
                        };
                    }
                }
            } else {
                returnObject = null;
            }
            // Don't return anything if we don't have a link.
            if (returnObject && !returnObject.link) {
                returnObject = null;
            }
            // If we have a link, but it's the same as or a parent of our source element we mark the object as non-clickable.
            // Clicking is not required here as normal event bubbling will work.
            // But we do need to track the object still, as it is animatable.
            if (returnObject && (containsElement(returnObject.link, element) || returnObject.link === returnObject.element)) {
                returnObject.containsLink = false;
            }
            return returnObject;
        }
        SloppyClickHandler.findCardFromElement = findCardFromElement;
        var containsElement = function(parent, element) {
            if (element) {
                var candidates = parent[getElementsByTagName](element.tagName);
                for (var i = 0; i < candidates.length; i++) {
                    if (candidates[i] === element) {
                        return true;
                    }
                }
            }
            return false;
        };
        var getViableLinkFromList = function(elements) {
            var viableLink = null;
            for (var i = 0; i < elements.length; i++) {
                var possibleLink = findLinkInAnchorTags(elements[i]);
                if (possibleLink) {
                    if (!viableLink) {
                        viableLink = possibleLink;
                    } else if (possibleLink.href !== viableLink.href) {
                        // We found more than one heading with a viable link - the click is ambiguous so there is no click.
                        viableLink = null;
                        break;
                    }
                } else if (elements[i][getElementsByTagName](anchorTag).length > 1) {
                    // A single header has more than one link, and they're not viable - we're confused so we stop.
                    viableLink = null;
                    break;
                }
            }
            return viableLink;
        };
        var isViableLink = function(element) {
            return element && element.className.indexOf(notTargetElementClass) < 0;
        };
        var findLinkInAnchorTags = function(element) {
            var viableLink = null;
            if (element) {
                var anchorTags = element[getElementsByTagName](anchorTag);
                var anchorTagCount = anchorTags.length;
                var linksMatch = true;
                var matchingLink = null;
                var firstLinkUrl = null;
                for (var i = 0; i < anchorTagCount; i++) {
                    /* Only compare the viable links */
                    if (isViableLink(anchorTags[i])) {
                        if (!firstLinkUrl) {
                            matchingLink = anchorTags[i];
                            firstLinkUrl = anchorTags[i].href;
                        } else if (firstLinkUrl !== anchorTags[i].href) {
                            linksMatch = false;
                            break;
                        }
                    }
                }
                /* We need to have found at least one viable link */
                if (linksMatch && firstLinkUrl) {
                    viableLink = matchingLink;
                }
            }
            return viableLink;
        };
        var getParentContainer = function(target, tags, className) {
            for (; target !== document && target; target = target.parentNode) {
                if (target) {
                    for (var i = 0; i < tags.length; ++i) {
                        if (target.tagName === tags[i] || (className && target.className && (space + target.className + space).indexOf(space + className + space) >= 0)) {
                            return target;
                        }
                    }
                }
            }
        };
    })(SloppyClickHandler || (SloppyClickHandler = {}));; ///<reference path="..\Declarations\Shared.d.ts"/>
    ClickTrackingConfig = {
        lc: true,
        rc: true
    };; ///<reference path="..\Declarations\Shared.d.ts"/>
    ///<reference path="..\..\..\..\..\Web\Content\Content\Script\Declarations\SloppyClickHandler.d.ts"/>
    // See Hyperlink and FdHyperlink at the FD for what this all means
    // BUGBUG: TFS 780914: TypeScript throws build error when two ts file declare the same variable
    _w["si_ct"] = function(el, noRecurse, evt) {
        var getAttribute = "getAttribute",
            ct, ctf, found;
        try {
            for (; el !== document.body; el = el.parentNode) {
                // The 'h' or '_ct' attribute contains the payload for the click tracking function
                // Stop on the first anchor with an 'h' attribute or the first element found with a '_ct' attribute present
                ct = (el.tagName == "A" && el[getAttribute]("h")) || el[getAttribute]("_ct") || el[getAttribute]("data-h");
                if (ct) {
                    // The '_ctf' attribute contains the name of the overriden global click
                    // tracking function which is optional, default is si_T
                    ctf = el[getAttribute]("_ctf");
                    var clickType = -1;
                    if (evt != null && evt.button != null) {
                        clickType = evt.button;
                    }
                    if (!ctf || !_w[ctf]) {
                        ctf = "si_T";
                    }
                    // Try to fire the gping by calling the click-tracking function with the 'ct' payload and the clicked element
                    _w[ctf] && _w[ctf]('&' + ct, el, evt, clickType);
                    break;
                }
                if (noRecurse)
                    break;
            }
        } catch (ignored) {}
        return true;
    };
    (function() {
        function leftClickHandler(evt) {
            _w["si_ct"](sb_ie ? _w.event.srcElement : evt.target, false, _w.event || evt);
        }

        function rightClickHandler(evt) {
            var clickedObject = _w["SloppyClickHandler"] ? SloppyClickHandler.findCardFromElement(sj_et(evt)) : null;
            var target = (clickedObject && clickedObject.link) ? clickedObject.link : (sb_ie ? _w.event.srcElement : evt.target);
            _w["si_ct"](target, false, _w.event || evt);
        }
        if (_w["_G"]) {
            _G["si_ct_e"] = "click";
        }
        // sj_be: Indicates bubble-phase handler (supported on all browsers as opposed to capture which IE doesn't support)
        sj_be(document, "click", leftClickHandler, false);
        sj_be(document, "contextmenu", rightClickHandler, false);
    })();;
    var wlc_d = 1500,
        wlc_t = 63598110985;;
    var perf;
    (function(perf) {
        var perfKeyArray = [
            "redirectStart",
            "redirectEnd",
            "fetchStart",
            "domainLookupStart",
            "domainLookupEnd",
            "connectStart",
            "secureConnectionStart",
            "connectEnd",
            "requestStart",
            "responseStart",
            "responseEnd",
            "domLoading",
            "domInteractive",
            "domContentLoadedEventStart",
            "domContentLoadedEventEnd",
            "domComplete",
            "loadEventStart",
            "loadEventEnd",
            "unloadEventStart",
            "unloadEventEnd",
            "firstChunkEnd",
            "secondChunkStart",
            "htmlEnd",
            "pageEnd",
            "msFirstPaint"
        ];
        var versionString = "v:1.1";
        // For now the key compression is based on array index. The assumption is 
        // that this is a fixed list that will not change often and tightly contolled.
        // This is not very flexible as any addition in between can essentially
        // break the reporting side. Two possible solutions to try would be to
        // have the keyMap logged in nif. Advantage of this would be it is easy to
        // maintain but the disadvantage is no real time reporting. The other way
        // to have a package that defines the keyMap. Advantage is the keyMap can 
        // be consumed by multiple sources but the disadvantage is it would need 
        // version control.
        var perfKeyMap = {};
        var i;
        for (i = 0; i < perfKeyArray.length; i++) {
            perfKeyMap[perfKeyArray[i]] = i;
        }

        function compressKey(key) {
            return perfKeyMap.hasOwnProperty(key) ? perfKeyMap[key] : key;
        }

        function typeToString(type) {
            var typeString = "S";
            if (type == 0 /* Mark */ ) {
                typeString = "P";
            } else if (type == 2 /* Measure */ ) {
                typeString = "M";
            }
            return typeString;
        }
        // Creates an array of strings that are essentially are of the form "${key}:${value}"
        function compress(q) {
            var data = [];
            var typeArrays = {},
                typeArray;
            for (var i = 0; i < q.length; i++) {
                var obj = q[i];
                var value = obj.v,
                    qType = obj.t,
                    key = obj.k;
                if (qType === 0 /* Mark */ ) {
                    key = compressKey(key);
                    value = value.toString(36);
                }
                if (qType === 3 /* None */ ) {
                    data.push("" + key + ":" + value);
                } else {
                    typeArray = typeArrays[qType] = typeArrays[qType] || [];
                    typeArray.push("" + key + ":" + value);
                }
            }
            for (var t in typeArrays) {
                if (typeArrays.hasOwnProperty(t)) {
                    typeArray = typeArrays[t];
                    data.push("" + typeToString(t) + ":\"" + typeArray.join(",") + "\"");
                }
            }
            data.push(versionString);
            return data;
        }
        perf.compress = compress;
    })(perf || (perf = {}));; ///<reference path="..\..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    window["perf"] = window["perf"] || {};
    (function(perf) {
        perf.log = function(perfData, time) {
            var data = perf.compress(perfData);
            data.push("T:\"CI.Perf\",FID:\"CI\",Name:\"PerfV2\"");
            var url = "/fd/ls/lsp.aspx?";
            var sendBeacon = "sendBeacon";
            // if eventData contains the raw string "]]>", it'll end the CDATA section prematurely
            var eventXML = "<E><T>Event.ClientInst</T><IG>" + _G.IG + "</IG><TS>" + time + "</TS><D><![CDATA[{" + data.join(",") + "}]]></D></E>";
            var xml = "<ClientInstRequest><Events>" + eventXML + "</Events><STS>" + time + "</STS></ClientInstRequest>";
            if (!_w.navigator || !navigator[sendBeacon] || !navigator[sendBeacon](url, xml)) {
                var request = sj_gx();
                request.open("POST", url, true);
                request.setRequestHeader("Content-Type", "text/xml");
                request.send(xml);
            }
        };
    })(window["perf"]);; ///<reference path="..\..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    var perf;
    (function(perf) {
        var perfName = "performance";
        var hasPerformanceObject = !!_w[perfName];
        var perfObj = _w[perfName];
        var highResTimeAvailable = hasPerformanceObject && !!perfObj.now;
        var roundOf = Math.round;
        var q = [];
        // The data is only flushed after the first time flush is called.
        // We bind flush to onload so that pings are restricted to before onload.
        var firstFlushCalled = false;
        var navigationStart;
        var startTimestamp;
        if (hasPerformanceObject) {
            navigationStart = startTimestamp = perfObj.timing.navigationStart;
        } else {
            startTimestamp = _w["si_ST"] ? _w["si_ST"] : +new Date();
        }

        function createUniqueId() {
            return roundOf(Math.random() * 10000);
        }
        var uniqueId = createUniqueId();

        function getTime() {
            if (highResTimeAvailable) {
                return roundOf(perfObj.now()) + navigationStart;
            } else {
                return +new Date;
            }
        }

        function queue(key, value, qType) {
            if (q.length === 0 && firstFlushCalled) {
                sb_st(flush, 1000);
            }
            q.push({
                k: key,
                v: value,
                t: qType
            });
        }

        function setStartTime(time) {
            if (!firstFlushCalled) {
                startTimestamp = time;
            }
            return !firstFlushCalled;
        }
        perf.setStartTime = setStartTime;

        function mark(key, value) {
            if (!value) {
                value = getTime();
            }
            queue(key, value, 0 /* Mark */ );
        }
        perf.mark = mark;

        function record(key, value) {
            queue(key, value, 1 /* Record */ );
        }
        perf.record = record;

        function flush() {
            if (q.length) {
                for (var i = 0; i < q.length; i++) {
                    var obj = q[i];
                    if (obj.t === 0 /* Mark */ ) {
                        obj.v -= startTimestamp;
                    }
                }
                q.push({
                    k: "id",
                    v: uniqueId,
                    t: 3 /* None */
                });
                perf.log(q, getTime());
                q = [];
                firstFlushCalled = true;
            }
        }
        perf.flush = flush;

        function reset() {
            startTimestamp = getTime();
            uniqueId = createUniqueId();
            firstFlushCalled = false;
            sj_evt.bind("onP1", flush);
        }
        perf.reset = reset;
        sj_be(window, "load", flush, false);
        sj_be(window, "beforeunload", flush, false);
    })(perf || (perf = {}));; ///<reference path="..\..\..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    // Performance ping instrumentation for browsers supporting the W3C Web Timing API.
    // si_PP() is the PerformancePing function used to report back performance data.
    // currentTime - a javascript Date object
    // state - "A" for abandoned, "L" for load.
    // This function is called after pageload. However, some verticals may
    // choose to call it at a different time, after setting the sb_ppCPL (custom page load) flag
    _w.si_PP = function(currentTime, state, ajaxRequest) {
        // Only fire one perf ping
        if (_G.PPS) {
            return;
        }
        // Include the impression GUID (IG)
        // The DATA field contains a JSON blob of the event.
        // pp is the name of the event.
        // S is the status to report, from parameter b.
        // PC is the elapsed time between when the <BODY> tag is opened (_G.PCT) and the start time
        // FC is the elapsed time between when the first chunk is complete (_G.FCT) and the start time.
        //    For non-CTE rendering, the value is -1
        // BC is the elapsed time between when the second chunk arrives (_G.BCT) and the start time.
        //    If there is no second chunk, the timer is inserted right after _G.PPCT
        // BS is the elapsed time between right before the BOP scripts are inserted (_G.BST) and the start time
        // H is the elapsed time between when the HTML finished being downloaded and the last inline script got executed (_G.HT), and the start time
        // FE is the elapsed time between the beginning of the first embeded image chunk and the start time, if there are embedded image chunks
        //    Otherwise, the value is -1
        // LE is the elapsed time between the end of last embedded image chunk and the start time, if there are embedded image chunks
        //    Otherwise, the value is -1
        // C1 and C2 are custom ppMetrics, available in each vertical to be overridden with vertical specific elapsed times from the start time.
        //    To use, a page can simply set
        //           _G.C1T=new Date()
        // BP is the elapsed time between when the pageLoad event begins (_G.BPT) and the start time.
        // KP is the page's KeyPoint - the point the page's owner has decided is key to users.
        //    For example, on the SERP, this could be when web results and top answers are loaded, but not BOP answers.
        //    To use, insert the following in-lined JS to the place of interest
        //           _G.KPT=new Date()
        // CT is the total client elapsed time to "Page Load", calculated from the difference between the currentTime parameter and _G.ST
        // IL is the numbers of images
        // If CID is explicitly specified in the response
        //    it should be included in our instrumention as well
        // Collect a small number of PerfPing Metrics
        // --------------------------------------------------
        var key;
        var ppMetrics = ['FC', 'BC', 'H', 'BP', null];
        while (key = ppMetrics.shift()) {
            ppMetrics.push('"' + key + '":' + (_G[key + 'T'] ? _G[key + 'T'] - _G.ST : -1));
        }
        // --------------------------------------------------
        var w3cTimings = ajaxRequest || (_w.performance && _w.performance.timing);
        var w3cPayload = null;
        if (w3cTimings) {
            var w3cFields = [
                "unloadEventStart",
                "unloadEventEnd",
                "redirectStart",
                "redirectEnd",
                "fetchStart",
                "domainLookupStart",
                "domainLookupEnd",
                "connectStart",
                "connectEnd",
                "secureConnectionStart",
                "requestStart",
                "responseStart",
                "domLoading",
                "domInteractive",
                "domContentLoadedEventStart",
                "domContentLoadedEventEnd",
                "domComplete",
                "loadEventStart",
                "loadEventEnd",
                "msFirstPaint",
                "responseEnd",
                ""
            ];
            // Check that navigationStart is a number >= 0
            var navigationStart = w3cTimings.navigationStart;
            if (navigationStart >= 0) {
                var i, t, mask, prev;
                for (mask = prev = i = 0; key = w3cFields.shift(); i++) {
                    t = w3cTimings[key];
                    if (t > 0) {
                        mask |= 1 << i;
                        t -= navigationStart;
                        w3cFields.push(t === prev ? '' : (t - prev).toString(16));
                        prev = t;
                    }
                }
                var navigation = "navigation";
                w3cPayload = ',"w3c":"' + mask.toString(16) + "," + w3cFields.join() + '","nav":' + (navigation in w3cTimings ? w3cTimings[navigation] : performance[navigation].type);
            }
        }
        // NOTE: Any changes to the following part of the string 'DATA={"pp":{' should be communicated to lsdmft because
        //       they could break some features dependent on PP.
        var payLoad = '{"pp":{"S":"' + (state || 'L') + '",' + ppMetrics.join(',') + ',"CT":' + (currentTime - _G.ST) + ',"IL":' + _d.images.length + '}' + (_G.C1 ? ',' + _G.C1 : '') + (w3cPayload !== null ? w3cPayload : '') + '}';
        if (_w['Log2']) {
            Log2.LogEvent("CPT", JSON.parse(payLoad), null, null, null, null, null, null);
        } else {
            _G.PPImg = new Image();
            _G.PPImg.src = _G.lsUrl + '&Type=Event.CPT&DATA=' + payLoad + (_G.P ? '&P=' + _G.P : '');
        }
        _G.PPS = 1; // flag set if perfping has fired
        sb_st(function() {
            sj_evt.fire('onPP');
            sj_evt.fire(_w.p1);
        }, 1);
    };
    // Bind onbefore unload so we can capture the cases of people leaving the page before
    // it has loaded (called the abandon state, denoted as 'A').
    // Note that onbeforeunload is bound to directly because this should be just about the very first script executing on the page,
    // so we don't have to worry about tromping on an existing event handler.
    _w.onbeforeunload = function() {
        si_PP(new Date, 'A');
    };; ///<reference path="..\..\..\answers\services\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    (function(perfping) {
        if (document.querySelector) {
            var logText = [];
            var customField = "ad";

            function run() {
                var start = sb_gt();
                var de = document.documentElement;
                var body = document.body;
                var adsHeight = -1;
                var adsTop = -1;
                var fold = de.clientHeight;
                var selectors = ["#b_results .b_ad", ".sb_adsWv2", ".ads"];
                // Do not attempt to log anything if body itself is missing
                if (!body)
                    return;
                for (var i = 0; i < selectors.length; i++) {
                    var selector = selectors[i];
                    var ads = document.querySelector(selector);
                    if (ads && ads.offsetTop < fold) {
                        adsHeight = ads.offsetHeight;
                        adsTop = ads.offsetTop;
                        break;
                    }
                }
                // Data in following order: Ads Top, Ads Height, Viewport Width, Viewport Height, Page Width, Page Height, Cost
                logText = [adsTop, adsHeight, de.clientWidth, fold, body.offsetWidth, body.offsetHeight, sb_gt() - start];
            }
            // Adding payload to perf-ping
            if (perfping) {
                var fn = perfping.onbeforefire;
                perfping.onbeforefire = function() {
                    if (fn)
                        fn();
                    run();
                    perfping.mark(customField, logText);
                };
            } else {
                var fn = si_PP;
                si_PP = function() {
                    run();
                    var customLog = '"' + customField + '":[' + logText.join() + ']';
                    _G.C1 = _G.C1 ? _G.C1 + ',' + customLog : customLog;
                    fn.apply(null, [].slice.apply(arguments));
                };
            }
        }
    })(_w["pp"]);; ///<reference path="..\..\..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
    (function(fn) {
        function extractTimestampParam(qs, key) {
            var param = '&' + key + '=';
            var pos = qs.indexOf(param);
            if (pos < 0) {
                return -1;
            }
            var offset = pos + param.length;
            var ts = qs.substr(offset);
            return parseInt(ts, 10);
        }
        _w.si_PP = function(currentTime, state) {
            var t = _w.performance && _w.performance.timing;
            if (t) {
                var data = '"NS":"' + t.navigationStart + '"';
                var location = window.location;
                var qs = window.location && location.search;
                if (qs) {
                    var st = extractTimestampParam(qs, "sbts");
                    if (!st || st < 0) {
                        var nclidts = extractTimestampParam(qs, "nclidts");
                        var tsms = extractTimestampParam(qs, "tsms");
                        if (nclidts > 0 && tsms >= 0) {
                            st = (nclidts * 1000) + tsms;
                        }
                    }
                    if (st > 0) {
                        data += ',"E2E_PLT":"' + (t.loadEventEnd - st) + '"';
                        // 
                        // Attempt to remove the timestamp parameters from the URL for the following reasons:
                        // (1) User refreshes the page 
                        // (2) Navigates forward and then uses the back button
                        // (3) User adds the page as a bookmark
                        // 
                        // In these cases the timestamps from the first impression are used in the E2E PLT calculation as well as the
                        // browser launch time calculation which yields unusable times. There is currently no way to properly sanitize
                        // all instances of these values. It also decreases perf coverage for those affected impressions.
                        if (window.history && history.replaceState) {
                            var historyUrl = location.href.replace(/(&(sbts|nclidts|tsms)=\d+)/g, "");
                            if (historyUrl !== location.href) {
                                history.replaceState(null, null, historyUrl);
                            }
                        }
                    }
                }
                _G.C1 = _G.C1 ? _G.C1 + ',' + data : data;
            }
            if (fn) {
                fn(currentTime, state);
            }
        };
    })(_w.si_PP);; // BoxModel Rules
    // Format: [x, y, includeChildren]
    // E.g. "#b_tween": [100, 140, 1] ==>
    //          Look for #b_tween and validate that it's (x,y) matches (100,140)
    //          And, since third parameter is 1, also grab coordinates for all children elements
    // Value of -1 for x or y coordinate indicates wildcard, i.e., no validation on that particular coordinate
    var BM = BM || {};
    BM.rules = {
        ".b_scopebar": [-1, -1, 0],
        ".b_scopebar ul": [-1, -1, 1],
        "#b_results": [-1, -1, 1],
        ".b_hList": [-1, -1, 1],
        ".b_flex": [-1, -1, 1],
        ".b_flex span": [-1, -1, 0],
        "img,div[data-src]": [-1, -1, 0],
        "#root": [-1, -1, 1],
        ".suggestion": [-1, -1, 0],
        "#topResult": [-1, -1, 0],
        ".groupHeader": [-1, -1, 0]
    };;
    var BM = BM || {};
    (function(BM) {
        var items = {};
        var unloads = {};
        var computes = {};

        function wireup(moduleID, q) {
            if (!(moduleID in items))
                items[moduleID] = [];
            if (q.compute && !(moduleID in computes))
                computes[moduleID] = q.compute;
            if (q.unload && !(moduleID in unloads))
                unloads[moduleID] = q.unload;
            if (q.load)
                q.load();
        }

        function enqueue(moduleID, item) {
            items[moduleID].push({
                t: getElapsedTime(),
                i: item
            });
        }

        function dequeue(moduleID) {
            if (moduleID in unloads)
                unloads[moduleID]();
            if (moduleID in items)
                return items[moduleID];
        }

        function trigger() {
            for (var moduleID in computes) {
                computes[moduleID]();
            }
        }

        function getElapsedTime() {
            return window.performance && performance.now ? Math.round(performance.now()) : (new Date()) - window["si_ST"];
        }
        BM.wireup = wireup;
        BM.enqueue = enqueue;
        BM.dequeue = dequeue;
        BM.trigger = trigger;
    })(BM);; ///<reference path="..\queue.ts"/>
    (function(BM) {
        var moduleID = "V";
        // Viewport computation
        function compute() {
            var de = document.documentElement;
            var body = document.body;
            var screenWidth = "innerWidth" in window ? window.innerWidth : de.clientWidth;
            var screenHeight = "innerHeight" in window ? window.innerHeight : de.clientHeight;
            var screenLeft = window["pageXOffset"] || de.scrollLeft;
            var screenTop = window["pageYOffset"] || de.scrollTop;
            var state = document["visibilityState"] || "default";
            BM.enqueue(moduleID, {
                x: screenLeft,
                y: screenTop,
                w: screenWidth,
                h: screenHeight,
                dw: body.clientWidth,
                dh: body.clientHeight,
                v: state
            });
        }
        // Initialize queue
        BM.wireup(moduleID, {
            load: null,
            compute: compute,
            unload: null
        });
    })(BM);; ///<reference path="..\queue.ts"/>
    (function(BM) {
        var moduleID = "L";
        // Viewport computation
        function compute() {
            // Bail out if querySelector API doesn't exist
            // Eventually, post page load, we will log the error via core framework
            if (!document.querySelector || !document.querySelectorAll) {
                return;
            }
            var nodes = [];
            var rules = BM.rules;
            for (var selector in rules) {
                var rule = rules[selector];
                selector += !!rule[2] ? " >*" : "";
                var elements = document.querySelectorAll(selector);
                for (var e = 0; e < elements.length; e++) {
                    var el = elements[e];
                    var x = 0,
                        y = 0,
                        w = el.offsetWidth,
                        h = el.offsetHeight;
                    do {
                        x += el.offsetLeft;
                        y += el.offsetTop;
                    } while (el = el.offsetParent);
                    nodes.push({
                        _e: elements[e],
                        x: x,
                        y: y,
                        w: w,
                        h: h
                    });
                }
            }
            BM.enqueue(moduleID, nodes);
        }
        // Initialize queue
        BM.wireup(moduleID, {
            load: null,
            compute: compute,
            unload: null
        });
    })(BM);; ///<reference path="..\queue.ts"/>
    (function(BM) {
        var moduleID = "EVT";
        // Storing events for later reference
        var events = ["click", "mousedown", "mouseup", "touchstart", "touchend", "mousemove", "touchmove", "scroll", "keydown", "resize"];

        function load() {
            eventManager(sj_be, enqueue);
        }

        function enqueue(evt) {
            // Do not attempt to queue if evt is not natively supported by the browser
            // In older versions of IE, it's possible to lookup _w.event synchronously 
            // but it doesn't work when you try to queue the reference and use it later
            // As per stackoverflow: http://stackoverflow.com/questions/3531751/member-not-found-ie-error-ie-6-7-8-9
            // As a possible future work item, it's possible to get around this by making a copy in another variable for IE8 & IE9
            if (evt) {
                BM.enqueue(moduleID, evt);
            }
            return true;
        }

        function unload() {
            eventManager(sj_ue, enqueue);
        }

        function eventManager(api, handler) {
            for (var i = 0; i < events.length; i++) {
                var evt = events[i];
                api(evt === "resize" ? window : document, window.navigator.pointerEnabled ? evt.replace("mouse", "pointer") : evt, handler, false);
            }
        }
        // Initialize queue with a callback to teardown event bindings later
        BM.wireup(moduleID, {
            load: load,
            compute: null,
            unload: unload
        });
    })(BM);;
    _TC = {
        SP: "search,images,images\/search,videos\/search,local,local\/fetchlocalpivot,local\/fetchlocalelv,news,news\/search,devicecontent,people411,meetingprep,tasklineth\/search,stores,profile\/interests\/v2,account\/permissions,cabs\/search,cabs\/searchasync,cabs\/book,cabs\/driver,cabs\/driverupdate,events\/search,showtimesth,showmoremoviesth,themebasedlocalrecommendation\/search,transitline,transitstop,morescholarinfo\/search,financemywatchlist\/search,trainschedule,billpay,nearbyshowmore\/search,skywalk\/seemore,UserDataDictionary\/search,cortanalocal\/placesearch,\/interesttracking,\/interesttracking\/packagetracking,\/entityexplore",
        BP: "videos\/search?view=detail",
        NW: false
    };;
    //]]>
    </script>
</head>

<body onload="if(_w.lb)lb();">
    <header id="b_header">
        <nav aria-label="navigation" class="b_scopebar" role="navigation" data-tag="">
            <ul>
                <li class="b_active"><a href="/search?q=play+lady+gaga+poker+face&amp;FORM=HDRSC1" h="ID=SERP,5019.1">Web</a></li>
                <li><a href="/images/search?q=play+lady+gaga+poker+face&amp;FORM=HDRSC2" h="ID=SERP,5020.1">Images</a></li>
                <li><a href="/videos/search?q=play+lady+gaga+poker+face&amp;FORM=HDRSC3" h="ID=SERP,5021.1">Videos</a></li>
                <li><a href="/news/search?q=play+lady+gaga+poker+face&amp;FORM=HDRSC4" h="ID=SERP,5022.1">News</a></li>
            </ul>
        </nav>
    </header>
    <script type="text/javascript">
    //<![CDATA[
    /***********************************************************
     * winjs-promise.js start
     **********************************************************/
    var globalHolder = {
        WinJS: {
            Namespace: {}
        }
    };

    /***********************************************************
     * base.js
     **********************************************************/
    (function baseInit(global, undefined) {
        "use strict";

        function initializeProperties(target, members, prefix) {
            var keys = Object.keys(members);
            var properties;
            var i, len;
            for (i = 0, len = keys.length; i < len; i++) {
                var key = keys[i];
                var enumerable = key.charCodeAt(0) !== /*_*/ 95;
                var member = members[key];
                if (member && typeof member === 'object') {
                    if (member.value !== undefined || typeof member.get === 'function' || typeof member.set === 'function') {
                        if (member.enumerable === undefined) {
                            member.enumerable = enumerable;
                        }
                        if (prefix && member.setName && typeof member.setName === 'function') {
                            member.setName(prefix + "." + key)
                        }
                        properties = properties || {};
                        properties[key] = member;
                        continue;
                    }
                }
                if (!enumerable) {
                    properties = properties || {};
                    properties[key] = {
                        value: member,
                        enumerable: enumerable,
                        configurable: true,
                        writable: true
                    }
                    continue;
                }
                target[key] = member;
            }
            if (properties) {
                Object.defineProperties(target, properties);
            }
        }

        (function(rootNamespace) {

            // Create the rootNamespace in the global namespace
            if (!global[rootNamespace]) {
                global[rootNamespace] = Object.create(Object.prototype);
            }

            // Cache the rootNamespace we just created in a local variable
            var _rootNamespace = global[rootNamespace];
            if (!_rootNamespace.Namespace) {
                _rootNamespace.Namespace = Object.create(Object.prototype);
            }

            function defineWithParent(parentNamespace, name, members) {
                /// <signature helpKeyword="WinJS.Namespace.defineWithParent">
                /// <summary locid="WinJS.Namespace.defineWithParent">
                /// Defines a new namespace with the specified name under the specified parent namespace.
                /// </summary>
                /// <param name="parentNamespace" type="Object" locid="WinJS.Namespace.defineWithParent_p:parentNamespace">
                /// The parent namespace.
                /// </param>
                /// <param name="name" type="String" locid="WinJS.Namespace.defineWithParent_p:name">
                /// The name of the new namespace.
                /// </param>
                /// <param name="members" type="Object" locid="WinJS.Namespace.defineWithParent_p:members">
                /// The members of the new namespace.
                /// </param>
                /// <returns type="Object" locid="WinJS.Namespace.defineWithParent_returnValue">
                /// The newly-defined namespace.
                /// </returns>
                /// </signature>
                var currentNamespace = parentNamespace || {};

                if (name) {
                    var namespaceFragments = name.split(".");
                    for (var i = 0, len = namespaceFragments.length; i < len; i++) {
                        var namespaceName = namespaceFragments[i];
                        if (!currentNamespace[namespaceName]) {
                            Object.defineProperty(currentNamespace, namespaceName, {
                                value: {},
                                writable: false,
                                enumerable: true,
                                configurable: true
                            });
                        }
                        currentNamespace = currentNamespace[namespaceName];
                    }
                }

                if (members) {
                    initializeProperties(currentNamespace, members, name || "<ANONYMOUS>");
                }

                return currentNamespace;
            }

            function define(name, members) {
                /// <signature helpKeyword="WinJS.Namespace.define">
                /// <summary locid="WinJS.Namespace.define">
                /// Defines a new namespace with the specified name.
                /// </summary>
                /// <param name="name" type="String" locid="WinJS.Namespace.define_p:name">
                /// The name of the namespace. This could be a dot-separated name for nested namespaces.
                /// </param>
                /// <param name="members" type="Object" locid="WinJS.Namespace.define_p:members">
                /// The members of the new namespace.
                /// </param>
                /// <returns type="Object" locid="WinJS.Namespace.define_returnValue">
                /// The newly-defined namespace.
                /// </returns>
                /// </signature>
                return defineWithParent(global, name, members);
            }

            var LazyStates = {
                uninitialized: 1,
                working: 2,
                initialized: 3,
            };

            function lazy(f) {
                if (typeof f === "string") {
                    var target = f;
                    f = function() {
                        return WinJS.Utilities.getMember(target);
                    };
                }
                var name;
                var state = LazyStates.uninitialized;
                var result;
                return {
                    setName: function(value) {
                        name = value;
                    },
                    get: function() {
                        switch (state) {
                            case LazyStates.initialized:
                                return result;

                            case LazyStates.uninitialized:
                                state = LazyStates.working;
                                try {
                                    msWriteProfilerMark("WinJS.Namespace._lazy:" + name + ",StartTM");
                                    result = f();
                                } finally {
                                    msWriteProfilerMark("WinJS.Namespace._lazy:" + name + ",StopTM");
                                    state = LazyStates.uninitialized;
                                }
                                f = null;
                                state = LazyStates.initialized;
                                return result;

                            case LazyStates.working:
                                throw "Illegal: reentrancy on initialization";

                            default:
                                throw "Illegal";
                        }
                    },
                    set: function(value) {
                        switch (state) {
                            case LazyStates.working:
                                throw "Illegal: reentrancy on initialization";

                            default:
                                state = LazyStates.initialized;
                                result = value;
                                break;
                        }
                    },
                    enumerable: true,
                    configurable: true,
                }
            }

            // Establish members of the "WinJS.Namespace" namespace
            Object.defineProperties(_rootNamespace.Namespace, {

                defineWithParent: {
                    value: defineWithParent,
                    writable: true,
                    enumerable: true,
                    configurable: true
                },

                define: {
                    value: define,
                    writable: true,
                    enumerable: true,
                    configurable: true
                },

                _lazy: {
                    value: lazy,
                    writable: true,
                    enumerable: true,
                    configurable: true
                },

            });

        })("WinJS");

        (function(WinJS) {

            function define(constructor, instanceMembers, staticMembers) {
                /// <signature helpKeyword="WinJS.Class.define">
                /// <summary locid="WinJS.Class.define">
                /// Defines a class using the given constructor and the specified instance members.
                /// </summary>
                /// <param name="constructor" type="Function" locid="WinJS.Class.define_p:constructor">
                /// A constructor function that is used to instantiate this class.
                /// </param>
                /// <param name="instanceMembers" type="Object" locid="WinJS.Class.define_p:instanceMembers">
                /// The set of instance fields, properties, and methods made available on the class.
                /// </param>
                /// <param name="staticMembers" type="Object" locid="WinJS.Class.define_p:staticMembers">
                /// The set of static fields, properties, and methods made available on the class.
                /// </param>
                /// <returns type="Function" locid="WinJS.Class.define_returnValue">
                /// The newly-defined class.
                /// </returns>
                /// </signature>
                constructor = constructor || function() {};
                WinJS.Utilities.markSupportedForProcessing(constructor);
                if (instanceMembers) {
                    initializeProperties(constructor.prototype, instanceMembers);
                }
                if (staticMembers) {
                    initializeProperties(constructor, staticMembers);
                }
                return constructor;
            }

            function derive(baseClass, constructor, instanceMembers, staticMembers) {
                /// <signature helpKeyword="WinJS.Class.derive">
                /// <summary locid="WinJS.Class.derive">
                /// Creates a sub-class based on the supplied baseClass parameter, using prototypal inheritance.
                /// </summary>
                /// <param name="baseClass" type="Function" locid="WinJS.Class.derive_p:baseClass">
                /// The class to inherit from.
                /// </param>
                /// <param name="constructor" type="Function" locid="WinJS.Class.derive_p:constructor">
                /// A constructor function that is used to instantiate this class.
                /// </param>
                /// <param name="instanceMembers" type="Object" locid="WinJS.Class.derive_p:instanceMembers">
                /// The set of instance fields, properties, and methods to be made available on the class.
                /// </param>
                /// <param name="staticMembers" type="Object" locid="WinJS.Class.derive_p:staticMembers">
                /// The set of static fields, properties, and methods to be made available on the class.
                /// </param>
                /// <returns type="Function" locid="WinJS.Class.derive_returnValue">
                /// The newly-defined class.
                /// </returns>
                /// </signature>
                if (baseClass) {
                    constructor = constructor || function() {};
                    var basePrototype = baseClass.prototype;
                    constructor.prototype = Object.create(basePrototype);
                    WinJS.Utilities.markSupportedForProcessing(constructor);
                    Object.defineProperty(constructor.prototype, "constructor", {
                        value: constructor,
                        writable: true,
                        configurable: true,
                        enumerable: true
                    });
                    if (instanceMembers) {
                        initializeProperties(constructor.prototype, instanceMembers);
                    }
                    if (staticMembers) {
                        initializeProperties(constructor, staticMembers);
                    }
                    return constructor;
                } else {
                    return define(constructor, instanceMembers, staticMembers);
                }
            }

            function mix(constructor) {
                /// <signature helpKeyword="WinJS.Class.mix">
                /// <summary locid="WinJS.Class.mix">
                /// Defines a class using the given constructor and the union of the set of instance members
                /// specified by all the mixin objects. The mixin parameter list is of variable length.
                /// </summary>
                /// <param name="constructor" locid="WinJS.Class.mix_p:constructor">
                /// A constructor function that is used to instantiate this class.
                /// </param>
                /// <returns type="Function" locid="WinJS.Class.mix_returnValue">
                /// The newly-defined class.
                /// </returns>
                /// </signature>
                constructor = constructor || function() {};
                var i, len;
                for (i = 1, len = arguments.length; i < len; i++) {
                    initializeProperties(constructor.prototype, arguments[i]);
                }
                return constructor;
            }

            // Establish members of "WinJS.Class" namespace
            WinJS.Namespace.define("WinJS.Class", {
                define: define,
                derive: derive,
                mix: mix
            });

        })(WinJS);

    })(this);

    /***********************************************************
     * baseUtils.js
     **********************************************************/
    (function baseUtilsInit(global, WinJS) {
        "use strict";

        var hasWinRT = !!global.Windows;

        var strings = {
            get notSupportedForProcessing() {
                return WinJS.Resources._getWinJSString("base/notSupportedForProcessing").value;
            }
        };

        function nop(v) {
            return v;
        }

        function getMemberFiltered(name, root, filter) {
            return name.split(".").reduce(function(currentNamespace, name) {
                if (currentNamespace) {
                    return filter(currentNamespace[name]);
                }
                return null;
            }, root);
        }

        // Establish members of "WinJS.Utilities" namespace
        WinJS.Namespace.define("WinJS.Utilities", {
            // Used for mocking in tests
            _setHasWinRT: {
                value: function(value) {
                    hasWinRT = value;
                },
                configurable: false,
                writable: false,
                enumerable: false
            },

            /// <field type="Boolean" locid="WinJS.Utilities.hasWinRT" helpKeyword="WinJS.Utilities.hasWinRT">Determine if WinRT is accessible in this script context.</field>
            hasWinRT: {
                get: function() {
                    return hasWinRT;
                },
                configurable: false,
                enumerable: true
            },

            _getMemberFiltered: getMemberFiltered,

            getMember: function(name, root) {
                /// <signature helpKeyword="WinJS.Utilities.getMember">
                /// <summary locid="WinJS.Utilities.getMember">
                /// Gets the leaf-level type or namespace specified by the name parameter.
                /// </summary>
                /// <param name="name" locid="WinJS.Utilities.getMember_p:name">
                /// The name of the member.
                /// </param>
                /// <param name="root" locid="WinJS.Utilities.getMember_p:root">
                /// The root to start in. Defaults to the global object.
                /// </param>
                /// <returns type="Object" locid="WinJS.Utilities.getMember_returnValue">
                /// The leaf-level type or namespace in the specified parent namespace.
                /// </returns>
                /// </signature>
                if (!name) {
                    return null;
                }
                return getMemberFiltered(name, root || global, nop);
            },

            ready: function(callback, async) {
                /// <signature helpKeyword="WinJS.Utilities.ready">
                /// <summary locid="WinJS.Utilities.ready">
                /// Ensures that the specified function executes only after the DOMContentLoaded event has fired
                /// for the current page.
                /// </summary>
                /// <returns type="WinJS.Promise" locid="WinJS.Utilities.ready_returnValue">A promise that completes after DOMContentLoaded has occurred.</returns>
                /// <param name="callback" optional="true" locid="WinJS.Utilities.ready_p:callback">
                /// A function that executes after DOMContentLoaded has occurred.
                /// </param>
                /// <param name="async" optional="true" locid="WinJS.Utilities.ready_p:async">
                /// If true, the callback is executed asynchronously.
                /// </param>
                /// </signature>
                return new WinJS.Promise(function(c, e) {
                    function complete() {
                        if (callback) {
                            try {
                                callback();
                                c();
                            } catch (err) {
                                e(err);
                            }
                        } else {
                            c();
                        }
                    }

                    var readyState = WinJS.Utilities.testReadyState;
                    if (!readyState) {
                        if (global.document) {
                            readyState = document.readyState;
                        } else {
                            readyState = "complete";
                        }
                    }
                    if (readyState === "complete" || (global.document && document.body !== null)) {
                        if (async) {
                            WinJS.Utilities.Scheduler.schedule(function() {
                                complete();
                            }, WinJS.Utilities.Scheduler.Priority.normal, null, "WinJS.Utilities.ready");
                        } else {
                            complete();
                        }
                    } else {
                        global.addEventListener("DOMContentLoaded", complete, false);
                    }
                });
            },

            /// <field type="Boolean" locid="WinJS.Utilities.strictProcessing" helpKeyword="WinJS.Utilities.strictProcessing">Determines if strict declarative processing is enabled in this script context.</field>
            strictProcessing: {
                get: function() {
                    return true;
                },
                configurable: false,
                enumerable: true,
            },

            markSupportedForProcessing: {
                value: function(func) {
                    /// <signature helpKeyword="WinJS.Utilities.markSupportedForProcessing">
                    /// <summary locid="WinJS.Utilities.markSupportedForProcessing">
                    /// Marks a function as being compatible with declarative processing, such as WinJS.UI.processAll
                    /// or WinJS.Binding.processAll.
                    /// </summary>
                    /// <param name="func" type="Function" locid="WinJS.Utilities.markSupportedForProcessing_p:func">
                    /// The function to be marked as compatible with declarative processing.
                    /// </param>
                    /// <returns type="Function" locid="WinJS.Utilities.markSupportedForProcessing_returnValue">
                    /// The input function.
                    /// </returns>
                    /// </signature>
                    func.supportedForProcessing = true;
                    return func;
                },
                configurable: false,
                writable: false,
                enumerable: true
            },

            requireSupportedForProcessing: {
                value: function(value) {
                    /// <signature helpKeyword="WinJS.Utilities.requireSupportedForProcessing">
                    /// <summary locid="WinJS.Utilities.requireSupportedForProcessing">
                    /// Asserts that the value is compatible with declarative processing, such as WinJS.UI.processAll
                    /// or WinJS.Binding.processAll. If it is not compatible an exception will be thrown.
                    /// </summary>
                    /// <param name="value" type="Object" locid="WinJS.Utilities.requireSupportedForProcessing_p:value">
                    /// The value to be tested for compatibility with declarative processing. If the
                    /// value is a function it must be marked with a property 'supportedForProcessing'
                    /// with a value of true.
                    /// </param>
                    /// <returns type="Object" locid="WinJS.Utilities.requireSupportedForProcessing_returnValue">
                    /// The input value.
                    /// </returns>
                    /// </signature>
                    var supportedForProcessing = true;

                    supportedForProcessing = supportedForProcessing && !(value === global);
                    supportedForProcessing = supportedForProcessing && !(value === global.location);
                    supportedForProcessing = supportedForProcessing && !(value instanceof HTMLIFrameElement);
                    supportedForProcessing = supportedForProcessing && !(typeof value === "function" && !value.supportedForProcessing);

                    switch (global.frames.length) {
                        case 0:
                            break;

                        case 1:
                            supportedForProcessing = supportedForProcessing && !(value === global.frames[0]);
                            break;

                        default:
                            for (var i = 0, len = global.frames.length; supportedForProcessing && i < len; i++) {
                                supportedForProcessing = supportedForProcessing && !(value === global.frames[i]);
                            }
                            break;
                    }

                    if (supportedForProcessing) {
                        return value;
                    }

                    throw new WinJS.ErrorFromName("WinJS.Utilities.requireSupportedForProcessing", WinJS.Resources._formatString(strings.notSupportedForProcessing, value));
                },
                configurable: false,
                writable: false,
                enumerable: true
            },

            _shallowCopy: function _shallowCopy(a) {
                // Shallow copy a single object.
                return this._mergeAll([a]);
            },

            _merge: function _merge(a, b) {
                // Merge 2 objects together into a new object
                return this._mergeAll([a, b]);
            },

            _mergeAll: function _mergeAll(list) {
                // Merge a list of objects together
                var o = {};
                list.forEach(function(part) {
                    Object.keys(part).forEach(function(k) {
                        o[k] = part[k];
                    });
                });
                return o;
            },

            _getProfilerMarkIdentifier: function(element) {
                var profilerMarkIdentifier = "";
                if (element.id) {
                    profilerMarkIdentifier += " id='" + element.id + "'";
                }
                if (element.className) {
                    profilerMarkIdentifier += " class='" + element.className + "'";
                }
                return profilerMarkIdentifier;
            }
        });

        WinJS.Namespace.define("WinJS", {
            validation: false,

            strictProcessing: {
                value: function() {
                    /// <signature helpKeyword="WinJS.strictProcessing">
                    /// <summary locid="WinJS.strictProcessing">
                    /// Strict processing is always enforced, this method has no effect.
                    /// </summary>
                    /// </signature>
                },
                configurable: false,
                writable: false,
                enumerable: false
            },
        });
    })(this, WinJS);

    /***********************************************************
     * errors.js
     **********************************************************/
    (function errorsInit(global, WinJS) {
        "use strict";


        WinJS.Namespace.define("WinJS", {
            // ErrorFromName establishes a simple pattern for returning error codes.
            //
            ErrorFromName: WinJS.Class.derive(Error, function(name, message) {
                /// <signature helpKeyword="WinJS.ErrorFromName">
                /// <summary locid="WinJS.ErrorFromName">
                /// Creates an Error object with the specified name and message properties.
                /// </summary>
                /// <param name="name" type="String" locid="WinJS.ErrorFromName_p:name">The name of this error. The name is meant to be consumed programmatically and should not be localized.</param>
                /// <param name="message" type="String" optional="true" locid="WinJS.ErrorFromName_p:message">The message for this error. The message is meant to be consumed by humans and should be localized.</param>
                /// <returns type="Error" locid="WinJS.ErrorFromName_returnValue">Error instance with .name and .message properties populated</returns>
                /// </signature>
                this.name = name;
                this.message = message || name;
            }, {
                /* empty */
            }, {
                supportedForProcessing: false,
            })
        });

    })(this, WinJS);



    /***********************************************************
     * events.js
     **********************************************************/
    (function eventsInit(WinJS, undefined) {
        "use strict";


        function createEventProperty(name) {
            var eventPropStateName = "_on" + name + "state";

            return {
                get: function() {
                    var state = this[eventPropStateName];
                    return state && state.userHandler;
                },
                set: function(handler) {
                    var state = this[eventPropStateName];
                    if (handler) {
                        if (!state) {
                            state = {
                                wrapper: function(evt) {
                                    return state.userHandler(evt);
                                },
                                userHandler: handler
                            };
                            Object.defineProperty(this, eventPropStateName, {
                                value: state,
                                enumerable: false,
                                writable: true,
                                configurable: true
                            });
                            this.addEventListener(name, state.wrapper, false);
                        }
                        state.userHandler = handler;
                    } else if (state) {
                        this.removeEventListener(name, state.wrapper, false);
                        this[eventPropStateName] = null;
                    }
                },
                enumerable: true
            }
        }

        function createEventProperties(events) {
            /// <signature helpKeyword="WinJS.Utilities.createEventProperties">
            /// <summary locid="WinJS.Utilities.createEventProperties">
            /// Creates an object that has one property for each name passed to the function.
            /// </summary>
            /// <param name="events" locid="WinJS.Utilities.createEventProperties_p:events">
            /// A variable list of property names.
            /// </param>
            /// <returns type="Object" locid="WinJS.Utilities.createEventProperties_returnValue">
            /// The object with the specified properties. The names of the properties are prefixed with 'on'.
            /// </returns>
            /// </signature>
            var props = {};
            for (var i = 0, len = arguments.length; i < len; i++) {
                var name = arguments[i];
                props["on" + name] = createEventProperty(name);
            }
            return props;
        }

        var EventMixinEvent = WinJS.Class.define(
            function EventMixinEvent_ctor(type, detail, target) {
                this.detail = detail;
                this.target = target;
                this.timeStamp = Date.now();
                this.type = type;
            }, {
                bubbles: {
                    value: false,
                    writable: false
                },
                cancelable: {
                    value: false,
                    writable: false
                },
                currentTarget: {
                    get: function() {
                        return this.target;
                    }
                },
                defaultPrevented: {
                    get: function() {
                        return this._preventDefaultCalled;
                    }
                },
                trusted: {
                    value: false,
                    writable: false
                },
                eventPhase: {
                    value: 0,
                    writable: false
                },
                target: null,
                timeStamp: null,
                type: null,

                preventDefault: function() {
                    this._preventDefaultCalled = true;
                },
                stopImmediatePropagation: function() {
                    this._stopImmediatePropagationCalled = true;
                },
                stopPropagation: function() {}
            }, {
                supportedForProcessing: false,
            }
        );

        var eventMixin = {
            _listeners: null,

            addEventListener: function(type, listener, useCapture) {
                /// <signature helpKeyword="WinJS.Utilities.eventMixin.addEventListener">
                /// <summary locid="WinJS.Utilities.eventMixin.addEventListener">
                /// Adds an event listener to the control.
                /// </summary>
                /// <param name="type" locid="WinJS.Utilities.eventMixin.addEventListener_p:type">
                /// The type (name) of the event.
                /// </param>
                /// <param name="listener" locid="WinJS.Utilities.eventMixin.addEventListener_p:listener">
                /// The listener to invoke when the event is raised.
                /// </param>
                /// <param name="useCapture" locid="WinJS.Utilities.eventMixin.addEventListener_p:useCapture">
                /// if true initiates capture, otherwise false.
                /// </param>
                /// </signature>
                useCapture = useCapture || false;
                this._listeners = this._listeners || {};
                var eventListeners = (this._listeners[type] = this._listeners[type] || []);
                for (var i = 0, len = eventListeners.length; i < len; i++) {
                    var l = eventListeners[i];
                    if (l.useCapture === useCapture && l.listener === listener) {
                        return;
                    }
                }
                eventListeners.push({
                    listener: listener,
                    useCapture: useCapture
                });
            },
            dispatchEvent: function(type, details) {
                /// <signature helpKeyword="WinJS.Utilities.eventMixin.dispatchEvent">
                /// <summary locid="WinJS.Utilities.eventMixin.dispatchEvent">
                /// Raises an event of the specified type and with the specified additional properties.
                /// </summary>
                /// <param name="type" locid="WinJS.Utilities.eventMixin.dispatchEvent_p:type">
                /// The type (name) of the event.
                /// </param>
                /// <param name="details" locid="WinJS.Utilities.eventMixin.dispatchEvent_p:details">
                /// The set of additional properties to be attached to the event object when the event is raised.
                /// </param>
                /// <returns type="Boolean" locid="WinJS.Utilities.eventMixin.dispatchEvent_returnValue">
                /// true if preventDefault was called on the event.
                /// </returns>
                /// </signature>
                var listeners = this._listeners && this._listeners[type];
                if (listeners) {
                    var eventValue = new EventMixinEvent(type, details, this);
                    // Need to copy the array to protect against people unregistering while we are dispatching
                    listeners = listeners.slice(0, listeners.length);
                    for (var i = 0, len = listeners.length; i < len && !eventValue._stopImmediatePropagationCalled; i++) {
                        listeners[i].listener(eventValue);
                    }
                    return eventValue.defaultPrevented || false;
                }
                return false;
            },
            removeEventListener: function(type, listener, useCapture) {
                /// <signature helpKeyword="WinJS.Utilities.eventMixin.removeEventListener">
                /// <summary locid="WinJS.Utilities.eventMixin.removeEventListener">
                /// Removes an event listener from the control.
                /// </summary>
                /// <param name="type" locid="WinJS.Utilities.eventMixin.removeEventListener_p:type">
                /// The type (name) of the event.
                /// </param>
                /// <param name="listener" locid="WinJS.Utilities.eventMixin.removeEventListener_p:listener">
                /// The listener to remove.
                /// </param>
                /// <param name="useCapture" locid="WinJS.Utilities.eventMixin.removeEventListener_p:useCapture">
                /// Specifies whether to initiate capture.
                /// </param>
                /// </signature>
                useCapture = useCapture || false;
                var listeners = this._listeners && this._listeners[type];
                if (listeners) {
                    for (var i = 0, len = listeners.length; i < len; i++) {
                        var l = listeners[i];
                        if (l.listener === listener && l.useCapture === useCapture) {
                            listeners.splice(i, 1);
                            if (listeners.length === 0) {
                                delete this._listeners[type];
                            }
                            // Only want to remove one element for each call to removeEventListener
                            break;
                        }
                    }
                }
            }
        };

        WinJS.Namespace.define("WinJS.Utilities", {
            _createEventProperty: createEventProperty,
            createEventProperties: createEventProperties,
            eventMixin: eventMixin
        });

    })(WinJS);

    /***********************************************************
     * promise.js
     **********************************************************/
    (function promiseInit(global, undefined) {
        "use strict";

        var ListenerType = WinJS.Class.mix(WinJS.Class.define(null, { /*empty*/ }, {
            supportedForProcessing: false
        }), WinJS.Utilities.eventMixin);
        var promiseEventListeners = new ListenerType();
        // make sure there is a listeners collection so that we can do a more trivial check below
        promiseEventListeners._listeners = {};
        var errorET = "error";
        var canceledName = "Canceled";
        var tagWithStack = false;
        var tag = {
            promise: 0x01,
            thenPromise: 0x02,
            errorPromise: 0x04,
            exceptionPromise: 0x08,
            completePromise: 0x10,
        };
        tag.all = tag.promise | tag.thenPromise | tag.errorPromise | tag.exceptionPromise | tag.completePromise;

        //
        // Global error counter, for each error which enters the system we increment this once and then
        // the error number travels with the error as it traverses the tree of potential handlers.
        //
        // When someone has registered to be told about errors (WinJS.Promise.callonerror) promises
        // which are in error will get tagged with a ._errorId field. This tagged field is the
        // contract by which nested promises with errors will be identified as chaining for the
        // purposes of the callonerror semantics. If a nested promise in error is encountered without
        // a ._errorId it will be assumed to be foreign and treated as an interop boundary and
        // a new error id will be minted.
        //
        var error_number = 1;

        //
        // The state machine has a interesting hiccup in it with regards to notification, in order
        // to flatten out notification and avoid recursion for synchronous completion we have an
        // explicit set of *_notify states which are responsible for notifying their entire tree
        // of children. They can do this because they know that immediate children are always
        // ThenPromise instances and we can therefore reach into their state to access the
        // _listeners collection.
        //
        // So, what happens is that a Promise will be fulfilled through the _completed or _error
        // messages at which point it will enter a *_notify state and be responsible for to move
        // its children into an (as appropriate) success or error state and also notify that child's
        // listeners of the state transition, until leaf notes are reached.
        //

        var state_created, // -> working
            state_working, // -> error | error_notify | success | success_notify | canceled | waiting
            state_waiting, // -> error | error_notify | success | success_notify | waiting_canceled
            state_waiting_canceled, // -> error | error_notify | success | success_notify | canceling
            state_canceled, // -> error | error_notify | success | success_notify | canceling
            state_canceling, // -> error_notify
            state_success_notify, // -> success
            state_success, // -> .
            state_error_notify, // -> error
            state_error; // -> .

        // Noop function, used in the various states to indicate that they don't support a given
        // message. Named with the somewhat cute name '_' because it reads really well in the states.

        function _() {}

        // Initial state
        //
        state_created = {
            name: "created",
            enter: function(promise) {
                promise._setState(state_working);
            },
            cancel: _,
            done: _,
            then: _,
            _completed: _,
            _error: _,
            _notify: _,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        // Ready state, waiting for a message (completed/error/progress), able to be canceled
        //
        state_working = {
            name: "working",
            enter: _,
            cancel: function(promise) {
                promise._setState(state_canceled);
            },
            done: done,
            then: then,
            _completed: completed,
            _error: error,
            _notify: _,
            _progress: progress,
            _setCompleteValue: setCompleteValue,
            _setErrorValue: setErrorValue
        };

        // Waiting state, if a promise is completed with a value which is itself a promise
        // (has a then() method) it signs up to be informed when that child promise is
        // fulfilled at which point it will be fulfilled with that value.
        //
        state_waiting = {
            name: "waiting",
            enter: function(promise) {
                var waitedUpon = promise._value;
                // We can special case our own intermediate promises which are not in a 
                //  terminal state by just pushing this promise as a listener without 
                //  having to create new indirection functions
                if (waitedUpon instanceof ThenPromise &&
                    waitedUpon._state !== state_error &&
                    waitedUpon._state !== state_success) {
                    pushListener(waitedUpon, {
                        promise: promise
                    });
                } else {
                    var error = function(value) {
                        if (waitedUpon._errorId) {
                            promise._chainedError(value, waitedUpon);
                        } else {
                            // Because this is an interop boundary we want to indicate that this 
                            //  error has been handled by the promise infrastructure before we
                            //  begin a new handling chain.
                            //
                            callonerror(promise, value, detailsForHandledError, waitedUpon, error);
                            promise._error(value);
                        }
                    };
                    error.handlesOnError = true;
                    waitedUpon.then(
                        promise._completed.bind(promise),
                        error,
                        promise._progress.bind(promise)
                    );
                }
            },
            cancel: function(promise) {
                promise._setState(state_waiting_canceled);
            },
            done: done,
            then: then,
            _completed: completed,
            _error: error,
            _notify: _,
            _progress: progress,
            _setCompleteValue: setCompleteValue,
            _setErrorValue: setErrorValue
        };

        // Waiting canceled state, when a promise has been in a waiting state and receives a
        // request to cancel its pending work it will forward that request to the child promise
        // and then waits to be informed of the result. This promise moves itself into the
        // canceling state but understands that the child promise may instead push it to a
        // different state.
        //
        state_waiting_canceled = {
            name: "waiting_canceled",
            enter: function(promise) {
                // Initiate a transition to canceling. Triggering a cancel on the promise
                // that we are waiting upon may result in a different state transition
                // before the state machine pump runs again.
                promise._setState(state_canceling);
                var waitedUpon = promise._value;
                if (waitedUpon.cancel) {
                    waitedUpon.cancel();
                }
            },
            cancel: _,
            done: done,
            then: then,
            _completed: completed,
            _error: error,
            _notify: _,
            _progress: progress,
            _setCompleteValue: setCompleteValue,
            _setErrorValue: setErrorValue
        };

        // Canceled state, moves to the canceling state and then tells the promise to do
        // whatever it might need to do on cancelation.
        //
        state_canceled = {
            name: "canceled",
            enter: function(promise) {
                // Initiate a transition to canceling. The _cancelAction may change the state
                // before the state machine pump runs again.
                promise._setState(state_canceling);
                promise._cancelAction();
            },
            cancel: _,
            done: done,
            then: then,
            _completed: completed,
            _error: error,
            _notify: _,
            _progress: progress,
            _setCompleteValue: setCompleteValue,
            _setErrorValue: setErrorValue
        };

        // Canceling state, commits to the promise moving to an error state with an error
        // object whose 'name' and 'message' properties contain the string "Canceled"
        //
        state_canceling = {
            name: "canceling",
            enter: function(promise) {
                var error = new Error(canceledName);
                error.name = error.message;
                promise._value = error;
                promise._setState(state_error_notify);
            },
            cancel: _,
            done: _,
            then: _,
            _completed: _,
            _error: _,
            _notify: _,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        // Success notify state, moves a promise to the success state and notifies all children
        //
        state_success_notify = {
            name: "complete_notify",
            enter: function(promise) {
                promise.done = CompletePromise.prototype.done;
                promise.then = CompletePromise.prototype.then;
                if (promise._listeners) {
                    var queue = [promise];
                    var p;
                    while (queue.length) {
                        p = queue.shift();
                        p._state._notify(p, queue);
                    }
                }
                promise._setState(state_success);
            },
            cancel: _,
            done: null,
            /*error to get here */
            then: null,
            /*error to get here */
            _completed: _,
            _error: _,
            _notify: notifySuccess,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        // Success state, moves a promise to the success state and does NOT notify any children.
        // Some upstream promise is owning the notification pass.
        //
        state_success = {
            name: "success",
            enter: function(promise) {
                promise.done = CompletePromise.prototype.done;
                promise.then = CompletePromise.prototype.then;
                promise._cleanupAction();
            },
            cancel: _,
            done: null,
            /*error to get here */
            then: null,
            /*error to get here */
            _completed: _,
            _error: _,
            _notify: notifySuccess,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        // Error notify state, moves a promise to the error state and notifies all children
        //
        state_error_notify = {
            name: "error_notify",
            enter: function(promise) {
                promise.done = ErrorPromise.prototype.done;
                promise.then = ErrorPromise.prototype.then;
                if (promise._listeners) {
                    var queue = [promise];
                    var p;
                    while (queue.length) {
                        p = queue.shift();
                        p._state._notify(p, queue);
                    }
                }
                promise._setState(state_error);
            },
            cancel: _,
            done: null,
            /*error to get here*/
            then: null,
            /*error to get here*/
            _completed: _,
            _error: _,
            _notify: notifyError,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        // Error state, moves a promise to the error state and does NOT notify any children.
        // Some upstream promise is owning the notification pass.
        //
        state_error = {
            name: "error",
            enter: function(promise) {
                promise.done = ErrorPromise.prototype.done;
                promise.then = ErrorPromise.prototype.then;
                promise._cleanupAction();
            },
            cancel: _,
            done: null,
            /*error to get here*/
            then: null,
            /*error to get here*/
            _completed: _,
            _error: _,
            _notify: notifyError,
            _progress: _,
            _setCompleteValue: _,
            _setErrorValue: _
        };

        //
        // The statemachine implementation follows a very particular pattern, the states are specified
        // as static stateless bags of functions which are then indirected through the state machine
        // instance (a Promise). As such all of the functions on each state have the promise instance
        // passed to them explicitly as a parameter and the Promise instance members do a little
        // dance where they indirect through the state and insert themselves in the argument list.
        //
        // We could instead call directly through the promise states however then every caller
        // would have to remember to do things like pumping the state machine to catch state transitions.
        //

        var PromiseStateMachine = WinJS.Class.define(null, {
            _listeners: null,
            _nextState: null,
            _state: null,
            _value: null,

            cancel: function() {
                /// <signature helpKeyword="WinJS.PromiseStateMachine.cancel">
                /// <summary locid="WinJS.PromiseStateMachine.cancel">
                /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't
                /// already been fulfilled and cancellation is supported, the promise enters
                /// the error state with a value of Error("Canceled").
                /// </summary>
                /// </signature>
                this._state.cancel(this);
                this._run();
            },
            done: function Promise_done(onComplete, onError, onProgress) {
                /// <signature helpKeyword="WinJS.PromiseStateMachine.done">
                /// <summary locid="WinJS.PromiseStateMachine.done">
                /// Allows you to specify the work to be done on the fulfillment of the promised value,
                /// the error handling to be performed if the promise fails to fulfill
                /// a value, and the handling of progress notifications along the way.
                ///
                /// After the handlers have finished executing, this function throws any error that would have been returned
                /// from then() as a promise in the error state.
                /// </summary>
                /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.done_p:onComplete">
                /// The function to be called if the promise is fulfilled successfully with a value.
                /// The fulfilled value is passed as the single argument. If the value is null,
                /// the fulfilled value is returned. The value returned
                /// from the function becomes the fulfilled value of the promise returned by
                /// then(). If an exception is thrown while executing the function, the promise returned
                /// by then() moves into the error state.
                /// </param>
                /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onError">
                /// The function to be called if the promise is fulfilled with an error. The error
                /// is passed as the single argument. If it is null, the error is forwarded.
                /// The value returned from the function is the fulfilled value of the promise returned by then().
                /// </param>
                /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onProgress">
                /// the function to be called if the promise reports progress. Data about the progress
                /// is passed as the single argument. Promises are not required to support
                /// progress.
                /// </param>
                /// </signature>
                this._state.done(this, onComplete, onError, onProgress);
            },
            then: function Promise_then(onComplete, onError, onProgress) {
                /// <signature helpKeyword="WinJS.PromiseStateMachine.then">
                /// <summary locid="WinJS.PromiseStateMachine.then">
                /// Allows you to specify the work to be done on the fulfillment of the promised value,
                /// the error handling to be performed if the promise fails to fulfill
                /// a value, and the handling of progress notifications along the way.
                /// </summary>
                /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.then_p:onComplete">
                /// The function to be called if the promise is fulfilled successfully with a value.
                /// The value is passed as the single argument. If the value is null, the value is returned.
                /// The value returned from the function becomes the fulfilled value of the promise returned by
                /// then(). If an exception is thrown while this function is being executed, the promise returned
                /// by then() moves into the error state.
                /// </param>
                /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onError">
                /// The function to be called if the promise is fulfilled with an error. The error
                /// is passed as the single argument. If it is null, the error is forwarded.
                /// The value returned from the function becomes the fulfilled value of the promise returned by then().
                /// </param>
                /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onProgress">
                /// The function to be called if the promise reports progress. Data about the progress
                /// is passed as the single argument. Promises are not required to support
                /// progress.
                /// </param>
                /// <returns type="WinJS.Promise" locid="WinJS.PromiseStateMachine.then_returnValue">
                /// The promise whose value is the result of executing the complete or
                /// error function.
                /// </returns>
                /// </signature>
                return this._state.then(this, onComplete, onError, onProgress);
            },

            _chainedError: function(value, context) {
                var result = this._state._error(this, value, detailsForChainedError, context);
                this._run();
                return result;
            },
            _completed: function(value) {
                var result = this._state._completed(this, value);
                this._run();
                return result;
            },
            _error: function(value) {
                var result = this._state._error(this, value, detailsForError);
                this._run();
                return result;
            },
            _progress: function(value) {
                this._state._progress(this, value);
            },
            _setState: function(state) {
                this._nextState = state;
            },
            _setCompleteValue: function(value) {
                this._state._setCompleteValue(this, value);
                this._run();
            },
            _setChainedErrorValue: function(value, context) {
                var result = this._state._setErrorValue(this, value, detailsForChainedError, context);
                this._run();
                return result;
            },
            _setExceptionValue: function(value) {
                var result = this._state._setErrorValue(this, value, detailsForException);
                this._run();
                return result;
            },
            _run: function() {
                while (this._nextState) {
                    this._state = this._nextState;
                    this._nextState = null;
                    this._state.enter(this);
                }
            }
        }, {
            supportedForProcessing: false
        });

        //
        // Implementations of shared state machine code.
        //

        function completed(promise, value) {
            var targetState;
            if (value && typeof value === "object" && typeof value.then === "function") {
                targetState = state_waiting;
            } else {
                targetState = state_success_notify;
            }
            promise._value = value;
            promise._setState(targetState);
        }

        function createErrorDetails(exception, error, promise, id, parent, handler) {
            return {
                exception: exception,
                error: error,
                promise: promise,
                handler: handler,
                id: id,
                parent: parent
            };
        }

        function detailsForHandledError(promise, errorValue, context, handler) {
            var exception = context._isException;
            var errorId = context._errorId;
            return createErrorDetails(
                exception ? errorValue : null,
                exception ? null : errorValue,
                promise,
                errorId,
                context,
                handler
            );
        }

        function detailsForChainedError(promise, errorValue, context) {
            var exception = context._isException;
            var errorId = context._errorId;
            setErrorInfo(promise, errorId, exception);
            return createErrorDetails(
                exception ? errorValue : null,
                exception ? null : errorValue,
                promise,
                errorId,
                context
            );
        }

        function detailsForError(promise, errorValue) {
            var errorId = ++error_number;
            setErrorInfo(promise, errorId);
            return createErrorDetails(
                null,
                errorValue,
                promise,
                errorId
            );
        }

        function detailsForException(promise, exceptionValue) {
            var errorId = ++error_number;
            setErrorInfo(promise, errorId, true);
            return createErrorDetails(
                exceptionValue,
                null,
                promise,
                errorId
            );
        }

        function done(promise, onComplete, onError, onProgress) {
            var asyncOpID = "WinJS.Promise.done";
            pushListener(promise, {
                c: onComplete,
                e: onError,
                p: onProgress,
                asyncOpID: asyncOpID
            });
        }

        function error(promise, value, onerrorDetails, context) {
            promise._value = value;
            callonerror(promise, value, onerrorDetails, context);
            promise._setState(state_error_notify);
        }

        function notifySuccess(promise, queue) {
            var value = promise._value;
            var listeners = promise._listeners;
            if (!listeners) {
                return;
            }
            promise._listeners = null;
            var i, len;
            for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {
                var listener = len === 1 ? listeners : listeners[i];
                var onComplete = listener.c;
                var target = listener.promise;

                if (target) {
                    try {
                        target._setCompleteValue(onComplete ? onComplete(value) : value);
                    } catch (ex) {
                        target._setExceptionValue(ex);
                    } finally {}
                    if (target._state !== state_waiting && target._listeners) {
                        queue.push(target);
                    }
                } else {
                    CompletePromise.prototype.done.call(promise, onComplete);
                }
            }
        }

        function notifyError(promise, queue) {
            var value = promise._value;
            var listeners = promise._listeners;
            if (!listeners) {
                return;
            }
            promise._listeners = null;
            var i, len;
            for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {
                var listener = len === 1 ? listeners : listeners[i];
                var onError = listener.e;
                var target = listener.promise;

                if (target) {
                    var asyncCallbackStarted = false;
                    try {
                        if (onError) {
                            asyncCallbackStarted = true;
                            if (!onError.handlesOnError) {
                                callonerror(target, value, detailsForHandledError, promise, onError);
                            }
                            target._setCompleteValue(onError(value))
                        } else {
                            target._setChainedErrorValue(value, promise);
                        }
                    } catch (ex) {
                        target._setExceptionValue(ex);
                    } finally {}
                    if (target._state !== state_waiting && target._listeners) {
                        queue.push(target);
                    }
                } else {
                    ErrorPromise.prototype.done.call(promise, null, onError);
                }
            }
        }

        function callonerror(promise, value, onerrorDetailsGenerator, context, handler) {
            if (promiseEventListeners._listeners[errorET]) {
                if (value instanceof Error && value.message === canceledName) {
                    return;
                }
                promiseEventListeners.dispatchEvent(errorET, onerrorDetailsGenerator(promise, value, context, handler));
            }
        }

        function progress(promise, value) {
            var listeners = promise._listeners;
            if (listeners) {
                var i, len;
                for (i = 0, len = Array.isArray(listeners) ? listeners.length : 1; i < len; i++) {
                    var listener = len === 1 ? listeners : listeners[i];
                    var onProgress = listener.p;
                    if (onProgress) {
                        try {
                            onProgress(value);
                        } catch (ex) {}
                    }
                    if (!(listener.c || listener.e) && listener.promise) {
                        listener.promise._progress(value);
                    }
                }
            }
        }

        function pushListener(promise, listener) {
            var listeners = promise._listeners;
            if (listeners) {
                // We may have either a single listener (which will never be wrapped in an array)
                // or 2+ listeners (which will be wrapped). Since we are now adding one more listener
                // we may have to wrap the single listener before adding the second.
                listeners = Array.isArray(listeners) ? listeners : [listeners];
                listeners.push(listener);
            } else {
                listeners = listener;
            }
            promise._listeners = listeners;
        }
        // The difference beween setCompleteValue()/setErrorValue() and complete()/error() is that setXXXValue() moves
        // a promise directly to the success/error state without starting another notification pass (because one
        // is already ongoing).
        function setErrorInfo(promise, errorId, isException) {
            promise._isException = isException || false;
            promise._errorId = errorId;
        }

        function setErrorValue(promise, value, onerrorDetails, context) {
            promise._value = value;
            callonerror(promise, value, onerrorDetails, context);
            promise._setState(state_error);
        }

        function setCompleteValue(promise, value) {
            var targetState;
            if (value && typeof value === "object" && typeof value.then === "function") {
                targetState = state_waiting;
            } else {
                targetState = state_success;
            }
            promise._value = value;
            promise._setState(targetState);
        }

        function then(promise, onComplete, onError, onProgress) {
            var result = new ThenPromise(promise);
            var asyncOpID = "WinJS.Promise.then";
            pushListener(promise, {
                promise: result,
                c: onComplete,
                e: onError,
                p: onProgress,
                asyncOpID: asyncOpID
            });
            return result;
        }

        //
        // Internal implementation detail promise, ThenPromise is created when a promise needs
        // to be returned from a then() method.
        //
        var ThenPromise = WinJS.Class.derive(PromiseStateMachine,
            function(creator) {

                if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.thenPromise))) {
                    this._stack = WinJS.Promise._getStack();
                }

                this._creator = creator;
                this._setState(state_created);
                this._run();
            }, {
                _creator: null,

                _cancelAction: function() {
                    if (this._creator) {
                        this._creator.cancel();
                    }
                },
                _cleanupAction: function() {
                    this._creator = null;
                }
            }, {
                supportedForProcessing: false
            }
        );

        //
        // Slim promise implementations for already completed promises, these are created
        // under the hood on synchronous completion paths as well as by WinJS.Promise.wrap
        // and WinJS.Promise.wrapError.
        //

        var ErrorPromise = WinJS.Class.define(
            function ErrorPromise_ctor(value) {

                if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.errorPromise))) {
                    this._stack = WinJS.Promise._getStack();
                }

                this._value = value;
                callonerror(this, value, detailsForError);
            }, {
                cancel: function() {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.cancel">
                    /// <summary locid="WinJS.PromiseStateMachine.cancel">
                    /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't
                    /// already been fulfilled and cancellation is supported, the promise enters
                    /// the error state with a value of Error("Canceled").
                    /// </summary>
                    /// </signature>
                },
                done: function ErrorPromise_done(unused, onError) {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.done">
                    /// <summary locid="WinJS.PromiseStateMachine.done">
                    /// Allows you to specify the work to be done on the fulfillment of the promised value,
                    /// the error handling to be performed if the promise fails to fulfill
                    /// a value, and the handling of progress notifications along the way.
                    ///
                    /// After the handlers have finished executing, this function throws any error that would have been returned
                    /// from then() as a promise in the error state.
                    /// </summary>
                    /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.done_p:onComplete">
                    /// The function to be called if the promise is fulfilled successfully with a value.
                    /// The fulfilled value is passed as the single argument. If the value is null,
                    /// the fulfilled value is returned. The value returned
                    /// from the function becomes the fulfilled value of the promise returned by
                    /// then(). If an exception is thrown while executing the function, the promise returned
                    /// by then() moves into the error state.
                    /// </param>
                    /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onError">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument. If it is null, the error is forwarded.
                    /// The value returned from the function is the fulfilled value of the promise returned by then().
                    /// </param>
                    /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onProgress">
                    /// the function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// </signature>
                    var value = this._value;
                    if (onError) {
                        try {
                            if (!onError.handlesOnError) {
                                callonerror(null, value, detailsForHandledError, this, onError);
                            }
                            var result = onError(value);
                            if (result && typeof result === "object" && typeof result.done === "function") {
                                // If a promise is returned we need to wait on it.
                                result.done();
                            }
                            return;
                        } catch (ex) {
                            value = ex;
                        }
                    }
                    if (value instanceof Error && value.message === canceledName) {
                        // suppress cancel
                        return;
                    }
                    // force the exception to be thrown asyncronously to avoid any try/catch blocks
                    //
                    WinJS.Utilities.Scheduler.schedule(function() {
                        throw value;
                    }, WinJS.Utilities.Scheduler.Priority.normal, null, "WinJS.Promise._throwException");
                },
                then: function ErrorPromise_then(unused, onError) {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.then">
                    /// <summary locid="WinJS.PromiseStateMachine.then">
                    /// Allows you to specify the work to be done on the fulfillment of the promised value,
                    /// the error handling to be performed if the promise fails to fulfill
                    /// a value, and the handling of progress notifications along the way.
                    /// </summary>
                    /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.then_p:onComplete">
                    /// The function to be called if the promise is fulfilled successfully with a value.
                    /// The value is passed as the single argument. If the value is null, the value is returned.
                    /// The value returned from the function becomes the fulfilled value of the promise returned by
                    /// then(). If an exception is thrown while this function is being executed, the promise returned
                    /// by then() moves into the error state.
                    /// </param>
                    /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onError">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument. If it is null, the error is forwarded.
                    /// The value returned from the function becomes the fulfilled value of the promise returned by then().
                    /// </param>
                    /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onProgress">
                    /// The function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.PromiseStateMachine.then_returnValue">
                    /// The promise whose value is the result of executing the complete or
                    /// error function.
                    /// </returns>
                    /// </signature>

                    // If the promise is already in a error state and no error handler is provided
                    // we optimize by simply returning the promise instead of creating a new one.
                    //
                    if (!onError) {
                        return this;
                    }
                    var result;
                    var value = this._value;
                    try {
                        if (!onError.handlesOnError) {
                            callonerror(null, value, detailsForHandledError, this, onError);
                        }
                        result = new CompletePromise(onError(value));
                    } catch (ex) {
                        // If the value throw from the error handler is the same as the value
                        // provided to the error handler then there is no need for a new promise.
                        //
                        if (ex === value) {
                            result = this;
                        } else {
                            result = new ExceptionPromise(ex);
                        }
                    }
                    return result;
                }
            }, {
                supportedForProcessing: false
            }
        );

        var ExceptionPromise = WinJS.Class.derive(ErrorPromise,
            function ExceptionPromise_ctor(value) {

                if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.exceptionPromise))) {
                    this._stack = WinJS.Promise._getStack();
                }

                this._value = value;
                callonerror(this, value, detailsForException);
            }, {
                /* empty */
            }, {
                supportedForProcessing: false
            }
        );

        var CompletePromise = WinJS.Class.define(
            function CompletePromise_ctor(value) {

                if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.completePromise))) {
                    this._stack = WinJS.Promise._getStack();
                }

                if (value && typeof value === "object" && typeof value.then === "function") {
                    var result = new ThenPromise(null);
                    result._setCompleteValue(value);
                    return result;
                }
                this._value = value;
            }, {
                cancel: function() {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.cancel">
                    /// <summary locid="WinJS.PromiseStateMachine.cancel">
                    /// Attempts to cancel the fulfillment of a promised value. If the promise hasn't
                    /// already been fulfilled and cancellation is supported, the promise enters
                    /// the error state with a value of Error("Canceled").
                    /// </summary>
                    /// </signature>
                },
                done: function CompletePromise_done(onComplete) {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.done">
                    /// <summary locid="WinJS.PromiseStateMachine.done">
                    /// Allows you to specify the work to be done on the fulfillment of the promised value,
                    /// the error handling to be performed if the promise fails to fulfill
                    /// a value, and the handling of progress notifications along the way.
                    ///
                    /// After the handlers have finished executing, this function throws any error that would have been returned
                    /// from then() as a promise in the error state.
                    /// </summary>
                    /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.done_p:onComplete">
                    /// The function to be called if the promise is fulfilled successfully with a value.
                    /// The fulfilled value is passed as the single argument. If the value is null,
                    /// the fulfilled value is returned. The value returned
                    /// from the function becomes the fulfilled value of the promise returned by
                    /// then(). If an exception is thrown while executing the function, the promise returned
                    /// by then() moves into the error state.
                    /// </param>
                    /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onError">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument. If it is null, the error is forwarded.
                    /// The value returned from the function is the fulfilled value of the promise returned by then().
                    /// </param>
                    /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.done_p:onProgress">
                    /// the function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// </signature>
                    if (!onComplete) {
                        return;
                    }
                    try {
                        var result = onComplete(this._value);
                        if (result && typeof result === "object" && typeof result.done === "function") {
                            result.done();
                        }
                    } catch (ex) {
                        // force the exception to be thrown asynchronously to avoid any try/catch blocks
                        WinJS.Utilities.Scheduler.schedule(function() {
                            throw ex;
                        }, WinJS.Utilities.Scheduler.Priority.normal, null, "WinJS.Promise._throwException");
                    }
                },
                then: function CompletePromise_then(onComplete) {
                    /// <signature helpKeyword="WinJS.PromiseStateMachine.then">
                    /// <summary locid="WinJS.PromiseStateMachine.then">
                    /// Allows you to specify the work to be done on the fulfillment of the promised value,
                    /// the error handling to be performed if the promise fails to fulfill
                    /// a value, and the handling of progress notifications along the way.
                    /// </summary>
                    /// <param name='onComplete' type='Function' locid="WinJS.PromiseStateMachine.then_p:onComplete">
                    /// The function to be called if the promise is fulfilled successfully with a value.
                    /// The value is passed as the single argument. If the value is null, the value is returned.
                    /// The value returned from the function becomes the fulfilled value of the promise returned by
                    /// then(). If an exception is thrown while this function is being executed, the promise returned
                    /// by then() moves into the error state.
                    /// </param>
                    /// <param name='onError' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onError">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument. If it is null, the error is forwarded.
                    /// The value returned from the function becomes the fulfilled value of the promise returned by then().
                    /// </param>
                    /// <param name='onProgress' type='Function' optional='true' locid="WinJS.PromiseStateMachine.then_p:onProgress">
                    /// The function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.PromiseStateMachine.then_returnValue">
                    /// The promise whose value is the result of executing the complete or
                    /// error function.
                    /// </returns>
                    /// </signature>
                    try {
                        // If the value returned from the completion handler is the same as the value
                        // provided to the completion handler then there is no need for a new promise.
                        //
                        var newValue = onComplete ? onComplete(this._value) : this._value;
                        return newValue === this._value ? this : new CompletePromise(newValue);
                    } catch (ex) {
                        return new ExceptionPromise(ex);
                    }
                }
            }, {
                supportedForProcessing: false
            }
        );

        //
        // Promise is the user-creatable WinJS.Promise object.
        //

        function timeout(timeoutMS) {
            var id;
            return new WinJS.Promise(
                function(c) {
                    if (timeoutMS) {
                        id = setTimeout(c, timeoutMS);
                    } else {
                        setImmediate(c);
                    }
                },
                function() {
                    if (id) {
                        clearTimeout(id);
                    }
                }
            );
        }

        function timeoutWithPromise(timeout, promise) {
            var cancelPromise = function() {
                promise.cancel();
            }
            var cancelTimeout = function() {
                timeout.cancel();
            }
            timeout.then(cancelPromise);
            promise.then(cancelTimeout, cancelTimeout);
            return promise;
        }

        var staticCanceledPromise;

        var Promise = WinJS.Class.derive(PromiseStateMachine,
            function Promise_ctor(init, oncancel) {
                /// <signature helpKeyword="WinJS.Promise">
                /// <summary locid="WinJS.Promise">
                /// A promise provides a mechanism to schedule work to be done on a value that
                /// has not yet been computed. It is a convenient abstraction for managing
                /// interactions with asynchronous APIs.
                /// </summary>
                /// <param name="init" type="Function" locid="WinJS.Promise_p:init">
                /// The function that is called during construction of the  promise. The function
                /// is given three arguments (complete, error, progress). Inside this function
                /// you should add event listeners for the notifications supported by this value.
                /// </param>
                /// <param name="oncancel" optional="true" locid="WinJS.Promise_p:oncancel">
                /// The function to call if a consumer of this promise wants
                /// to cancel its undone work. Promises are not required to
                /// support cancellation.
                /// </param>
                /// </signature>

                if (tagWithStack && (tagWithStack === true || (tagWithStack & tag.promise))) {
                    this._stack = WinJS.Promise._getStack();
                }

                this._oncancel = oncancel;
                this._setState(state_created);
                this._run();

                try {
                    var complete = this._completed.bind(this);
                    var error = this._error.bind(this);
                    var progress = this._progress.bind(this);
                    init(complete, error, progress);
                } catch (ex) {
                    this._setExceptionValue(ex);
                }
            }, {
                _oncancel: null,

                _cancelAction: function() {
                    if (this._oncancel) {
                        try {
                            this._oncancel();
                        } catch (ex) {}
                    }
                },
                _cleanupAction: function() {
                    this._oncancel = null;
                }
            }, {

                addEventListener: function Promise_addEventListener(eventType, listener, capture) {
                    /// <signature helpKeyword="WinJS.Promise.addEventListener">
                    /// <summary locid="WinJS.Promise.addEventListener">
                    /// Adds an event listener to the control.
                    /// </summary>
                    /// <param name="eventType" locid="WinJS.Promise.addEventListener_p:eventType">
                    /// The type (name) of the event.
                    /// </param>
                    /// <param name="listener" locid="WinJS.Promise.addEventListener_p:listener">
                    /// The listener to invoke when the event is raised.
                    /// </param>
                    /// <param name="capture" locid="WinJS.Promise.addEventListener_p:capture">
                    /// Specifies whether or not to initiate capture.
                    /// </param>
                    /// </signature>
                    promiseEventListeners.addEventListener(eventType, listener, capture);
                },
                any: function Promise_any(values) {
                    /// <signature helpKeyword="WinJS.Promise.any">
                    /// <summary locid="WinJS.Promise.any">
                    /// Returns a promise that is fulfilled when one of the input promises
                    /// has been fulfilled.
                    /// </summary>
                    /// <param name="values" type="Array" locid="WinJS.Promise.any_p:values">
                    /// An array that contains promise objects or objects whose property
                    /// values include promise objects.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.any_returnValue">
                    /// A promise that on fulfillment yields the value of the input (complete or error).
                    /// </returns>
                    /// </signature>
                    return new Promise(
                        function(complete, error, progress) {
                            var keys = Object.keys(values);
                            var errors = Array.isArray(values) ? [] : {};
                            if (keys.length === 0) {
                                complete();
                            }
                            var canceled = 0;
                            keys.forEach(function(key) {
                                Promise.as(values[key]).then(
                                    function() {
                                        complete({
                                            key: key,
                                            value: values[key]
                                        });
                                    },
                                    function(e) {
                                        if (e instanceof Error && e.name === canceledName) {
                                            if ((++canceled) === keys.length) {
                                                complete(WinJS.Promise.cancel);
                                            }
                                            return;
                                        }
                                        error({
                                            key: key,
                                            value: values[key]
                                        });
                                    }
                                );
                            });
                        },
                        function() {
                            var keys = Object.keys(values);
                            keys.forEach(function(key) {
                                var promise = Promise.as(values[key]);
                                if (typeof promise.cancel === "function") {
                                    promise.cancel();
                                }
                            });
                        }
                    );
                },
                as: function Promise_as(value) {
                    /// <signature helpKeyword="WinJS.Promise.as">
                    /// <summary locid="WinJS.Promise.as">
                    /// Returns a promise. If the object is already a promise it is returned;
                    /// otherwise the object is wrapped in a promise.
                    /// </summary>
                    /// <param name="value" locid="WinJS.Promise.as_p:value">
                    /// The value to be treated as a promise.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.as_returnValue">
                    /// A promise.
                    /// </returns>
                    /// </signature>
                    if (value && typeof value === "object" && typeof value.then === "function") {
                        return value;
                    }
                    return new CompletePromise(value);
                },
                /// <field type="WinJS.Promise" helpKeyword="WinJS.Promise.cancel" locid="WinJS.Promise.cancel">
                /// Canceled promise value, can be returned from a promise completion handler
                /// to indicate cancelation of the promise chain.
                /// </field>
                cancel: {
                    get: function() {
                        return (staticCanceledPromise = staticCanceledPromise || new ErrorPromise(new WinJS.ErrorFromName(canceledName)));
                    }
                },
                dispatchEvent: function Promise_dispatchEvent(eventType, details) {
                    /// <signature helpKeyword="WinJS.Promise.dispatchEvent">
                    /// <summary locid="WinJS.Promise.dispatchEvent">
                    /// Raises an event of the specified type and properties.
                    /// </summary>
                    /// <param name="eventType" locid="WinJS.Promise.dispatchEvent_p:eventType">
                    /// The type (name) of the event.
                    /// </param>
                    /// <param name="details" locid="WinJS.Promise.dispatchEvent_p:details">
                    /// The set of additional properties to be attached to the event object.
                    /// </param>
                    /// <returns type="Boolean" locid="WinJS.Promise.dispatchEvent_returnValue">
                    /// Specifies whether preventDefault was called on the event.
                    /// </returns>
                    /// </signature>
                    return promiseEventListeners.dispatchEvent(eventType, details);
                },
                is: function Promise_is(value) {
                    /// <signature helpKeyword="WinJS.Promise.is">
                    /// <summary locid="WinJS.Promise.is">
                    /// Determines whether a value fulfills the promise contract.
                    /// </summary>
                    /// <param name="value" locid="WinJS.Promise.is_p:value">
                    /// A value that may be a promise.
                    /// </param>
                    /// <returns type="Boolean" locid="WinJS.Promise.is_returnValue">
                    /// true if the specified value is a promise, otherwise false.
                    /// </returns>
                    /// </signature>
                    return value && typeof value === "object" && typeof value.then === "function";
                },
                join: function Promise_join(values) {
                    /// <signature helpKeyword="WinJS.Promise.join">
                    /// <summary locid="WinJS.Promise.join">
                    /// Creates a promise that is fulfilled when all the values are fulfilled.
                    /// </summary>
                    /// <param name="values" type="Object" locid="WinJS.Promise.join_p:values">
                    /// An object whose fields contain values, some of which may be promises.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.join_returnValue">
                    /// A promise whose value is an object with the same field names as those of the object in the values parameter, where
                    /// each field value is the fulfilled value of a promise.
                    /// </returns>
                    /// </signature>
                    return new Promise(
                        function(complete, error, progress) {
                            var keys = Object.keys(values);
                            var errors = Array.isArray(values) ? [] : {};
                            var results = Array.isArray(values) ? [] : {};
                            var undefineds = 0;
                            var pending = keys.length;
                            var argDone = function(key) {
                                if ((--pending) === 0) {
                                    var errorCount = Object.keys(errors).length;
                                    if (errorCount === 0) {
                                        complete(results);
                                    } else {
                                        var canceledCount = 0;
                                        keys.forEach(function(key) {
                                            var e = errors[key];
                                            if (e instanceof Error && e.name === canceledName) {
                                                canceledCount++;
                                            }
                                        });
                                        if (canceledCount === errorCount) {
                                            complete(WinJS.Promise.cancel);
                                        } else {
                                            error(errors);
                                        }
                                    }
                                } else {
                                    progress({
                                        Key: key,
                                        Done: true
                                    });
                                }
                            };
                            keys.forEach(function(key) {
                                var value = values[key];
                                if (value === undefined) {
                                    undefineds++;
                                } else {
                                    Promise.then(value,
                                        function(value) {
                                            results[key] = value;
                                            argDone(key);
                                        },
                                        function(value) {
                                            errors[key] = value;
                                            argDone(key);
                                        }
                                    );
                                }
                            });
                            pending -= undefineds;
                            if (pending === 0) {
                                complete(results);
                                return;
                            }
                        },
                        function() {
                            Object.keys(values).forEach(function(key) {
                                var promise = Promise.as(values[key]);
                                if (typeof promise.cancel === "function") {
                                    promise.cancel();
                                }
                            });
                        }
                    );
                },
                removeEventListener: function Promise_removeEventListener(eventType, listener, capture) {
                    /// <signature helpKeyword="WinJS.Promise.removeEventListener">
                    /// <summary locid="WinJS.Promise.removeEventListener">
                    /// Removes an event listener from the control.
                    /// </summary>
                    /// <param name='eventType' locid="WinJS.Promise.removeEventListener_eventType">
                    /// The type (name) of the event.
                    /// </param>
                    /// <param name='listener' locid="WinJS.Promise.removeEventListener_listener">
                    /// The listener to remove.
                    /// </param>
                    /// <param name='capture' locid="WinJS.Promise.removeEventListener_capture">
                    /// Specifies whether or not to initiate capture.
                    /// </param>
                    /// </signature>
                    promiseEventListeners.removeEventListener(eventType, listener, capture);
                },
                supportedForProcessing: false,
                then: function Promise_then(value, onComplete, onError, onProgress) {
                    /// <signature helpKeyword="WinJS.Promise.then">
                    /// <summary locid="WinJS.Promise.then">
                    /// A static version of the promise instance method then().
                    /// </summary>
                    /// <param name="value" locid="WinJS.Promise.then_p:value">
                    /// the value to be treated as a promise.
                    /// </param>
                    /// <param name="onComplete" type="Function" locid="WinJS.Promise.then_p:complete">
                    /// The function to be called if the promise is fulfilled with a value.
                    /// If it is null, the promise simply
                    /// returns the value. The value is passed as the single argument.
                    /// </param>
                    /// <param name="onError" type="Function" optional="true" locid="WinJS.Promise.then_p:error">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument.
                    /// </param>
                    /// <param name="onProgress" type="Function" optional="true" locid="WinJS.Promise.then_p:progress">
                    /// The function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.then_returnValue">
                    /// A promise whose value is the result of executing the provided complete function.
                    /// </returns>
                    /// </signature>
                    return Promise.as(value).then(onComplete, onError, onProgress);
                },
                thenEach: function Promise_thenEach(values, onComplete, onError, onProgress) {
                    /// <signature helpKeyword="WinJS.Promise.thenEach">
                    /// <summary locid="WinJS.Promise.thenEach">
                    /// Performs an operation on all the input promises and returns a promise
                    /// that has the shape of the input and contains the result of the operation
                    /// that has been performed on each input.
                    /// </summary>
                    /// <param name="values" locid="WinJS.Promise.thenEach_p:values">
                    /// A set of values (which could be either an array or an object) of which some or all are promises.
                    /// </param>
                    /// <param name="onComplete" type="Function" locid="WinJS.Promise.thenEach_p:complete">
                    /// The function to be called if the promise is fulfilled with a value.
                    /// If the value is null, the promise returns the value.
                    /// The value is passed as the single argument.
                    /// </param>
                    /// <param name="onError" type="Function" optional="true" locid="WinJS.Promise.thenEach_p:error">
                    /// The function to be called if the promise is fulfilled with an error. The error
                    /// is passed as the single argument.
                    /// </param>
                    /// <param name="onProgress" type="Function" optional="true" locid="WinJS.Promise.thenEach_p:progress">
                    /// The function to be called if the promise reports progress. Data about the progress
                    /// is passed as the single argument. Promises are not required to support
                    /// progress.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.thenEach_returnValue">
                    /// A promise that is the result of calling Promise.join on the values parameter.
                    /// </returns>
                    /// </signature>
                    var result = Array.isArray(values) ? [] : {};
                    Object.keys(values).forEach(function(key) {
                        result[key] = Promise.as(values[key]).then(onComplete, onError, onProgress);
                    });
                    return Promise.join(result);
                },
                timeout: function Promise_timeout(time, promise) {
                    /// <signature helpKeyword="WinJS.Promise.timeout">
                    /// <summary locid="WinJS.Promise.timeout">
                    /// Creates a promise that is fulfilled after a timeout.
                    /// </summary>
                    /// <param name="timeout" type="Number" optional="true" locid="WinJS.Promise.timeout_p:timeout">
                    /// The timeout period in milliseconds. If this value is zero or not specified
                    /// setImmediate is called, otherwise setTimeout is called.
                    /// </param>
                    /// <param name="promise" type="Promise" optional="true" locid="WinJS.Promise.timeout_p:promise">
                    /// A promise that will be canceled if it doesn't complete before the
                    /// timeout has expired.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.timeout_returnValue">
                    /// A promise that is completed asynchronously after the specified timeout.
                    /// </returns>
                    /// </signature>
                    var to = timeout(time);
                    return promise ? timeoutWithPromise(to, promise) : to;
                },
                wrap: function Promise_wrap(value) {
                    /// <signature helpKeyword="WinJS.Promise.wrap">
                    /// <summary locid="WinJS.Promise.wrap">
                    /// Wraps a non-promise value in a promise. You can use this function if you need
                    /// to pass a value to a function that requires a promise.
                    /// </summary>
                    /// <param name="value" locid="WinJS.Promise.wrap_p:value">
                    /// Some non-promise value to be wrapped in a promise.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.wrap_returnValue">
                    /// A promise that is successfully fulfilled with the specified value
                    /// </returns>
                    /// </signature>
                    return new CompletePromise(value);
                },
                wrapError: function Promise_wrapError(error) {
                    /// <signature helpKeyword="WinJS.Promise.wrapError">
                    /// <summary locid="WinJS.Promise.wrapError">
                    /// Wraps a non-promise error value in a promise. You can use this function if you need
                    /// to pass an error to a function that requires a promise.
                    /// </summary>
                    /// <param name="error" locid="WinJS.Promise.wrapError_p:error">
                    /// A non-promise error value to be wrapped in a promise.
                    /// </param>
                    /// <returns type="WinJS.Promise" locid="WinJS.Promise.wrapError_returnValue">
                    /// A promise that is in an error state with the specified value.
                    /// </returns>
                    /// </signature>
                    return new ErrorPromise(error);
                },

                _veryExpensiveTagWithStack: {
                    get: function() {
                        return tagWithStack;
                    },
                    set: function(value) {
                        tagWithStack = value;
                    }
                },
                _veryExpensiveTagWithStack_tag: tag,
                _getStack: function() {
                    try {
                        throw new Error();
                    } catch (e) {
                        return e.stack;
                    }
                },

                _cancelBlocker: function Promise__cancelBlocker(input) {
                    //
                    // Returns a promise which on cancelation will still result in downstream cancelation while
                    //  protecting the promise 'input' from being  canceled which has the effect of allowing 
                    //  'input' to be shared amoung various consumers.
                    //
                    if (!Promise.is(input)) {
                        return Promise.wrap(input);
                    }
                    var complete;
                    var error;
                    var output = new WinJS.Promise(
                        function(c, e) {
                            complete = c;
                            error = e;
                        },
                        function() {
                            complete = null;
                            error = null;
                        }
                    );
                    input.then(
                        function(v) {
                            complete && complete(v);
                        },
                        function(e) {
                            error && error(e);
                        }
                    );
                    return output;
                },

            }
        );
        Object.defineProperties(Promise, WinJS.Utilities.createEventProperties(errorET));

        var SignalPromise = WinJS.Class.derive(PromiseStateMachine,
            function(cancel) {
                this._oncancel = cancel;
                this._setState(state_created);
                this._run();
            }, {
                _cancelAction: function() {
                    this._oncancel && this._oncancel();
                },
                _cleanupAction: function() {
                    this._oncancel = null;
                }
            }, {
                supportedForProcessing: false
            }
        );

        var Signal = WinJS.Class.define(
            function Signal_ctor(oncancel) {
                this._promise = new SignalPromise(oncancel);
            }, {
                promise: {
                    get: function() {
                        return this._promise;
                    }
                },

                cancel: function Signal_cancel() {
                    this._promise.cancel();
                },
                complete: function Signal_complete(value) {
                    this._promise._completed(value);
                },
                error: function Signal_error(value) {
                    this._promise._error(value);
                },
                progress: function Signal_progress(value) {
                    this._promise._progress(value);
                }
            }, {
                supportedForProcessing: false,
            }
        );

        // Publish WinJS.Promise
        //
        WinJS.Namespace.define("WinJS", {
            Promise: Promise,
            _Signal: Signal
        });

    }(this));

    /***********************************************************
     * winjs-promise.js end
     **********************************************************/
    //globalHolder.WinJS.Promise.all = globalHolder.WinJS.Promise.join;

    /***********************************************************
     * assign to global Class
     **********************************************************/
    Promise = WinJS.Promise;;
    var CoreUtilities;
    (function(CoreUtilities) {
        // Contains utility functions that are common to Threshold clients - Cortana, Spartan OneBox etc.
        // Do not include client specfic code here.
        function deferFunction(functionPointer) {
            var originalArgs = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                originalArgs[_i - 1] = arguments[_i];
            }
            return deferMethod.apply(null, [null, functionPointer].concat(originalArgs));
        }
        CoreUtilities.deferFunction = deferFunction;

        function deferMethod(sourceObject, functionPointer) {
            var originalArgs = [];
            for (var _i = 2; _i < arguments.length; _i++) {
                originalArgs[_i - 2] = arguments[_i];
            }
            return function() {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i - 0] = arguments[_i];
                }
                if (!args || args.length === 0) {
                    args = originalArgs;
                } else {
                    for (var i in originalArgs) {
                        if (originalArgs.hasOwnProperty(i)) {
                            args.push(originalArgs[i]);
                        }
                    }
                }
                return functionPointer.apply(sourceObject, args);
            };
        }
        CoreUtilities.deferMethod = deferMethod;
        // gets a property out of an object. 
        // should be used in cases where object has a lot of layers of properties.
        // the arguments will be object, list of properties. 
        // it works recursively so it will keep calling itself with the current object and the rest of the properties.
        // e.g. var a = { b: { c: { d: "e" } } } to get to "e", you can call getProperty(a, b, c, d)
        // will return null if any of the layers don't have what was passed in (e. g. getProperty(a, b, d))
        function getProperty() {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i - 0] = arguments[_i];
            }
            var currentState = args[0];
            for (var i = 1; i < args.length; i++) {
                if (currentState) {
                    currentState = currentState[args[i]];
                } else {
                    return null;
                }
            }
            return currentState;
        }
        CoreUtilities.getProperty = getProperty;
        // Legacy Support
        window["sj_df"] = deferFunction;
        window["sj_dm"] = deferMethod;
        window["sj_gp"] = getProperty;
    })(CoreUtilities || (CoreUtilities = {}));; /// <reference path="..\Declarations\Shared.d.ts"/>
    /// <reference path="..\Declarations\Threshold.Utilities.d.ts"/>
    var ThresholdDiagnosticsProd = (function() {
        function ThresholdDiagnosticsProd() {
            this.debugStrings = [];
            this.submitCallbackBound = false;
            sj_evt.bind("ajax.WindowsFeedback.Form.Shown", sj_dm(this, this.onFeedbackFormShown));
            sj_evt.bind("ajax.threshold.pageStart", sj_dm(this, this.clearDebugStrings));
        }
        ThresholdDiagnosticsProd.prototype.recordApiString = function(debugString) {
            console.log(debugString);
            this.debugStrings.push(debugString);
        };
        ThresholdDiagnosticsProd.prototype.clearDebugStrings = function() {
            this.debugStrings.length = 0;
        };
        ThresholdDiagnosticsProd.prototype.onFeedbackFormShown = function() {
            var form = _ge("fdbkfrm");
            if (form) {
                if (!this.submitCallbackBound) {
                    var deferredSubmitCallback = sj_dm(this, this.onFeedbackFormSubmit, form);
                    var formButtons = form.getElementsByClassName("fdbkactionbtns");
                    if (formButtons && formButtons.length == 1) {
                        // onFeedbackFormSubmit is bound to a parent of the submit button (the div containing the submit/cancel buttons).
                        // It is bound with useCapture=true to ensure that a click on the submit button reaches our callback before the feedback 
                        // form's normal submission callback (which is bound to "click" on the button itself).
                        sj_be(formButtons[0], "click", deferredSubmitCallback, true);
                        this.submitCallbackBound = true;
                    }
                }
            } else {
                // If the form is missing, a new method would need to be created and bound
                this.submitCallbackBound = false;
            }
        };
        ThresholdDiagnosticsProd.prototype.onFeedbackFormSubmit = function(event, form) {
            var apiDebug = "apiDebug";
            var pageDebug = _w["PageDebug"];
            var screenshotCheckbox = form.elements["screenshot"];
            // We assume that if there was no screenshot input element we didn't need the user's permission to get one
            if (!screenshotCheckbox || screenshotCheckbox.checked) {
                pageDebug[apiDebug] = this.debugStrings.toString();
            } else if (pageDebug[apiDebug]) {
                delete pageDebug[apiDebug];
            }
        };
        return ThresholdDiagnosticsProd;
    })();
    _w["ThresholdDiagnostics"] = new ThresholdDiagnosticsProd();;
    //]]>
    </script>
    <script type="text/javascript" src="/rms/rms%20answers%20Shared%20Threshold$Threshold.UtilitiesM2/nj/ebdb5391/c4a005fe.js"></script>
    <script type="text/javascript">
    //<![CDATA[
    // ------------------------------------------------------------------------------
    // <copyright file="SearchAppAndroid.ts" company="Microsoft Corporation">
    //     Copyright (c) Microsoft Corporation. All Rights Reserved.
    //     Information Contained Herein is Proprietary and Confidential.
    // </copyright>
    // ------------------------------------------------------------------------------
    /// <reference path="Declarations\CortanaSearch.d.ts" />
    /// <reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Promise.Mock.d.ts" />
    /// <reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts" />
    var WrapApi;
    (function(WrapApi) {
        function completePromise(completionFunction) {
            if (WrapApi.AndroidReturnAsync) {
                // Set a timeout to finish resolution after the current call stack of execution finished.
                sb_st(function() {
                    return completionFunction();
                }, 0);
            } else {
                // To maintain current behavior, resolve synchronously.
                completionFunction();
            }
        }
        // This method clones an object while providing a wrapMethod bridges between one implementation of a function and another.
        // We use it to make sure the object we get back from Cortana API calls can fall back to our mock implementations if Cortana APIs fail or are not implemented.
        function wrapAndroidApi(cortanaObject) {
            if (cortanaObject) {
                // we don't implement the following as QF and device search are not part of CoA
                // searchResultsView: ISearchResultsView;
                // searchBox: ISearchBox;
                cortanaObject.isCortanaEnabled = cortanaObject.getIsCortanaEnabled();
                cortanaObject.isBingEnabled = cortanaObject.getIsBingEnabled();
                cortanaObject.isMobile = cortanaObject.getIsMobile();
                cortanaObject.region = cortanaObject.getRegion(); // The country code for the current region  
                cortanaObject.uiLanguage = cortanaObject.getUiLanguage(); // the language code for localized resources  
                cortanaObject.sessionId = cortanaObject.getSessionId(); // Logged in the Client to identify App open -> App close "sessions"  
                cortanaObject.impressionId = cortanaObject.getImpressionId(); // Produced by the client & logged by the server to identify each Keystroke  
                cortanaObject.launcher = cortanaObject.launcher || {
                    launchUriAsync: function(uri, options) {
                        return new Promise(function(resolve, reject) {
                            var result = cortanaObject.launchUriSync(uri, options);
                            completePromise(function() {
                                return resolve(result);
                            });
                        });
                    },
                    launchRAFAsync: function(rawQuery, formCode) {
                        cortanaObject.launchRAFSync(rawQuery, formCode);
                    },
                    startPhoneCallAsync: function(phoneNumber, displayName) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.startPhoneCallSync(phoneNumber, displayName);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    navigateReactiveViewAsync: function(rawQuery, formCode) {
                        return new Promise(function(resolve, reject) {
                            var result = false;
                            if (cortanaObject.navigateReactiveViewSync) {
                                result = cortanaObject.navigateReactiveViewSync(rawQuery, formCode);
                            }
                            completePromise(function() {
                                return resolve(result);
                            });
                        });
                    }
                };
                cortanaObject.proactiveView = cortanaObject.proactiveView || {
                    invalidateCacheAsync: function() {
                        return new Promise(function(resolve, reject) {
                            var result = false;
                            if (cortanaObject.invalidateCacheSync) {
                                result = cortanaObject.invalidateCacheSync();
                            }
                            completePromise(function() {
                                return resolve(result);
                            });
                        });
                    },
                    perfMetrics: {
                        lookup: function(perfMetricKey) {
                            var result = 0;
                            if (cortanaObject.perfMetricLookup) {
                                result = cortanaObject.perfMetricLookup(perfMetricKey);
                            }
                            return new Date(result);
                        }
                    }
                };
                cortanaObject.getQueryHeadersAsync = function() {
                    return new Promise(function(resolve, reject) {
                        var headerString = cortanaObject.getQueryHeadersSync();
                        var headers = JSON.parse(headerString);
                        completePromise(function() {
                            return resolve(headers);
                        });
                    });
                };
                if (typeof cortanaObject.navigateWebViewSync === 'function') {
                    cortanaObject.navigateWebViewAsync = function(uri) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.navigateWebViewSync(uri);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    };
                }
                cortanaObject.navigateWebViewWithPostAsync = function(uri, parameters) {
                    return new Promise(function(resolve, reject) {
                        var postDataStringified = JSON.stringify(parameters);
                        cortanaObject.navigateWebViewWithPostSync(uri, postDataStringified);
                        completePromise(function() {
                            return resolve(true);
                        });
                    });
                };
                cortanaObject.navigateWebViewBackAsync = function(frameCount) {
                    return new Promise(function(resolve, reject) {
                        cortanaObject.navigateWebViewBackSync(frameCount);
                        completePromise(function() {
                            return resolve(true);
                        });
                    });
                };
                cortanaObject.showWebViewAsync = function() {
                    return new Promise(function(resolve, reject) {
                        cortanaObject.showWebViewSync();
                        completePromise(function() {
                            return resolve(true);
                        });
                    });
                };
                cortanaObject.launchExperienceByName = function(experienceName, parameters) {
                    var experienceDataStringified = JSON.stringify(parameters);
                    cortanaObject.launchExperienceByNameSync(experienceName, experienceDataStringified);
                };
                var eventListenerMap = {};

                function triggerElement(element, index, array) {
                    element();
                };
                cortanaObject.addEventListener = function(eventName, cb) {
                    if (eventListenerMap[eventName] === undefined) {
                        eventListenerMap[eventName] = [];
                    }
                    eventListenerMap[eventName].push(cb);
                };
                cortanaObject.triggerEventListener = function(eventName) {
                    if (eventListenerMap[eventName] !== undefined) {
                        eventListenerMap[eventName].forEach(triggerElement);
                    }
                };

                function doneablePromise(fn) {
                    var promise = new Promise(fn);
                    if (typeof Promise.prototype.done !== 'function') {
                        promise.done = function(onFulfilled, onRejected) {
                            promise.then(onFulfilled, onRejected);
                        };
                    }
                    return promise;
                }
                var Screenshot = function(fileName, content, type) {
                    this.fileName = fileName;
                    this.contentType = type;
                    var base64Content = content;
                    this.getBase64ContentAsync = function() {
                        return doneablePromise(function(resolve, reject) {
                            completePromise(function() {
                                return resolve(base64Content);
                            });
                        });
                    };
                };
                cortanaObject.getFeedbackFilesAsync = function() {
                    return doneablePromise(function(resolve, reject) {
                        var data = JSON.parse(cortanaObject.getFeedbackFilesSync());
                        if (!data) {
                            completePromise(function() {
                                return reject("Get feedback files failed.");
                            });
                            return;
                        }
                        var screenshots = data.screenshots;
                        var files = {};
                        var i = 0;
                        var iLength = 0;
                        if (screenshots && screenshots.length > 0) {
                            for (i = 0, iLength = screenshots.length; i < iLength; i++) {
                                files[i] = new Screenshot(screenshots[i].fileName, screenshots[i].content, screenshots[i].type);
                            }
                        }
                        files['size'] = iLength;
                        completePromise(function() {
                            return resolve(files);
                        });
                    });
                };
                //TFS 52    27831: [CoA] In order to support proactive peek, implement cortanaApp.logMeasure() and cortanaApp.setNonAnimatingCortanaText()
                cortanaObject.logMeasure = function() {};
                cortanaObject.setNonAnimatingCortanaText = function() {};

                cortanaObject.currentState = cortanaObject.getCurrentState();
                cortanaObject.logVerboseTrace = function(eventName, opCode, payloadName, payloadData, impressionId) {
                    cortanaObject.logVerboseTrace(eventName, opCode, payloadName, payloadData, impressionId);
                }
                cortanaObject.processNLCommandAsync = function(commandTaskFrame, impressionId) {
                    return new Promise(function(resolve, reject) {
                        cortanaObject.processNLCommandSync(commandTaskFrame, impressionId);
                        completePromise(function() {
                            return resolve(true);
                        });
                    });
                }

                cortanaObject.searchResultsView = {};
                cortanaObject.searchResultsView.executeSearchAsync = function(query) {
                    return new Promise(function(resolve, reject) {
                        cortanaObject.executeSearchSync(query);
                        completePromise(function() {
                            return resolve(true);
                        });
                    });
                }
                cortanaObject.searchResultsView.deviceSearch = {};
                cortanaObject.searchResultsView.deviceSearch.findAppsAsync = function(appIds) {
                    return new Promise(function(resolve, reject) {
                        var appMapString = cortanaObject.findAppsSync(appIds);
                        var appMap;
                        if (appMapString) {
                            try {
                                appMap = JSON.parse(appMapString);
                            } catch (e) {
                                alert(e);
                            }
                        }
                        completePromise(function() {
                            return resolve(appMap);
                        });
                    });
                }

                var spaEventListenerMap = {};

                // SPA - Potable Cortana
                cortanaObject.spaDialogRuntime = cortanaObject.spaDialogRuntime || {
                    // NL APIs
                    // Doing
                    startLanguageUnderstandingFromVoiceAsync: function(cuInput) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.startLanguageUnderstandingFromVoiceSync(cuInput);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    startDictationAsync: function(cuInput) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.startDictationSync(cuInput);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    endpointAudio: function(operationId) {
                        cortanaObject.endpointAudio(operationId);
                    },
                    dialogComplete: function(completionState) {
                        cortanaObject.dialogComplete(completionState);
                    },
                    // TTS APIs
                    playEarconAsync: function(earConType) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.playEarconSync(earConType);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    // 
                    speakAsync: function(ssmlData) {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.speakSync(ssmlData);
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    // 
                    stopSpeakingAsync: function() {
                        return new Promise(function(resolve, reject) {
                            cortanaObject.stopSpeakingSync();
                            completePromise(function() {
                                return resolve(true);
                            });
                        });
                    },
                    // UI update APIs
                    // 
                    updateTrex: function(trexText) {
                        cortanaObject.updateTrex(trexText);
                    },
                    // 
                    updateGui: function(uiState) {
                        cortanaObject.updateGui(uiState);
                    },
                    changeSticMode: function(isEnabled) {
                        cortanaObject.changeSticMode(isEnabled);
                    },
                    changeSticStateAndInputMode: function(spaSticState, spaSticInputMode) {
                        cortanaObject.changeSticStateAndInputMode(spaSticState, spaSticInputMode);
                    },
                    addEventListener: function(eventName, cb) {
                        if (spaEventListenerMap[eventName] === undefined) {
                            spaEventListenerMap[eventName] = [];
                        }
                        spaEventListenerMap[eventName].push(cb);
                    },
                    triggerEventListener: function(eventName) {
                        if (spaEventListenerMap[eventName] !== undefined) {
                            spaEventListenerMap[eventName].forEach(triggerElement);
                        }
                    }
                };

                return cortanaObject;
            }
        }
        WrapApi.wrapAndroidApi = wrapAndroidApi;
    })(WrapApi || (WrapApi = {}));
    var SearchAppWrapper = {
        CortanaApp: (_w['CortanaApp'] ? WrapApi.wrapAndroidApi(_w['CortanaApp']) : _w['MockCortanaAppInstance'])
    };


    ; ///<reference path="..\Declarations\Shared.d.ts"/>
    var sj_b = _d.body;; ///<reference path="queue.ts"/>
    BM.trigger();;
    _G.AppVer = "8_1_2_4885003";
    //]]>
    </script>
    <script type="text/javascript">
    //<![CDATA[
    _G.FCT = new Date;
    //]]>
    </script>
    <script type="text/javascript">
    //<![CDATA[
    _G.BCT = new Date;
    //]]>
    </script>
    <style type="text/css">
    /*
    Use the javascipt methods in Animation.ts to toggle the animation instead of directly setting the class.      
        
    b_slide - Use this class when an element may slide up/down via animation.  Used by toggleSlide in Animation.ts.
    b_fade - Use this class when an element may fade in/out via animation. Upon completion of animation, element will completely disappear and occupies no space in view. Used by toggleFade in Animation.ts
    b_fadeUp - Use this class when an element may fade up/down via animation. Upon completion of animation, element will completely disappear and occupies no space in view. Used by toggleFadeUp in Animation.ts
    b_slideListUp - Use this class to animate a list of items slide up from bottom and arrive at destination one by one. Used by cascadeList in Animation.ts
    b_anim - Use this class when an element may show/hide via animation.     
    Animate by toggling the b_hide class. We override the default behavior of b_hide here.
*/
    
    .b_fade,
    .b_slide,
    .b_anim,
    .b_fadeUp,
    .b_slideListHide,
    .b_slideTranslate {
        overflow: hidden;
    }
    
    .b_fade.b_hide,
    .b_slide.b_hide,
    .b_slideTranslate.b_hide,
    .b_anim.b_hide,
    .b_fadeUp.b_hide,
    .b_slideListHide {
        display: block;
        /* Needs to be important to override the values from other classes */
        padding-top/* bingcss-ignore */
        : 0 !important;
        padding-bottom/* bingcss-ignore */
        : 0 !important;
        margin-top/* bingcss-ignore */
        : 0 !important;
        margin-bottom/* bingcss-ignore */
        : 0 !important;
        border-top/* bingcss-ignore */
        : 0 !important;
        border-bottom/* bingcss-ignore */
        : 0 !important;
    }
    
    .b_slide.b_hide,
    .b_anim.b_hide,
    .b_slideListHide {
        /* Needs to be important to override the values from other classes */
        height/* bingcss-ignore */
        : 0 !important;
    }
    /* slide up/down the element with fixed/known height */
    
    .b_anim {
        -webkit-transition: all 250ms;
        -moz-transition: all 250ms;
        -o-transition: all 250ms;
        transition: all 250ms;
    }
    /* fade out the element and makes sure no space is occupied upon completion*/
    
    .b_fade {
        opacity: 1;
        max-height: 9999px;
        /* open up the container first, then fade in the content*/
        -webkit-transition: opacity linear 250ms, max-height linear 0ms 0ms;
        -moz-transition: opacity linear 250ms, max-height linear 0ms 0ms;
        -o-transition: opacity linear 250ms, max-height linear 0ms 0ms;
        transition: opacity linear 250ms, max-height linear 0ms 0ms;
    }
    
    .b_fade.b_hide {
        opacity: 0;
        max-height: 0;
        /* fade out the content first, then collapse the container*/
        -webkit-transition: opacity linear 250ms, max-height linear 0ms 250ms;
        -moz-transition: opacity linear 250ms, max-height linear 0ms 250ms;
        -o-transition: opacity linear 250ms, max-height linear 0ms 250ms;
        transition: opacity linear 250ms, max-height linear 0ms 250ms;
    }
    /* fade up the element and makes sure no space is occupied upon completion.  This is usually used for text animation*/
    
    .b_fadeUp {
        opacity: 1;
        max-height: 9999px;
        -webkit-transform: translateY(0);
        -moz-transform: translateY(0);
        -o-transform: translateY(0);
        transform: translateY(0);
        -webkit-transition: opacity linear 170ms, -webkit-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms;
        -moz-transition: opacity linear 170ms, -moz-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms;
        -o-transition: opacity linear 170ms, -o-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms;
        transition: opacity linear 170ms, transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms;
    }
    
    .b_fadeUp.b_hide {
        opacity: 0;
        max-height: 0;
        -webkit-transform: translateY(10px);
        -moz-transform: translateY(10px);
        -o-transform: translateY(10px);
        transform: translateY(10px);
        -webkit-transition: opacity linear 170ms, -webkit-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms 500ms;
        -moz-transition: opacity linear 170ms, -moz-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms 500ms;
        -o-transition: opacity linear 170ms, -o-transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms 500ms;
        transition: opacity linear 170ms, transform cubic-bezier(0.15, 0.85, 0.35, 1) 500ms, max-height linear 0ms 500ms;
    }
    /* slide up/down the element */
    
    .b_slide,
    .b_slide.b_hide {
        -webkit-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 250ms;
        -moz-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 250ms;
        -o-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 250ms;
        transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 250ms;
    }
    
    .b_slideTranslate {
        max-height: 9999px;
        -webkit-transform: translateY(0);
        -moz-transform: translateY(0);
        -o-transform: translateY(0);
        transform: translateY(0);
        -webkit-transition: -webkit-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 0ms;
        -moz-transition: -moz-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 0ms;
        -o-transition: -o-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 0ms;
        transition: transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 0ms;
    }
    
    .b_slideTranslate.b_hide {
        max-height: 0;
        -webkit-transform: translateY(-200px);
        -moz-transform: translateY(-200px);
        -o-transform: translateY(-200px);
        transform: translateY(-200px);
        -webkit-transition: -webkit-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 250ms;
        -moz-transition: -moz-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 250ms;
        -o-transition: -o-transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 250ms;
        transition: transform cubic-bezier(0.15, 0.85, 0.35, 1) 250ms, max-height linear 0ms 250ms;
    }
    
    .b_fadeAnim {
        -webkit-animation: fadeAnim linear 330ms;
        -moz-animation: fadeAnim linear 330ms;
        -o-animation: fadeAnim linear 330ms;
        animation: fadeAnim linear 330ms;
    }
    /* slide up a list of items from below the viewport into the canvas. Starting translations will be set in Animation.ts.
   Items will arrive one by one, starting from the top. */
    
    .b_slideListHide > li {
        opacity: 0;
    }
    
    .b_slideUp.b_slideListHide {
        opacity: 0;
        -webkit-transform: translateY(200px);
        -moz-transform: translateY(200px);
        -o-transform: translateY(200px);
        transform: translateY(200px);
    }
    
    .b_slideUp:not(.b_slideListHide),
    .b_slideListUp:not(.b_slideListHide) {
        opacity: 1;
        -webkit-transform: translateY(0);
        -moz-transform: translateY(0);
        -o-transform: translateY(0);
        -ms-transform: translateY(0);
        transform: translateY(0);
        -webkit-transition: -webkit-transform cubic-bezier(0.15, 0.85, 0.35, 1) 400ms, opacity linear 250ms;
        -moz-transition: -moz-transform cubic-bezier(0.15, 0.85, 0.35, 1) 400ms, opacity linear 250ms;
        -o-transition: -o-transform cubic-bezier(0.15, 0.85, 0.35, 1) 400ms, opacity linear 250ms;
        transition: transform cubic-bezier(0.15, 0.85, 0.35, 1) 400ms, opacity linear 250ms;
    }
    /* Keyframes animation */
    
    @keyframes fadeAnim {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    @-webkit-keyframes fadeAnim {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    @-moz-keyframes fadeAnim {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    @-o-keyframes fadeAnim {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    /* color overrides for thbrand themable pages */
    
    body.b_theme a:not(.b_moreLink):not(.b_accentColor),
    body.b_theme a:visited:not(.b_moreLink):not(.b_accentColor),
    body.b_theme #b_results > li a:visited:not(.b_moreLink):not(.b_accentColor) {
        color: #0078d7;
    }
    
    body.b_theme .sml a:not(.b_accentColor),
    body.b_theme .sml a:visited:not(.b_accentColor),
    body.b_theme .b_corActList a:not(.b_accentColor),
    body.b_theme .b_corActList a:visited:not(.b_accentColor) {
        color/* bingcss-ignore: expansion links should inherit the accent color */
        : inherit;
    }
    /* color overrides for Dark themable pages */
    
    body.b_thDark,
    body.b_thDark #b_pole .b_ans,
    body.b_thDark #b_results > li,
    body.b_thDark #b_content > .sml {
        background-color: black;
    }
    
    body.b_thDark,
    body.b_thDark #b_results,
    body.b_thDark #b_results .b_defaultText,
    body.b_thDark #b_results a.recourseLink,
    body.b_thDark .cbl,
    body.b_thDark .b_corActList,
    body.b_thDark .b_promoteText,
    body.b_thDark .b_action {
        color: white;
    }
    
    body.b_thDark .b_factrow,
    body.b_thDark .b_attribution,
    body.b_thDark .b_focusLabel,
    body.b_thDark .b_secondaryFocus,
    body.b_thDark .b_secondaryText,
    body.b_thDark .b_demoteText,
    body.b_thDark .b_footnote,
    body.b_thDark .b_dropdown,
    body.b_thDark .b_footnote .cbl,
    body.b_thDark .b_meta,
    body.b_thDark .b_entitySubTitle,
    body.b_thDark #b_results .b_footnote a,
    body.b_thDark #b_results .b_footnote a:visited,
    body.b_thDark cite,
    body.b_thDark #b_results cite.sb_crmb a,
    body.b_thDark #b_results cite a.sb_metalink {
        color/* bingcss-ignore: value not in palette; convert to LESS */
        : #bbbbbb;
    }
    /* force type to Segoe UI typography for themable pages */
    /* register with SegoeFontFaces as a dependency */
    
    body.b_theme,
    body.b_theme h3,
    body.b_theme h4,
    body.b_theme h5,
    body.b_theme .b_groupLabel {
        font-size: 15px;
        line-height: 20px;
    }
    
    body.b_theme .b_groupLabel,
    body.b_theme .b_strong,
    body.b_theme strong,
    body.b_theme .pushpin,
    body.b_theme .cardLabel {
        font-weight: 600;
        /* Semibold variant */
    }
    
    body.b_theme h1,
    body.b_theme h2,
    body.b_theme .b_secondaryFocus,
    body.b_theme .b_focusTextExtraSmall,
    body.b_theme .b_mText {
        font-size: 20px;
        line-height: 24px;
    }
    
    body.b_theme select,
    body.b_theme .s_btn.b_highlighted a,
    body.b_theme input[type="text"],
    body.b_theme .cbtn input {
        font-size: 15px;
    }
    
    body.b_theme #fti3,
    body.b_theme #ftrLnks,
    body.b_theme .b_focusLabel,
    body.b_theme .b_footnote,
    body.b_theme .b_meta,
    body.b_theme .b_corActList,
    body.b_theme .pushpin,
    body.b_theme .cardLabel,
    body.b_theme .sb_count {
        font-size: 13px;
        line-height: 16px;
    }
    /*Focus text styles*/
    
    body.b_theme .b_focusTextSmall,
    body.b_theme .b_focusTextMedium,
    body.b_theme .b_focusTextLarge {
        font-weight: 300;
        /* Semilight variant */
    }
    
    body.b_theme .b_focusTextSmall {
        font-size: 24px;
        line-height: 28px;
    }
    
    body.b_theme .b_focusTextMedium {
        font-size: 34px;
        line-height: 40px;
    }
    
    body.b_theme .b_focusTextLarge {
        font-size: 46px;
        line-height: 56px;
    }
    
    body.b_theme,
    body.b_theme input,
    body.b_theme textarea,
    body.b_theme button,
    body.b_theme select,
    body.b_theme option,
    body.b_theme strong,
    body.b_theme .b_strong,
    body.b_theme .b_no h4,
    body.b_theme .b_focusTextSmall,
    body.b_theme .b_focusTextMedium,
    body.b_theme .b_focusTextLarge {
        font-family: Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(am, ti),
    body.b_theme input:-ms-lang(am, ti),
    body.b_theme textarea:-ms-lang(am, ti),
    body.b_theme button:-ms-lang(am, ti),
    body.b_theme select:-ms-lang(am, ti),
    body.b_theme option:-ms-lang(am, ti),
    body.b_theme strong:-ms-lang(am, ti),
    body.b_theme .b_strong:-ms-lang(am, ti),
    body.b_theme .b_no h4:-ms-lang(am, ti),
    body.b_theme .b_focusTextSmall:-ms-lang(am, ti),
    body.b_theme .b_focusTextMedium:-ms-lang(am, ti),
    body.b_theme .b_focusTextLarge:-ms-lang(am, ti) {
        font-family: Ebrima, Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme input:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme textarea:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme button:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme select:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme option:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme strong:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme .b_strong:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme .b_no h4:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme .b_focusTextSmall:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme .b_focusTextMedium:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te),
    body.b_theme .b_focusTextLarge:-ms-lang(as, bn, gu, hi, kn, kok, ml, mr, ne, or, pa, si, ta, te) {
        font-family: "Nirmala UI", Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(chr-CHER-US),
    body.b_theme input:-ms-lang(chr-CHER-US),
    body.b_theme textarea:-ms-lang(chr-CHER-US),
    body.b_theme button:-ms-lang(chr-CHER-US),
    body.b_theme select:-ms-lang(chr-CHER-US),
    body.b_theme option:-ms-lang(chr-CHER-US),
    body.b_theme strong:-ms-lang(chr-CHER-US),
    body.b_theme .b_strong:-ms-lang(chr-CHER-US),
    body.b_theme .b_no h4:-ms-lang(chr-CHER-US),
    body.b_theme .b_focusTextSmall:-ms-lang(chr-CHER-US),
    body.b_theme .b_focusTextMedium:-ms-lang(chr-CHER-US),
    body.b_theme .b_focusTextLarge:-ms-lang(chr-CHER-US) {
        font-family: Gadugi, Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(ja),
    body.b_theme input:-ms-lang(ja),
    body.b_theme textarea:-ms-lang(ja),
    body.b_theme button:-ms-lang(ja),
    body.b_theme select:-ms-lang(ja),
    body.b_theme option:-ms-lang(ja),
    body.b_theme strong:-ms-lang(ja),
    body.b_theme .b_strong:-ms-lang(ja),
    body.b_theme .b_no h4:-ms-lang(ja),
    body.b_theme .b_focusTextSmall:-ms-lang(ja),
    body.b_theme .b_focusTextMedium:-ms-lang(ja),
    body.b_theme .b_focusTextLarge:-ms-lang(ja) {
        font-family: "Yu Gothic UI", Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(ko),
    body.b_theme input:-ms-lang(ko),
    body.b_theme textarea:-ms-lang(ko),
    body.b_theme button:-ms-lang(ko),
    body.b_theme select:-ms-lang(ko),
    body.b_theme option:-ms-lang(ko),
    body.b_theme strong:-ms-lang(ko),
    body.b_theme .b_strong:-ms-lang(ko),
    body.b_theme .b_no h4:-ms-lang(ko),
    body.b_theme .b_focusTextSmall:-ms-lang(ko),
    body.b_theme .b_focusTextMedium:-ms-lang(ko),
    body.b_theme .b_focusTextLarge:-ms-lang(ko) {
        font-family: "Malgun Gothic", Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(th, km, lo),
    body.b_theme input:-ms-lang(th, km, lo),
    body.b_theme textarea:-ms-lang(th, km, lo),
    body.b_theme button:-ms-lang(th, km, lo),
    body.b_theme select:-ms-lang(th, km, lo),
    body.b_theme option:-ms-lang(th, km, lo),
    body.b_theme strong:-ms-lang(th, km, lo),
    body.b_theme .b_strong:-ms-lang(th, km, lo),
    body.b_theme .b_no h4:-ms-lang(th, km, lo),
    body.b_theme .b_focusTextSmall:-ms-lang(th, km, lo),
    body.b_theme .b_focusTextMedium:-ms-lang(th, km, lo),
    body.b_theme .b_focusTextLarge:-ms-lang(th, km, lo) {
        font-family: "Leelawadee UI", Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme input:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme textarea:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme button:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme select:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme option:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme strong:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme .b_strong:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme .b_no h4:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme .b_focusTextSmall:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme .b_focusTextMedium:-ms-lang(zh-CN, zh-Hans, zh-SG),
    body.b_theme .b_focusTextLarge:-ms-lang(zh-CN, zh-Hans, zh-SG) {
        font-family: "Microsoft YaHei UI", Segoe, Arial, sans-serif;
    }
    
    body.b_theme:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme input:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme textarea:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme button:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme select:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme option:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme strong:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme .b_strong:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme .b_no h4:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme .b_focusTextSmall:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme .b_focusTextMedium:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO),
    body.b_theme .b_focusTextLarge:-ms-lang(zh-HK, zh-TW, zh-Hant, zh-MO) {
        font-family: "Microsoft JhengHei UI", Segoe, Arial, sans-serif;
    }
    
    #vidans2 {
        margin-top/*bingcss-ignore*/
        : -10px;
    }
    
    #vidans2 .vidr {
        position: relative;
        height: auto;
        width: 100%;
        padding/*bingcss-ignore*/
        : 3px 0;
        border-top: 1px solid #eeeeee;
        background-color: white;
    }
    
    #vidans2 .vidr:last-child {
        border-bottom: 1px solid #eeeeee;
    }
    
    #vidans2 .vidr.idx2 {
        margin-bottom: 0;
    }
    
    #vidans2 .vidr .videoThumb {
        position: relative;
        float: left;
        margin-right: 10px;
    }
    
    #vidans2 .vidr > a {
        margin-left: 131px;
        height: 74px;
    }
    
    #vidans2 .vidrc.stitched .vidr > a {
        margin-left: 120px;
        height: 68px;
    }
    
    #vidans2 .vidr .videoDetail {
        padding/*bingcss-ignore*/
        : 10px;
    }
    
    #vidans2 .vidr .videoDetail .si {
        position: absolute;
        bottom: 6px;
    }
    
    #vidans2 .vidrc.stitched .vidr .videoDetail .si {
        left: initial;
    }
    
    #vidans2 .vidr .videoTitle {
        color: #1020d0;
        margin-bottom: 3px;
        line-height: 17px;
        overflow: hidden;
    }
    
    #vidans2 .vidr cite.videoSource {
        display: inline-block;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 100%;
        bottom: 0;
        position: absolute;
        padding-left: 20px;
        left: 10px;
        right: 60px;
        color: #008900;
    }
    
    #vidans2 .vidrc.stitched .vidr cite.videoSource {
        right: 10px;
    }
    
    #vidans2 .vidr cite.noIcon {
        padding-left: 0;
    }
    
    #vidans2 .vidr cite.noPreview {
        padding-right: 0;
    }
    
    #vidans2 .vtv2 {
        margin: 0;
        font-size: 11px;
        font-family: HelveticaNeue, Roboto, Arial, sans-serif;
    }
    
    #vidans2 .vtv2 a.vt3b {
        width: 100%;
        height: 74px;
    }
    
    #vidans2 .vtv2 a.vtst {
        width: 120px;
        height: 68px;
    }
    
    .vidr .vtv2:hover {
        border: 0;
    }
    
    #vidans2 .vidr a:hover .VideoAnswer.MM_Mask,
    #vidans2 .vidr a:hover .VideoAnswer.MM_MaskText {
        display: block;
    }
    
    #vidans2 .vidr .vtv2 .b_lLeft.vidPaid {
        padding/*bingcss-ignore*/
        : 4px 0;
        top: 2px;
    }
    
    #vidans2 .vidr .vtv2 .b_lLeft.vidPaid img {
        margin-bottom: -6px;
    }
    
    .vtv2 > a > .vt_text > .b_lLeft {
        display: initial;
        padding/*bingcss-ignore*/
        : 4px;
        color: white;
    }
    
    #vidans2 .ans3 {
        position: relative;
        margin-bottom: -2px;
    }
    
    .vidr {
        float: left;
        width: 172px;
        height: 147px;
        background-color: #eeeeee;
        margin: 0 1px 1px 0;
    }
    
    .vidr.idx2 {
        margin-bottom: 12px;
    }
    
    .vidr:last-child {
        margin-bottom: 5px;
    }
    
    .vidr > .b_lLeft {
        padding-bottom: 10px;
        padding-right: 10px;
        line-height: 15px;
    }
    
    .vidr a {
        position: relative;
        display: block;
        text-decoration: none;
    }
    
    .vidr a:hover {
        text-decoration: none;
    }
    
    .vidr cite {
        color: #444444;
    }
    
    .vid2 .vidr {
        overflow: hidden;
    }
    
    .vid2s .vidr {
        height: 104px;
    }
    
    .vidr .vtv2 {
        border: 0;
    }
    
    .vidr .vtv2 a {
        border: 0;
        height: 97px;
        width: 172px;
    }
    
    .vidr .vtv2 a:hover {
        border-color: white;
        background-color: white;
    }
    
    .vidr .vtv2 a .vthv {
        top: 39px;
    }
    
    .vidr a:hover .VideoAnswer.MM_Mask,
    .vidr a:hover .VideoAnswer.MM_MaskText {
        display: none;
    }
    
    .vidr a .videoInfoPanel .pubInfo {
        padding/*bingcss-ignore*/
        : 1px 4px 4px 4px;
        color: #404040;
        line-height: normal;
    }
    
    .vidr a .videoInfoPanel .mtc {
        position: absolute;
        width: 162px;
        top: 29px;
        color: #404040;
        padding-left: 3px;
    }
    
    .vidr a .videoInfoPanel .mtc > .mti,
    .vidr a .videoInfoPanel .mtc > .mt {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
    }
    
    .vidr a .videoInfoPanel .mtc > .rms_img {
        float: left;
        margin-right: 3px;
    }
    
    .vidr a .videoInfoPanel .ib {
        position: relative;
        display: inline-block;
        margin-right: 4px;
        top: -1px;
    }
    
    .vidr a .videoInfoPanel .ib .pl {
        background: url('/s/mm2.png') -31px -54px;
        height: 8px;
        width: 7px;
        display: inline-block;
    }
    
    .vidr a .videoInfoPanel .ib .ple {
        background: url('/s/mm2.png') -31px -44px;
        height: 8px;
        width: 12px;
        display: inline-block;
    }
    
    .vidrc > .tct > a {
        width: 129px;
        height: 62px;
        display: block;
        position: relative;
        z-index: 1;
    }
    
    .vidrc > .tct > a > .title {
        margin-bottom: 10px;
        padding-right: 10px;
        height: 30px;
        overflow: hidden;
    }
    
    .vidrc > .tct > .b_1linetrunc {
        position: relative;
        top: -22px;
        padding-bottom: 0;
    }
    
    .videoPreview {
        display: table-cell;
        cursor: pointer;
        position: absolute;
        color: #1020d0;
        right: 5px;
        bottom: 5px;
        max-width: 60px;
        text-overflow: ellipsis;
        overflow: hidden;
        font-size: 11px;
        white-space: nowrap;
    }
    
    .vt_con {
        position: relative
    }
    
    .vt_con .vt_tl {
        display: -moz-inline-stack;
        display: inline-block;
        position: relative;
        border: 1px solid #525051;
        margin: 1px;
        background: #000;
        text-align: center
    }
    
    .vt_vsm {
        width: 100%;
        display: none;
        position: absolute;
        top: 15px;
        left: 0;
        color: #fff;
        text-decoration: underline;
        cursor: pointer
    }
    
    .vt_tl:hover {
        text-decoration: none
    }
    
    a:hover .vt_vsm {
        display: inline
    }
    
    a:hover .vt_vsp {
        display: none
    }
    
    .vt_vsp {
        position: absolute;
        bottom: 0;
        right: 0;
        height: 20px;
        width: 20px
    }
    
    .vt_pl {
        background-image: url("/s/a/mm_pl.png");
        background-repeat: no-repeat
    }
    
    .vt_vp,
    .vt_vph {
        position: absolute;
        width: 100%;
        height: 100%;
        cursor: pointer;
        z-index: 1;
        padding: 2px;
        top: -2px;
        left: -2px;
        _padding: 0;
        _top: 0;
        _left: 0
    }
    
    .vt_stl:hover img,
    .vt_vph {
        opacity: .5;
        filter: alpha(opacity=50)
    }
    
    .vt_vph {
        background: #000 url(/fd/s/mm/vld.gif) no-repeat center center
    }
    
    .vt_con object {
        width: 100%;
        height: 100%
    }
    
    .vtbb {
        border: 1px solid #04c;
        padding: 1px
    }
    
    .vtbb a.vt_tl {
        margin: 0
    }
    
    .vtv2 {
        border: 1px solid transparent;
        _border: 0;
        position: relative;
        margin: 3px 0 6px 0;
        display: inline-block;
        *zoom: 1;
        *display: inline
    }
    
    .vtv2:hover {
        border: 1px solid #36b;
        z-index: 1
    }
    
    .vtv2 a {
        border: 1px solid #ccc;
        display: block;
        text-decoration: none
    }
    
    .vtv2 a:hover {
        border-color: #fff;
        background-color: #000
    }
    
    .vtv2 a:hover img {
        opacity: .35;
        filter: alpha(opacity=35)
    }
    
    .mask {
        width: 100%;
        height: 100%
    }
    
    .vtv2 a:hover .mask {
        background-color: #000;
        opacity: .65;
        filter: alpha(opacity=65)
    }
    
    .vthv {
        display: none;
        position: absolute;
        left: 0;
        top: 13px;
        width: 100%;
        cursor: pointer;
        color: #fff;
        font-size: 13px;
        text-align: center;
        text-decoration: underline
    }
    
    .vthv span {
        margin: 2px
    }
    
    a:hover .vthv {
        display: inline
    }
    
    .vtmu,
    .vtpl {
        position: absolute;
        bottom: 1px;
        left: 1px;
        width: 20px;
        height: 20px;
        cursor: pointer;
        background: url(/fd/s/mm1.png)
    }
    
    .vtmu {
        background-position: -67px -44px
    }
    
    .vtpl {
        background-position: -45px -44px
    }
    
    .irhc .vt_tl {
        text-align: center
    }
    
    .irhc .vt_vsm {
        display: inline;
        color: #fff;
        background: #000
    }
    
    .irhc .vt_tl img {
        left: 0
    }
    
    .vt_con {
        position: relative
    }
    
    .vt_con .vt3b {
        width: 131px;
        height: 74px
    }
    
    .vt_text {
        position: absolute;
        bottom: 2px;
        left: 0;
        background: transparent
    }
    
    .vt_text .b_lLeft {
        margin-right: 1px;
        position: relative;
        display: inline-block;
        height: 20px;
        line-height: 20px;
        padding: 0 4px;
        top: 2px;
        background: #000;
        background: rgba(0, 0, 0, .7)
    }
    
    .b_caption .vt_text .b_lLeft {
        top: 1px;
        left: 1px
    }
    
    .vt_text .plc {
        width: 15px;
        color: transparent;
        text-align: center
    }
    
    .vtv2 a:hover .vt_text,
    .vt_tl:hover .vt_text {
        display: none;
        background: transparent
    }
    
    .rms_rmsanswersMultimediaVideoAnswer_Bundle {
        background-image: url(/rms/VideoAnswer_Bundle/c/34bc16aa/8889123d.png?bu=rms+answers+Multimedia+videoanswer_play%2cvideoanswer_externalplay);
        display: inline-block;
        background-repeat: no-repeat;
    }
    
    .rms_rmsanswersMultimediaVideoAnswer_Play {
        height: 8px;
        width: 7px;
    }
    
    .mobilevideoitemtitle_mmftb {
        width: 100%;
        max-width: 100%;
        height: 34px;
        position: relative;
        overflow: hidden;
        word-wrap: break-word;
        word-break: normal;
    }
    
    .mobilevideoitemtitle_mmftb:after {
        content: "";
        bottom: 0;
        right: 0;
        width: 50px;
        height: 17px;
        ;
        position: absolute;
    }
    
    .mobilevideoitemtitle_mmftb:after {
        background: -webkit-linear-gradient(left, rgba(255, 255, 255, 0), rgba(255, 255, 255, 100));
        background: -moz-linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 100));
        background: -o-linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 100));
        background: -ms-linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 100));
        background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(255, 255, 255, 100));
    }
    
    .rms_rmsanswersMultimediaVideoAnswer_ExternalPlay {
        height: 8px;
        width: 13px;
        background-position: -8px 0;
    }
    
    .wpc_tp,
    #b_results div.wpc_tp {
        margin: -13px 0;
    }
    
    .wpc_tp #iaplanner {
        padding-top/* bingcss-ignore: Top padding is OK before first element in a container */
        : 13px;
    }
    
    .wpc_tp .b_subModule.b_partialModule {
        padding-bottom: 0;
        border-bottom: 0;
    }
    
    .tp_exptrgimg {
        width: 14px;
        height: 10px;
        display: block;
        margin: 15px auto 0;
    }
    
    .wpc_tp .b_hList > li:not(:last-child) {
        padding-right: 1px;
    }
    
    .wpc_tp .b_hList p {
        padding: 0 5px;
        font-size: 13px;
    }
    
    .wpc_tp .b_hList p.b_smText {
        font-size: 11px;
    }
    
    .wpc_tp .b_hList .cico,
    .wpc_tp .b_mBottom {
        padding-bottom: 5px;
    }
    
    .b_infocardContent > div {
        padding-bottom: 10px;
    }
    
    .b_truncate {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
    }
    
    .tp_exptrg {
        padding/* bingcss-ignore: Padding required to expand clickable area */
        : 10px 0;
    }
    
    span.tp_exptrgimg {
        float: left;
        margin: 2px 10px 0 0;
    }
    
    #wpc_tp #tp_mobileexp {
        margin-top: -1px;
    }
    
    .b_infocardTop h2 {
        font: 24px/28px 'Segoe UI Semilight';
    }
    
    .b_factrow .cbl {
        font-weight: normal;
        font-family: 'Segoe UI';
    }
    /*
// Styles for common image
//
// cico - image container
*/
    
    .cico {
        position: relative;
        overflow: hidden;
    }
    /*This file is intentionally left empty*/
    
    .imse {}
    
    .b_top .sml.topanswer a,
    .b_top .btm_sml a {
        background-color: #f9f9f9;
        margin: 0 -19px -10px -19px;
        display: block;
        text-decoration: none;
        text-align: center;
    }
    
    .b_top .sml.topanswer a {
        line-height: 35px;
        outline: none;
    }
    
    .b_top .btm_sml .leftAlign {
        text-align: left;
    }
    
    .b_top .btm_sml a {
        line-height: 40px;
        height: 40px;
        vertical-align: middle;
    }
    
    .b_top .btm_sml {
        padding-bottom: 0;
    }
    
    .b_top .btm_sml a:hover,
    .b_top .sml.topanswer a:hover {
        background-color: #eeeeee;
    }
    
    .b_top .btm_sml a .expansionDefaultText {
        display: none;
        text-align: center;
    }
    
    .b_top .btm_sml a .expansionCustomizedText {
        text-align: left;
        padding: 0 0 0 19px;
        display: inline-block;
        *display: inline;
        zoom: 1;
    }
    
    .b_top .btm_sml .expansionChevronUp {
        background-image: url(/sa/simg/ansexp_chev_up.png);
    }
    
    .b_top .btm_sml .expansionChevronDown {
        background-image: url(/sa/simg/ansexp_chev_down.png);
    }
    
    .b_top .btm_sml .expansionChevronDown,
    .b_top .btm_sml .expansionChevronUp {
        background-repeat: no-repeat;
        height: 9px;
        width: 16px;
        display: inline-block;
        *display: inline;
        zoom: 1;
        background-position: 0 0;
        margin: 0 19px 0 12px;
    }
    
    .b_top .btm_sml .expandChevronContainer {
        line-height: 40px;
        vertical-align: middle;
    }
    
    .b_top .btm_sml .expansionChevronDown.noExpandText,
    .b_top .btm_sml .expansionChevronUp.noExpandText {
        margin: 0;
    }
    
    .b_top .btm_sml .expansionChevronUp.hasExpandText,
    .b_top .btm_sml .expansionChevronDown.hasExpandText {
        margin-bottom: 0;
    }
    
    #b_results > .b_top .btm_sml a,
    #b_results > .b_top .btm_sml a:visited {
        color: #444444;
    }
    
    .e_mhdr .btm_sml a {
        padding: 0;
        border-top: 0;
        margin-top: 10px;
    }
    
    .btm_sml a {
        background-color: #f9f9f9;
        border-bottom: 1px solid #cccccc;
        vertical-align: middle;
        height: 39px;
        line-height: 39px;
        text-decoration: none;
        text-align: left;
        margin: 0 -10px;
        padding: 0 12px 0 10px;
        display: block;
    }
    
    li .btm_sml:last-child a {
        margin-bottom: -15px;
    }
    
    .btm_sml .ciptr,
    .btm_sml .ciplr {
        margin-left: 12px;
    }
    
    #b_results > li .btm_sml a,
    #b_results > li .btm_sml a:visited {
        color: #444444;
    }
    
    .btm_sml .sw_plus,
    .btm_sml .sw_minus,
    .sml .sw_plus,
    .sml .sw_minus {
        display: inline-block;
        text-decoration: none;
        margin: 0 5px 1px 0;
    }
    
    .b_tblWithExpansion .btm_sml,
    .b_tblWithExpansion .sml {
        padding-bottom: 10px;
    }
    
    .b_relative .btm_sml,
    .b_relative .sml {
        letter-spacing: 2px;
    }
    
    .inline {
        display: inline-block;
        margin-left: 4px;
    }
    
    .sml.inline .sw_plus,
    .sml.inline .sw_minus {
        margin: 0;
    }
    
    .hidden_nostyle {
        padding: 0 !important;
        margin: 0 !important;
    }
    /*
    for slide animation, from animation.css
*/
    
    .exp_slide {
        overflow: hidden;
        -webkit-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        -moz-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        -o-transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        transition: height cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
    }
    
    .exp_slide.b_hide {
        display: block;
        /* Needs to be important to override the values from other classes */
        height: 0 !important;
        padding-top/* bingcss-ignore */
        : 0 !important;
        padding-bottom: 0 !important;
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        border-top: 0 !important;
        border-bottom: 0 !important;
    }
    /*
    for scroll back when collapse
*/
    
    body.exp_scroll {
        -webkit-transition: margin-top cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        -moz-transition: margin-top cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        -o-transition: margin-top cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
        transition: margin-top cubic-bezier(0.15, 0.85, 0.35, 1) 350ms;
    }
    /*
//  cipl - Common play icon for use with text link
//  cipa - Common play icon link
//  cipg - Disabled common play icon
//  cipt - Disabled common play icon for use with text
//  ciptr - icon on right side
//  ciplr - icon on right side
*/
    
    .cipt,
    .cipg,
    .cipa,
    .cipl,
    .ciptr,
    .ciplr {
        display: inline-block;
    }
    
    .cipa,
    .cipl,
    .ciplr {
        cursor: pointer;
    }
    
    .vab {
        vertical-align: bottom;
    }
    
    .vam {
        vertical-align: middle;
    }
    
    .vat {
        vertical-align: top;
    }
    
    .vabl {
        vertical-align: baseline;
    }
    
    .vatt {
        vertical-align: text-top;
    }
    
    .vatb {
        vertical-align: text-bottom;
    }
    
    .cipt,
    .cipl {
        margin-right: 10px;
    }
    
    .b_action > .cipt,
    .b_action > .cipl {
        float: left;
    }
    
    .ciptr,
    .ciplr {
        margin-left: 10px;
    }
    /*This file is intentionally left empty*/
    
    .imse {}
    /*
// Styles for row and column padding
*/
    
    .b_gridrow > div {
        float: left;
    }
    
    .b_gridrow {
        overflow: hidden;
    }
    /* Bottom padding */
    
    .b_xsbpad {
        padding-bottom: 2px;
    }
    
    .b_smbpad {
        padding-bottom: 5px;
    }
    
    .b_mdbpad {
        padding-bottom: 10px;
    }
    
    .b_bgbpad {
        padding-bottom: 15px;
    }
    
    .b_xbbpad {
        padding-bottom: 20px;
    }
    /*remove extra bottom when grid has parent grid*/
    
    .b_xsbpad > div > .b_xsbpad:last-child {
        padding-bottom: 0;
    }
    
    .b_smbpad > div > .b_smbpad:last-child {
        padding-bottom: 0;
    }
    
    .b_mdbpad > div > .b_mdbpad:last-child {
        padding-bottom: 0;
    }
    
    .b_bgbpad > div > .b_bgbpad:last-child {
        padding-bottom: 0;
    }
    
    .b_xbbpad > div > .b_xbbpad:last-child {
        padding-bottom: 0;
    }
    /* Right padding */
    
    .b_xsrpad {
        padding-right: 2px;
    }
    
    .b_smrpad {
        padding-right: 5px;
    }
    
    .b_mdrpad {
        padding-right: 10px;
    }
    
    .b_bgrpad {
        padding-right: 15px;
    }
    
    .b_xbrpad {
        padding-right: 20px;
    }
    
    .avc .b_focusTextExtraSmall {
        padding-bottom: 4px;
        line-height: 1.2em;
    }
    
    .avc .b_factrow {
        padding-bottom: 4px;
    }
    
    .avc .b_float_img,
    .avc .b_floatR_img,
    .avc .b_footnote {
        padding-bottom: 0;
    }
    
    div.avc {
        padding-bottom: 10px;
    }
    
    .b_gridrow div.avc.avc2linesimg {
        padding-bottom: 0;
        margin-bottom: -1px;
    }
    
    .avc.avcradius .b_float_img img {
        border-radius: 20%;
    }
    
    .b_imgSet {
        overflow: hidden;
        margin-left: -10px;
        margin-right: -10px;
    }
    
    .b_imgSet ul {
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        padding-left: 10px;
        padding-right: 10px;
        -webkit-overflow-scrolling: touch;
    }
    
    .b_imgSet ul::-webkit-scrollbar {
        -webkit-appearance: none;
    }
    
    .b_imgSet .b_hList {
        padding-bottom: 0;
    }
    
    .b_imgSet .b_hList li {
        white-space: normal;
    }
    
    .b_imgSet .b_moreLink {
        padding-bottom: 0;
        text-align: center;
        background-color/* bingcss-ignore: For experiment */
        : #999999;
        height: 80px;
    }
    
    .b_imgSet .tall_m .b_moreLink {
        height: 118px;
    }
    
    .b_imgSet .wide_m .b_moreLink {
        height: 79px;
    }
    
    .b_imgSet .b_hList li.square_m,
    .b_imgSet .b_hList li.tall_m {
        width: 80px;
    }
    
    .b_imgSet .b_hList li.wide_m {
        width: 139px;
    }
    
    .b_imgSet .b_moreText {
        top: 50%;
        padding: 0 5px;
        transform: translateY(-50%);
        position: relative;
        -webkit-transform: translateY(-50%);
        color/* bingcss-ignore: For experiment */
        : white;
    }
    
    .b_imagePair .inner img,
    .b_hList img {
        display: block;
    }
    
    .b_imagePair > .inner,
    .b_hList .cico {
        padding-bottom: 10px;
    }
    
    .b_title .b_imagePair > .inner,
    .b_vList > li > .b_imagePair > .inner,
    .b_hList .b_imagePair > .inner,
    .b_vPanel > div > .b_imagePair > .inner,
    .b_gridList .b_imagePair > .inner,
    .b_caption .b_imagePair > .inner,
    .b_attribution .b_imagePair > .inner,
    .b_imagePair > .inner > .b_footnote,
    /* nuke .b_footnote's padding so the .inner and .b_footnote don't double-pad */
    
    .b_poleContent .b_imagePair > .inner {
        padding-bottom: 0;
    }
    
    .b_imagePair > .inner {
        float: left;
    }
    
    .b_imagePair.reverse > .inner {
        float: right;
    }
    
    .b_imagePair .b_imagePair:last-child:after {
        clear: none;
    }
    
    .b_algo .b_title .b_imagePair,
    .b_ans .b_title .b_imagePair {
        display: block;
    }
    
    li.square_m {
        width: 69px;
        word-wrap: break-word;
    }
    
    #b_context .b_rs .b_vList > li {
        padding-bottom: 4px;
    }
    
    #b_context .b_rs > .b_vList {
        padding-bottom: 6px;
    }
    
    a {
        a: 1
    }
    
    .sb_pag {
        padding: 0;
        margin: 0;
        width: 100%;
    }
    
    .sb_pag span {
        margin: 0;
        padding: 0;
        float: left;
        width: 14.24%;
    }
    
    .sb_pag a {
        float: left;
        cursor: pointer;
        text-decoration: none;
        padding/*bingcss-ignore: we aren't stacking elements vertically, so top padding should be OK'*/
        : 5px 11px;
        margin: 0 6px 0 0;
        text-align: center;
        font-size: 16px;
    }
    
    a.sb_pagP,
    a.sb_pagN {
        padding/*bingcss-ignore: same as above, with a slight change due to us using a sprite sheet for content in place of numbers*/
        : 5px 8px;
        border: none;
        text-decoration: none;
        font-weight: bold;
        white-space: nowrap;
    }
    
    a.sb_pagS {
        background: #ededed;
        border: 1px solid #c8c8c8;
        font-weight: bold;
        color: #333333;
    }
    
    a.sb_pagP {
        margin-right: 11px;
        padding-left: 0;
    }
    </style>
    <script type="text/javascript">
    //<![CDATA[
    ///<reference path="..\Declarations\Shared.d.ts" />
    ///<reference path="..\Declarations\CssClass.d.ts" />
    var Animation;
    (function(Animation) {
        var toggleClass = "b_hide";
        // this list need to be kept in sync so that all animations are cleared in toggleHide
        var animClasses = ["b_slideListUp", "b_slide", "b_fade", "b_fadeUp"];
        var elementLogMap = {};
        var curElementKey = 0;
        // these variables keep track of vendor-prefixed css/events
        var transitionEndEvent = "transitionend";
        var transformCss = "transform";
        var vendorEndEvents = {
            o: "oTransitionEnd",
            moz: "transitionend",
            webkit: "webkitTransitionEnd"
        };

        function IsElementHidden(ele) {
            return Lib.CssClass.contains(ele, "b_hide") || getComputedStyle(ele, null).display === "none";
        }

        function setVendorTransitionPrefix() {
            if ("transition" in _d.documentElement.style) {
                return;
            }
            for (var prefix in vendorEndEvents) {
                var cssPrefix = "-" + prefix + "-";
                if (cssPrefix + "transition" in _d.documentElement.style) {
                    transitionEndEvent = vendorEndEvents[prefix];
                }
            }
        }

        function setVendorCssPrefix() {
            if ("transform" in _d.documentElement.style) {
                return;
            }
            for (var prefix in vendorEndEvents) {
                var prefixedCss = "-" + prefix + "-" + "transform";
                if (prefixedCss in _d.documentElement.style) {
                    transformCss = prefixedCss;
                }
            }
        }

        function setVendorPrefix() {
            setVendorTransitionPrefix();
            setVendorCssPrefix();
        }

        function updateLogEnd(htmlElement) {
            if (htmlElement["AnimationKey"]) {
                var logData = elementLogMap[htmlElement["AnimationKey"]];
                logData.endTime = Date.now();
                if (_w["Log2"]) {
                    Log2.LogEvent("ClientInst", {
                        "T": "AnimationTiming",
                        "startTime": logData.startTime,
                        "endTime": logData.endTime,
                        "AnimationName": logData.animationName
                    }, null, null, null, null, null, null);
                }
            }
        }

        function updateLogStart(htmlElement, animation) {
            curElementKey += 1;
            htmlElement["AnimationKey"] = curElementKey;
            elementLogMap[curElementKey] = {
                startTime: Date.now(),
                endTime: -1,
                animationName: animation
            };
        }

        function cascadeListOld(list) {
            if (!list || !list.children || list.children.length == 0) {
                return;
            }
            var startingOffset = _w.innerHeight;
            list.style[transformCss] = "translateY(" + startingOffset + "px)";
            toggleAnimClass(list, "b_slideListUp");
            Lib.CssClass.remove(list, "b_slideListHide");
            list.style[transformCss] = "";
            var lastAnimatedItem = list.children[list.children.length - 1];
            if (lastAnimatedItem) {
                sj_be(lastAnimatedItem, transitionEndEvent, function(evt) {
                    if (evt.target === lastAnimatedItem && evt.propertyName === transformCss) {
                        updateLogEnd(list);
                        for (var i = 0; i < list.children.length; i++) {
                            var item = list.children[i];
                            item.style[transformCss] = "";
                        }
                    }
                });
                updateLogStart(list, "cascadeListOld");
            }
        }
        Animation.cascadeListOld = cascadeListOld;

        function cascadeList(list) {
            if (!list || !list.children || list.children.length == 0) {
                return;
            }
            var startingOffset = 200;
            list.style[transformCss] = "translateY(" + startingOffset + "px)";
            toggleAnimClass(list, "b_slideListUp");
            Lib.CssClass.remove(list, "b_slideListHide");
            /*
             * This works because when calling list.style the browser will recalculate all styles
             * and the previous change will occur, before we override the value with ""
             */
            list.style[transformCss] = "";
        }
        Animation.cascadeList = cascadeList;

        function toggleSlideTranslate(ele) {
            if (ele) {
                toggleAnimation(ele, "b_slideTranslate", false, [transformCss, transformCss]);
            }
        }
        Animation.toggleSlideTranslate = toggleSlideTranslate;

        function toggleSlide(ele) {
            if (ele) {
                toggleAnimation(ele, "b_slide", true, ["height", "height"]);
            }
        }
        Animation.toggleSlide = toggleSlide;

        function toggleFade(ele) {
            if (ele) {
                toggleAnimation(ele, "b_fade", false, ["opacity", "opacity"]);
            }
        }
        Animation.toggleFade = toggleFade;

        function toggleFadeUp(ele) {
            if (ele) {
                toggleAnimation(ele, "b_fadeUp", false, [transformCss, transformCss]);
            }
        }
        Animation.toggleFadeUp = toggleFadeUp;

        function toggleHide(ele) {
            if (ele) {
                for (var i = 0; i < animClasses.length; i++) {
                    Lib.CssClass.remove(ele, animClasses[i]);
                }
                toggleAnimClass(ele, toggleClass);
                sj_evt.fire("transitionDone", ele);
                // instant animation.  Log both events one after the other
                updateLogStart(ele, "Hide");
                updateLogEnd(ele);
            }
        }
        Animation.toggleHide = toggleHide;

        function forceUpdateStyle(ele) {
            // Due to browser optimization of style update, multiple style changes may go at the same time instead of sequentially.  
            // To force update of styles before applying the animation class, a layout property is accessed, which forces the browser
            // to update the style and layouts.
            var tmp = ele.offsetTop;
        }

        function toggleAnimClass(ele, anim) {
            forceUpdateStyle(ele);
            Lib.CssClass.toggle(ele, anim);
        }
        // to animate on the height of an element, the height needs to be explicitly set on the element.
        function setHeight(ele) {
            var height = ele.clientHeight;
            if (height == 0 && Lib.CssClass.contains(ele, toggleClass)) {
                Lib.CssClass.remove(ele, toggleClass);
                height = ele.clientHeight;
                Lib.CssClass.add(ele, toggleClass);
            }
            if (height > 0) {
                ele.style.height = height + "px";
            }
        }

        function transitionEndHandler(evt, ele, lastProperty, anim) {
            if (evt.target != ele) {
                return;
            }
            // send an event to signal that the ele has finished all transitions
            var prop = Lib.CssClass.contains(ele, "b_hide") ? lastProperty[1] : lastProperty[0];
            if (evt.propertyName === prop) {
                updateLogEnd(ele);
                Lib.CssClass.remove(ele, anim);
                if (evt.propertyName === "height") {
                    // upon height finishes animating, it should be cleared out.
                    ele.style.removeProperty('height');
                }
                sj_ue(ele, transitionEndEvent, transitionEndHandler);
                sj_evt.fire("transitionDone", ele);
            }
        }

        function toggleAnimation(ele, anim, animateHeight, lastProperty) {
            if (animateHeight) {
                setHeight(ele);
            }
            toggleAnimClass(ele, anim);
            toggleAnimClass(ele, toggleClass);
            sj_be(ele, transitionEndEvent, function(evt) {
                transitionEndHandler(evt, ele, lastProperty, anim);
            });
            // log start of animation
            updateLogStart(ele, anim);
        }
        setVendorPrefix();
    })(Animation || (Animation = {}));;
    //]]>
    </script>
    <script type="text/javascript">
    //<![CDATA[
    ///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
    ///<reference path="..\..\..\..\Threshold\src\Content\Script\Declarations\SearchAppWrapper.d.ts" />
    var CUDialog;
    (function(CUDialog) {
        function sendAction(response) {
            SearchAppWrapper.CortanaApp.sendAction(response.CuAction);
        }
        CUDialog.sendAction = sendAction;
    })(CUDialog || (CUDialog = {}));; /// <reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts" />
    /// <reference path="..\..\..\..\Threshold\src\Content\Script\Declarations\CortanaSearch.d.ts" />
    /// <reference path="..\..\..\..\Threshold\src\content\script\declarations\SearchAppWrapper.d.ts" />
    var DialogSPALib;
    (function(DialogSPALib) {
        // global variables per SPA session
        var g_ttsCounter = 15 /* Max */ ;
        var g_currentUIState = 0 /* Idle */ ;
        var g_isSpeechInput = false;
        var g_currentWebviewState = 0 /* AppHidden */ ;
        var g_currentSpeakOperation = null;
        var g_currentLuOperation = null;
        var g_currentEventHandlers = {};
        var g_cuRequestHeaders;
        var g_cortanaApp = SearchAppWrapper.CortanaApp;
        var g_spaDialogRuntime = g_cortanaApp.spaDialogRuntime;
        // Turn 0 input parameters to be cached
        var trumanEndpoint;
        var turn0CuInput;
        var turn0ImpressionId;
        // Per turn variables
        var t_currentImpressionId;
        var t_currentTurnCount;
        var t_isRequestSentToSNR;
        // constants   
        var LOG_DIALOGSPA = "DialogSPA";
        var changeSticModeFunctionName = "changeSticStateAndInputMode";
        var spaDialogSjEvtName = "AJAX.sj_evt_startspadialog";
        InitializeSPADialog();

        function InitializeSPADialog() {
            registerEventHandler("startspadialog", startSpaDialogEventHandler);
        }

        function startSpaDialogEventHandler(eventArgs) {
            initializeISpaDialogContextValues(eventArgs);
            sj_evt.fire(spaDialogSjEvtName);
        }

        function processResolutionActionsInternal(projectedApis, callBackUrl, taskFrameId, sessionId, locale) {
            if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 1 /* Disabled */ , 0 /* Standard */ );
            }
            DialogSPALib.logVerboseTrace("SPADialog: processResolutionActionInternal", 0 /* Info */ , "g_currentWebviewState: " + g_currentWebviewState + " currenUIState: " + g_currentUIState + " tf id: " + taskFrameId + " impression id: " + t_currentImpressionId, "callbackUrl: " + callBackUrl + ", turnCount: " + t_currentTurnCount + ", cuRequestHeaders" + JSON.stringify(g_cuRequestHeaders));
            updateCortanaUIState(3 /* Thinking */ , 9 /* Thinking */ );
            ClientResolutionRequested.executeResolutionActions(projectedApis, callBackUrl, taskFrameId, sessionId, t_currentImpressionId, locale, t_currentTurnCount, g_cuRequestHeaders);
        }

        function processIntermediateTurnInternal(ssml, postssmlAction, emotion, dictationParam) {
            DialogSPALib.logVerboseTrace("SPADialog: processIntermediateTurnInternal", 0 /* Info */ , " g_currentUIState: " + g_currentUIState + "g_isSpeechInput: " + g_isSpeechInput, "turnCount: " + t_currentTurnCount + ", postSsmlAction: " + postssmlAction + ", cuRequestHeaders" + JSON.stringify(g_cuRequestHeaders));
            if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 1 /* Disabled */ , (g_isSpeechInput) ? 1 /* ListeningOnly */ : 0 /* Standard */ );
            }
            if (!g_isSpeechInput) {
                // for text input, just setup state and exit since the UI controls will determine
                // how to proceed
                updateCortanaUIState(0 /* Idle */ , 0 /* None */ );
                renderSPAUX(emotion);
                return;
            } else {
                var microphoneButtonPressedEventHandler = function(eventArgs) {
                    processMicrophoneButtonPressed(dictationParam);
                };
                registerEventHandler("microphonebuttonpressed", microphoneButtonPressedEventHandler);
                renderSPAUX(emotion);
                processSsmlAndAction(ssml, postssmlAction, dictationParam);
            }
        }

        function executeFinalActionInternal(ssml, emotion, projectedApi) {
            DialogSPALib.logVerboseTrace("SPADialog: executeFinalActionInternal", 0 /* Info */ , "g_currentWebviewState: " + g_currentWebviewState + " g_currentUIState: " + g_currentUIState, "projectedApi: " + projectedApi);
            renderSPAUX(emotion);
            var shouldHandoffDialogToCortana = true;
            if (!isStringNullOrEmpty(ssml) && g_isSpeechInput) {
                shouldHandoffDialogToCortana = false;
                updateCortanaUIState(2 /* Speaking */ , 0 /* None */ );
                g_currentSpeakOperation = ThresholdUtilities.wrapApiCall(g_spaDialogRuntime, "speakAsync", "SA", null, ssml, g_ttsCounter++);
                g_currentSpeakOperation.done(function() {
                    if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                        ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 0 /* Enabled */ , 0 /* Standard */ );
                    }
                    ThresholdUtilities.wrapSynchronousApiCall(g_cortanaApp, "dismissApp", "DA", null);
                    g_currentSpeakOperation = null;
                }, function() {
                    handoffDialogToCortana(2 /* Error */ );
                    g_currentSpeakOperation = null;
                });
            }
            if (!isStringNullOrEmpty(projectedApi)) {
                ThresholdUtilities.wrapApiCall(g_cortanaApp, "processNLCommandAsync", "PNLC", null, projectedApi, t_currentImpressionId).done(function() {
                    if (shouldHandoffDialogToCortana) {
                        handoffDialogToCortana(0 /* RetainUI */ );
                    }
                }, function() {
                    if (shouldHandoffDialogToCortana) {
                        handoffDialogToCortana(2 /* Error */ );
                    }
                });
            } else {
                if (shouldHandoffDialogToCortana) {
                    handoffDialogToCortana(0 /* RetainUI */ );
                }
            }
        }

        function executeFinalActionInternalMobile(ssml, emotion, projectedApi) {
            var ttsCompleteEvent = "ttsComplete";
            DialogSPALib.logVerboseTrace("SPADialog: executeFinalActionInternalMobile", 0 /* Info */ , "g_currentWebviewState: " + g_currentWebviewState + " g_currentUIState: " + g_currentUIState, "projectedApi: " + projectedApi);
            renderSPAUX(emotion);
            if (!isStringNullOrEmpty(ssml) && g_isSpeechInput) {
                updateCortanaUIState(2 /* Speaking */ , 0 /* None */ );
                g_currentSpeakOperation = ThresholdUtilities.wrapApiCall(g_spaDialogRuntime, "speakAsync", "SA", null, ssml, g_ttsCounter++);
                g_currentSpeakOperation.done(function() {
                    if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                        ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 0 /* Enabled */ , 0 /* Standard */ );
                    }
                    g_currentSpeakOperation = null;
                    sj_evt.fire(ttsCompleteEvent);
                }, function() {
                    handoffDialogToCortana(2 /* Error */ );
                    g_currentSpeakOperation = null;
                    sj_evt.fire(ttsCompleteEvent);
                });
            } else {
                sj_evt.fire(ttsCompleteEvent);
            }

            function ttsCompleteAction() {
                sj_evt.unbind(ttsCompleteEvent, ttsCompleteAction);
                if (!isStringNullOrEmpty(projectedApi)) {
                    ThresholdUtilities.wrapApiCall(g_cortanaApp, "processNLCommandAsync", "PNLC", null, projectedApi, t_currentImpressionId).done(function() {
                        handoffDialogToCortana(0 /* RetainUI */ );
                    }, function() {
                        handoffDialogToCortana(2 /* Error */ );
                    });
                } else {
                    handoffDialogToCortana(0 /* RetainUI */ );
                }
            }
            sj_evt.bind(ttsCompleteEvent, ttsCompleteAction, true);
        }
        // Sets emotion, udate cortana webview
        function renderSPAUX(emotion) {
            DialogSPALib.logVerboseTrace("SPADialog: renderSPAUX", 0 /* Info */ , "emotion: " + emotion, "");
            if (!isStringNullOrEmpty(emotion)) {
                ThresholdUtilities.wrapSynchronousApiCall(g_cortanaApp, "setEmotion", "SE", null, emotion, false, false);
            }
            if (g_currentWebviewState == 1 /* AppVisible */ ) {
                DialogSPALib.logVerboseTrace("SPADialog: renderSPAUX", 0 /* Info */ , "Calling ShowWebViewAsync", "");
                ThresholdUtilities.wrapApiCall(g_cortanaApp, "showWebViewAsync", "SWW", null);
            }
        }
        // Helper method for validating string
        function isStringNullOrEmpty(inputString) {
            if (inputString != null && inputString != "") {
                return false;
            }
            return true;
        }

        function initializeISpaDialogContextValues(eventArgs) {
            DialogSPALib.logVerboseTrace("SPADialog: initializeISpaDialogContextValues", 0 /* Info */ , "ISpaDialogContext", "snrConnectionUrl: " + eventArgs.snrConnectionUrl + ", impressionId: " + eventArgs.impressionId);
            turn0CuInput = eventArgs.cuInput;
            trumanEndpoint = eventArgs.snrConnectionUrl;
            turn0ImpressionId = eventArgs.impressionId;
            // set the state to thinking the first time dialog is transitioned to SPA
            g_currentUIState = 3 /* Thinking */ ;
        }

        function updateCortanaUIState(uiState, earCon) {
            DialogSPALib.logVerboseTrace("SPADialog: updateCortanaUIState", 0 /* Info */ , "cortana UI state: " + uiState, "Earcon : " + earCon);
            if (g_currentUIState != uiState) {
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "updateGui", "UG", null, uiState);
                g_currentUIState = uiState;
                if (g_isSpeechInput && earCon != 0 /* None */ ) {
                    ThresholdUtilities.wrapApiCall(g_spaDialogRuntime, "playEarconAsync", "PE", null, earCon);
                }
            }
        }
        // Helper method for validating if InputQueryType is speech
        function isSpeechQuery(inputQueryType) {
            if (inputQueryType != undefined && inputQueryType == "SpeechQuery") {
                return true;
            }
            return false;
        }
        // processes current turn ssml and action
        function processSsmlAndAction(ssml, postssmlAction, dictationParam) {
            DialogSPALib.logVerboseTrace("SPADialog: processSsmlAndAction", 0 /* Info */ , "ssml:" + ssml, "postssmlaction : " + postssmlAction + ", cuRequestHeaders: " + JSON.stringify(g_cuRequestHeaders));
            if (!isStringNullOrEmpty(postssmlAction) && postssmlAction == "waitforuserinput" && g_isSpeechInput) {
                // prompt user for input and start listening
                updateCortanaUIState(2 /* Speaking */ , 0 /* None */ );
                g_currentSpeakOperation = ThresholdUtilities.wrapApiCall(g_spaDialogRuntime, "speakAsync", "SA", null, ssml, g_ttsCounter++);
                g_currentSpeakOperation.done(function() {
                    g_currentSpeakOperation = null;
                    processVoiceInput(dictationParam);
                }, function() {
                    g_currentSpeakOperation = null;
                    handoffDialogToCortana(2 /* Error */ );
                });
            }
        }

        function processMicrophoneButtonPressed(dictationParam) {
            DialogSPALib.logVerboseTrace("SPADialog: processMicrophonebuttonpressed", 0 /* Info */ , "Entering processMicrophonebuttonpressed()", "speakinprogress :" + (g_currentUIState == 2 /* Speaking */ ) + ", g_isSpeechInput: " + g_isSpeechInput + ", turnCount: " + t_currentTurnCount);
            if (!g_isSpeechInput) {
                // nothing to do if not speech input
                return;
            }
            if (g_currentSpeakOperation != null && g_currentUIState == 2 /* Speaking */ ) {
                // if there is a speak operation in progress, cancel it first
                g_currentSpeakOperation.cancel();
                g_currentSpeakOperation = null;
            }
            switch (g_currentUIState) {
                case 1 /* Listening */ :
                case 3 /* Thinking */ :
                    updateCortanaUIState(0 /* Idle */ , 7 /* Cancel */ );
                    break;
                default:
                    // create a new impression ID for this turn and process microphone button pressed
                    t_currentImpressionId = createCUImpressionId();
                    processVoiceInput(dictationParam);
                    break;
            }
        }
        // processes all speech events
        function processVoiceInput(dictationParameter) {
            DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput", 0 /* Info */ , "turnCount: " + t_currentTurnCount + ", cuRequestHeaders" + JSON.stringify(g_cuRequestHeaders), "cuInput :" + turn0CuInput);
            if (!turn0CuInput) {
                handoffDialogToCortana(2 /* Error */ );
                return;
            }
            t_isRequestSentToSNR = false;
            var modifiedCuInput = modifyCuInput(turn0CuInput, t_currentImpressionId, dictationParameter);
            if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                // Put the STIC in listening only mode
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 0 /* Enabled */ , 1 /* ListeningOnly */ );
            }
            // Don't need to play earcon for listening since RAF will play it
            updateCortanaUIState(1 /* Listening */ , 0 /* None */ );
            g_currentLuOperation = ThresholdUtilities.wrapApiCall(g_spaDialogRuntime, "startLanguageUnderstandingFromVoiceAsync", "SLU", null, modifiedCuInput);
            g_currentLuOperation.then(function onComplete(finalResult) {
                if (finalResult.notificationType == 3 /* FinalResult */ ) {
                    if (finalResult.finalResultNotification) {
                        var finalSr = finalResult.finalResultNotification;
                        var recoStatus = getRecoResultAndUpdateTrex(finalSr.cuOutput, true);
                        DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput: NlProgressNotificationType", 0 /* Info */ , "FinalResult: hr = " + finalSr.operationHResult, "CuOutput reco result = " + recoStatus + " t_isRequestSentToSNR = " + (t_isRequestSentToSNR ? "true" : "false"));
                        // if the operation is successful, query truman endpoint and go to thinking state
                        // else go to idle state so the user can interact with the microphone
                        if (finalSr.operationHResult == 0 && recoStatus == "200") {
                            updateCortanaUIState(3 /* Thinking */ , 9 /* Thinking */ );
                            if (!t_isRequestSentToSNR) {
                                // this is hard coded for now we will be updating IDL and start using spa dialog context
                                ClientResolutionRequested.CallEndPointGet("https://www.bing.com/speech_render?speech=1&input=2&snrtrace=1&form=WNSBOX&cc=US&setlang=en-US", t_currentImpressionId, t_currentTurnCount, g_cuRequestHeaders, function(innerHtml) {
                                    return ClientResolutionRequested.render(innerHtml);
                                });
                                t_isRequestSentToSNR = true;
                            }
                        } else {
                            updateCortanaUIState(0 /* Idle */ , 0 /* None */ );
                        }
                    } else {
                        DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput", 0 /* Info */ , "Speech finalResultNotification is null; turnCount: " + t_currentTurnCount, "", true);
                    }
                } else {
                    DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput", 0 /* Info */ , "onComplete", "NlProgressNotificationType.FinalResult Event not received turnCount: " + t_currentTurnCount, true);
                }
                g_currentLuOperation = null;
            }, function onError(error) {
                DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput", 0 /* Info */ , "startLanguageUnderstandingFromVoiceAsync" + "Error: " + error + ", turnCount: " + t_currentTurnCount, "", true);
                handoffDialogToCortana(2 /* Error */ );
                g_currentLuOperation = null;
            }, function onProgress(progress) {
                switch (progress.notificationType) {
                    case 0 /* AudioStarted */ :
                        DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput: NlProgressNotificationType", 0 /* Info */ , "AudioStarted", "");
                        break;
                    case 1 /* CookiesAvailable */ :
                        DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput: NlProgressNotificationType", 0 /* Info */ , "CookiesAvailable", "");
                        var iterator = progress.cookiesNotification.cookies.first();
                        if (iterator) {
                            var cookieValue;
                            var cookieName = "CUCookie";
                            do {
                                var item = iterator.current;
                                if (item.key.toLowerCase() == cookieName.toLowerCase()) {
                                    cookieValue = item.value;
                                    break;
                                }
                            } while (iterator.moveNext());
                            DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput: NlProgressNotificationType", 0 /* Info */ , "CUCookie set value:" + cookieValue + " sj_cook.get() result: " + sj_cook.get(cookieName), "");
                        }
                        break;
                    case 2 /* IntermediateResult */ :
                        DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput: NlProgressNotificationType", 0 /* Info */ , "IntermediateResult", "t_isRequestSentToSNR = " + (t_isRequestSentToSNR ? "true" : "false"));
                        if (progress.intermediateResultNotification) {
                            if (!t_isRequestSentToSNR) {
                                // this is hard coded for now we will be updating IDL and start using spa dialog context
                                ClientResolutionRequested.CallEndPointGet("https://www.bing.com/speech_render?speech=1&input=2&snrtrace=1&form=WNSBOX&cc=US&setlang=en-US", t_currentImpressionId, t_currentTurnCount, g_cuRequestHeaders, function(innerHtml) {
                                    return ClientResolutionRequested.render(innerHtml);
                                });
                                t_isRequestSentToSNR = true;
                            }
                            var intermediate = progress.intermediateResultNotification;
                            getRecoResultAndUpdateTrex(intermediate.cuOutput);
                        } else {
                            DialogSPALib.logVerboseTrace("SPADialog: processVoiceInput", 0 /* Info */ , "Speech intermediateResultNotification is null, turnCount: " + t_currentTurnCount, "", true);
                        }
                        break;
                    default:
                        break;
                }
            });
        }
        // get speech recognition result and update trex
        function getRecoResultAndUpdateTrex(cuOutput, isFinal) {
            if (isFinal === void 0) {
                isFinal = false;
            }
            var recoStatus = "0";
            if (cuOutput) {
                var cuOutputJson = JSON.parse(cuOutput);
                recoStatus = cuOutputJson.SrObject.RecognitionStatus;
                var phrase = cuOutputJson.SrObject.RecognizedPhrases[0].DisplayText;
                if (phrase != undefined) {
                    DialogSPALib.logVerboseTrace("SPADialog: getRecoResultAndUpdateTrex", 0 /* Info */ , "cuOutput result: " + cuOutputJson.SrObject.RecognitionStatus, "Update trex: '" + phrase + "' isFinal: " + isFinal);
                    ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "updateTrex", "UT", null, phrase, isFinal);
                }
            } else {
                DialogSPALib.logVerboseTrace("SPADialog: getRecoResultAndUpdateTrex", 0 /* Info */ , "cuOutput", "Speech cuOutput output is null isFinal: " + isFinal);
            }
            return recoStatus;
        }
        // Set current impression id & dictation param
        function modifyCuInput(cuInput, impressionId, dictationParameter) {
            try {
                var json = JSON.parse(cuInput);
                json.ImpressionId = impressionId;
                if (!json.DictationParameters) {
                    var dictationobj = JSON.parse(dictationParameter);
                    json.DictationParameters = dictationobj;
                } else {
                    json.DictationParameters.CompleteTimeout = 1000;
                    json.DictationParameters.IncompleteTimeout = 1000;
                    json.DictationParameters.InitialSilenceTimeout = 3000;
                }
                return JSON.stringify(json);
            } catch (err) {
                DialogSPALib.logVerboseTrace("SPADialog: modifyCuInput", 0 /* Info */ , "cuInput:" + cuInput, "dictationPrameter: " + dictationParameter + ",Json exception: " + err.message);
                handoffDialogToCortana(2 /* Error */ );
            }
        }

        function registerEventHandler(eventName, handler) {
            ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "addEventListener", "AEL", null, eventName, handler);
            g_currentEventHandlers[eventName] = handler;
        }

        function unregisterAllEventHandlers() {
            for (var eventName in g_currentEventHandlers) {
                DialogSPALib.logVerboseTrace("SPADialog: unRegisterEventHandler", 0 /* Info */ , "eventName:" + eventName, "");
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "removeEventListener", "REL", null, eventName, g_currentEventHandlers[eventName]);
            }
            g_currentEventHandlers = {};
        }

        function initGlobals(inputQueryType, turnCount, cuRequestHeaders) {
            if (cuRequestHeaders === void 0) {
                cuRequestHeaders = null;
            }
            g_isSpeechInput = isSpeechQuery(inputQueryType);
            g_currentWebviewState = g_cortanaApp.currentState;
            g_cuRequestHeaders = cuRequestHeaders;
            t_currentImpressionId = createCUImpressionId();
            t_currentTurnCount = turnCount;
            DialogSPALib.logVerboseTrace("SPADialog: InitGlobals", 0 /* Info */ , "IG:" + t_currentImpressionId, "");
        }

        function isNumberWithinRange(str, minValue, maxValue) {
            if (!/^\d+$/.test(str)) {
                return false;
            }
            var num = parseInt(str, 10);
            return (!isNaN(num) && (num >= minValue) && (num <= maxValue));
        }

        function createCUImpressionId() {
            return g_cortanaApp.createGuid().replace("{", "").replace("}", "").toLowerCase();
        }
        // process client resolution action and send data back to DialogPolicy
        function processResolutionActions(projectedApis, callBackUrl, taskFrameId, sessionId, locale, turnCount, inputQueryType, cuRequestHeaders) {
            function evtAction() {
                try {
                    sj_evt.unbind(spaDialogSjEvtName, evtAction);
                    // unregister all event handlers from previous turn
                    unregisterAllEventHandlers();
                    initGlobals(inputQueryType, turnCount, cuRequestHeaders);
                    processResolutionActionsInternal(projectedApis, callBackUrl, taskFrameId, sessionId, locale);
                } catch (error) {
                    DialogSPALib.logVerboseTrace("SPADialog: processResolutionActions", 0 /* Info */ , "Session ID: " + sessionId, "Exception: " + error.message + ", inputQueryType: " + inputQueryType + ", turnCount: " + turnCount, true);
                    handoffDialogToCortana(2 /* Error */ );
                }
            }
            sj_evt.bind(spaDialogSjEvtName, evtAction, true);
        }
        DialogSPALib.processResolutionActions = processResolutionActions;
        // execute final task action
        function executeFinalAction(ssml, emotion, projectedApi, inputQueryType, turnCount) {
            function evtAction() {
                try {
                    sj_evt.unbind(spaDialogSjEvtName, evtAction);
                    // unregister all event handlers from previous turn
                    unregisterAllEventHandlers();
                    initGlobals(inputQueryType, turnCount);
                    if (g_cortanaApp.isMobile) {
                        // On mobile we need to wait for TTS before executing projected API.
                        executeFinalActionInternalMobile(ssml, emotion, projectedApi);
                    } else {
                        executeFinalActionInternal(ssml, emotion, projectedApi);
                    }
                } catch (error) {
                    DialogSPALib.logVerboseTrace("SPADialog: executeFinalAction", 0 /* Info */ , "projectedAPI: " + projectedApi, "Exception: " + error.message + ", inputQueryType: " + inputQueryType + ", turnCount: " + turnCount, true);
                    handoffDialogToCortana(2 /* Error */ );
                }
            }
            sj_evt.bind(spaDialogSjEvtName, evtAction, true);
        }
        DialogSPALib.executeFinalAction = executeFinalAction;
        // initializes dialog processing and processes intermediate turns
        function processIntermediateTurn(ssml, postssmlAction, emotion, dictationParam, inputQueryType, turnCount, cuRequestHeaders) {
            function evtAction() {
                try {
                    sj_evt.unbind(spaDialogSjEvtName, evtAction);
                    // unregister all event handlers from previous turn
                    unregisterAllEventHandlers();
                    initGlobals(inputQueryType, turnCount, cuRequestHeaders);
                    processIntermediateTurnInternal(ssml, postssmlAction, emotion, dictationParam);
                } catch (error) {
                    DialogSPALib.logVerboseTrace("SPADialog: processIntermediateTurn", 0 /* Info */ , "", "Exception: " + error.message + ", inputQueryType: " + inputQueryType + ", turnCount: " + turnCount + ", postSsmlAction: " + postssmlAction, true);
                    handoffDialogToCortana(2 /* Error */ );
                }
            }
            sj_evt.bind(spaDialogSjEvtName, evtAction, true);
        }
        DialogSPALib.processIntermediateTurn = processIntermediateTurn;
        // This function passes back confirmation accept as a string 'yes' until there is support
        // in TCP to pass back structured data
        function processConfirmationAccept() {
            DialogSPALib.logVerboseTrace("SPADialog: processConfirmationAccept", 0 /* Info */ , "impression ID: " + t_currentImpressionId + "turn count: " + t_currentTurnCount, "snr connection URL: " + trumanEndpoint);
            var confirmUrl = "https://www.bing.com/search?q=yes&input=1";
            ClientResolutionRequested.CallEndPointGet(confirmUrl, t_currentImpressionId, t_currentTurnCount, g_cuRequestHeaders, function(innerHtml) {
                ClientResolutionRequested.render(innerHtml);
            });
        }
        DialogSPALib.processConfirmationAccept = processConfirmationAccept;
        // This function passes back confirmation reject as a string 'no' until there is support
        // in TCP to pass back structured data
        function processConfirmationReject() {
            DialogSPALib.logVerboseTrace("SPADialog: processConfirmationReject", 0 /* Info */ , "impression ID: " + t_currentImpressionId + "turn count: " + t_currentTurnCount, "snr connection URL: " + trumanEndpoint);
            var rejectUrl = "https://www.bing.com/search?q=no&input=1";
            ClientResolutionRequested.CallEndPointGet(rejectUrl, t_currentImpressionId, t_currentTurnCount, g_cuRequestHeaders, function(innerHtml) {
                ClientResolutionRequested.render(innerHtml);
            });
        }
        DialogSPALib.processConfirmationReject = processConfirmationReject;
        // This function passes back time duration as a string until there is support from TCP to send
        // structured time data back
        function processTimePickerData(hoursId, minutesId, secondsId) {
            DialogSPALib.logVerboseTrace("SPADialog: processTimePickerData", 0 /* Info */ , "impression ID: " + t_currentImpressionId + "turn count: " + t_currentTurnCount, "");
            if (!isNumberWithinRange(hoursId.value, 0, 23) || !isNumberWithinRange(minutesId.value, 0, 59) || !isNumberWithinRange(secondsId.value, 0, 59)) {
                // invalid input
                hoursId.value = hoursId.defaultValue;
                minutesId.value = minutesId.defaultValue;
                secondsId.value = secondsId.defaultValue;
                return;
            }
            if ((hoursId.value == hoursId.defaultValue) && (minutesId.value == minutesId.defaultValue) && (secondsId.value == secondsId.defaultValue)) {
                // all 0s input - invalid. Do nothing
                return;
            }
            if (g_isSpeechInput && g_currentLuOperation != null) {
                // cancel the current LU operation
                g_currentLuOperation.cancel();
                g_currentLuOperation = null;
            }
            var hours = (isStringNullOrEmpty(hoursId.value) || (hoursId.value == hoursId.defaultValue)) ? "" : (hoursId.value + "%20hours");
            var minutes = (isStringNullOrEmpty(minutesId.value) || (minutesId.value == minutesId.defaultValue)) ? "" : ("%20" + minutesId.value + "%20minutes");
            var seconds = (isStringNullOrEmpty(secondsId.value) || (secondsId.value == secondsId.defaultValue)) ? "" : ("%20" + secondsId.value + "%20seconds");
            var timeUrl = "https://www.bing.com/search?q=" + hours + minutes + seconds + "&input=1";
            ClientResolutionRequested.CallEndPointGet(timeUrl, t_currentImpressionId, t_currentTurnCount, g_cuRequestHeaders, function(innerHtml) {
                ClientResolutionRequested.render(innerHtml);
            });
        }
        DialogSPALib.processTimePickerData = processTimePickerData;

        function processHandoff() {
            DialogSPALib.logVerboseTrace("SPADialog: processHandoff", 0 /* Info */ , "impression ID: " + t_currentImpressionId + "; turn count: " + t_currentTurnCount, "snr connection URL: " + trumanEndpoint);
            handoffDialogToCortana(1 /* RelinquishUI */ );
        }
        DialogSPALib.processHandoff = processHandoff;
        // remove SPA dialog to RAF
        function handoffDialogToCortana(dialogCompleteState) {
            DialogSPALib.logVerboseTrace("SPADialog: handoffDialogToCortana", 0 /* Info */ , "dialogCompleteState: " + dialogCompleteState, "stic mode: enabled");
            if (dialogCompleteState == 2 /* Error */ ) {
                updateCortanaUIState(4 /* Error */ , 8 /* Error */ );
            } else {
                updateCortanaUIState(0 /* Idle */ , 0 /* None */ );
            }
            if (g_spaDialogRuntime.changeSticStateAndInputMode) {
                ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, changeSticModeFunctionName, "CSI", null, 0 /* Enabled */ , 0 /* Standard */ );
            }
            ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "updateTrex", "UT", null, "", true);
            ThresholdUtilities.wrapSynchronousApiCall(g_spaDialogRuntime, "dialogComplete", "DC", null, "SPA Dialog completed", dialogCompleteState);
            // unregister all event handlers
            unregisterAllEventHandlers();
        }
        DialogSPALib.handoffDialogToCortana = handoffDialogToCortana;

        function processLaunchUri(launchUri) {
            var projectedApi = "{\"Uri\":\"action://LaunchTaskCompletionUri\",\"LaunchUri\":\"" + launchUri + "\",\"DismissOnComplete\":false}";
            DialogSPALib.logVerboseTrace("SPADialog: processLaunchUri", 0 /* Info */ , "LaunchUri: " + launchUri, "Projected API: " + projectedApi);
            SearchAppWrapper.CortanaApp.processNLCommandAsync(projectedApi, t_currentImpressionId).done(function() {
                handoffDialogToCortana(0 /* RetainUI */ );
            }, function() {
                handoffDialogToCortana(2 /* Error */ );
            });
        }
        DialogSPALib.processLaunchUri = processLaunchUri;

        function logVerboseTrace(eventName, opCode, payloadName, payloadData, isError) {
            if (isError === void 0) {
                isError = false;
            }
            g_cortanaApp.logVerboseTrace(eventName, opCode, payloadName, payloadData, t_currentImpressionId);
            if (isError) {
                SharedLogHelper.LogError(LOG_DIALOGSPA, "eventName: " + eventName + ", payloadName: " + payloadName + ", payloadData: " + payloadData + ", impressionId: " + t_currentImpressionId);
            }
        }
        DialogSPALib.logVerboseTrace = logVerboseTrace;
    })(DialogSPALib || (DialogSPALib = {}));; ///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
    ///<reference path="..\..\..\..\Threshold\src\Content\Script\Declarations\SearchAppWrapper.d.ts" />
    var ClientResolutionRequested;
    (function(ClientResolutionRequested) {
        function executeResolutionActions(projectedApis, callBackUrl, taskFrameId, sessionId, impressionId, locale, turnCount, cuRequestHeaders) {
            DialogSPALib.logVerboseTrace("ClientResolutionRequested: executeResolutionActions (prepare calls)", 0 /* Info */ , "projectedApi:" + projectedApiContext, "callBackUrl: " + callBackUrl + ", cuRequestHeaders: " + JSON.stringify(cuRequestHeaders));
            if (projectedApis.length == 0) {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: no projected API found.", 0 /* Info */ , "projectedApi:" + projectedApiContext, "no projected API found.", true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                return;
            }
            var index = 0;
            var resolverName = projectedApis[index][0];
            var projectedApiContext = projectedApis[index][1];
            var results = {};
            var callback = function(response, isSuccess) {
                // if it's success, return response. If failed, return error object in response.
                if (isSuccess) {
                    DialogSPALib.logVerboseTrace("ClientResolutionRequested: " + resolverName, 0 /* Info */ , "projectedApi:" + projectedApiContext, "resolverName: " + resolverName + ", callbackUrl: " + callBackUrl + ", clientResponse: " + response);
                    // Original format.
                    // {"Uri":"action://SearchLocalMusic","AlbumArtist":"kelly clarkson","MatchedMusicUri":"mswindowsmusic://play?mediaType=artistartistName=Kelly%20Clarkson","Result":0}";
                    var formattedResponse = encodeURIComponent(response.replace(/\"/g, "\\\""));
                    results[resolverName] = formattedResponse;
                    index++;
                    if (index < projectedApis.length) {
                        resolverName = projectedApis[index][0];
                        projectedApiContext = projectedApis[index][1];
                        // If there is more API, call it here. As some APIs are async, and some are synchronzed.
                        // So use callback can it simpler. APIs should callback to return value, it supports both async/sync well.
                        executeResolutionAction(resolverName, projectedApiContext, callback, impressionId);
                    } else {
                        sendResolutionResultsToTCP(results, callBackUrl, taskFrameId, locale, sessionId, turnCount, cuRequestHeaders);
                    }
                } else {
                    // If any projected API fails, the following APIs won't be called. It post error information to server and returns error message to user.
                    DialogSPALib.logVerboseTrace("ClientResolutionRequested: " + resolverName, 0 /* Info */ , "projectedApi:" + projectedApiContext, "processNLCommandAsync() failed callbackUrl: " + callBackUrl + ", error: " + response, true);
                    DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                }
            };
            // init first call
            executeResolutionAction(resolverName, projectedApiContext, callback, impressionId);
        }
        ClientResolutionRequested.executeResolutionActions = executeResolutionActions;

        function executeResolutionAction(resolverName, projectedApiContext, callback, impressionId) {
            DialogSPALib.logVerboseTrace("ClientResolutionRequested: executeResolutionAction (calling one)", 0 /* Info */ , "projectedApi:" + projectedApiContext, "resolverName: " + resolverName);
            // To prevent break existing features, use else block to deal with existing code.
            // If there is ClientApiWrapper in resolver name, it goes to API wrappers.
            // For example, UniqueResolverName:ClientApiWrapper
            var parsedResolverName = resolverName.split(":");
            if (parsedResolverName.length == 2 && parsedResolverName[1] == "ClientApiWrapper") {
                // As limitation of current API, the ProjectedApi parameter put both projected api and passed in data.
                // For example, {"ProjectedApi"="MockProjectedAPINamespace.MockProjectedAPI", "inputParameter1"="mockvalue"}
                var apiContext = {};
                try {
                    apiContext = JSON.parse(projectedApiContext);
                } catch (error) {
                    // prevent the projectedApi is not a json object for some legacy reason.
                    DialogSPALib.logVerboseTrace("ClientResolutionRequested: executeResolutionAction", 0 /* Info */ , "projectedApi: " + projectedApiContext, "JSON.parse EXCEPTION: " + error.message + ", resolverName: " + resolverName, true);
                    DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                }
                ClientApiWrapper.executeApi(apiContext, function(projectedAPIOutput, isSuccess) {
                    callback(projectedAPIOutput, isSuccess);
                }, impressionId);
            } else {
                SearchAppWrapper.CortanaApp.processNLCommandAsync(projectedApiContext, impressionId).done(function(clientResponse) {
                    callback(clientResponse, true);
                }, function(error) {
                    callback(error, false);
                });
            }
        }

        function sendResolutionResultsToTCP(clientResponse, callBackUrl, taskFrameId, locale, sessionId, turnCount, cuRequestHeaders) {
            DialogSPALib.logVerboseTrace("ClientResolutionRequested: sendResolutionResultsToTCP", 0 /* Info */ , "clientResponse:" + clientResponse, "callbackUrl: " + callBackUrl + ", turnCount: " + turnCount + ", cuRequestHeaders: " + JSON.stringify(cuRequestHeaders));
            try {
                ajaxRequestWrapper(callBackUrl, function(url, onComplete) {
                    callEndPoint(url, taskFrameId, locale, sessionId, false, clientResponse, turnCount, cuRequestHeaders, onComplete);
                }, function(innerHtml) {
                    return render(innerHtml);
                }, true);
            } catch (err) {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: sendResolutionResultsToTCP", 0 /* Info */ , "clientResponse:" + clientResponse, "EXCEPTION: " + err.message + ", callbackUrl: " + callBackUrl + ", turnCount: " + turnCount, true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            }
        }

        function CallEndPointGet(url, impressionId, turnCount, cuRequestHeaders, onSuccess) {
            if (!onSuccess) {
                return;
            }
            ajaxRequestWrapper(url, function(reqUrl, callback) {
                return CallEndPointGetInternal(reqUrl, impressionId, turnCount, cuRequestHeaders, callback);
            }, onSuccess, true);
        }
        ClientResolutionRequested.CallEndPointGet = CallEndPointGet;

        function CallEndPointGetInternal(url, impressionId, turnCount, cuRequestHeaders, onSuccess) {
            DialogSPALib.logVerboseTrace("ClientResolutionRequested: CallEndPointGet", 0 /* Info */ , "url:" + url, "turnCount: " + turnCount + ", cuRequestHeaders" + JSON.stringify(cuRequestHeaders));
            var xmlhttp = sj_gx();
            xmlhttp.open("GET", url, true);
            if (cuRequestHeaders) {
                for (var i = 0; i < cuRequestHeaders.length; i++) {
                    xmlhttp.setRequestHeader(cuRequestHeaders[i][0], cuRequestHeaders[i][1]);
                }
            }
            var formattedImpressionId = impressionId.replace(/-/g, '');
            xmlhttp.setRequestHeader("X-Search-IG", formattedImpressionId);
            turnCount++;
            xmlhttp.setRequestHeader("X-CU-TurnId", turnCount.toString());
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4) {
                    if (xmlhttp.status == 200) {
                        onSuccess(xmlhttp.responseText);
                        // if returned length is 0, it should be invalid status. Report it to server side.
                        if (xmlhttp.responseText.length == 0) {
                            DialogSPALib.logVerboseTrace("ClientResolutionRequested: CallEndPointGetInternal", 0 /* Info */ , "url:" + url, "ClientResolutionRequested CallEndPointGetInternal() return 0 length content. There may be errors on server side.", true);
                        }
                    } else {
                        DialogSPALib.logVerboseTrace("ClientResolutionRequested: CallEndPointGet - HTTP error", 0 /* Info */ , "url:" + url + "; http error code: " + xmlhttp.status, "ClientResolutionRequested callEndPointGet() failed turnCount: " + turnCount, true);
                        DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                    }
                }
            };
            xmlhttp.onerror = function() {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: CallEndPointGet", 0 /* Info */ , "url:" + url, "ClientResolutionRequested callEndPointGet() failed turnCount: " + turnCount, true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            };
            xmlhttp.send();
        }

        function ajaxRequestWrapper(url, makeRequestFunc, onSuccess, shouldAddJsonParameter) {
            if (!onSuccess) {
                return;
            }
            var ajaxProvider = require("ajax.cortanaprovider");
            if (ajaxProvider) {
                ajaxProvider.navigate(url, function(renderUrl, callback, addJsonParamaeters) {
                    var requestUrl = shouldAddJsonParameter ? addJsonParamaeters(url) : url;
                    var onComplete = function(response) {
                        onSuccess(shouldAddJsonParameter ? "" : response);
                        callback(shouldAddJsonParameter ? response : "", shouldAddJsonParameter);
                    };
                    makeRequestFunc(requestUrl, onComplete);
                });
            } else {
                makeRequestFunc(url, onSuccess);
            }
        }

        function callEndPoint(url, taskFrameId, locale, sessionId, isSpeech, response, turnCount, cuRequestHeaders, onSuccess) {
            DialogSPALib.logVerboseTrace("ClientResolutionRequested: callEndPoint", 0 /* Info */ , "url:" + url, "turnCount: " + turnCount + ", isSpeech: " + isSpeech);
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open("POST", url, true);
            var params = 'clientData=' + JSON.stringify(response);
            params += '&locale=' + locale;
            params += '&sessionId=' + sessionId;
            params += '&taskFrameId=' + taskFrameId;
            turnCount++;
            if (cuRequestHeaders) {
                for (var i = 0; i < cuRequestHeaders.length; i++) {
                    xmlhttp.setRequestHeader(cuRequestHeaders[i][0], cuRequestHeaders[i][1]);
                }
            }
            xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xmlhttp.setRequestHeader("X-CU-TurnId", turnCount.toString());
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4) {
                    if (xmlhttp.status == 200) {
                        onSuccess(xmlhttp.responseText);
                        // if returned length is 0, it should be invalid status. Report it to server side.
                        if (xmlhttp.responseText.length == 0) {
                            DialogSPALib.logVerboseTrace("ClientResolutionRequested: callEndPoint", 0 /* Info */ , "url:" + url, "ClientResolutionRequested callEndPoint() return 0 length content. There may be errors on server side.", true);
                        }
                    } else {
                        // request completed with failure error code
                        DialogSPALib.logVerboseTrace("ClientResolutionRequested: callEndPoint - HTTP error", 0 /* Info */ , "url:" + url + "; http error code: " + xmlhttp.status, "ClientResolutionRequested callEndPoint() failed turnCount: " + turnCount + ", isSpeech: " + isSpeech, true);
                        DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                    }
                }
            };
            xmlhttp.onerror = function() {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: callEndPoint", 0 /* Info */ , "url:" + url, "ClientResolutionRequested callEndPoint() failed turnCount: " + turnCount + ", isSpeech: " + isSpeech, true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            };
            xmlhttp.ontimeout = function() {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: callEndPoint", 0 /* Info */ , "url:" + url, "ClientResolutionRequested callEndPoint() timed out; turnCount: " + turnCount + ", isSpeech: " + isSpeech, true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            };
            xmlhttp.send(params);
        }

        function render(innerHtml) {
            if (!innerHtml) {
                return;
            }
            var container = _ge('b_container');
            if (innerHtml == null || innerHtml == "") {
                SharedLogHelper.LogError("LOG_DIALOGSPA", "ClientResolutionRequested: innerHTML is empty");
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            }
            if (container) {
                container.innerHTML = innerHtml;
            } else {
                DialogSPALib.logVerboseTrace("ClientResolutionRequested: render", 0 /* Info */ , "render()", "innerHTML b_container not found", true);
                DialogSPALib.handoffDialogToCortana(2 /* Error */ );
            }
            insertScriptsIntoDom(container);
        }
        ClientResolutionRequested.render = render;
        // removes existing scripts and insert new ones
        function insertScriptsIntoDom(source) {
            var scripts = source.getElementsByTagName("script");
            for (var i = 0; i < scripts.length; i++) {
                var s = document.createElement("script");
                var sc = scripts[i];
                s.text = sc.text;
                document.body.appendChild(s);
            }
        }
    })(ClientResolutionRequested || (ClientResolutionRequested = {}));; /// <reference path="..\..\..\..\Threshold\src\Content\Script\Declarations\CortanaSearch.d.ts" />
    /// <reference path="..\..\..\..\Threshold\src\content\script\declarations\SearchAppWrapper.d.ts" />
    // constants   
    var LOG_DIALOGSPA = "DialogSPA";
    var ClientApiWrapper;
    (function(ClientApiWrapper) {
        var impressionId;
        // all wrapped projected API should be listed here.
        var wrappedPorjectedAPIs = [
            ["SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch.findAppsAsync", findAppsAsync],
            ["SearchAppWrapper.CortanaApp.searchResultsView.executeSearchAsync", executeSearchAsync]
        ];
        // The passed in API name should be exectly match with the actual API.
        // For example, SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch.findAppsAsync
        //
        // The passed in/out data have to be a string. The actual contract is decided by each wrapper.
        // 
        function executeApi(apiContext, callback, impressionIdParameter) {
            var functionObject;
            var projectedApi = apiContext.ProjectedApi;
            DialogSPALib.logVerboseTrace("ClientApiWrapper: executeApi", 0 /* Info */ , "projectedApi:" + projectedApi, impressionIdParameter);
            impressionId = impressionIdParameter;
            if (projectedApi == undefined) {
                DialogSPALib.logVerboseTrace("ClientApiWrapper: executeApi", 0 /* Info */ , "projectedApi", "Couldn't found ProjectedApi parameter", true);
            } else {
                // check if API implemented or not
                var isApiFound = false;
                for (var i = 0; i < wrappedPorjectedAPIs.length; i++) {
                    if (projectedApi == wrappedPorjectedAPIs[i][0]) {
                        functionObject = wrappedPorjectedAPIs[i][1];
                        isApiFound = true;
                        break;
                    }
                }
                if (isApiFound) {
                    DialogSPALib.logVerboseTrace("ClientApiWrapper: executeApi", 0 /* Info */ , "executing API:" + projectedApi, "apiContext:" + JSON.stringify(apiContext));
                    try {
                        functionObject(apiContext, callback);
                    } catch (e) {
                        // If any projected API fails, the following APIs won't be called. It post error information to server and returns error message to user.
                        DialogSPALib.logVerboseTrace("ClientApiWrapper: executeApi", 0 /* Info */ , "hit error:" + projectedApi, "Error on call API: " + e, true);
                        DialogSPALib.handoffDialogToCortana(2 /* Error */ );
                    }
                } else {
                    DialogSPALib.logVerboseTrace("ClientApiWrapper: executeApi", 0 /* Info */ , "projectedApi", "The projected API \"" + projectedApi + "\" is not wrapped or case is incorrect.\r\n Implement the wrapper in ClientAPIWrapper.ts\r\n", true);
                }
            }
        }
        ClientApiWrapper.executeApi = executeApi;

        function findAppsAsync(apiContext, callback) {
            // input example:
            // {
            //   "ProjectedApi":"SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch.findAppsAsync",
            //   "AppIds":["1F8B0F94.122165AE053F_j2p0p5q0044a6!App"]
            // }
            //
            // output example (included required fields only)
            // {
            //   "Result":
            //   {
            //     "1F8B0F94.122165AE053F_j2p0p5q0044a6!app":{"exists":true,"displayName":"Photos","packageFamilyName":"122165AE053F_j2p0p5q0044a6"},
            //     "microsoft.bingmaps_8wekyb3d8bbwe!appexmaps":{"exists":false}
            //   }
            // }
            SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch.findAppsAsync(apiContext.AppIds, impressionId).done(function(itemMap) {
                var existenceMap = {};
                apiContext.AppIds.forEach(function(value, index, array) {
                    // null is not found, and {} is found.
                    if (itemMap[value] != null) {
                        existenceMap[value] = {
                            "exists": true,
                            "displayName": itemMap[value].displayName,
                            "packageFamilyName": itemMap[value].packageFamilyName
                        };
                    } else {
                        existenceMap[value] = {
                            "exists": false
                        };
                    }
                });
                var output = {};
                output.Result = existenceMap;
                callback(JSON.stringify(output), true);
            }, function(error) {
                callback(error, false);
            });
        }

        function executeSearchAsync(apiContext, callback) {
            var unresolvedAppNames = [];
            var resolvedAppNames = [];
            var resolvedApps = {};
            var expandedAppNames = [];
            var complete = false;
            apiContext.UnresolvedAppNames.forEach(function(value, index, array) {
                SearchAppWrapper.CortanaApp.searchResultsView.executeSearchAsync(value).then(function(folders) {
                    if (folders && folders.apps) {
                        folders.apps.getItemsAsync(0, 10).then(function(appMap) {
                            if (appMap && appMap.resultSet.length > 0) {
                                resolvedAppNames.push(value);
                                resolvedApps[value] = appMap.resultSet[0];
                                for (var i in appMap.resultSet) {
                                    expandedAppNames.push(appMap.resultSet[i].displayName);
                                }
                            } else {
                                unresolvedAppNames.push(value);
                            }
                            // If all requested app names are processed, call callback function
                            if (!complete && ((resolvedAppNames.length + unresolvedAppNames.length) == apiContext.UnresolvedAppNames.length)) {
                                complete = true;
                                var res = {
                                    Uri: apiContext.Uri,
                                    UnresolvedAppNames: unresolvedAppNames,
                                    ResolvedAppNames: expandedAppNames,
                                    ResolvedApps: resolvedAppNames
                                };
                                callback(JSON.stringify(res), true);
                            }
                        }, function(error) {
                            callback(error, false);
                        });
                    }
                }, function(error) {
                    callback(error, false);
                });
            });
        }
    })(ClientApiWrapper || (ClientApiWrapper = {}));;
    //]]>
    </script>
    <div id="b_content" data-tag="" data-partnerTag="">
        <div id="b_pole">
            <div class="b_poleContent">
                <div class="b_ans b_cat3a">
                    <div data-ssml="&lt;speak version=&quot;1.0&quot; xmlns=&quot;http://www.w3.org/2001/10/synthesis&quot; xmlns:mstts=&quot;http://www.w3.org/2001/mstts&quot; xmlns:emo=&quot;http://www.w3.org/2009/10/emotionml&quot; xml:lang=&quot;en-US&quot;&gt;&lt;mstts:prompt domain=&quot;VoiceAssistant&quot;/&gt;&lt;emo:emotion&gt;&lt;emo:category name=&quot;CALM&quot; value=&quot;CALM&quot;/&gt;I found this for you.&lt;/emo:emotion&gt;&lt;/speak&gt;"></div>
                    <h2 class="b_anno b_anim" data-tag="" data-partnerTag="">I found this for you.</h2>
                    <div id="b_thp"></div>
                    <div class="b_hide" id="CUDialogResponse">{&quot;Uri&quot;:&quot;action://CuOutput&quot;,&quot;SystemAction&quot;:{&quot;Uri&quot;:&quot;action://Conversation/LaunchSPA&quot;,&quot;Version&quot;:&quot;1.0&quot;},&quot;ConversationId&quot;:&quot;cea4dc63-122c-c7bf-5b09-62c0092037f4&quot;,&quot;TraceId&quot;:&quot;0FD24AC8D32A4DB480F6C516FC781763&quot;,&quot;ImpressionId&quot;:&quot;f81131fda41d8d55c3464df4c356c1da&quot;,&quot;LgObject&quot;:{&quot;Uri&quot;:&quot;action://LgObject&quot;,&quot;Ssml&quot;:null,&quot;DisplayText&quot;:null,&quot;SuggestionText&quot;:null,&quot;SecondaryDisplayTextSmall&quot;:null,&quot;SecondaryDisplayTextMedium&quot;:null,&quot;SecondaryDisplayTextLarge&quot;:null}}</div>
                </div>
            </div>
        </div>
        <ol id="b_results" data-tag="" data-partnerTag="">
            <li class="b_ans" data-tag="" data-partnerTag="" data-id="">
                <h2 class="b_groupLabel" data-tag="" data-partnerTag="">Videos</h2>
                <div class="b_rich">
                    <div id="vidans2">
                        <div class="vidrc">
                            <div class="vidr idx0 videoResult">
                                <div class="videoThumb">
                                    <div class="vtv2">
                                        <a href="/videos/search?q=play+lady+gaga+poker+face&amp;view=detail&amp;mid=2B71C38EE9D71532DD6B2B71C38EE9D71532DD6B&amp;FORM=VIRE" class="vt3b" h="ID=SERP,5088.1"><img data-src-hq="/th?id=OVP.V2cee20313321225533cd6de6ed9a8c71&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=90" width="131" height="74" id="emb2A204C92" class="rms_img" src="/th?id=OVP.V2cee20313321225533cd6de6ed9a8c71&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=30" />
                                            <div class="vtbc" id="vtbc0"></div>
                                            <div class="vt_text b_lRight b_smText b_foregroundText"><span class="b_lLeft plc"><div class="rms_img rms_rmsanswersMultimediaVideoAnswer_Play rms_rmsanswersMultimediaVideoAnswer_Bundle"></div></span><span class="b_lLeft">3:35</span></div>
                                        </a>
                                    </div>
                                </div>
                                <a href="/videos/search?q=play+lady+gaga+poker+face&amp;view=detail&amp;mid=2B71C38EE9D71532DD6B2B71C38EE9D71532DD6B&amp;FORM=VIRE" h="ID=SERP,5088.2">
                                    <div class="videoDetail">
                                        <div class="videoTitle">
                                            <div class="mobilevideoitemtitle_mmftb"><span><strong>Poker</strong> <strong>Face</strong></span></div>
                                        </div>
                                        <cite class="videoSource noIcon noPreview">Yahoo Music</cite>
                                    </div>
                                </a>
                            </div>
                            <div class="vidr idx1 videoResult">
                                <div class="videoThumb">
                                    <div class="vtv2">
                                        <a href="http://en.musicplayon.com/play?v=241472" class="vt3b" h="ID=SERP,5089.1"><img data-src-hq="/th?id=OVP.Vac97297117e1d12bc13f15b8aa51b58d&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=90" width="131" height="74" id="emb118E7E0AF" class="rms_img" src="/th?id=OVP.Vac97297117e1d12bc13f15b8aa51b58d&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=30" />
                                            <div class="vtbc" id="vtbc1"></div>
                                            <div class="vt_text b_lRight b_smText b_foregroundText"><span class="b_lLeft plc"><div class="rms_img rms_rmsanswersMultimediaVideoAnswer_ExternalPlay rms_rmsanswersMultimediaVideoAnswer_Bundle"></div></span><span class="b_lLeft">3:58</span></div>
                                        </a>
                                    </div>
                                </div>
                                <a href="http://en.musicplayon.com/play?v=241472" h="ID=SERP,5089.2">
                                    <div class="videoDetail">
                                        <div class="videoTitle">
                                            <div class="mobilevideoitemtitle_mmftb"><span><strong>Lady</strong> <strong>GaGa</strong> - <strong>Poker</strong> <strong>Face</strong> (2008)</span></div>
                                        </div>
                                        <cite class="videoSource noIcon noPreview">MusicPlayOn</cite>
                                    </div>
                                </a>
                            </div>
                            <div class="vidr idx2 videoResult">
                                <div class="videoThumb">
                                    <div class="vtv2">
                                        <a href="http://www.zapkolik.com/video/lady-gaga-poker-face-349848" class="vt3b" h="ID=SERP,5090.1"><img data-src-hq="/th?id=OVP.V173f820d298780d9951e68a5acc860cf&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=90" width="131" height="74" id="emb22FF703A0" class="rms_img" src="/th?id=OVP.V173f820d298780d9951e68a5acc860cf&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=30" />
                                            <div class="vtbc" id="vtbc2"></div>
                                            <div class="vt_text b_lRight b_smText b_foregroundText"><span class="b_lLeft plc"><div class="rms_img rms_rmsanswersMultimediaVideoAnswer_ExternalPlay rms_rmsanswersMultimediaVideoAnswer_Bundle"></div></span><span class="b_lLeft">3:38</span></div>
                                        </a>
                                    </div>
                                </div>
                                <a href="http://www.zapkolik.com/video/lady-gaga-poker-face-349848" h="ID=SERP,5090.2">
                                    <div class="videoDetail">
                                        <div class="videoTitle">
                                            <div class="mobilevideoitemtitle_mmftb"><span><strong>Lady</strong> <strong>Gaga</strong> - <strong>Poker</strong> <strong>Face</strong> | Zapkolik</span></div>
                                        </div>
                                        <cite class="videoSource noIcon noPreview">Zapkolik</cite>
                                    </div>
                                </a>
                            </div>
                            <div class="vidr idx3 videoResult">
                                <div class="videoThumb">
                                    <div class="vtv2">
                                        <a href="http://www.vagalume.com.br/lady-gaga/poker-face.html" class="vt3b" h="ID=SERP,5091.1"><img data-src-hq="/th?id=OVP.V82dcab5f8a9073d9245213ff78239b78&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=90" width="131" height="74" id="emb3122EEC39" class="rms_img" src="/th?id=OVP.V82dcab5f8a9073d9245213ff78239b78&amp;w=131&amp;h=74&amp;c=7&amp;rs=1&amp;pid=4.1&amp;qlt=30" />
                                            <div class="vtbc" id="vtbc3"></div>
                                            <div class="vt_text b_lRight b_smText b_foregroundText"><span class="b_lLeft plc"><div class="rms_img rms_rmsanswersMultimediaVideoAnswer_ExternalPlay rms_rmsanswersMultimediaVideoAnswer_Bundle"></div></span><span class="b_lLeft">4:21</span></div>
                                        </a>
                                    </div>
                                </div>
                                <a href="http://www.vagalume.com.br/lady-gaga/poker-face.html" h="ID=SERP,5091.2">
                                    <div class="videoDetail">
                                        <div class="videoTitle">
                                            <div class="mobilevideoitemtitle_mmftb"><span><strong>Poker</strong> <strong>Face</strong></span></div>
                                        </div>
                                        <cite class="videoSource noIcon noPreview">Vagalume</cite>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div><a href="/videos/search?q=play+lady+gaga+poker+face&amp;FORM=VQFRML" title="" class="b_moreLink" h="ID=SERP,5092.1">See more videos</a></li>
            <li class="b_ans" data-tag="" data-partnerTag="" data-id="">
                <div id="wpc_tp" class="wpc_tp tp_collapsed" data-expId="expitem_2099700714_4">
                    <div class="b_subModule" data-tag="" data-partnerTag="">
                        <div class="b_infocardTop" data-tag="">
                            <div class="b_clearfix b_overflow" data-tag="" data-partnerTag="">
                                <div class="b_floatR_img" data-tag="">
                                    <div class="cico" style="width:100px;height:100px;" data-tag="" data-partnerTag="">
                                        <a href="https://music.microsoft.com/Track/BBC41701-0100-11DB-89CA-0019B92A3933?action=play" h="ID=SERP,5100.1">
                                            <div class="rms_iac" style="height:100px;width:100px;" data-height="100" data-width="100" data-title="Poker Face" data-alt="Poker Face" data-class="rms_img" data-src="/th?id=A24996d0ed98f186196b6060c9c578c10&amp;w=100&amp;h=100&amp;c=7&amp;rs=1&amp;qlt=80&amp;cdv=1&amp;pid=16.1"></div>
                                        </a>
                                    </div>
                                </div>
                                <h2 class=" b_entityTitle" data-tag="" data-partnerTag="">Poker Face</h2>
                                <div style="width: 0px;"></div>
                                <div id="ic_desc" class="b_lBottom" data-partnertag="" data-tag=""><span id="dscexpitem_2099856965_6" data-partnertag=""><span id="infoc_5">&quot;Poker Face&quot; is a song by American singer Lady Gaga from her debut studio album, The F</span>
                                    <div class="sml inline" id="expitem_2099856965_6" data-appns="SERP" data-k="5182.1" data-tag="" data-partnerTag="" data-expl=""><a id="expitem_2099856965_6_hit" class="leftAlign" data-exp="I;expitem_2099856965_6;;0;;infoc_5;TaskPane;InfoCardDescription;0;0" href="javascript:void(0);"><span class="sw_plus cipa " width="24" height="24"></span></a></div>
                                    </span>
                                    <div class="b_hide" data-exp="H;expitem_2099856965_6;;dscexpitem_2099856965_6;;;">
                                        <div class="b_lBottom" data-partnertag="">&quot;Poker Face&quot; is a song by American singer Lady Gaga from her debut studio album, The Fame. Produced by RedOne, it was released as the album's second single in late 2008 for some markets and in early 2009 for the rest of the world. &quot;Poker Face&quot; is an uptempo synthpop song in the key of G minor, following in the footsteps of her previous single &quot;Just Dance&quot;, but </div>
                                        <div><a href="http://en.wikipedia.org/wiki/Poker_Face_(Lady_Gaga_song)" h="ID=SERP,5101.1">en.wikipedia.org</a><span class="b_footnote" data-partnertag=""> &#183; Text under <a href="http://creativecommons.org/licenses/by-sa/3.0/" h="ID=SERP,5183.1">CC-BY-SA license</a></span></div>
                                    </div>
                                </div>
                                <ul class="b_vList" data-tag="" data-partnerTag="">
                                    <li data-tag="" data-partnerTag="">
                                        <div class="b_factrow" data-tag="" data-partnerTag=""><span class="cbl b_lower b_strong" data-tag="" data-partnerTag="">Album:</span> <a href="/entityexplore?q=lady+gaga+the+fame&amp;filters=ufn%3a%22lady+gaga+the+fame%22+sid%3a%2278f10713-0fbe-7fcc-994e-6d04d1c4b211%22&amp;FORM=SNAPST" h="ID=SERP,5102.1">The Fame</a></div>
                                    </li>
                                    <li data-tag="" data-partnerTag="">
                                        <div class="b_factrow" data-tag="" data-partnerTag=""><span class="cbl b_lower b_strong" data-tag="" data-partnerTag="">Artist:</span> <a href="/entityexplore?q=lady+gaga&amp;filters=ufn%3a%22lady+gaga%22+sid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5103.1">Lady Gaga</a></div>
                                    </li>
                                    <div class="b_hide" data-exp="H;expitem_2098763211_1;;;;;">
                                        <li data-tag="" data-partnerTag="">
                                            <div class="b_factrow" data-tag="" data-partnerTag=""><span class="cbl b_lower b_strong" data-tag="" data-partnerTag="">Duration:</span> 3:48</div>
                                        </li>
                                    </div>
                                    <div class="b_hide" data-exp="H;expitem_2098763211_1;;;;;">
                                        <li data-tag="" data-partnerTag="">
                                            <div class="b_factrow" data-tag="" data-partnerTag=""><span class="cbl b_lower b_strong" data-tag="" data-partnerTag="">Genre:</span> Pop music, Contemporary Pop</div>
                                        </li>
                                    </div>
                                </ul>
                                <div class="sml" id="expitem_2098763211_1" data-appns="SERP" data-k="5105.5" data-tag="" data-partnerTag="" data-expl=""><a id="expitem_2098763211_1_hit" class="leftAlign" data-exp="I;expitem_2098763211_1;1;0;;;TaskPane;InfoCardFacts;0;0" href="javascript:void(0);">See more<img class="ciplr vam rms_img" width="10" height="7" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHBAMAAADDgsFQAAAAElBMVEX///8QINAQINAQINAQINAQINCEqDprAAAABXRSTlMAESIzZkG9BZgAAAAtSURBVAgdY3BVYGAOYQgNYjANZVANVQYymEJDQxUYgJwgBgYgB8hkYBBkYAAAjZEFp9arzeUAAAAASUVORK5CYII=" /></a>
                                    <div class="b_hide" data-exp="H;expitem_2098763211_1;;expitem_2098763211_1_hit;;;">See less<img class="ciplr vam rms_img" width="10" height="7" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHBAMAAADDgsFQAAAAFVBMVEX///8QINAQINAQINAQINAQINAQINBJFl3yAAAABnRSTlMAESIzRHdFROtBAAAALUlEQVQIHWNgYEwTYGBgEEtLZAAy04AcsTQTICctmcEtjSHMgIEllYEJqEABAI0lBpXZD2dhAAAAAElFTkSuQmCC" /></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="b_hide" data-exp="H;expitem_2099700714_4;;;;;">
                        <div class="b_subModule" data-tag="" data-partnerTag="">
                            <h2 class="" data-tag="" data-partnerTag="">Listen or buy</h2>
                            <div class="b_gridrow" data-tag="">
                                <div class="b_mdrpad" style="width:164px;">
                                    <div data-tag="" class="avc avcradius">
                                        <div class="b_clearfix b_overflow b_vmparent" data-tag="" data-partnerTag="">
                                            <div class="b_float_img" data-tag="">
                                                <div class="cico" style="width:40px;height:40px;" data-tag="" data-partnerTag="">
                                                    <a href="http://www.amazon.com/dp/B001IXQU3O" h="ID=SERP,5108.1"><img height="40" width="40" class="rms_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAABGdBTUEAALEQa0zv0AAAACBjSFJNAACHDwAAjA8AAP1SAACBQAAAfXkAAOmLAAA85QAAGcxzPIV3AAABF2lDQ1BJQ0MgUHJvZmlsZQAAKM9jYGDiyUnOLWYSYGDIzSspCnJ3UoiIjFJgv8PAyCDJwMygyWCZmFxc4BgQ4MOAE3y7BlQNBJd1QWYxkAa4UlKLk4H0HyCOSy4oKmFgYIwBsrnLSwpA7AwgWyQpG8yuAbGLgA4EsieA2OkQ9hKwGgh7B1hNSJAzkH0GyHZIR2InIbGh9oIAc7IRA9VBSWpFCYh2c2JgAIUpelghxJjFgNgYGBdLEGL5ixgYLL4CxScgxJJmMjBsb2VgkLiFEFNZwMDA38LAsO18cmlRGdRqKSA+zXiSOZl1Ekc29zcBe9FAaRPFj5oTjCSsJ7mxBpbHvs0uqGLt3DirZk3m/trLh18a/P8PAN5BU32YWvgkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACXRFWHRDb21tZW50ACpSkUTQAAAYJUlEQVR4XuVbCXhV5Zm2VVmEBAJJyH6zE6yKKFq1tp3iVOzU1i5aOx2nncX6VEfGmenM2NZWa2cefbRFQxYSoqViXbGdZ4ragm1ViqBdAFHWQEIiEJJA9tz13Hvfed/v3BMuMYQ2iUWf+fTjLPec//z/+7/f9p+T03CKJRaLIR6PI85tjMfxEVTn/9zyZwfGQEjocBEAyfr/Cpi3iY2e/wgs7zCh5BJiPC/9c8s7AkwyG7x9Mxn+Fw1HEHOiCPoDtnV47KLw9sEHg0FEo1G7NxwOD5mdtp4k70+kvGPAeKqBeYOzQREMA2K4ROljqCP+RtH9oVBoqB1P3yl5xxnjgTIkBObNra+jrroGX7/tX3DtZz6LRR/5KM6pmId5cytML77wIlzzqU/jn29dguplVdjx5vbEza4MB+SdAOodAUZAiPp+v38IlF27duPGG7+KUl8hZk5PQfrMNMyeMRM5mXOQnZmJ/Owc5FLzcnKRk5WNjNnpmJ02CzNSUpHK6ysqKrBkyRJ0dHRYewKhp6fHnuM4zvHgT4CMGRh1Y0hFb/kI/U9zCLGzEfkOyu4dO3H5JZdi8ulnIpMDLczOQ3FeAUqk+T5uqd7WVL/5UMxzRXn5KCkoRFFuHnzZuQbk+087DV/76k3wDwzaMwcHBw0cjy0TxZpxAaMuePPkATMk3P/WN76JlLOmISs9nYPLR5mvyAVFQIyi3jXeVqDMLSpBRXEJigt8BlAp97fRJCX+QGAIkIlizoQAo07F6EsCnEUvuiz++JUGSlF+AUo56xpgUQ4ZkDT4ZE0GwjtXmJNn92q/NMEsmWIJwcnKyEQaAdq6eYs9T32QSU2UjAMYOjvbHgNmsH/AfrvkoouRTrMpKyrmwIpQpsHlFqA8MTixR1tPNfhkELzz3n4hry/NIVja8riI58vZdjb900z6oCCjlUCJRJgKyKwT7PG2Y5FxAeOpOhAKhuz8P918C1KmnoVyUr2AzvQDpXNRQqaUEZS5+cdMydsKDM/Mks9rm3xNGYFVG6W5/C0BbGlhEWaRNV+47jp7tsBJ9jfjMasxA6NHMxAz/Tg2Q69t3ISUadPND2hQ5lM4iPJ8DowzXiqA+JsGVVFcaizKzZiDjBlpSE+diVnTU5GXmTUEhscgsak8x0dwqGId75NTFhMLaaozUlPR0tJifejv7z+1wOiRUcLjRB3LVSRXXbnYQq2PAxEopQRE5qPZLueg5lI1aDlSgTHl9DNw+cWX4J67v4eaByqx9N77cPWVV9n5vMzsIcYIhHK1kQCnVMBIBSCfk5KSgqVLl1of1J9TCoxED7ZslbJ39x7MSp0BH0OrQm6yKRRzVkukPC4o4AzPmIGrr74aR44csXuHS09XN+afex4yZs029smBK3x7YXxI1T41m474us9+zu5VqWF0HqeM3ZQ4K+EIkys6PMkD938faUzEijgQmcAxQNytDYw6k4ndDTfcYPdIxDa1pW0kkah5DKwoLbNBl9LRGtCJNo5TglXApHBeWbkB4qYNY2eKJ+NmjOO4wCz+y48zX8lAIZMyU4JRRHaUMLxqKy0gmwoLC81BSuQsBYpH/TDbEiiqiSSrfvQIUumz1MZQQjgCMGKpmNXf02v3sUF3Ow4ZF2NsZhN90KxlMESrk9ZRASOmyBHL4VJVBtz+n7fb9UrnPUAkBjLb03KVd761pRVZc+agQBnwSYBRSdG8r8nu84BJbv9PlXExRsB4ywdrn/85Lrv4g7h04UVW88whe5TLKAmbzvA9i6CcxnR+2xvbrMPJYdUTOXNz6DHXvASez+dj/SS/NQIoCRUT8+j0W5qa3YZOpSlphtX5kWalr7cPhw4ewpY/bMbzzz6HWlbS37nj23hoRYP9rkRspMJPniVCYCIERmal68rLy5GTkzMqMGLM8cCMnSmejMuUPI1GOMNyeopQ/D+ecJ4jiVhmFTG3npP1RDBJwwy5Yk0gFEAxHW/+aKZEfTtjTiEwySJwxACpOc9ohIPjjHPWVWkHgkEEBv0IBYJmdtHklbtRRIBr4EoMFe5PFJXk7LV80dq8373x3QKMJ55Z6V9PZS4hAhMJuZEoWQRQL3OWXTt24ufPPY9HfrgS995zD2699VZ8/tprsXDBBSgvLLYE8WTA5L5bgREAYovA8WoodTDZXKIRBy/++kXc/d27cc2nr8HCCy5ENk1AjlmLUQrN01iRp2ekIy0tDfmMdFqTsWyXILzngNHgk53x8G69sn6DLWFmMpPV4GcQhJw5Waa5BKZYeQoLQg2wmAzJz2cexHxHwKgckCm9J4GRaEU/EAigq6vL6hXJc88+i/OZ2k8+40zkpGdaMajcxhI2qpfj6Jyd576PiaBCdAFVgOl8ha/YnO97DhjP+Sq89vX1sUxwcMOX/gbTmL+IEVpc8pYXNBi3RHCjTHK5IBAKBQ5B8ZExKi/st+y89y5jFIEkCsXeYrYvjwMqKjImaMat4vYA4rHVVMYEAsJzuTQt3acic/r06UhNYTnAgcvHCIT3DDBiSJRMCWuRin1ROFbYzGHhpyiigWvpIbnS1vqtrdNwX/VTVkYGZqSkII/Z8kJmzdcyGt1xxx2orKzE/fffj0KyLVcJXjIYyfpuA8aiDx1uhGYjQCSf+sRfWb2kznpASL19bcvpL7SVz0lLScXf0uTW/WItBvr7rY1kkXkWkXF5ZJ7aHAIjWd+tjIkn6pLHVj2KsyZNNqeazJJkUKRaWBIoZcUl2MqSwROZoiWHrKy1FSgDAwMuMLmMTicB5vgEz+3TeGRcjFHntQgu8apqdVId9gAZvl/IUKy1Wm/h3BN7eZ8I+V747+3tRXFx8UkY40Y0AfOuKAm8hE7ywtp1mHT6Ge7yAgedDMTwQch8Xn7xJbtP/dcQpJpjgSJR2xJFOEWoUWulBDBWKw0xxt2MR8YMjECRKUmu+/y1FlHUQV+CMcNVYGmh++ILF9o9Culi3BAo2iYY42lnZ6clejk52aMwxjUlrce07ncXxE8pMOq4txKXRRprxc6SNa3aJQ3CY4+Su3SG4e986w67x0BhGwLFUx1LPMbs3bsX6enpKGDbJ2YMI10CmAMtrXbfKQdG0tnRaYtR6pwLjDrrDmK4SU2fNBVPPvmk3ecBkyxapBIkoYgL+Jo1azB18hRbejgRMHqGNIv5z77de9gwW4mSeVoGcfEdk4wbmObmZuu83jqa42VUSgbGchklcjyeduZkrF692u7zHGyyRBlN1KpAk3ztppuQzvrKfEwSGMnqAaP3UusTvkuNGDiJNxhjkXED07Rvn1XGAsarfZJn1+u4wJkxdRpqqmvsPn2lIHDUjqeqsbw3BRIxMZ+Rbrh5JqvXdtr0VCy97367z/s4Ses5Y5VxOV/Jrp077e2jRSOZkvmD4zsu1X727Axcf/31dp/eGAoADxxz5gRFhajkP77+77ZmrELSqu9EGyOp/FcBM2qxVWILYXTu2o5Vxs2YgwcOYvpZ02x50XszMNLsChzVSBksAfTxj+73FsSl+shIKtm0cSOmnDnJNU+2K0Z44I7Urra6JpX9WNnwkLUh1sScU2RKBg7/15dPikpK3JTkDe/8kBIwLUJ98pOfTLTC2R3mZ3657gWCnG+vY1SVewMfCRjVW8nAaFJUkhziZEmCiVJlLDJmYGQG4UQec/558y3Bcl+yJTpsSjMydY8FTL46T9YsWLDAoo6KUJnRhg0bcMNff8k+LdNShTlxMYXXGwgEwHSo7SSAeN4DRothH7n8w7ZaaMXtGGXsjKHHdxLruMuXVSGNfqaswK2a7ZMNvYQnEN5Lfe9lfFkhQy/B85ER01hbnX7aaZj8/tMtYuUTEFXe+v5FZmRvLgW0mMN2zaTIJmuH7Un1sYCioSZEKUMRr53Cdquqq61vbsyWrxlJTyxjB4Z5gpybZiY46EfKlLNs9uRH5upjIc0mByDV11CuJsxBYAkAXmtLEAKCW9fBcvAEQIMtpmlqoGJRCUsDrf/aPfzdA0dfQBSx/rKPlKi6ftKkSaitrfV6ShU4w9X1kSeScQDDiEIzsNcglCU334LZqTNsZjXjHs09qns63JEm74tJZibclpBZPg54yuTJqKmpsbblwwqycgxEAybBRpmdly6c/r73464777Kl1u7ubuvbWGTsPoaO1/wMI4tY42e1rM7J18hcNLvmPDVQ+Qn5AJ1LAOOBJAZoayBxYMpZykvL7J11SmoK1q1bZ8/77nfutOgncHRtkb22ddkoNuneqTShH6961K7X8oUX+oeLYsbJZOzAUPUAJWUBfZNC2bNzFzLTMyyieKv+GqgGI8foJmouQ5LBcc3IBUV+Qtlubm4uXt+2zdpVfiO54mOLkEbmyHS8NrQWLGetZYdNr2y06xT2NWFBOl+tF8ViXpbtTmYskWGPJmM3pSSVyKxizDTfYiF3dvlczKAzljPVNy4CRTNqJpIAxhuYtvZSjeDpS8wpk6ZYtT5IvyXQBwN+RBJvHfp7+3D23Ar7YEDf+M2l5szOtGe0JL500Gqi/YmPAcF+xYMENsC2eB5hgkKGU8l1/npieE4CDHMVd5MQFwr9K5+e7MKMupwpvYrVO2x96i72TDrjTNtmMuvVV9/6YNFHPyFfIc2alY6UyVPxPkanT1y5GK9u2mTtqW5SMal33PYuW8Cz3QGarI+A6utyRbP58z4wtLQaDoYRoorJia9q2Ueyxv1UgMrfTIM87/pGybFReaMZARgvcRP9Iug0AOKaMD47FuvnY4LQ6qwe5+g6hw+MEv1YmPQlhblNlvXr19un7osXL8b8+fPtE7LzzjnXtov+4mO45Ws3Y/VTTx+3oqe8RkAkq9snlwWSJbcuwV133eUeOOwNQQxwrP1hphFChj1ErA8x/w7Ejm5A8PBv0H/k94h009wCezgutxyJRAkVUXR4fRT62pwj5niPA+YYKMSXD/rtSw04+NtVwMCbiAUOo4sz1sXfws4ArwuwEaLlEP1IAJEQt7w3rPvNro/R+Y8SjkWz5vVhNE0WGxxP2QTGydb4IaBvEzo3L8PWJ/8Oux6+Ck0PXoSmZR/G7rorsPfBc9BSdzFanr0NYX8nWTbIRJUwxZl6cNLjYgG7/TZgPBFybVt+it9UXol9j1+FWMdPyKAABiOaiS7Ooqpj/T2RvnXRIjapzvvUQXV2uHqrfeK4/JEb7tkhgi0A/9SCT22KSRHeL9cfYD8Q70Tr1h/jpZU34IXKy7Fx+aV4o/5DaKu7DAdrPoLWygsQqJ4NpyENm3+QS1LRL0UGEA3KTNm1GLPwuF4FOSP7GAEUVlYbbEfHq/+F39Wfje31F6B/473swS5e0Qm6RAwQ5QFiqcQ7QAqbibLDEg9kDVr72goczyw0MM6/7bvXHpuU0cS7PlnF0hDNGNFudLW+ho49z8Oh+aCXZhNnZAttBXo2I9b0FDpXXYqDdTnYsnIh4oPb6Zh6EQ+zf8RVzj4qK6BzPgEwvMiqU6HXRHP6LhprzkX70nI0rfoC2nY9zRG3kSHdCMX74CdzgsYktS6YTjxI70/5pB4cno5NeCdnPRah/yM4Ec56hD1zOGlqM+y00FQ6EZQf5IS2rfkK9j90Pl575BO8r4Wg9XJL18Gfjf0GTHRkYCRRRYI4HyZnGj2Kng33oal6AQ48NB/b6i/F7if+HsE3V7izEjtIpOmSScHRvqaSyNw8ILSfrGMTthQfZF+DGGRfB6N+9qWTfd6HcOvz2Ln6Jqx/7Ovo6dIfgzWi8anPoqmO41h7C48HLXg4DhnMvjv0mzIndebEphSmp48eoO0TfRIhFuhC3+v3obG2AP6aafBXF6OtZiGaVn8FnW8+wbt63Hvt3xOLB8pIOvzoeDn+imSJcFDMVGjSLiv8LY9i7zOfxt7lJWh/wIc/1CxC4MgvOYhN2PbYYmxZNh/hfY8QEIZ3ugB/WCxjvgMGlZGi0vHCx9MRyUvrcTIvIRxpXoPtKz+PngdzEK3PQ9/yXM7A2djy8GIcfOnbcN5ajWhgP0HvpQZJY30FwT4p5FMDSrbMyemFHZ1uRCoTZNhndIvTLJ1YyAbLqzj7vI6/R2IDCJDmvey4AnuAphFz+tgxmjN2YvDIOnS/cg8ONFyBQw+UorduHo4uPwdvrPwMug9rLfgInO3LcPD787Cr4Ys0Zd6bJMcM25XRgWEHaaVEkjYonCz80lkNbMG+n96M7ZUXomd5ISIPF+BIw1y01F+ExrqPYsfj/4gOmp6oHO+j84u3m2MEzU0xJMKwGmaYDzGiBE2j9FOcdYI1wIH308b7CYscfFgAyXcRIM2m0gTEGJKDmxE+vBptv70bzav/AY0NV6G16hx01Oaj+0cV2LHsfDQ/+iWg4xfsvbLiRuxbcwsaqz6EwOYVPDe68Y4CDMWAYKc4czRDBKndHEgPj+Mx+p2tD6Ox+oPor8lDpG4OnBW58FdlYrCmGO3LytBcfSF2r7wazWtuQ/urD6J79xOIdqwnOxjZ4noHpL8lkAn2sJtHqf3sMOlMpy6TAA5T3+Ljm4jrJgSaf4ajv69B83O3Ye/j16Dp4UtxoP48hJZych7MQ6whD10P5eH1OgaKjf/Nzm5jT/W1+EE4Pb/CL1d8Drv/dwmJv4PZ9Oi+cFRgdKuLrEyKlOeeaNzDs3RT3GPn255D60++gt1VC9BdVwxn+Wxg2XTEq6cjVDUTRytn40hdCfZXlWNf9TnYVXUZ9tQvQuMPr0HbT76K9p//Kzp+fTva138bh3+3FO2v3Yf2l+9E29p/w4H/uRHNT3wRewju7hULsKu2Aq3Ly3CEfm6wKhfRyhygktsVMzFQm4eWynPR8vj1cA78lH3rgJ8Te5jzGkcXGl+txstP3QqndxP9ZjdNk5eMIqMC4wZe2Z3oq3BMaGjnTlSzzKAY6uOvKhAOo3PnU9j71JfRQoC6qksxWF8CP1kUbpgJp3Yq4nUpiC+fSSWzqrMRrik0B95XXcLri3GULHurei4OUTt5f29VMZnno6PPQ6guH4HaYoQ4+HBNGqJVbK82BbHqNISq07Fz1dl487Fr0P27lZy5A5zEMAZYXR9hd4+w+yGnHxHmMfHANvqrwzzmGDSsUWRUYORwGcioKrxkPjxhANGYlK8wPMpJyj8w92UPGhHc8wyan74RW2oXYQ/D4uH6IvQ1ZMFfn84BZiJek84BpQN02gIoVptNlmUY05wGOXSeq8kEaql16YgSCP0WWlaBMEEMEJy+Oh8O1FRg1/JLsO+xz+HwG/QZ/p00Uab3ftZsHLXqpcEQqx/VWuynypdImJ6L/Q6FFZbHbEoEgQMWbxgbjD2qYYW0KlXt27qGo7+tZtTQlUrL9YuzA077z3D4ldux69FF2F57Nlofno9D1KPLizDQUM5oRkbQxPz1BQjU5yCwIpPAkWF1WXBqCBYB61k6m8zzMcIUoGeFD+3L81nz+LCTaX77i3cjePBVEpeMZbhVdNBY1beoIo6ctL5YdziJqtRpOvY2RddE9Rf/GtGJaTO687Ubj7/57U25Z5T7WOEomjGsI0anx8QQ4Rb4W9ei5ZWl2Lz6Zux5hkxaNR+tD5XgUFU6ulm7dJNF3VVz4P+BD4HKIhxdVoi26nlorb8Mu2uvQPPK69H4xJfR9utvIvjWM2x3B596mF5ukNPAJE0Ra6hj2hEC3gl3/7ifTYZ2RpSTAPPHiy2Oq/4RQCSOLC1C8nBySCXNIEGK7KcP2AL/gbW0uqcR+EMNejf8AJ2/uhdtLzAHefEOtL78DRx87U76rAfQs//HCHSsYzr1BonYBvjZBjNbrc6FWN9wA2X6eq7YO5EyccAQkCFgGNIj5G2AdjcQjjIZc5ir9JPxPWaSMjgnRjuPKsb5OXeqbrSqpmPWPQzXShAdsoEeg6yQn+CVtJgBmsIgtyzmLUFkJHj3AuOZUZSAmFNjNhqjgw7RnPwc3CBrLi1vBdDHXIjOjwme0rcwzw1S+3jcJ3A4Nt0u1xYnqDHFVO4LSUdJIe8JEjhWRNQBuguCF+0dmpCJlAkFxvUxHEyIPiZIRmiZgZ3WmonUoYLO2jTKa2gWcTJH67IOQ6zD+6Vy5ir9lRqYTcoeHbJJDGNpELOiMURlucHnRU8SYcYiE2pKQ8oxab1HQYq4GAvMfqRRzqynFv6PKT0HL1EJwshClYm5ZibK8F5p4loRxHbFMupEy4QBc0zIHv6nEE++8D93kDYqzTCP3DV6DZcM4bGussHbKDlaAcldlkxklLuvQlatuPm3kgWyToknwZxoMwKA/wNY3ILm26XOHgAAAABJRU5ErkJggg==" /></a>
                                                </div>
                                            </div>
                                            <div>
                                                <p style="padding-bottom:2px"><a href="http://www.amazon.com/dp/B001IXQU3O" class="b_action actWebAction" h="ID=SERP,5108.2">Amazon MP3</a></p>
                                                <div class="b_footnote" data-tag="" data-partnerTag="">Play</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="width:164px;">
                                    <div data-tag="" class="avc avcradius">
                                        <div class="b_clearfix b_overflow b_vmparent" data-tag="" data-partnerTag="">
                                            <div class="b_float_img" data-tag="">
                                                <div class="cico" style="width:40px;height:40px;" data-tag="" data-partnerTag="">
                                                    <a href="http://itunes.apple.com/album/poker-face/id902122441?i=902122445&amp;uo=5" h="ID=SERP,5109.1"><img height="40" width="40" class="rms_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAABGdBTUEAALEQa0zv0AAAACBjSFJNAACHDwAAjA8AAP1SAACBQAAAfXkAAOmLAAA85QAAGcxzPIV3AAABF2lDQ1BJQ0MgUHJvZmlsZQAAKM9jYGDiyUnOLWYSYGDIzSspCnJ3UoiIjFJgv8PAyCDJwMygyWCZmFxc4BgQ4MOAE3y7BlQNBJd1QWYxkAa4UlKLk4H0HyCOSy4oKmFgYIwBsrnLSwpA7AwgWyQpG8yuAbGLgA4EsieA2OkQ9hKwGgh7B1hNSJAzkH0GyHZIR2InIbGh9oIAc7IRA9VBSWpFCYh2c2JgAIUpelghxJjFgNgYGBdLEGL5ixgYLL4CxScgxJJmMjBsb2VgkLiFEFNZwMDA38LAsO18cmlRGdRqKSA+zXiSOZl1Ekc29zcBe9FAaRPFj5oTjCSsJ7mxBpbHvs0uqGLt3DirZk3m/trLh18a/P8PAN5BU32YWvgkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAP2UlEQVR4XuVciVbbyBLl/7/gvfOSCdiWZMmyLS8YMAQIkAwTSCbJkH0hgeyQkJAA3uvdWy2BYdhsPGAydSgkC7mXq+qqW90tBqSfpNmCirRaTalDdxp1qeMy9fXHr/LH0gsZnb4lTior1XoD97Wk1eRfey99BUyzWeNvaTQbUgdIDXx69HJZ7ExO/mdlJJ4eFidTENvLyE61LoDx3wBMC8BUpFbb0k/vPn2W3PC4xNxALABiZcfEyZXFyQ5LKluQWqOJ+/GdBsHsvVwoMBwKkTRhJbXqT57J0pPHEnM8cbMjkgQgdrosqeFJsXNjkgyGJZMv6XfqjYY0fkVgKM0mnEoo8Bhye2ERQyUtdipQUJLBuCRzE7CWMUlkRiTh56U8OaP387utXxWYBp56tVrV8zt3/xIrmYZzDcQLRsSm0mICDCEMIzsYk3gqJ/cfPtH7aXG/pMVwJNXrcKKIQB8+fpShmCdpdN5Ll3QYublRSRZgNVArOyrp0pRcSbhSAZh1GBotxjjs3ssFAYN406IiHCPsbtdbcLAFdbB2ZhSAjMPJ4hiMipclSMMYTqMy6OZk5o+7YRkU+ijGrt7LBQFDv0IeYvzLwr0lGfJyOlTc/LhYmRJ8yyjAGVFgvGxRreeanZK3n7/qd4z8QsDsxSF2qCXVWkOS4CZu3vgQB/6EvoWgEJwUgEkFJYknMzI3f0e/1dgrBLLnvHsp5w4Mu8How/BMeQoCd81BFCIodLAYQklEIFqI5YOzACQXwKWyeSV9GHXgOv8MqWuXCwEG3AzEzABzfeYm/EoRHIWWUgYoVPqakqSLEwjbeRlMePJjkxwH32PacA5y7sAQDlKXRthBxw9gJSWJhRZDYMhZOIwSKThk+J73axsAktHL5Eft3Oefkg6BYWci7U6ipJB9267W5JrlIhrBhxAQgJMkZwEocS8Pxjssn79u6vBp1Ml1CAhIXffVn1qOB8a0w/SCzxrhVYQNhDLcGleIhvJpMqkLr9EaVPERqsGHnUE5POgp9MvmllyJe7ASsFtEozjCdRzsdsgL5Nbin7gjElOQsZgGiomsJ4xs5s9GKVEl1C7lZGC0F1FX2HGCY0iV1o1fat5QY+bmyOuRENfdz+F9/Pjl+0/577U4gMjCAWckGLku83cfyNo3k0huV2phWYAc5RJW1sPm6Gcc+Tk80ft6JacEhh94QjXgMGRWYeP7Q+d+YTvpaOln2XYVRCNOFdBPNKDLK+/kA7jJ960d3KMV6b3VWg3lN5XhHlPFrhjwjAUZDa0Y1yPtRE4ABoWxPG2ceVp1OEFCwy5QN7ersvL+kyyCpN28fUfGJm/I+PUZmZn7Q569eC0bsIqoSQYcAAJ/0SIwSAcoDaALAoxK1PsoaHoduvZtU+4uPZXhses63UDlfIwfFGVkfEpmf7+N+t/LDoCk0K6q1W0cAX6rAkBQIsrr1GGfDEyoBKXBJ4HLFdTxePmtjEzehJPkfElBBpH8McFLILw6OCaRBSdwbdDyJBguy537j2EVFS2WZTRgStQaEDHDUP+kx89r6zK/cFf5y29wzoPJQJx0EUQQqQHUA+FLIsRbqCuBqDWUdMX2szI+NS3vP33Scprqi6pQtL33wKAwPM0WO4FTPs/Vj5/FL47IVScrMb8oHrkGqXxhQqcFLJ1DAXNFB1ySM5wzusTRgasJX8an5+QVhs8OGK9Wob9Ffu5U5cGT55IbQTmwiBiYLgF3UAbzJCV+rAdOmueGCJIQoo480gfUZ3Gqws1Iefy6bHzd0HKZvVN6O5SiCIMfdmBq9ne5aiXhLDMAAoke85pwWiBirqT0TP4cEDQ3TAT1HEcX91h+TmJuFpaVkywsaXZ+UfIjiEppEDlYACejHKQHESB7ivo0lDNtQFhnJNNrqB9tYEqRGZ6QFMBMow43mZKXz1+ZbnQhAIaIHlCGw0ZNqTdN8SeiA/OZOIaHdh6aZMO18W0afnZUAUio7Ji5RgsyYBmrKhkSp3O5GB68D2VEoETne9f2dPcaykrwAdF6CD7+loL/SaUDicUtuX3nnlp6BX2JSOVp5BBgmgADwDRrCsrWdsXMqOEpOBjbFp+6PjE2sP2JnqwEKQImUgKkimEYgXh6NW1gewgKk88kpyjgf5iRe3DUcceDf1tScDoZTACGg6Rd6WhN2GOoTOeGka9kJZUrKTA0dZPT9AaYXcX1zoEJvxMADLUeTlfwHG0FQPQ7fsAolpalx0/Rt9PLPh9Dz11DCOWaDqU8NSdxOLMUTVcni/hUacK9s5izA4OhA+ug0lrcPH0OH6Jpn5OCI4fVrL770KHFtN1NOKoAhYzgyZvXiCIpfRJOW0Uc092AQj0Pi3GpaJ9fLMsQnHxhpAyutWMcRUc+xowelSqshaCQbcTTvngIwQzDGoLVUroDJNLeA0Mw4Fs0GsJSeA1tpH9JZvKSK5WlCjDYxS0krGTap5V9wNQR65kizt+/B47ia4XkJkmAwzmSngFzhHYHzJiJSpwBRBsTCPuZQkn8TE4qBAP9qaJfTF2OS18OygDx5P1ktdu1puwAqDR4RZxkKaycgJwVlEjZ+aP0sPtPVpDKDCMSpyxIB4oSt335AcLYydA5KAPgtLvAVAHKGzDbIThcr4DGwkwPb0w/Kdm2Cdc8t8G1Hjwy606cCu1WYDERMGYsziIR5DTApQGGlhwyZa5SkkGzH3QnOiXRpQzoxA+gITws0EIy5oKz2GCPhzakz5SAcOLcRqgmtXi+vKoP+gzGojJAlmtsRmT9+w+5ZruwFi6NXg5gqORYXJSz/UCd7Z6T5aPuTga49hsB82r1nQKThMVQL8NQUqcNULhvpjwVLvbvIkOYupMBnbcIgVl68kyGnBQAKUJNUtfvSmBI6jj3c/+Rof2c+DKgnMFimo2qrh9TZucXjANjphpl0Aca0o/KUP0bWPqb1Q/ajxb70wlpOUQGzPyrKeTGzfk9YLpMFM9LI27FvIiTV4PgLmtfvilZbfYCGC6DRGFtfHoWzLGAikOLuQTAaFRCuP7N8uQbggdHj1rMGcOSASYshM7L5nSiTi10l0GfvwIctHfQTsnaV1gMRC3mDByGohNVEXWeuDGroc9CNCKbvCzAMI8jMCtvjY9RYM5uMc1di5mGjyFRsnQ2rb+H0p5yOI3JEKLSwzAq9cT5cqtWlI7PzS+KzbndNDjMJQFGfQzaaiFoTM/c1H40uaTBPp0BmwFgC3/F3yJPnz0z20hhmhZn4cPE7LAG9YvqDB7IqC614KFy2kTnd+FjzrKjc6CmyaMB5vXKaxlMOJIqcNb9EgETgPnCBcT8gjxf/aSGQu/ACf1uBcCYFJJ2s7GxAQbJ6cwxSSiP6X8HrMwXoJCMJtJFyZdvhFsOILrk250M1AAIbYZWw53WSWTX6oDpYy6FxeBIPsMj+Mx/Ykl5++mLWo1Z3N9zNJ2sRgIYM+EQDadCCdbiI1MFm7wMwERpC7kM9wLr8m2mKDuITJVKRZdoI0A6Wb/eBQb2ohcW7/0lca4OqsVcAi6jwCA1QHvjaK8uCMIRD49NaH+itWtKhxZjfEwEzOu3HyXm5lABfYxxbjTTg/q3Bl6YAhS0NQLG1jVt+BvwmhuzJnzrlhPdw9cBMG0jEJ68KVu1GpxYFhbDyZ/9s/jt2m/g7Fk2CZ9Rblkbm5hUnlarNzVSRcPppGE1sPdn7lGh5YiMzcwB/YIBAX6mN2tA56EGnAgYWrvt+ZIJ8rK2/sV0E3IaX9MGDBBtmuH0dHlFrsEU28Hgwnv/A2M0WqK1g5J4mbx42bxYri8Li3dlfX1d+8jhdZy0DSVk2WCKHIZblZpYXrALCNUjp4nA6XNgImUbPVoRdz8ERRkCeV1YXNTe1utmd9dREqYEEPgXnnH7F2Vq9rbuWaESlH1Wc0mAMf4G7cXRhRVdjduyvb2DriISh6PjKBngn9Vq6JnUYsx+uLX173IllpIU12yQbSsgISiXBhgOJ0SrBLe6pfNSKk+yp9Koo58nAUOLUWCUJcL5IiqF7z9IMDKlO7Q9VhICorxBHVtbAy5Y2ZZ2ja7xyE3VPvpx1fJl+d17HR31GneNngBMeNwVWgzfOtM9uKurEndSAISvzXAqghuHkOIr+TMR4KKVADBXalcHPsVFYsnhw11WVmZY9/hQdOIfBkCfepwcCgzZIvfz0pLSeRQK1UU4gGPnubugD4EJ98YQFAOM+ZwenpBBJy3PXq8aX6rCnnUBDOO8vsQJy3n5ZkUSCHU2Qh4txsmPigVw+hEY3VEVHs0iXFHiblayhVGpNJj4tMv+Twflb8BEogABWY7E4ti42OlArcZipaioX4FheKZyUp9hOm65us1MYwt+MbCcRo4EhsIUgeVsbP6UISuJirkhuQhw+mdd++BQiqyF4NDPTCAloJCGdJRdh8dDxcwHm7H459JDmKUvyTwtBWZKXnOgkRehhw0lJXU4DtppqexsdZxAUo4FptHgXny+aWLm+NwcHJv6mnAzoDYg1AONPVpNDnOY7pZF0KHt97eX3668xwDDNpmNiZZfAM3IyoOnL7UfDM0kdT2zGOO5DdIscn2zotOHsVQeljOhcx8Ot60zXQjBMQ09SslAD7tORYdIxhDxbFolIqGG3ByoQo4P42hw+D4BwzK3mfGlUsfLyOSNWW03/wtAZC3/GDD89OjFG4nxHWl0hm+lcUgxYYsauQsMWfJBRQeiLfeHqdlgSGXZ/A79huEkxwGj1gWls3XTOXFTGamBqNZJVgFGBEwnw+kEYPYQrsJ5cUWBMn1rQcHx+K8F2Bi+/cGGoZHswEFgokRU30ThpJJOKIXHtnMnINC0QAOUy9VQtSZapgEmmlLYDwwjEY6g/ZaXlvcfw1dzQgvhsRNroZwAzJ4Qkxq4AF/cpBRGr8uQ44vPvXoAhw3kJLq+M00QQlCiJFQTUV7XrbF8G5+dNMBwrlbBwJH/woAvjPLfGPC/gbicSYxmE0NQuPubbJbXeKSzJbMdROR8/OyFaSAaHL3bTUvpqfNtF5bLpVxWwN0RFVDrAre9Jn1d8NJ9/Og8n347MLQUvq9kMvMx/Uc5cU6dwk/xfSa/MC5BaVI8gujjieO6xTdofQLKFcai+hCCQECoETgKFAHjKz22J7f/vK9t1SVnBcUA042cGhgKwdElCXj5GtMGfJ64cVMtx+YThEOmBRwEhhn6oBNILBlIeWJaXr5akR8/d9QCucSsCkvfrtXl49oX7WAaZPJqwlMrNDtIATBzH2hkLQQnAWu9MmTLw2fL2kaCopaiwByfKB4nHQEDWKCosAVg4NgIFKt/9GJFO0CHbHyDASbyLbSK+0+X5ds2F1CNtPSphsofIFOnL8Df2J1tFP52/YuU525JzM+oNRKMCBACFUdYHpn+XTa3K2ZpFmUxSWyBt0irhrK7XYkU+T8u5N59F3tAxAAAAABJRU5ErkJggg==" /></a>
                                                </div>
                                            </div>
                                            <div>
                                                <p style="padding-bottom:2px"><a href="http://itunes.apple.com/album/poker-face/id902122441?i=902122445&amp;uo=5" class="b_action actWebAction" h="ID=SERP,5109.2">iTunes</a></p>
                                                <div class="b_footnote" data-tag="" data-partnerTag="">Play</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="b_subModule" data-tag="" data-partnerTag="">
                            <h2 class="" data-tag="" data-partnerTag="">Lyrics</h2>
                            <div class="b_vPanel" data-tag="" data-partnerTag="">
                                <div data-tag="" data-partnerTag="">
                                    <div class="b_factrow" data-tag="" data-partnerTag="">I wanna hold em' like they do in Texas Plays</div>
                                </div>
                                <div data-tag="" data-partnerTag="">
                                    <div class="b_factrow" data-tag="" data-partnerTag="">Fold em' let em' hit me raise it baby stay with me (I love it)</div>
                                </div>
                                <div data-tag="" data-partnerTag="">
                                    <div class="b_factrow" data-tag="" data-partnerTag="">Luck and intuition play the cards with spades to start</div>
                                </div>
                                <div data-tag="" data-partnerTag="">
                                    <div class="b_factrow" data-tag="" data-partnerTag="">And after he's been hooked I'll play the one that's on his heart</div>
                                </div><a href="/search?q=lady+gaga+poker+face+lyrics&amp;filters=ufn%3a%22lady+gaga+poker+face+lyrics%22+sid%3a%2234d89b45-1a83-d48e-7dbf-d8b2e7c66787%22+aid%3a%222D70417CF33B73F2%22&amp;FORM=SNAPST" title="" class="b_moreLink" h="ID=SERP,5116.1">See more</a></div>
                        </div>
                        <div class="b_subModule" data-tag="" data-partnerTag="">
                            <h2 class="" data-tag="" data-partnerTag="">Songs</h2>
                            <div class="b_tblWithExpansion" data-tag="common.TableWithExpansion">
                                <table data-tag="" data-partnerTag="">
                                    <tbody>
                                        <tr data-exp="H;;;;;;">
                                            <td style="width:227px;" data-tag=""><a href="/entityexplore?q=lady+gaga+bad+romance&amp;filters=ufn%3a%22lady+gaga+bad+romance%22+sid%3a%226de68e96-5489-dffc-ea96-f2c512e644d8%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5120.1">Bad Romance</a></td>
                                            <td class="b_rTxt" style="" data-tag="">4:21</td>
                                        </tr>
                                        <tr data-exp="H;;;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+just+dance&amp;filters=ufn%3a%22lady+gaga+just+dance%22+sid%3a%22e63ac6d9-5a9d-fc4a-bd71-febb1748a5e0%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5121.1">Just Dance</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:39</td>
                                        </tr>
                                        <tr data-exp="H;;;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+paparazzi&amp;filters=ufn%3a%22lady+gaga+paparazzi%22+sid%3a%22b1a1f92e-ad24-a1b6-2b99-3858cf8552b9%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5122.1">Paparazzi</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:28</td>
                                        </tr>
                                        <tr data-exp="H;;;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+applause&amp;filters=ufn%3a%22lady+gaga+applause%22+sid%3a%22dacd76b0-d86b-8c57-0db1-3a9defe4126f%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5123.1">Applause</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:27</td>
                                        </tr>
                                        <tr data-exp="H;;;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+alejandro&amp;filters=ufn%3a%22lady+gaga+alejandro%22+sid%3a%22f35a0c74-56f4-96b5-392f-4833546c3f3a%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5124.1">Alejandro</a></td>
                                            <td class="b_rTxt" style="" data-tag="">4:34</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+telephone&amp;filters=ufn%3a%22lady+gaga+telephone%22+sid%3a%226874fe4d-386c-41e7-4d53-cf9f913f0249%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5125.1">Telephone</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:41</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+love+game&amp;filters=ufn%3a%22lady+gaga+love+game%22+sid%3a%22eb1fbe48-56c2-626f-4598-2dde0d5b759f%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5126.1">Love Game</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:36</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+til+it+happens+to+you&amp;filters=ufn%3a%22lady+gaga+til+it+happens+to+you%22+sid%3a%22e786c5a2-a50b-eeee-7932-baa62f7582dc%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5127.1">Til It Happens To You</a></td>
                                            <td class="b_rTxt" style="" data-tag="">4:18</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+born+this+way&amp;filters=ufn%3a%22lady+gaga+born+this+way%22+sid%3a%229a1551a6-6593-b1e9-4dd9-0e4b8a2aa8e3%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5128.1">Born This Way</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:30</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+do+what+u+want&amp;filters=ufn%3a%22lady+gaga+do+what+u+want%22+sid%3a%22bd65ec5c-427b-03e5-4d57-74a5a59fc5ac%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5129.1">Do What U Want</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:47</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+starstruck&amp;filters=ufn%3a%22lady+gaga+starstruck%22+sid%3a%22ebc9c4ff-1593-a002-be77-2e1113b875c0%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5130.1">Starstruck</a></td>
                                            <td class="b_rTxt" style="" data-tag="">3:37</td>
                                        </tr>
                                        <tr class="b_hide" data-exp="H;expitem_2098919457_3;1;;;;">
                                            <td style="" data-tag=""><a href="/entityexplore?q=lady+gaga+eh%2c+eh+(nothing+else+i+can+say)&amp;filters=ufn%3a%22lady+gaga+eh%2c+eh+nothing+else+i+can+say%22+sid%3a%2260645d21-a62a-1f4e-61cf-9e36f03cbdc9%22+catguid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07_498707c2%22+segment%3a%22generic.carousel%22+psid%3a%221d804cce-259a-4bf1-b771-509e0fdf1f07%22&amp;FORM=SNAPST" h="ID=SERP,5131.1">Eh, Eh (Nothing Else I Can Say)</a></td>
                                            <td class="b_rTxt" style="" data-tag="">2:57</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="sml" id="expitem_2098919457_3" data-appns="SERP" data-k="5133.13" data-tag="" data-partnerTag="" data-expl=""><a id="expitem_2098919457_3_hit" class="leftAlign" data-exp="I;expitem_2098919457_3;;0;;;Expansion;;0;0" href="javascript:void(0);">See more<img class="ciplr vam rms_img" width="10" height="7" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHBAMAAADDgsFQAAAAElBMVEX///8QINAQINAQINAQINAQINCEqDprAAAABXRSTlMAESIzZkG9BZgAAAAtSURBVAgdY3BVYGAOYQgNYjANZVANVQYymEJDQxUYgJwgBgYgB8hkYBBkYAAAjZEFp9arzeUAAAAASUVORK5CYII=" /></a></div>
                            </div>
                        </div>
                        <div class="b_subModule" data-tag="" data-partnerTag="">
                            <h2 class="" data-tag="" data-partnerTag="">Also appears on</h2>
                            <div class="b_imgSet" data-tag="" data-partnerTag="">
                                <ul class="b_hList" data-tag="" data-partnerTag="">
                                    <li class="square_m" data-tag="" data-partnerTag="">
                                        <div class="cico b_capImg" style="width:80px;height:80px;" data-tag="" data-partnerTag="">
                                            <a href="/entityexplore?q=lady+gaga+the+fame+monster&amp;filters=ufn%3a%22lady+gaga+the+fame+monster%22+sid%3a%2265393b92-4dce-148b-95e7-cd1fe63dbc9f%22&amp;FORM=SNAPST" h="ID=SERP,5136.1">
                                                <div class="rms_iac" style="height:80px;width:80px;" data-height="80" data-width="80" data-title="The Fame Monster" data-alt="The Fame Monster" data-class="rms_img" data-src="/th?id=A9e19b7c94abc28c303182c7e6929c5f9&amp;w=80&amp;h=80&amp;c=7&amp;rs=1&amp;qlt=80&amp;cdv=1&amp;pid=16.1"></div>
                                            </a>
                                        </div>
                                        <p><a href="/entityexplore?q=lady+gaga+the+fame+monster&amp;filters=ufn%3a%22lady+gaga+the+fame+monster%22+sid%3a%2265393b92-4dce-148b-95e7-cd1fe63dbc9f%22&amp;FORM=SNAPST" h="ID=SERP,5136.2">The Fame Monster</a></p>
                                    </li>
                                    <li class="square_m" data-tag="" data-partnerTag="">
                                        <div class="cico b_capImg" style="width:80px;height:80px;" data-tag="" data-partnerTag="">
                                            <a href="/entityexplore?q=lady+gaga+and+friends+album&amp;filters=ufn%3a%22lady+gaga+and+friends+album%22+sid%3a%220be41e73-e6bd-495d-8b3e-44e080af7865%22&amp;FORM=SNAPST" h="ID=SERP,5137.1">
                                                <div class="rms_iac" style="height:80px;width:80px;" data-height="80" data-width="80" data-title="Lady Gaga And Friends" data-alt="Lady Gaga And Friends" data-class="rms_img" data-src="/th?id=Ac98e7debc936acd622b2c6c6708cd8e1&amp;w=80&amp;h=80&amp;c=7&amp;rs=1&amp;qlt=80&amp;cdv=1&amp;pid=16.1"></div>
                                            </a>
                                        </div>
                                        <p><a href="/entityexplore?q=lady+gaga+and+friends+album&amp;filters=ufn%3a%22lady+gaga+and+friends+album%22+sid%3a%220be41e73-e6bd-495d-8b3e-44e080af7865%22&amp;FORM=SNAPST" h="ID=SERP,5137.2">Lady Gaga And Frie</a></p>
                                    </li>
                                    <li class="square_m" data-tag="" data-partnerTag="">
                                        <div class="cico b_capImg" style="width:80px;height:80px;" data-tag="" data-partnerTag="">
                                            <a href="/entityexplore?q=2010+grammy+nominees+cd&amp;filters=ufn%3a%222010+grammy+nominees+cd%22+sid%3a%22286e9fce-27c0-eda6-40ac-aa106ce18899%22&amp;FORM=SNAPST" h="ID=SERP,5138.1">
                                                <div class="rms_iac" style="height:80px;width:80px;" data-height="80" data-width="80" data-title="2010 Grammy Nominees Cd" data-alt="2010 Grammy Nominees Cd" data-class="rms_img" data-src="/th?id=A51432d4083a830e4f7d1f9090bc2a0db&amp;w=80&amp;h=80&amp;c=7&amp;rs=1&amp;qlt=80&amp;cdv=1&amp;pid=16.1"></div>
                                            </a>
                                        </div>
                                        <p><a href="/entityexplore?q=2010+grammy+nominees+cd&amp;filters=ufn%3a%222010+grammy+nominees+cd%22+sid%3a%22286e9fce-27c0-eda6-40ac-aa106ce18899%22&amp;FORM=SNAPST" h="ID=SERP,5138.2">2010 Gramm</a></p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="b_suppModule" data-tag="" data-partnerTag="">
                            <div class="b_footnote" data-tag="" data-partnerTag="">Data from: <a href="http://musicbrainz.org/recording/080975b0-39b1-493c-ae64-5cb3292409bb" h="ID=SERP,5141.1">Musicbrainz</a>&#183;<a href="http://www.lyricfind.com/" h="ID=SERP,5142.1">LyricFind</a>&#183;<a href="https://www.microsoft.com/store/music/groove-music-pass" h="ID=SERP,5143.1">Groove</a>&#183;<a href="http://www.freebase.com/" h="ID=SERP,5144.1">Freebase</a></div>
                            <div class="wpc_sfl"><a href="#" id="epf" h="ID=SERP,5146.1">Feedback</a></div>
                        </div>
                    </div>
                    <div id="tp_mobileexp">
                        <div class="btm_sml" id="expitem_2099700714_4" data-appns="SERP" data-k="5181.2" data-tag="" data-partnerTag="" data-expl="">
                            <a id="expitem_2099700714_4_hit" class="leftAlign" data-exp="I;expitem_2099700714_4;1;0;;tp_mobileexp;Expansion;;0;0" href="javascript:void(0);">
                                <div class="expandSection">More about Poker Face<img class="ciplr vam rms_img" width="10" height="7" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHBAMAAADDgsFQAAAAElBMVEX///8QINAQINAQINAQINAQINCEqDprAAAABXRSTlMAESIzZkG9BZgAAAAtSURBVAgdY3BVYGAOYQgNYjANZVANVQYymEJDQxUYgJwgBgYgB8hkYBBkYAAAjZEFp9arzeUAAAAASUVORK5CYII=" /></div>
                            </a>
                            <div class="b_hide" data-exp="H;expitem_2099700714_4;;expitem_2099700714_4_hit;;;">
                                <div class="expandSection">Less about Poker Face<img class="ciplr vam rms_img" width="10" height="7" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHBAMAAADDgsFQAAAAFVBMVEX///8QINAQINAQINAQINAQINAQINBJFl3yAAAABnRSTlMAESIzRHdFROtBAAAALUlEQVQIHWNgYEwTYGBgEEtLZAAy04AcsTQTICctmcEtjSHMgIEllYEJqEABAI0lBpXZD2dhAAAAAElFTkSuQmCC" /></div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="b_ans" data-tag="" data-partnerTag="" data-id="">
                <div class="b_rs">
                    <h2 class="" data-tag="" data-partnerTag="">Related searches</h2>
                    <div class="b_rich">
                        <div class="b_vlist2col" data-tag="" data-partnerTag="">
                            <ul data-tag="">
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Listen+to+Song+Poker+Face&amp;FORM=QSRE1" h="ID=SERP,5148.1">Listen to Song <strong>Poker Face</strong></a></li>
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Poker+Face+Lady+Gaga+Music&amp;FORM=QSRE2" h="ID=SERP,5149.1"><strong>Poker Face Lady Gaga</strong> Music</a></li>
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Lady+Gaga+Poker+Face+YouTube&amp;FORM=QSRE3" h="ID=SERP,5150.1"><strong>Lady Gaga Poker Face</strong> YouTube</a></li>
                            </ul>
                            <ul data-tag="">
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Sonic+Frozen+Poker+Face&amp;FORM=QSRE4" h="ID=SERP,5151.1">Sonic Frozen <strong>Poker Face</strong></a></li>
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Lady+Gaga+Videos+Music&amp;FORM=QSRE5" h="ID=SERP,5152.1"><strong>Lady Gaga</strong> Videos Music</a></li>
                                <li data-tag="" data-partnerTag=""><a href="/search?q=Lady+Gaga+Song+Poker+Face&amp;FORM=QSRE6" h="ID=SERP,5153.1"><strong>Lady Gaga</strong> Song <strong>Poker Face</strong></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>
            <li class="b_msg">
                <div class="rc_msg">Your results are personalized. <a href="http://go.microsoft.com/fwlink/?LinkID=618196" h="ID=SERP,5172.1">Learn more</a></div>
            </li>
            <li class="b_pag">
                <div class="sb_pag clrfix"><span><a class="sb_pagS">1</a></span><span><a href="/search?formcode=WNSGPH&amp;q=play+lady+gaga+poker+face&amp;cc=us&amp;setlang=en-us&amp;mkt=en-us&amp;setflight=dialoglaunchspa&amp;uncrunched=1&amp;p1=%5bMustShow+service%3d%5c%22CortanaSPA%5c%22+position%3d%5c%22Pole%5c%22%5d&amp;addfeaturesnoexpansion=TASKCOMPLETION%2csupportsSiteNavigation%2ccufeaturesth2%2clupredeploy&amp;snrtrace=1&amp;first=1&amp;FORM=PERE" h="ID=SERP,5161.1">2</a></span><span><a href="/search?formcode=WNSGPH&amp;q=play+lady+gaga+poker+face&amp;cc=us&amp;setlang=en-us&amp;mkt=en-us&amp;setflight=dialoglaunchspa&amp;uncrunched=1&amp;p1=%5bMustShow+service%3d%5c%22CortanaSPA%5c%22+position%3d%5c%22Pole%5c%22%5d&amp;addfeaturesnoexpansion=TASKCOMPLETION%2csupportsSiteNavigation%2ccufeaturesth2%2clupredeploy&amp;snrtrace=1&amp;first=11&amp;FORM=PERE1" h="ID=SERP,5162.1">3</a></span><span><a href="/search?formcode=WNSGPH&amp;q=play+lady+gaga+poker+face&amp;cc=us&amp;setlang=en-us&amp;mkt=en-us&amp;setflight=dialoglaunchspa&amp;uncrunched=1&amp;p1=%5bMustShow+service%3d%5c%22CortanaSPA%5c%22+position%3d%5c%22Pole%5c%22%5d&amp;addfeaturesnoexpansion=TASKCOMPLETION%2csupportsSiteNavigation%2ccufeaturesth2%2clupredeploy&amp;snrtrace=1&amp;first=1&amp;FORM=PORE" class="sb_pagN" h="ID=SERP,5163.1"><div class="sb_pagIconN"><span class="sw_next">Next</span></div>
                </a>
                </span>
    </div>
    </li>
    </ol>
    </div>
    <footer class="b_footer" role="contentinfo">
        <div id="CntFtr">
            <p id="fti3">&#169; 2016 Microsoft</p>
            <ul id="ftrLnks">
                <li><a href="http://go.microsoft.com/fwlink/?LinkId=521839&amp;CLCID=0409" h="ID=SERP,5026.1">Privacy</a></li>
                <li><a href="http://go.microsoft.com/fwlink/?LinkID=246338&amp;CLCID=0409" h="ID=SERP,5027.1">Legal</a></li>
                <li><a href="http://go.microsoft.com/fwlink/?LinkID=286759&amp;CLCID=409" h="ID=SERP,5028.1">Ad info</a></li>
                <div class="clrall"></div>
            </ul>
        </div>
    </footer>
    <script type="text/javascript">
    //<![CDATA[
    (function(_onload, si_PP) {
        onload = function() {
            _G.BPT = new Date();
            if (_onload) {
                _onload();
            }
            if (!_w.sb_ppCPL && si_PP) {
                sb_st(function() {
                    si_PP(new Date);
                }, 0);
            }
        };
    })(_w.onload, _w.si_PP);; ///<reference path="queue.ts"/>
    BM.trigger();; ///<reference path="..\..\..\..\..\Answers\services\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
    var Lib;
    (function(Lib) {
        var CssClass;
        (function(CssClass) {
            var supportsClassList = typeof(document.body.classList) !== 'undefined';

            function indexOf(elems, elem) {
                if (elems.indexOf) {
                    return elems.indexOf(elem);
                }
                var length = elems.length;
                for (var i = 0; i < length; i++) {
                    if (elems[i] === elem) {
                        return i;
                    }
                }
                return -1;
            }

            function add(elem, className) {
                if (contains(elem, className)) {
                    return;
                }
                if (supportsClassList) {
                    elem.classList.add(className);
                } else {
                    elem.className += ' ' + className;
                }
            }
            CssClass.add = add;

            function remove(elem, className) {
                if (!contains(elem, className)) {
                    return;
                }
                if (supportsClassList) {
                    elem.classList.remove(className);
                } else {
                    var classList = elem.className.split(' ');
                    var classId = indexOf(classList, className);
                    if (classId >= 0) {
                        classList.splice(classId, 1);
                    }
                    elem.className = classList.join(' ');
                }
            }
            CssClass.remove = remove;

            function toggle(elem, className) {
                if (supportsClassList) {
                    elem.classList.toggle(className);
                } else {
                    if (contains(elem, className)) {
                        remove(elem, className);
                    } else {
                        add(elem, className);
                    }
                }
            }
            CssClass.toggle = toggle;

            function contains(elem, className) {
                if (supportsClassList) {
                    return elem.classList.contains(className);
                } else {
                    var classList = elem.className.split(' ');
                    return indexOf(classList, className) >= 0;
                }
            }
            CssClass.contains = contains;
        })(CssClass = Lib.CssClass || (Lib.CssClass = {}));
    })(Lib || (Lib = {}));;
    sj_evt.bind("onP1", function() {
        var images = _d.getElementsByTagName("img");

        for (var i = 0; i < images.length; i++) {
            var image = images[i];
            var highQualityImage = image.getAttribute("data-src-hq");
            if (highQualityImage) {
                image.src = highQualityImage;
            }
        }
    }); // BUGBUG: TFS 457313: Add JS unittest
    (function(createElement, events, document, onloadEvent, imageLoadedEvent, imageInitEvent, imageCompletedEvent) {
        if (typeof RMS_IACL === "undefined") {
            RMS_IACL = {};
            var imagesCount;
            var images;
            var dataSrcStr = "data-src";
            var thumbRegex = /^(\/th\?(?:id\=|.*&id\=))([^&]*)(.*)$/i; // matches a thumbnail server url, e.g. /th?id=abcdef&etc
            var excludeRegex = /(&|\?)bw=/i; // url patterns to exclude. bw is the parameter for border width.
            var borderWidthStitchedImages = 3;

            function loadImage(element) {
                if (element) {
                    var src = element.getAttribute(dataSrcStr);
                    if (src) {
                        element.removeAttribute(dataSrcStr);
                        var image = createElement("img");
                        image.onload = function(e) {
                            imagesCount--;
                            image.onload = null;
                            var parentElement = element.parentNode;
                            if (parentElement) {
                                copyAttributes(element, image);
                                element.parentNode.replaceChild(image, element);
                            }

                            /* if parent element is set it would be evaluated as true, false otherwise */
                            fireImageCompleteEvent(e, image, parentElement, null);
                        };
                        image.onerror = function(e) {
                            imagesCount--;
                            fireImageCompleteEvent(e, image, false, element);
                        };
                        image.src = src;
                    }
                }
            }

            function loadGroup(group) {
                if (!group) {
                    return;
                } else if (group.length == 1) {
                    loadImage(group[0]);
                } else if (group.length > 1) {
                    var idlist = []; // list of thumbnail ids
                    var firstGroup = group[0];
                    for (var i = 0; i < group.length; i++) {
                        idlist.push(group[i].tid);
                    }
                    var image = createElement("img");
                    image.onload = function(e) {
                        imagesCount -= group.length;
                        image.onload = null;
                        copyAttributes(firstGroup, image);
                        var width = firstGroup.getAttribute("data-width");
                        for (var i = 0; i < group.length; i++) {
                            var currentGroup = group[i];
                            var currentGroupStyle = currentGroup.style;
                            currentGroupStyle.backgroundImage = "url('" + image.src + "')";
                            currentGroupStyle.backgroundRepeat = "no-repeat";
                            // Account for the border between stitched images to set the background position correctly.
                            currentGroupStyle.backgroundPosition = (-width * i - (borderWidthStitchedImages * (i + 1))) + "px " + -borderWidthStitchedImages + "px";
                            copyAttributes(currentGroup, currentGroup);
                        }
                        fireImageCompleteEvent(e, firstGroup, true, null);
                    };
                    image.onerror = function(e) {
                        imagesCount -= group.length;
                        fireImageCompleteEvent(e, firstGroup, false, null);
                    };

                    // We add border between stitched images to reduce impact of image colors bleeding over due to the way image compression is done.
                    image.src = firstGroup.getAttribute(dataSrcStr).replace(idlist[0], idlist.join(":")) + "&bw=" + borderWidthStitchedImages + "&bc=ffffff";
                }
            }

            function loadImages(e) {
                var timeStamp = getTimestamp(e);
                images = getImages();
                if (images) {
                    imagesCount = images.length;
                    if (imagesCount > 0) {
                        events.fire(imageInitEvent, {
                            timeStamp: timeStamp,
                            images: images
                        });
                    }

                    var groups = {};
                    var ungrouped = [];
                    for (var i = 0; i < images.length; i++) {
                        var image = images[i];
                        var src = image.getAttribute(dataSrcStr);
                        if (src) {
                            var key = null;
                            var regMatch = thumbRegex.exec(src);
                            if (regMatch && regMatch.length && !excludeRegex.test(src)) {
                                key = regMatch[1] + regMatch[3]; // thumbnail url with id removed
                                image.tid = regMatch[2]; // remember thumbnail id for later
                            }
                        }
                        if (key) {
                            var group = groups[key] = groups[key] || [];
                            group.push(image);
                        } else {
                            ungrouped.push(image);
                        }
                    }

                    for (var i = 0; i < ungrouped.length; i++) {
                        loadImage(ungrouped[i]);
                    }
                    for (var group in groups) {
                        if (groups.hasOwnProperty(group)) {
                            loadGroup(groups[group]);
                        }
                    }
                }
            }

            function getImages() {
                var className = "rms_iac";
                if (document.getElementsByClassName) {
                    return document.getElementsByClassName(className);
                }
                if (document.querySelectorAll) {
                    return document.querySelectorAll("." + className);
                }
                var results = [];
                var elements = document.getElementsByTagName("div");
                var pattern = new RegExp("(^|\\s)" + className + "(\\s|$)");
                for (var i = 0; i < elements.length; i++) {
                    if (pattern.test(elements[i].className)) {
                        results.push(elements[i]);
                    }
                }
                return results;
            }

            function copyAttributes(source, destination) {
                for (var i = 0; i < source.attributes.length; i++) {
                    var attribute = source.attributes[i];
                    if (attribute.name.lastIndexOf("data-", 0) == 0 && attribute.name != dataSrcStr) {
                        destination.setAttribute(attribute.name.substr(5), attribute.value);
                    }
                }
            }

            function getTimestamp(e) {
                // There is a firefox bug where e.timeStamp will sometimes be set to the future, so we check for that here. https://bugzilla.mozilla.org/show_bug.cgi?id=702015.
                var now = new Date();
                return (e && e.timeStamp > 0 && e.timeStamp <= now) ? e.timeStamp : now;
            }

            function fireImageCompleteEvent(e, imageElement, isSuccessful, placeholderElement) {
                var timeStamp = getTimestamp(e);
                events.fire(imageLoadedEvent, {
                    timeStamp: timeStamp,
                    image: imageElement,
                    state: isSuccessful ? "success" : "failed",
                    placeholderElement: placeholderElement
                });
                if (imagesCount == 0) {
                    events.fire(imageCompletedEvent, {
                        timeStamp: timeStamp,
                        images: images
                    });
                }
            }

            events.bind(onloadEvent, loadImages, 1);
        }
    })(sj_ce, sj_evt, _d, "onPP", "RMS.ImgAOLLoaded", "RMS.ImgAOLInit", "RMS.ImgAOLCompleted");;
    _w.rms.js({
        'A:0': 0
    }, {
        'A:rms:answers:BoxModel:Framework': '\/rms\/Framework\/nj\/92342395\/b2d8ec0a.js?bu=rms+answers+BoxModel+config.threshold%2ccore%2ccore%24viewport%2ccore%24layout%2ccore%24metrics%2cmodules%24mutation%2cmodules%24error%2cmodules%24network%2cmodules%24cursor%2cmodules%24keyboard%2cmodules%24bot'
    }, {
        'A:1': 1
    });;
    //]]>
    </script>
    <div id="aRmsDefer">
        <div style="display:none">
            <!--//<![CDATA[
/// <reference path="../../../../Shared/Content/Content/script/Declarations/Shared.d.ts"/>
/// <reference path="../../../../Shared/Content/Content/script/Declarations/Threshold.Utilities.d.ts"/>
(function () {
    var kValueExtractionRegex = /ID=(\w+),(\d+(?:\.\d+)*)(&PR=(.*))?/i;
    function sendRequest(linkInfo, el, evt, typeOfClick) {
        if (linkInfo) {
            var gpingData = getGPingData(linkInfo, typeOfClick);
            var clickConfig = _w["ClickConfig"] || {};
            if (_w["Log2"]) {
                Log2.LogEvent(gpingData.eventType, gpingData.data, null, null, null, null, null, null);
                if (_w["ThresholdUtilities"]) {
                    var utilities = _w["ThresholdUtilities"];
                    utilities.uploadApiTimes("PCE");
                }
                if (clickConfig.ForceFlushOnClick || ((typeOfClick === 0) && clickLeavesPage())) {
                    // if we are leaving the page with this click we will flush all relevant logs
                    sj_evt.fire("visibility", document["hidden"]);
                    if (clickConfig.FlushSkipAbort) {
                        Log2.FlushMainQueueDontForce();
                    }
                    else {
                        Log2.ForceFlush();
                    }
                    _w["clickFlushedTime"] = sb_gt();
                }
            }
        }
    }
    _w["si_T"] = sendRequest;
    function clickLeavesPage() {
        if (_w.event && _w.event.srcElement) {
            var linkToCheck = _w.event.srcElement;
            while (!linkToCheck.href) {
                if (linkToCheck.parentElement) {
                    linkToCheck = linkToCheck.parentElement;
                }
                else {
                    // we have no further up to go, this means the user didn't click on a link
                    return false;
                }
            }
            if (linkToCheck.href.split("#")[0] !== _d.URL.split("#")[0]) {
                return true;
            }
        }
        return false;
    }
    function getGPingData(linkInfo, typeOfClick) {
        var matches = linkInfo.match(kValueExtractionRegex);
        if (matches) {
            var gpingData = {
                eventType: "Click",
                data: {
                    AppNS: matches[1],
                    K: matches[2],
                    Case: typeOfClick
                }
            };
            if (matches[4]) {
                gpingData.data.Properties = JSON.parse(matches[4]);
            }
            return gpingData;
        }
        throw new Error("hValue passed to click tracking was unable to be parsed: " + linkInfo);
    }
})();
;///<amd-module name="onHTML" />
define("onHTML", ["require", "exports", "event.custom"], function (require, exports, customEvents) {
    customEvents.fire("onHTML");
});
;///<reference path="Declarations\Shared.d.ts"/>
// Prevent zooming via ctrl + mousewheel
sj_be(_d, "mousewheel", function (evt) {
    if (evt.ctrlKey == true) {
        sj_pd(evt);
    }
});
// Prevent zooming via ctrl +/-
sj_be(_d, "keydown", function (evt) {
    if (evt.ctrlKey == true && (evt.keyCode == 107 || evt.keyCode == 109 || evt.keyCode == 187 || evt.keyCode == 189)) {
        sj_pd(evt);
    }
});
;///<reference path="Declarations\Shared.d.ts" />
/*
Instrumentation library for server and client powered apps in Windows smartsearch
Per this design, Server sets the visibility to false (v=0) on all the app links and client sends the Merge update through MergeInstruction format
setting v=1 on link being shown and also sends the Datasource merge event setting correct installstate of the app.
*/
var AppInst;
(function (AppInst) {
    var kValueExtractionRegex = /ID=([\w]+),([\d]+\.[\d]+)/i;
    var kValueNew = 1;
    AppInst.layoutJson = [];
    AppInst.datasourceJson = [];
    (function (InstallState) {
        InstallState[InstallState["Installed"] = 0] = "Installed";
        InstallState[InstallState["NotInstalled"] = 1] = "NotInstalled";
    })(AppInst.InstallState || (AppInst.InstallState = {}));
    var InstallState = AppInst.InstallState;
    // queues for submission or submits the instrumentation log for server powered apps in smartsearch
    function queueServerAppLog(hVisibleLayout, appInfoDsKValue, installState, hideIfNotInstalled, canSubmit) {
        if (canSubmit === void 0) { canSubmit = true; }
        var namespace = "";
        if (hVisibleLayout) {
            var matches = hVisibleLayout.match(kValueExtractionRegex);
            if (matches && matches.length >= 3) {
                // Store the namespace and K value.
                namespace = matches[1];
                var kValue = matches[2];
                if (installState !== 1 /* NotInstalled */ || !hideIfNotInstalled) {
                    AppInst.layoutJson.push({
                        "T": "L.MI",
                        "Action": "Update",
                        "AppNS": namespace,
                        "K": kValue,
                        "V": "1"
                    });
                }
            }
        }
        if (appInfoDsKValue) {
            AppInst.datasourceJson.push({
                "T": "D.MI",
                "Action": "Update",
                "AppNS": namespace,
                "K": appInfoDsKValue,
                "InstallState": getInstallStateString(installState)
            });
        }
        if (canSubmit) {
            submitLog();
        }
    }
    AppInst.queueServerAppLog = queueServerAppLog;
    function getInstallStateString(installState) {
        switch (installState) {
            case 0 /* Installed */:
                return "Installed";
            case 1 /* NotInstalled */:
                return "NotInstalled";
            default:
                return "Unknown";
        }
    }
    function getUniqueId() {
        return kValueNew++;
    }
    AppInst.getUniqueId = getUniqueId;
    // submits the instrumentation log in Merge instruction (MI) format.
    function submitLog() {
        var data = [];
        if (AppInst.layoutJson.length > 0) {
            data.push({
                "Page": AppInst.layoutJson
            });
            AppInst.layoutJson = [];
        }
        if (AppInst.datasourceJson.length > 0) {
            data.push(AppInst.datasourceJson);
            AppInst.datasourceJson = [];
        }
        if (data.length > 0) {
            postLog(JSON.stringify(data));
        }
    }
    AppInst.submitLog = submitLog;
    function postLog(data) {
        if (data) {
            if (_w["Log2"]) {
                Log2.LogEvent("ClientInst", JSON.parse(data), null, null, null, null, null, null);
            }
            else {
                // If ClientInstV2 is not supported
                var time = sb_gt();
                var payload = "<E><T>Event.ClientInst</T><IG>" + _G.IG + "</IG><TS>" + time + "</TS><D>" + data + "</D></E>";
                var xml = "<ClientInstRequest><Events>" + payload + "</Events><STS>" + time + "</STS></ClientInstRequest>";
                var request = sj_gx();
                request.open("POST", "/fd/ls/lsp.aspx", true);
                request.setRequestHeader("Content-Type", "text/xml");
                request.send(xml);
            }
        }
    }
})(AppInst || (AppInst = {}));
;///<reference path="..\Declarations\Shared.d.ts"/>
///<reference path="..\AppInst.ts"/>
// this module is used to initialize the Hose page to have app context sense
var AppApi;
(function (AppApi) {
    // Adds a handler for the specified control name
    function AddControlHandler(controlName, handler) {
        if (!controlHandlers[controlName]) {
            controlHandlers[controlName] = handler;
        }
    }
    AppApi.AddControlHandler = AddControlHandler;
    // The map of handlers for each control type
    var controlHandlers = {};
    // holding a cache of current page apps
    var pageApps = null;
    var instrumentationEnabled = typeof (AppInst) != 'undefined';
    // update app
    function updateApp(app) {
        if (pageApps && app) {
            var elements = pageApps[app.id];
            if (elements) {
                for (var i = 0; i < elements.length; ++i) {
                    updateAppElement(elements[i], app);
                }
            }
        }
    }
    // Invokes the control-specific handler
    function updateAppElement(element, app) {
        var hideIfNotInstalled = Boolean(element.getAttribute("data-hideIfNotInstalled"));
        if (instrumentationEnabled) {
            // Setting canSubmit to 'false' here so that single payload can be submitted later for all the Apps through explicit call to AppInst.SubmitLog function.
            var canSubmit = false;
            var installState = app.installed ? 0 /* Installed */ : 1 /* NotInstalled */;
            AppInst.queueServerAppLog(element.getAttribute("h"), element.getAttribute("data-appInfoDsK"), installState, hideIfNotInstalled, canSubmit);
        }
        var controlName = element.getAttribute("data-controlName");
        if (controlName) {
            var handler = controlHandlers[controlName];
            if (handler) {
                var minVersionStr = element.getAttribute("data-minVersion");
                var additionalPropsStr = element.getAttribute("data-additionalProps");
                var installedVersion = app.installedAppVersion ? stringToVersion(app.installedAppVersion) : null;
                var requiredMinVersion = minVersionStr ? stringToVersion(minVersionStr) : null;
                var eventArgs = {
                    appElement: element,
                    appInfo: app,
                    installedVersion: installedVersion,
                    requiredMinVersion: requiredMinVersion,
                    // if the min version is not specified, no update is needed
                    updateRequired: requiredMinVersion && installedVersion ? compareAppVersions(installedVersion, requiredMinVersion) < 0 : false,
                    updateAvailable: app.updateAvailable,
                    hideIfNotInstalled: hideIfNotInstalled,
                    additionalProps: null
                };
                try {
                    eventArgs.additionalProps = additionalPropsStr ? JSON.parse(additionalPropsStr) : null;
                    handler(eventArgs);
                }
                catch (ex) {
                    // Nothing we can do, really...
                    Log.Log("Error", "AppApi", "Handler_" + controlName, false, "Tx", ex.message);
                }
                if (app.installed && hideIfNotInstalled) {
                    // Show previously hidden apps
                    element.classList.remove('b_hide');
                }
            }
        }
    }
    // Reads the app from current page
    function readApps() {
        // We create the list of apps on first call to UpdateApp
        if (pageApps) {
            return;
        }
        pageApps = {};
        var dataAttr = "data-appid";
        // Scrape the DOM to get all the DOM Elements related to apps
        var appLinks = _d.querySelectorAll("[" + dataAttr + "]");
        for (var i = 0; i < appLinks.length; i++) {
            var appLink = appLinks[i];
            if (appLink) {
                // Get the value of data - appid attribute
                var appId = appLink.getAttribute(dataAttr);
                // If the app id is valid, then add it to the collection
                if (appId) {
                    var appElementList = pageApps[appId];
                    if (appElementList) {
                        // add it to the existing collection
                        appElementList.push(appLink);
                    }
                    else {
                        // create a new list to hold apps
                        pageApps[appId] = [appLink];
                    }
                }
            }
        }
    }
    // Make an element a launch link with proper instrumentation
    function setLaunchLink(targetElement, appElement, appId, launchUrl) {
        targetElement.setAttribute("href", launchUrl);
        // This code sets proper instrumentation attribute on the launch link
        // We cannot have two identical apps within the same DOM element, for example in the same pivot. We can have two
        // identical apps on different pivots, e.g. OpenTable on About and Apps, however they will have different K values
        // so we need to select the correct sibling element which contains the launch K value to use.
        var siblingInstElement = querySelector(appElement.parentElement, "[data-launchappid='" + appId + "']");
        if (siblingInstElement) {
            var hAttr = "h";
            // data-inst will only be present behind FD
            var hValue = siblingInstElement.getAttribute(hAttr);
            if (hValue && hValue.length > 0) {
                targetElement.setAttribute(hAttr, hValue);
            }
        }
    }
    AppApi.setLaunchLink = setLaunchLink;
    function instrumentUpgradeLink(appElement) {
        // If upgrade link is instrumented with it's own InstLink and h value, then set that to be the h value of rendered link.
        // This is currently applicable for Windows app links which use separate link for upgrade state.
        var upgradeLinkElement = querySelector(appElement.parentElement, "[data-linkRole='Upgrade']");
        if (upgradeLinkElement) {
            var hUpgradeLink = upgradeLinkElement.getAttribute("h");
            if (hUpgradeLink) {
                appElement.setAttribute("h", hUpgradeLink);
            }
        }
    }
    AppApi.instrumentUpgradeLink = instrumentUpgradeLink;
    // Shell will call this method to update app info with app list
    // This function name and its namespace can't be changed.
    function UpdateAppInfo(apps) {
        if (apps) {
            // This will only read the app element list once, caching it for all subsequent calls
            readApps();
            for (var i = 0; i < apps.length; ++i) {
                updateApp(apps[i]);
            }
        }
        // At this point, we have enqueued the logs for all the app links through AppInst.queueServerAppLog function calls.
        // For perf reasons, we submit them all at once in single payload through the following function call.
        if (instrumentationEnabled) {
            AppInst.submitLog();
        }
    }
    AppApi.UpdateAppInfo = UpdateAppInfo;
    function stringToVersion(versionStr) {
        return versionStr.split('.').map(function (s) { return Number(s); });
    }
    // Version comparison function
    function compareAppVersions(version1, version2) {
        var commonLength = Math.min(version1.length, version2.length);
        for (var i = 0; i < commonLength; i++) {
            var diff = version1[i] - version2[i];
            if (diff != 0) {
                return diff;
            }
        }
        // The longer version number is considered greater
        return version1.length - version2.length;
    }
    function querySelector(element, query) {
        return element.querySelector(query);
    }
})(AppApi || (AppApi = {}));
;// ------------------------------------------------------------------------------
// <copyright file="SmartSearch.Navigation.ts" company="Microsoft Corporation">
//     Copyright (c) Microsoft Corporation. All Rights Reserved.
//     Information Contained Herein is Proprietary and Confidential.
// </copyright>
// ------------------------------------------------------------------------------
///<reference path="..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts" />
///<reference path="SearchApp.Mock.ts" />
///<reference path="Declarations\CortanaEnums.d.ts" />
var CachedDeviceItems = {};
var SmartSearch;
(function (SmartSearch) {
    var cortanaApp = SearchAppWrapper.CortanaApp;
    var _supportedPaths = null;
    var baseProtocol = null;
    var baseHostname = null;
    var launchApiAllowedLatency = 100;
    var apiNameAbbreviator = /(^.)|([A-Z])/g;
    function isSupportedPath(path, search) {
        var supportedPathsCollection = getSupportedPaths();
        path = cleanPath(path);
        // Cut off the leading ? in the search parameters
        if (search && search.substring) {
            search = search.substring(1);
        }
        // A path is supported if it's not blocked and there is a supported path for it
        // Check block lists first as they should be shorter
        return (!isPathSatisfied(supportedPathsCollection.Blocked, path, search) && isPathSatisfied(supportedPathsCollection.Supported, path, search));
    }
    SmartSearch.isSupportedPath = isSupportedPath;
    /// Called by test code to reset cached state between tests
    function reset() {
        _supportedPaths = null;
    }
    SmartSearch.reset = reset;
    function cleanPath(path) {
        var cleanPath = path;
        if (cleanPath) {
            var cleanPath = cleanPath.toLowerCase();
            var cutIndex = -1;
            for (var i = 0; i < cleanPath.length && cleanPath[i] === "/"; i++) {
                cutIndex = i;
            }
            if (cutIndex >= 0) {
                cleanPath = cleanPath.substring(cutIndex + 1);
            }
        }
        return cleanPath;
    }
    function getSupportedPaths() {
        if (!_supportedPaths) {
            var thresholdConfig = _TC;
            if (thresholdConfig) {
                var supportedPaths = null;
                var blockedPaths = null;
                if (thresholdConfig.SP) {
                    supportedPaths = parsePathList(thresholdConfig.SP);
                }
                if (thresholdConfig.BP) {
                    blockedPaths = parsePathList(thresholdConfig.BP);
                }
                _supportedPaths = { Supported: supportedPaths, Blocked: blockedPaths };
            }
        }
        return _supportedPaths;
    }
    function isPathSatisfied(supportedPathsMap, path, search) {
        for (var i in supportedPathsMap) {
            if (path.indexOf(i) >= 0) {
                var requiredParameters = supportedPathsMap[i];
                var allParametersPresent = true;
                // Check if this path requires specific querystring parameters
                if (requiredParameters.length > 0) {
                    // If we require some parameters we assume we don't have them until we succeed with parsing
                    allParametersPresent = false;
                    if (search) {
                        var parsedPathParameters = cleanArray(search.split("&"));
                        // If we require some parameters and have parameters in the input path then we assume we've got what we need until we find a parameter is missing
                        allParametersPresent = parsedPathParameters.length >= requiredParameters.length;
                        if (allParametersPresent) {
                            for (var requiredParameterIndex in requiredParameters) {
                                if (parsedPathParameters.indexOf(requiredParameters[requiredParameterIndex]) < 0) {
                                    // We've failed to find a required parameter, so we know this is not a match
                                    allParametersPresent = false;
                                    break;
                                }
                            }
                        }
                    }
                }
                // We found all required parameters or there were no required parameters.  This is a match.
                if (allParametersPresent) {
                    return true;
                }
            }
        }
        return false;
    }
    function parsePathList(supportedPaths) {
        var parsedPaths = {};
        supportedPaths = supportedPaths.toLowerCase();
        var supportedFullPaths = supportedPaths.split(",");
        var defaultRequiredQueryStrings = [];
        for (var supportedFullPathIndex in supportedFullPaths) {
            var pathAndQuery = cleanArray(supportedFullPaths[supportedFullPathIndex].split("?"));
            var requiredQueryStrings = defaultRequiredQueryStrings;
            if (pathAndQuery.length > 1) {
                requiredQueryStrings = cleanArray(pathAndQuery[1].split("&"));
            }
            parsedPaths[cleanPath(pathAndQuery[0])] = requiredQueryStrings;
        }
        return parsedPaths;
    }
    function cleanArray(inputArray) {
        var returnValue = inputArray;
        if (inputArray) {
            var startIndex = 0;
            var foundItemToClean = false;
            for (var i = startIndex; i < inputArray.length; i++) {
                if (!inputArray[i]) {
                    if (!foundItemToClean) {
                        returnValue = [];
                        foundItemToClean = true;
                    }
                    if (i > startIndex) {
                        returnValue.push.apply(returnValue, inputArray.slice(startIndex, i));
                    }
                    startIndex = i + 1;
                }
            }
        }
        return returnValue;
    }
    function signalComplete() {
        sj_evt.fire("NavigationComplete");
    }
    function navigateTo(targetElement, event) {
        var preventDefault = true;
        // Check if target element link is internal or external
        if (targetElement) {
            var searchUtils = ThresholdUtilities;
            var destinationPath = targetElement.pathname;
            var destinationHostname = getHostname(targetElement);
            var destinationProtocol = targetElement.protocol;
            var destinationSearch = targetElement.search;
            var destinationHash = targetElement.hash;
            if (!baseHostname || !baseProtocol) {
                getBaseUrl();
            }
            var destinationLink = targetElement.href;
            // If the link is really a javascript invocation (like "javascript:void(0)"), bail out.
            if (destinationProtocol.toLowerCase() === "javascript:") {
                return;
            }
            if (destinationPath.toLowerCase() === _w.location.pathname.toLowerCase() && destinationSearch.toLowerCase() === _w.location.search.toLowerCase() && destinationHash.toLowerCase() === _w.location.hash.toLowerCase()) {
                SharedLogHelper.LogWarning("SelfNavigate");
            }
            else if (destinationLink) {
                if (!destinationHostname) {
                    destinationHostname = baseHostname; // automatically accquire current domain for relative links
                }
                // Determine if a link is relative.
                // Handle a weird case where the url is ms-windows-store:PDP?PFN=..., no host, and "ms-windows-store:" protocol
                var isRelative = (!destinationProtocol || destinationProtocol.indexOf("http") === 0) && (destinationHostname === baseHostname || destinationHostname === getHostname(location));
                var urlType = getUrlType(destinationPath, destinationSearch, destinationHostname, isRelative);
                var launcher = cortanaApp.launcher;
                switch (urlType) {
                    case 5 /* Search */:
                    case 3 /* Navigation */:
                        if (isRelative) {
                            rebaseLink(targetElement);
                            // Need to refresh after changing the link properties
                            destinationLink = targetElement.href;
                        }
                        if (urlType === 5 /* Search */) {
                            // Force Cat3b (search)
                            var joiningChar = destinationLink.indexOf("?") === -1 ? "?" : "&";
                            destinationLink += joiningChar + "persona=0";
                        }
                        var navigateWebViewFunctionName = "navigateWebViewAsync";
                        var launchWebContentFunctionName = "launchWebContent";
                        var thresholdConfig = _TC;
                        if (thresholdConfig && thresholdConfig.NW && launcher[launchWebContentFunctionName]) {
                            var launchOptions = launcher.createWebContentLaunchOptions();
                            launchOptions.uri = destinationLink;
                            searchUtils.wrapSynchronousApiCall(launcher, launchWebContentFunctionName, createInstrumentationKey(launchWebContentFunctionName), null, launchOptions);
                            signalComplete();
                        }
                        else if (cortanaApp[navigateWebViewFunctionName]) {
                            searchUtils.wrapApiCallWithTimeout(cortanaApp, navigateWebViewFunctionName, createInstrumentationKey(navigateWebViewFunctionName), destinationLink, launchApiAllowedLatency, null, destinationLink).done(signalComplete);
                        }
                        else {
                            // We're in charge of the actual navigation
                            preventDefault = false;
                        }
                        break;
                    case 0 /* App */:
                        var options = null;
                        var appContext = targetElement.getAttribute("data-appcontext");
                        if (appContext) {
                            options = launcher.createAppLaunchOptions();
                            options.appContext = appContext;
                        }
                        var itemId = targetElement.getAttribute("data-appid");
                        if (itemId) {
                            var itemSource = targetElement.getAttribute("data-source");
                            var deviceItem = CachedDeviceItems[itemId + ":" + itemSource];
                            if (deviceItem) {
                                var launchSearchItemAsyncPromise;
                                var functionName = "launchSearchItemAsync";
                                if (options) {
                                    launchSearchItemAsyncPromise = searchUtils.wrapApiCallWithTimeout(launcher, functionName, createInstrumentationKey(functionName), deviceItem.id, launchApiAllowedLatency, null, deviceItem, options);
                                }
                                else {
                                    launchSearchItemAsyncPromise = searchUtils.wrapApiCallWithTimeout(launcher, functionName, createInstrumentationKey(functionName), deviceItem.id, launchApiAllowedLatency, null, deviceItem);
                                }
                                launchSearchItemAsyncPromise.done(signalComplete);
                            }
                            else {
                                var itemType = targetElement.getAttribute("data-itemtype");
                                var functionName = itemType && itemType === "settings" ? "findSettingsAsync" : "findAppsAsync";
                                searchUtils.wrapApiCallWithTimeout(cortanaApp.searchResultsView.deviceSearch, functionName, createInstrumentationKey(functionName), "Navigation", launchApiAllowedLatency, null, [itemId]).then(sj_df(launchFirstFoundItem, options));
                            }
                        }
                        break;
                    case 4 /* Experience */:
                        var experienceName = targetElement.getAttribute("data-experiencename");
                        if (experienceName) {
                            SearchAppWrapper.CortanaApp.launchExperienceByName(experienceName, null);
                        }
                        break;
                    case 2 /* Explore */:
                        var destination = targetElement.getAttribute("data-dest");
                        if (destination) {
                            var provider = targetElement.getAttribute("data-provider");
                            if (provider) {
                                launcher.launchSearchInApp(destination, ThresholdUtilities.getDecodedQuery(_w.location.toString()), provider);
                            }
                            else {
                                launcher.launchSearchInApp(destination, ThresholdUtilities.getDecodedQuery(_w.location.toString()));
                            }
                            signalComplete();
                        }
                        break;
                    case 1 /* Web */:
                        if (isRelative) {
                            rebaseLink(targetElement);
                            // Need to refresh after changing the link properties
                            destinationLink = targetElement.href;
                            // Instrument the time of the click to allow us to join the impressions. These requests are from two
                            // different apps, so will be seen as 2 different users, making it difficult to measure e2e perf from
                            // app click to browser page load without this query param.
                            var joiningChar = destinationLink.indexOf("?") === -1 ? "?" : "&";
                            destinationLink += joiningChar + "ts=" + sb_gt();
                            if (_G.nclid) {
                                destinationLink += "&nclid=" + _G.nclid;
                            }
                        }
                        var functionName = "launchUriAsync";
                        searchUtils.wrapApiCallWithTimeout(launcher, functionName, createInstrumentationKey(functionName), "Navigation", launchApiAllowedLatency, null, destinationLink).then(signalComplete);
                        break;
                }
            }
        }
        if (event && preventDefault) {
            event.preventDefault();
        }
    }
    ;
    function createInstrumentationKey(apiName) {
        return apiName.match(apiNameAbbreviator).join("").toUpperCase();
    }
    function launchFirstFoundItem(result, options) {
        if (result != null) {
            for (var i in result) {
                var currentResult = result[i];
                // This check seems unecessary, but the mapping returned maps IDs to empty objects when it fails to find it on the machine.
                if (currentResult && currentResult.id) {
                    var functionName = "launchSearchItemAsync";
                    ThresholdUtilities.wrapApiCallWithTimeout(SearchAppWrapper.CortanaApp.launcher, functionName, createInstrumentationKey(functionName), null, launchApiAllowedLatency, null, currentResult, options).then(signalComplete);
                    break;
                }
            }
        }
    }
    function getUrlType(destinationPath, destinationSearch, destinationHostname, isRelative) {
        if (isRelative && isSupportedPath(destinationPath, destinationSearch)) {
            // This is a requery on search
            if (destinationPath === "search" || destinationPath === "/search") {
                return 5 /* Search */;
            }
            // This is a navigation link to another bing page
            return 3 /* Navigation */;
        }
        else if (destinationHostname === "ms-smartsearch") {
            if (destinationPath === "app" || destinationPath === "/app") {
                return 0 /* App */;
            }
            else if (destinationPath === "searchInApp" || destinationPath === "/searchInApp") {
                return 2 /* Explore */;
            }
            else if (destinationPath === "experience" || destinationPath === "/experience") {
                return 4 /* Experience */;
            }
        }
        // Any other links should be launched in browser.
        return 1 /* Web */;
    }
    ;
    function onClickHandler(evt) {
        if (!evt.defaultPrevented) {
            var element = evt.target;
            var targetElement = getParentContainer(element, "A");
            if (targetElement) {
                navigateTo(targetElement, evt);
            }
        }
    }
    ;
    function getParentContainer(target, tagName) {
        for (; target && target !== document; target = target.parentNode) {
            if (target.tagName === tagName) {
                return target;
            }
        }
    }
    ;
    function getBaseUrl() {
        if (_w["_TH_BU"]) {
            var baseUrlPieces = _TH_BU.split("//", 2);
            if (baseUrlPieces.length === 2) {
                baseProtocol = baseUrlPieces[0];
                baseHostname = baseUrlPieces[1];
                return;
            }
        }
        baseProtocol = location.protocol;
        baseHostname = getHostname(location);
    }
    function rebaseLink(element) {
        element.protocol = baseProtocol;
        element.hostname = baseHostname;
        element.port = baseProtocol === "https:" ? "443" : "80";
    }
    function getHostname(element) {
        if (!element) {
            return null;
        }
        var hostname = element.hostname;
        if (!hostname) {
            return null;
        }
        // Microsoft Edge drops the [ ] for IPv6 urls, and we cannot actually navigate to IPv6 hosts without them.
        // Add them if they're missing.
        if (hostname.indexOf(":") >= 0 && hostname.indexOf("[") < 0) {
            hostname = "[" + hostname + "]";
        }
        return hostname;
    }
    sj_be(_w, "click", onClickHandler);
    var UrlType;
    (function (UrlType) {
        UrlType[UrlType["App"] = 0] = "App";
        UrlType[UrlType["Web"] = 1] = "Web";
        UrlType[UrlType["Explore"] = 2] = "Explore";
        UrlType[UrlType["Navigation"] = 3] = "Navigation";
        UrlType[UrlType["Experience"] = 4] = "Experience";
        UrlType[UrlType["Search"] = 5] = "Search";
    })(UrlType || (UrlType = {}));
})(SmartSearch || (SmartSearch = {}));
;// ------------------------------------------------------------------------------
// <copyright file="SmartSearch.ts" company="Microsoft Corporation">
//     Copyright (c) Microsoft Corporation. All Rights Reserved.
//     Information Contained Herein is Proprietary and Confidential.
// </copyright>
// ------------------------------------------------------------------------------
///<reference path="..\..\..\..\Shared\Content\Content\script\Declarations\AppApi.d.ts"/>
///<reference path="..\..\..\..\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts" />
///<reference path="SmartSearch.Navigation.ts"/>
///<reference path="SearchApp.Mock.ts"/>
(function () {
    var appIdAttribute = "data-appid";
    if (typeof AppApi === "undefined" || !AppApi.UpdateAppInfo || !SearchAppWrapper.CortanaApp.searchResultsView) {
        return;
    }
    // Get app ids
    var appIds = [];
    var appLinks = document.querySelectorAll("[" + appIdAttribute + "]");
    for (var i = 0; i < appLinks.length; i++) {
        var appId = appLinks[i].getAttribute(appIdAttribute);
        if (appIds.indexOf(appId) < 0) {
            appIds.push(appId);
        }
    }
    var processApplicationMap = function (results) {
        var apps = [];
        for (var index in appIds) {
            var appId = appIds[index];
            if (results.hasKey(appId)) {
                var item = results[appId];
                if (item) {
                    var app = {
                        id: appId,
                        installedAppVersion: item.version,
                        installed: true
                    };
                    apps.push(app);
                    if (CachedDeviceItems && !CachedDeviceItems[appId]) {
                        CachedDeviceItems[appId] = item;
                    }
                }
            }
        }
        AppApi.UpdateAppInfo(apps);
        ThresholdUtilities.uploadApiTimes("ALR");
    };
    // Check the app install state and update app info, only if we have some apps to check
    if (appIds.length > 0) {
        ThresholdUtilities.wrapApiCall(SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch, "findAppsAsync", "AL", "AppLinking", appIds).then(processApplicationMap);
    }
})();
;// sets a session cookie crumb with the browser's inner width and height, and the device pixel ratio
(function () {
    function setCW() {
        var clientSizeCookie = "SRCHHPGUSR";
        var cwCookie = sj_cook.get(clientSizeCookie, "CW");

        if (!cwCookie || (window.sj_b && cwCookie != sj_b.clientWidth)) {
            sj_cook.set(clientSizeCookie, "CW", sb_de.clientWidth || sj_b.clientWidth, 1, "/");
        }

        var chCookie = sj_cook.get(clientSizeCookie, "CH");
        if (!chCookie || chCookie != sb_de.clientHeight) {
            sj_cook.set(clientSizeCookie, "CH", sb_de.clientHeight, 1, "/");
        }

        var dprCookie = sj_cook.get(clientSizeCookie, "DPR");
        if (typeof _w.devicePixelRatio !== 'undefined' && (!dprCookie || dprCookie != _w.devicePixelRatio)) {
            sj_cook.set(clientSizeCookie, "DPR", _w.devicePixelRatio, 1, "/");
        }
    }
    sj_be(_w, "load", setCW);
    sj_be(_w, "resize", setCW);
})();;/// <reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
/// <reference path='..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts' />
/// <reference path="..\..\..\..\Threshold\src\Content\Script\Declarations\SearchAppWrapper.d.ts" />
/*This is a hack and temporary fix. TFS 5405929 tracks its removal as soon as LG issue is fixed for entity carousel from the backend.
invocation of "respond" API is necessary from the Cortana client perspective as it requres this API for removal of thinking canvas.
So this change is to unblock mobile2cortana flight while the right fix is being worked upon from backend side. */
(function () {
    if (SearchAppWrapper && SearchAppWrapper.CortanaApp) {
        var cat3AAnswer = _d.querySelector(".b_cat3a");
        var languageGenerationElement = cat3AAnswer && cat3AAnswer.querySelector("div[data-ssml]");
        if (languageGenerationElement) {
            ThresholdUtilities.wrapSynchronousApiCall(SearchAppWrapper.CortanaApp, "respond", null, "respond", languageGenerationElement.getAttribute("data-ssml"), languageGenerationElement.getAttribute("data-postssmlaction"), languageGenerationElement.getAttribute("data-secondarytext-small"), languageGenerationElement.getAttribute("data-secondarytext-medium"), languageGenerationElement.getAttribute("data-secondarytext-large"));
        }
        else {
            var emptySpaceString = " ";
            ThresholdUtilities.wrapSynchronousApiCall(SearchAppWrapper.CortanaApp, "respond", null, "respond", emptySpaceString, emptySpaceString, emptySpaceString, emptySpaceString, emptySpaceString);
        }
        var emotionElement = cat3AAnswer && cat3AAnswer.querySelector("div[data-emot]");
        if (emotionElement) {
            ThresholdUtilities.wrapSynchronousApiCall(SearchAppWrapper.CortanaApp, "setEmotion", null, "setEmotion", emotionElement.getAttribute("data-emot"), emotionElement.getAttribute("data-emot-size") === "large", emotionElement.hasAttribute("data-emot-overridespeaking"));
        }
    }
})();
;CUDialog.sendAction({"CuAction":"{\"Uri\":\"action://CuOutput\",\"SystemAction\":{\"Uri\":\"action://Conversation/LaunchSPA\",\"Version\":\"1.0\"},\"ConversationId\":\"cea4dc63-122c-c7bf-5b09-62c0092037f4\",\"TraceId\":\"0FD24AC8D32A4DB480F6C516FC781763\",\"ImpressionId\":\"f81131fda41d8d55c3464df4c356c1da\",\"LgObject\":{\"Uri\":\"action://LgObject\",\"Ssml\":null,\"DisplayText\":null,\"SuggestionText\":null,\"SecondaryDisplayTextSmall\":null,\"SecondaryDisplayTextMedium\":null,\"SecondaryDisplayTextLarge\":null}}"});;///<reference path="..\Declarations\Shared.d.ts" />
// Please don't change this module name - it's part of Cortana spec
var BMPage;
(function (BMPage) {
    function UpdateUserDisplayName(name) {
        if (!name) {
            return;
        }
        var userNameContainers = _d.querySelectorAll("[data-userDisplayName]");
        for (var i = 0; i < userNameContainers.length; i++) {
            var userNameContainer = userNameContainers[i];
            userNameContainer.innerText = name;
        }
    }
    BMPage.UpdateUserDisplayName = UpdateUserDisplayName;
})(BMPage || (BMPage = {}));
;/// <reference path='..\..\..\..\Shared\Content\Content\Script\Declarations\Threshold.Utilities.d.ts' />
var ThemablePage;
(function (ThemablePage) {
    var isDark;
    // find the themable page indicator and apply theme classname(s) to body element
    if (_ge("b_thp")) {
        _d.body.classList.add("b_theme");
        // find the requested theme and apply the dark classname
        ThresholdUtilities.getCortanaHeaders(function (headers) {
            if (headers) {
                var themeValue = headers["X-BM-Theme"];
                if (themeValue) {
                    var themeColor = themeValue.split(";")[0];
                    if (themeColor == "000000") {
                        isDark = true;
                    }
                }
            }
        });
        // find the query parameter for testing
        if (!isDark) {
            var themeValue = ThresholdUtilities.getUrlParameter(_w.location.search, 'theme');
            if (themeValue && themeValue.toLowerCase() === 'dark') {
                isDark = true;
            }
        }
        if (isDark) {
            _d.body.classList.add('b_thDark');
        }
    }
})(ThemablePage || (ThemablePage = {}));
;///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts"/>
_w["keyMap"] = {
    Content: "b_content",
    SearchForm: "sb_form",
    SBoxId: "sb_form_q",
    Notification: "b_notificationContainer",
    Identity: "id_h",
    Prefix: "b_",
    RmsDefer: "aRmsDefer",
    RmsKeys: ["rms:answers:Shared:BingCore.Bundle", "rms:answers:AjaxSerp:Ajax.Bundle", "rms:answers:BoxModel:Framework"],
    AutoSug: "sa_as",
    FeaturePersist: 1
};
;define("ajax.shared", ["require", "exports"], function (require, exports) {
    ///<reference path="..\ajax.keymap.d.ts"/>
    ///<reference path="..\..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts"/>
    function getPlaceholder(key) {
        var placeholderKey = keyMap[key] ? keyMap[key] : keyMap.Prefix + key;
        var placeholder = document.getElementById(placeholderKey);
        if (!placeholder && document.getElementsByClassName) {
            var holderClass = document.getElementsByClassName(placeholderKey);
            placeholder = holderClass && holderClass.length ? holderClass[0] : null;
        }
        return placeholder;
    }
    exports.getPlaceholder = getPlaceholder;
    function getRelativeUrl(url) {
        var a = sj_ce('a');
        a.href = url;
        var allowedPath = a.pathname;
        if (allowedPath[0] !== '/') {
            allowedPath = "/" + allowedPath;
        }
        var relativeUrl = "";
        if (allowedPath === "/") {
            relativeUrl = allowedPath;
        }
        else {
            var index = url.indexOf(allowedPath);
            relativeUrl = index > -1 ? url.substr(index) : "";
        }
        return relativeUrl;
    }
    exports.getRelativeUrl = getRelativeUrl;
    function getParentContainer(target, tagName, tag) {
        for (; target && target !== document; target = target.parentNode) {
            if (target[tagName] === tag) {
                return target;
            }
            if (target === undefined) {
                break;
            }
        }
    }
    exports.getParentContainer = getParentContainer;
    ;
});
;///<amd-module name="ajax.render" />
define("ajax.render", ["require", "exports", "ajax.shared"], function (require, exports, ajaxShared) {
    var dom = require("dom");
    var customEvents = require("event.custom");
    function renderJson(json) {
        for (var key in json) {
            if (key === "Script") {
                for (var i = 0; i < json[key].length; i++) {
                    var script = json[key][i];
                    renderItem(key, script);
                }
            }
            else {
                renderItem(key, json[key]);
            }
        }
    }
    exports.renderJson = renderJson;
    function renderItem(key, value) {
        switch (key) {
            case "Script":
                appendScripts(value);
                break;
            case "Style":
                dom.getCssHolder().innerHTML += '<div></div>' + value;
                break;
            case "IG":
                _G.IG = value;
                break;
            case "PageName":
                _G.PN = value;
                break;
            case "Title":
                document.title = value;
                break;
            case "HBop":
                var div = document.createElement("div");
                document.getElementById(keyMap.Content).appendChild(div);
                div.outerHTML = value;
                break;
            case "RmsDefer":
                var rmsContainer = ajaxShared.getPlaceholder(key);
                if (!rmsContainer) {
                    rmsContainer = document.createElement("div");
                    document.body.appendChild(rmsContainer);
                }
                rmsContainer.outerHTML = value;
                break;
            case "Content":
                appendContent(key, value);
                break;
            case "EOS":
                break;
            case "EOC":
                if (value === "1") {
                    customEvents.fire("ajax.firstChunkEnd");
                }
                break;
            default:
                appendContent(key, value);
        }
    }
    exports.renderItem = renderItem;
    function appendContent(key, value) {
        var placeholder = ajaxShared.getPlaceholder(key);
        if (placeholder) {
            if (typeof value === "string") {
                placeholder.outerHTML = value;
            }
            else {
                placeholder.parentNode.replaceChild(value, placeholder);
            }
        }
    }
    function appendScripts(script) {
        var value = script;
        if (value["Method"] === "reference") {
            dom.includeScriptReference(value["Content"]);
        }
        else {
            dom.includeScript(value["Content"]);
        }
    }
});
;///<amd-module name="ajax.providers" />
define("ajax.providers", ["require", "exports"], function (require, exports) {
    var providers = [];
    function registerProvider(responseCreator) {
        if (!responseCreator.sanitizeUrl) {
            responseCreator.sanitizeUrl = dummySanitizeUrl;
        }
        providers.push(responseCreator);
    }
    exports.registerProvider = registerProvider;
    function getAjaxController(url, origin, elem) {
        var length = providers.length;
        for (var i = 0; i < length; i++) {
            var responseCreator = providers[i];
            if (responseCreator.shouldAjax(url, origin, elem)) {
                return responseCreator;
            }
        }
        return null;
    }
    exports.getAjaxController = getAjaxController;
    function dummySanitizeUrl(url) {
        return url;
    }
});
;define("ajax.lifeCycle", ["require", "exports", "ajax.shared", "ajax.history", "ajax.providers", "ajax.render"], function (require, exports, ajaxShared, history, ajaxProviders, ajaxRender) {
    ///<reference path="..\ajax.keymap.d.ts"/>
    var dom = require("dom");
    var env = require("env");
    var cookies = require("cookies");
    var nativeEvents = require("event.native");
    var customEvents = require("event.custom");
    (function (Origin) {
        Origin[Origin["Click"] = 1] = "Click";
        Origin[Origin["History"] = 2] = "History";
        Origin[Origin["AS"] = 3] = "AS";
        Origin[Origin["DirectNav"] = 4] = "DirectNav";
        Origin[Origin["Hash"] = 5] = "Hash";
    })(exports.Origin || (exports.Origin = {}));
    var Origin = exports.Origin;
    var rms = require("rmsajax");
    var shared = require("shared");
    var jsNamespaceBlacklist = ["Bnp", "RMS_IACL", "sched", "TP", "bepns", "Identity", "initComCtrl", "ccal", "ccal_bundle", "expitem", "si_sendCReq"];
    var divClassNameBlackList = ["bubblePlaceholder", "irhc", "vrhc"];
    var _undefined;
    var lastRenderedOrigin = 1 /* Click */;
    var lastRenderedUrl = ajaxShared.getRelativeUrl(window.location.href);
    var pendingStyleBackup = false;
    var pendingRequestUrls = [];
    // Value to check if autosuggest is turned on.
    var autoSuggest;
    // For checking if query has at least one non whitespace character
    var queryRegex = /\S/;
    // For removing sid, format and jsoncbid parameters
    var urlRegex = /(&|%26)sid(=|%3d)\w+(&|%26)format(=|%3d)jsonv2(&|%26)jsoncbid(=|%3d)\d+/gm;
    function init() {
        autoSuggest = cookies.get("SRCHHPGUSR", "AS");
        wireup();
        customEvents.bind("ajax.state", handleHistoryChange);
        // Disabling escape key for ajax scenario
        nativeEvents.bind(document, "keydown", function (evt) {
            if (evt.keyCode === 27) {
                shared.preventDefault(evt);
            }
        });
        // this is used in GPing redirection code to check whether it's running on an AJAX SERP page
        _w["sj_isAjax"] = true;
        customEvents.fire("ajaxReady");
        customEvents.unbind("onP1", init);
    }
    function wireup() {
        var searchForm = document.getElementById("sb_form");
        nativeEvents.bind(searchForm, "submit", handleSearchForm);
        customEvents.bind("autoSugLoaded", function () {
            nativeEvents.unbind(searchForm, "submit", handleSearchForm);
            searchForm.submit = handleSearchForm;
        });
        document.onclick = clickHandler;
        nativeEvents.bind(_w, "hashchange", handleHashChange, false);
        // Wireup location change script
        window["sj_lc"] = function (url, originInput) {
            var originValue = originInput;
            if (!originValue) {
                originValue = 3 /* AS */;
            }
            handleLocationChange(url, originValue);
        };
    }
    // Wireup onClick handler to activate AJAX experience
    function clickHandler(evt) {
        // We ignore handling the click for the following cases
        // 1) The click was already prevented from doing default behavior by some other feature on the page.
        // 2) The control key/shift key was pressed along with click, which indicates user was trying to open in new tab/window
        // 3) The click was due to a right button click. (Firefox fires the click event even for a right click)
        // 4) The url pointed to by the anchor tag is not going to serp vertical.
        // 5) The url pointed to by the anchor tag is same as the current page url.
        if (!evt.defaultPrevented && !evt.ctrlKey && !evt.shiftKey && evt.button === 0) {
            var element = evt.target;
            var targetElement = ajaxShared.getParentContainer(element, "tagName", "A");
            if (targetElement) {
                var ajaxController = ajaxProviders.getAjaxController(targetElement.href, 1 /* Click */, targetElement);
                if (!ajaxController) {
                    return;
                }
                var destinationPath = targetElement.pathname;
                var destionationProtocol = targetElement.protocol ? targetElement.protocol : location.protocol;
                var destinationHostname = targetElement.hostname ? targetElement.hostname : location.hostname; // automatically accquire current domain for relative links
                var destinationLink = targetElement.href;
                // If any links have a sid, format and jsoncbid property on them, we need to remove it
                destinationLink = ajaxController.sanitizeUrl(destinationLink);
                if (destinationLink) {
                    targetElement.href = destinationLink;
                }
                if (destinationHostname === location.hostname && location.protocol === destionationProtocol) {
                    // Make link relative
                    destinationLink = destinationLink.substr(destinationLink.indexOf(destinationPath));
                    loadPage(destinationLink, 1 /* Click */, ajaxController);
                    evt.preventDefault();
                }
            }
        }
    }
    // Autosuggest & Searchbox
    function getSearchUrl(query) {
        return _w.location.pathname + "?q=" + encodeURIComponent(query);
    }
    function getFormParameters(form) {
        var value = "";
        var inputFields = form.getElementsByTagName("input");
        for (var i = 0; i < inputFields.length; i++) {
            if (inputFields[i]["type"] === "hidden") {
                value += "&" + inputFields[i]["name"] + "=" + encodeURIComponent(inputFields[i]["value"]);
            }
        }
        return value;
    }
    function handleSearchForm(evt) {
        var form = document.getElementById(keyMap.SearchForm);
        var query = document.getElementById(keyMap.SBoxId)["value"];
        if (queryRegex.test(query)) {
            // Query is not empty and not just whitespace
            shared.preventDefault(evt);
            var relativeUrl = getSearchUrl(query) + getFormParameters(form);
            renderPage(relativeUrl, 3 /* AS */);
        }
    }
    function handleHistoryChange(data) {
        if (data && data.length > 1) {
            var currentUrl = data[1];
            // prevent re-rendering same page twice
            if (currentUrl) {
                renderPage(currentUrl, 2 /* History */);
            }
        }
    }
    function handleHashChange() {
        handleLocationChange(_w.location.toString(), 5 /* Hash */);
    }
    function handleLocationChange(url, originValue) {
        var relativeUrl = ajaxShared.getRelativeUrl(url);
        var ajaxController = ajaxProviders.getAjaxController(url, originValue);
        if (ajaxController) {
            loadPage(relativeUrl, originValue, ajaxController);
        }
        else {
            window.location.assign(url);
        }
    }
    // First run operations
    customEvents.bind("onP1", init, true);
    function sendPerfPing() {
        _G.PPS = false;
        si_PP(new Date());
    }
    function isPendingUrl(url) {
        return pendingRequestUrls.indexOf(url) !== -1;
    }
    // Ajax Load Page
    function beforeRender(url, origin) {
        pendingStyleBackup = true;
        pendingRequestUrls.push(url);
        lastRenderedOrigin = origin;
        lastRenderedUrl = url;
        if (origin === 4 /* DirectNav */) {
            return;
        }
        customEvents.fire("unload");
        customEvents.fire("ajax.unload");
        env.clear();
        // Clear out black listed javascript namespaces
        shared.forEach(jsNamespaceBlacklist, function (jsNamespace) {
            if (window.hasOwnProperty(jsNamespace)) {
                window[jsNamespace] = _undefined;
                delete window[jsNamespace];
            }
        });
        shared.forEach(divClassNameBlackList, function (className) {
            var el = document.getElementsByClassName(className);
            for (var i = 0; i < el.length; i++) {
                var element = el[i];
                element.parentNode.removeChild(element);
            }
        });
        clearMaps();
        removeNotification();
        customEvents.reset();
        rms.reset();
    }
    function backupStyles() {
        if (pendingStyleBackup) {
            var backupCssHolder = dom.getCssHolder();
            backupCssHolder.id = "ajaxStylesBackup";
            var cssHolder = dom.getCssHolder();
            var backupCssHolderSibling = backupCssHolder.nextSibling;
            if (backupCssHolderSibling) {
                backupCssHolder.parentNode.insertBefore(cssHolder, backupCssHolderSibling);
            }
            pendingStyleBackup = false;
        }
    }
    function afterRender() {
        if (lastRenderedOrigin === 4 /* DirectNav */) {
            updateLocation(lastRenderedUrl);
            customEvents.fire("directNavComplete");
            return;
        }
        sendPerfPing();
        cleanupStyles();
        updateLocation(lastRenderedUrl);
        wireup();
        customEvents.fire("ajax.load");
        customEvents.fire("onHTML");
        customEvents.fire("onPP");
        customEvents.fire("onP1Lazy");
        customEvents.fire("ajax.postload");
    }
    // Short-term solutions
    function removeNotification() {
        var div = document.getElementById(keyMap.Notification);
        if (div) {
            div.parentNode.removeChild(div);
            var identity = document.getElementById("id_h");
            if (identity)
                identity.style.top = "0";
        }
    }
    // Bug 1060372: Cleanup once there is a more effective way to clear out unnecessary global variables.
    // Clear namespaces related to maps. Needed for map pins to work properly.
    function clearMaps() {
        if (window["Bing"] && Bing.hasOwnProperty("MapControl")) {
            Bing.MapControl = _undefined;
            delete Bing.MapControl;
        }
        if (window["$MapsNamespace"]) {
            if (window.hasOwnProperty($MapsNamespace)) {
                window[$MapsNamespace] = _undefined;
                delete window[$MapsNamespace];
            }
        }
    }
    function cleanupStyles() {
        var backupCssHolder = document.getElementById("ajaxStylesBackup");
        if (backupCssHolder)
            backupCssHolder.parentNode.removeChild(backupCssHolder);
    }
    // Basic navigation methods to clean up existing page, change location and update history
    function updateLocation(url) {
        nativeEvents.unbind(_w, "hashchange", handleHashChange, false);
        if (lastRenderedOrigin !== 2 /* History */ && lastRenderedOrigin !== 4 /* DirectNav */ && lastRenderedOrigin !== 5 /* Hash */) {
            history.pushState(url);
        }
        // Clear out all pending URLs now that we're starting a fresh page
        pendingRequestUrls = [];
    }
    function renderPage(url, origin) {
        var ajaxController = ajaxProviders.getAjaxController(url, origin);
        if (ajaxController) {
            var sanitizedUrl = ajaxShared.getRelativeUrl(ajaxController.sanitizeUrl(url));
            loadPage(sanitizedUrl, origin, ajaxController);
        }
    }
    exports.renderPage = renderPage;
    function loadPage(url, origin, ajaxController) {
        if (isPendingUrl(url)) {
            return;
        }
        beforeRender(url, origin);
        customEvents.fire("ajax.navigateStart", url);
        ajaxController.createJsonAsync(url, function (json) { return callback(url, json, ajaxRender.renderJson); });
    }
    function callback(url, json, renderJson) {
        if (json["Style"]) {
            backupStyles();
        }
        renderJson(json);
        if (json["EOS"]) {
            afterRender();
        }
    }
});
;///<amd-module name="ajax.cortanaprovider" />
///<reference path="..\ajax.lifecycle.ts"/>
define("ajax.cortanaprovider", ["require", "exports", "ajax.providers", "ajax.lifeCycle"], function (require, exports, ajaxProviders, pageLifeCycle) {
    var currentUrl;
    window["AjaxCB"] = [];
    var requestBuilder;
    exports.origin = pageLifeCycle.Origin;
    function navigate(url, loader, origin) {
        currentUrl = url;
        if (!origin) {
            origin = 4 /* DirectNav */;
        }
        requestBuilder = loader;
        pageLifeCycle.renderPage(url, origin);
    }
    exports.navigate = navigate;
    function addJsonParameters(url) {
        if (url.indexOf("?") <= 0) {
            url += "?";
        }
        return "" + url + "&format=snrjson&jsoncbid=" + (window["AjaxCB"].length - 1);
    }
    function createJsonAsync(relativeUrl, callback) {
        window["AjaxCB"].push(callback);
        if (requestBuilder) {
            requestBuilder(relativeUrl, function (response, isJsonReponse) {
                var container = document.body;
                if (response && container) {
                    sj_appHTML(container, response);
                }
                if (!isJsonReponse) {
                    callback({ "EOS": 1 });
                }
            }, addJsonParameters);
            requestBuilder = null;
        }
        currentUrl = "";
    }
    function shouldAjax(url, origin, elem) {
        return url === currentUrl;
    }
    ajaxProviders.registerProvider({
        "shouldAjax": shouldAjax,
        "createJsonAsync": createJsonAsync
    });
});
;var cuRequestHeaders = [["X-BM-Theme","FFFFFF;08517b"],["X-CU-RequestData","%7b%22CUServiceId%22%3a%22FB31CC89-63D2-4296-A806-33DBA8DA56F2%22%2c%22ClientVersion%22%3a%223.0.150531%22%2c%22ConversationId%22%3a%22cea4dc63-122c-c7bf-5b09-62c0092037f4%22%2c%22IsNewConversationId%22%3afalse%2c%22SpeechLanguage%22%3a%22en-us%22%2c%22ClientTaskFrame%22%3anull%2c%22QFClientContextTaskFrame%22%3a%7b%22Service%22%3a%22IceWeatherAnswer%22%7d%7d"],];var cortanaSpaClientRequests = [["LocalMusicResolver:ProcessNLCommandAsync","{\"Uri\":\"action://SearchLocalMusic\",\"MediaType\":\"unknown\",\"MediaTitle\":\"poker face\",\"AlbumArtist\":\"lady gaga\",\"AlbumTitle\":null,\"MatchedMusicUri\":null,\"MusicImageUri\":null}"],["InstalledAppResolver:ClientApiWrapper","{\"ProjectedApi\":\"SearchAppWrapper.CortanaApp.searchResultsView.deviceSearch.findAppsAsync\",\"AppIds\":[\"Microsoft.ZuneMusic_8wekyb3d8bbwe!Microsoft.ZuneMusic\"],\"Result\":null}"],];DialogSPALib.processResolutionActions(cortanaSpaClientRequests,"https://www.bing.com/DialogPolicy?\u0026isSpeech=0","6be07796-2a07-49c9-a994-1c7d7a9f62b5","cea4dc63-122c-c7bf-5b09-62c0092037f4","en-US",0,"TextQuery",cuRequestHeaders);;(function () {
    function Promote() {
        var isBingSE = _w["isBingCurrentSearchDefault"];
        var setSE = _w["setBingCurrentSearchDefault"];
        if (setSE && isBingSE) {
            var promptNow = false;
            var currDate = new Date();
            if (typeof (Storage) !== "undefined" && _w.localStorage) {
                var tempFlagData = localStorage.getItem("lastSEPromptShownFlag");
                if (tempFlagData != null && tempFlagData != "false") {
                    if (isBingSE() == false) {
                        Log.Log("SetSE", "SetSE", "setBingCurrentSearchDefault", true, "PSE", "Non-Bing", "SE", "Non-Bing", "UA", "Denied");
                    }
                    else {
                        Log.Log("SetSE", "SetSE", "setBingCurrentSearchDefault", true, "PSE", "Non-Bing", "SE", "Bing", "UA", "Accepted");
                    }
                    localStorage.setItem("lastSEPromptShownFlag", false);
                }
                if (!localStorage.getItem("lastSEPromptDate")) {
                    promptNow = true;
                }
                else {
                    if (currDate.getTime() - new Date(localStorage.getItem("lastSEPromptDate")).getTime() > 1000 * 60 * 60 * 24 * 7) {
                        promptNow = true;
                    }
                    else {
                        promptNow = false;
                    }
                }
            }
            if (promptNow && isBingSE() == false) {
                try {
                    localStorage.setItem("lastSEPromptDate", currDate);
                    localStorage.setItem("lastSEPromptShownFlag", true);
                    var result = setSE();
                }
                catch (err) {
                    promptNow = false;
                }
            }
        }
    }
    sj_be(_w, "load", Promote);
})();
;///<reference path="Declarations\Shared.d.ts" />
///<reference path="Declarations\CssClass.d.ts" />
// this module defines the script working for expansion item
var expitem;
(function (expitem) {
    var items = {};
    var hiddenOnExpansionAttribute = "data-hoe";
    var inversionAttribute = "inversion";
    var transitionEndEventName = getTransitionEndEventName();
    var scrollbarWidth = getScrollbarWidth();
    // toggle visible state of managed items
    function toggle(p) {
        if (!p.collapsible) {
            hideItem(p);
        }
        var toCollapse = isExpanded(p);
        var exp = _ge(p.id);
        if (p.scrollBackOnCollapse) {
            if (toCollapse) {
                p.topInViewportBeforeCollapse = getTopInViewport(exp);
                p.bodyHeightBelowViewportBeforeCollapse = _d.body.scrollHeight - getBodyScrollTop() - getViewportHeight();
                if (hasHorizontalScrollbar()) {
                    p.bodyHeightBelowViewportBeforeCollapse += scrollbarWidth;
                }
            }
            else {
                p.topInViewportBeforeExpand = getTopInViewport(exp);
                p.bodyHeightBeforeExpand = _d.body.scrollHeight;
                p.answerContainerHeightBeforeExpand = p.answerContainer.clientHeight;
            }
        }
        for (var i = 0; i < p.turnable.length; i++) {
            var node = p.turnable[i];
            if (p.animationEnabled) {
                toggleSlide(p, node);
            }
            else {
                var inversion = node.getAttribute(inversionAttribute) === "1";
                if (inversion) {
                    var removeHideClass = toCollapse === inversion;
                    removeHideClass ? Lib.CssClass.add(node, 'b_hide') : Lib.CssClass.remove(node, 'b_hide');
                }
                else {
                    var hideNodeOnExpansion = node.getAttribute(hiddenOnExpansionAttribute) === "1";
                    var removeHideClass = toCollapse != hideNodeOnExpansion;
                    removeHideClass ? Lib.CssClass.add(node, 'b_hide') : Lib.CssClass.remove(node, 'b_hide');
                }
            }
        }
        for (i = 0; i < p.movable.length; i++) {
            move(p, p.movable[i], toCollapse, p.animationEnabled);
        }
        for (i = 0; i < p.exclusive.length; i++) {
            var pair = p.exclusive[i];
            if (pair.length != 2) {
                continue;
            }
            swap(pair);
        }
        for (i = 0; i < p.buffer.length; i++) {
            // flush out
            node = p.buffer[i];
            for (var j = 0; j < node.childNodes.length; j++) {
                node.parentNode.insertBefore(node.childNodes[i], node);
            }
        }
        p.state++;
        var disableAnswerSideScrollBackWhenCollapse = p.scrollBackOnCollapse;
        sj_evt.fire('exptoggle', p.id, toCollapse, disableAnswerSideScrollBackWhenCollapse);
        if (p.scrollBackOnCollapse) {
            if (toCollapse) {
                updatePage(p);
            }
            else {
                updateExpansionHeight(p);
            }
        }
        // log the instrumentation
        Log.Log(toCollapse ? "Hide" : "Show", p.logArea, p.logName, false, "AppNS", exp.getAttribute("data-appns"), "K", exp.getAttribute("data-k"));
    }
    // hide current expansion item itself
    function hideItem(p) {
        setDisplayOfItem(p, 'none');
    }
    // show current expansion item itself
    function showItem(p) {
        setDisplayOfItem(p, '');
    }
    function setDisplayOfItem(p, display) {
        var anchor = _ge(p.id);
        if (!anchor) {
            return;
        }
        var par = anchor.parentNode;
        /*There may be padding specified in the parent 'sml' class (used in ExpansionItem) which needs to be hidden.  */
        if (par.className == 'sml' || par.className == 'btm_sml') {
            par.style.display = display;
        }
        else {
            anchor.style.display = display;
        }
    }
    function swap(pair) {
        if (pair.length !== 2) {
            return;
        }
        var temp = sj_ce("div");
        moveAll(pair[0], temp);
        moveAll(pair[1], pair[0]);
        moveAll(temp, pair[1]);
    }
    // move all children from one element to another
    function moveAll(elem1, elem2) {
        while (elem1.childNodes.length > 0) {
            elem2.appendChild(elem1.childNodes[0]);
        }
    }
    // move all elements managed by an movable entry
    function getMovableChildren(entry, forceRefresh) {
        var movableChildrenProperty = 'movech';
        var movableChildren = entry[movableChildrenProperty];
        if (!movableChildren || forceRefresh) {
            movableChildren = [];
            var childNodes = entry.childNodes;
            if (childNodes) {
                for (var i = 0; i < childNodes.length; i++) {
                    movableChildren.push(childNodes[i]);
                }
            }
            entry[movableChildrenProperty] = movableChildren;
        }
        return movableChildren;
    }
    function toggleOnEndForMovableEntry(entry) {
        Lib.CssClass.add(entry, "b_hide");
        var movableChildren = getMovableChildren(entry, true);
        for (var i = 0; i < movableChildren.length; i++) {
            var child = movableChildren[i];
            entry.parentNode.insertBefore(child, entry);
        }
    }
    function move(p, entry, toCollapse, enableAnimation) {
        var movableChildren;
        var child;
        var i;
        if (enableAnimation) {
            if (toCollapse) {
                Lib.CssClass.remove(entry, "b_hide");
                movableChildren = getMovableChildren(entry, false);
                for (i = 0; i < movableChildren.length; i++) {
                    child = movableChildren[i];
                    entry.appendChild(child);
                }
                toggleSlide(p, entry);
            }
            else {
                // disable padding, margin to avoid impact from other CSS rules when removing "b_hide" 
                Lib.CssClass.add(entry, "hidden_nostyle");
                toggleSlide(p, entry, toggleOnEndForMovableEntry);
            }
        }
        else {
            movableChildren = getMovableChildren(entry, !toCollapse);
            for (i = 0; i < movableChildren.length; i++) {
                child = movableChildren[i];
                if (toCollapse) {
                    entry.appendChild(child);
                }
                else {
                    entry.parentNode.insertBefore(child, entry);
                }
            }
        }
    }
    function updateExpansionHeight(p) {
        p.expansionHeight = p.answerContainer.clientHeight - p.answerContainerHeightBeforeExpand;
        p.bodyExpansionHeight = _d.body.scrollHeight - p.bodyHeightBeforeExpand;
    }
    // there might be enough content below viewport for this to collapse
    // so window scroll differently in this special case
    function updatePage(p) {
        if (p.expansionHeight != p.bodyExpansionHeight) {
            return;
        }
        pageScrollWithEqualHeight(p);
    }
    function pageScrollWithEqualHeight(p) {
        var offsetY = 0;
        var marginTop = 0;
        if (p.topInViewportBeforeCollapse <= p.topInViewportBeforeExpand) {
            if (p.expansionHeight <= p.bodyHeightBelowViewportBeforeCollapse) {
                offsetY = -p.expansionHeight;
            }
            else {
                offsetY = -p.bodyHeightBelowViewportBeforeCollapse;
            }
            marginTop = p.expansionHeight;
        }
        else {
            var topAfterCollapse = p.topInViewportBeforeCollapse - p.expansionHeight;
            if (p.expansionHeight <= p.bodyHeightBelowViewportBeforeCollapse) {
                offsetY = topAfterCollapse - p.topInViewportBeforeExpand;
            }
            else {
                offsetY = p.topInViewportBeforeCollapse - p.bodyHeightBelowViewportBeforeCollapse - p.topInViewportBeforeExpand;
            }
            marginTop = -(topAfterCollapse - p.topInViewportBeforeExpand);
        }
        pageScroll(p, offsetY, marginTop);
    }
    function pageScroll(p, offsetY, marginTop) {
        if (!p.animationEnabled || !p.inAnimation) {
            _w.scrollBy(0, offsetY);
            return;
        }
        Lib.CssClass.add(_d.body, "exp_scroll");
        forceStyleUpdate(_d.body);
        _d.body.style.marginTop = marginTop + "px";
        function resetPage() {
            sj_ue(_d.body, transitionEndEventName, resetPage);
            Lib.CssClass.remove(_d.body, "exp_scroll");
            forceStyleUpdate(_d.body);
            _d.body.style.marginTop = "";
            _w.scrollBy(0, offsetY);
        }
        sj_be(_d.body, transitionEndEventName, resetPage);
    }
    function toggleSlide(p, node, onEnd) {
        if (onEnd === void 0) { onEnd = null; }
        p.inAnimation = true;
        setHeight(node);
        forceStyleUpdate(node);
        Lib.CssClass.add(node, "exp_slide");
        forceStyleUpdate(node);
        Lib.CssClass.toggle(node, "b_hide");
        var toExpand = !isExpanded(p);
        function slideEndHandler(event) {
            if (event.target != node) {
                return;
            }
            sj_ue(node, transitionEndEventName, slideEndHandler);
            Lib.CssClass.remove(node, "exp_slide");
            node.style.height = "";
            if (onEnd) {
                onEnd(node);
            }
            // calculate expansion height when expanding this
            if (toExpand && p.scrollBackOnCollapse) {
                updateExpansionHeight(p);
            }
            p.inAnimation = false;
        }
        sj_be(node, transitionEndEventName, slideEndHandler);
    }
    function wireupAll() {
        var dataExp = "data-exp";
        var nodes = null;
        if (_d.querySelectorAll) {
            nodes = _d.querySelectorAll("[" + dataExp + "]");
        }
        else {
            nodes = _d.getElementsByTagName("*");
        }
        for (var i = 0; i < nodes.length; i++) {
            var node = nodes[i];
            if (node.getAttribute) {
                if (_w["progressiveLoad"] === true) {
                    if (Lib.CssClass.contains(node, "hasOnP1")) {
                        continue;
                    }
                    else {
                        Lib.CssClass.add(node, "hasOnP1");
                    }
                }
                var expAttribute = node.getAttribute(dataExp);
                if (expAttribute) {
                    wireupElement(node, expAttribute);
                    // Ensure that an element is not wired up twice.
                    node.removeAttribute(dataExp);
                }
            }
        }
    }
    function wireupElement(element, expAttribute) {
        var expAttributeList = expAttribute.split(";");
        switch (expAttributeList[0]) {
            case "I":
                wireupLinkElement(element, expAttributeList);
                break;
            case "H":
                wireupHiddenElement(element, expAttributeList);
                break;
        }
    }
    function wireupLinkElement(element, expAttributeList) {
        var id = expAttributeList[1];
        var item = getOrCreateItem(id);
        item.id = id;
        item.collapsible = "1" === expAttributeList[2];
        item.visibles = parseInt(expAttributeList[3]);
        item.state = "1" === expAttributeList[4] ? 1 : 0;
        item.hitTarget = expAttributeList[5];
        item.logArea = expAttributeList[6] || "Expansion";
        item.logName = expAttributeList[7] || id;
        item.scrollBackOnCollapse = "1" === expAttributeList[8];
        item.animationEnabled = ("1" === expAttributeList[9]) && (transitionEndEventName !== "");
        item.answerContainer = findAnswerContainer(_ge(item.id));
        sj_evt.bind("exphide", function (evtArgs) {
            var expId = evtArgs[1];
            if (expId === item.id) {
                hideItem(item);
            }
        });
        sj_evt.bind("expshow", function (evtArgs) {
            var expId = evtArgs[1];
            if (expId === item.id) {
                showItem(item);
            }
        });
        // bind extra hit targets
        var targets = [element.id, item.hitTarget];
        for (var i = 0; i < targets.length; ++i) {
            var hitTarget = _ge(targets[i]);
            if (hitTarget) {
                sj_be(hitTarget, "click", function (evt) {
                    toggle(item);
                    sj_sp(evt);
                });
            }
        }
        items[id] = item;
    }
    function wireupHiddenElement(element, expAttributeList) {
        var id = expAttributeList[1];
        var keep = "1" === expAttributeList[2];
        var exclusive = expAttributeList[3];
        var buffer = "1" === expAttributeList[4];
        var hiddenOnExpansion = "1" === expAttributeList[5];
        var expanded = "1" === expAttributeList[6];
        var item = getOrCreateItem(id);
        if (buffer) {
            item.buffer.push(element);
        }
        else if (expanded) {
            element.setAttribute(inversionAttribute, "1");
            item.turnable.push(element);
        }
        else if (hiddenOnExpansion) {
            element.setAttribute(hiddenOnExpansionAttribute, "1");
            item.turnable.push(element);
        }
        else if (keep) {
            item.turnable.push(element);
        }
        else if (exclusive && exclusive.length) {
            var other = _ge(exclusive);
            if (other) {
                item.exclusive.push([element, other]);
            }
        }
        else {
            item.movable.push(element);
        }
        items[id] = item;
    }
    function getOrCreateItem(id) {
        return items[id] || {
            id: id,
            movable: [],
            turnable: [],
            exclusive: [],
            external: [],
            buffer: []
        };
    }
    function isExpanded(item) {
        return (item.state % 2) !== 0;
    }
    function allowExplicitExpansionOnly(item) {
        var expansion = _ge(item.id);
        if (expansion != null && expansion.getAttribute("data-expl") == "1") {
            return true;
        }
        return false;
    }
    // Due to browser optimization of style update, multiple style changes may go at the same time instead of sequentially.  
    // To force update of styles before applying the animation class, a layout property is accessed, which forces the browser
    // to update the style and layouts.
    function forceStyleUpdate(node) {
        var tmp = node.offsetTop;
    }
    function findAnswerContainer(node) {
        var answerContainerParentIds = { "b_pole": true, "b_results": true, "b_context": true };
        var parent = node.parentElement;
        while (parent != null && !(parent.id in answerContainerParentIds)) {
            node = parent;
            parent = node.parentElement;
        }
        return node;
    }
    function setHeight(node) {
        var height = node.clientHeight;
        if (height == 0 && Lib.CssClass.contains(node, "b_hide")) {
            Lib.CssClass.remove(node, "b_hide");
            height = node.clientHeight;
            Lib.CssClass.add(node, "b_hide");
        }
        if (height > 0) {
            node.style.height = height + "px";
        }
    }
    function getTopInViewport(node) {
        var rect = node.getBoundingClientRect();
        return rect.top;
    }
    function getTransitionEndEventName() {
        var eventName = "TransitionEnd";
        var styleName = "Transition";
        var prefixes = ["o", "Moz", "webkit"];
        if (styleName.toLowerCase() in _d.documentElement.style) {
            return eventName.toLowerCase();
        }
        for (var i = 0; i < prefixes.length; i++) {
            var prefixStyleName = prefixes[i] + styleName;
            if (prefixStyleName in _d.documentElement.style) {
                return prefixes[i] + eventName;
            }
        }
        return "";
    }
    function hasHorizontalScrollbar() {
        return _w.innerHeight > _d.documentElement.clientHeight;
    }
    function getScrollbarWidth() {
        var outer = sj_ce("div");
        outer.style.visibility = "hidden";
        outer.style.width = "100px";
        _d.body.appendChild(outer);
        var outerWidth = outer.offsetWidth;
        outer.style.overflow = "scroll";
        var inner = sj_ce("div");
        inner.style.width = "100%";
        outer.appendChild(inner);
        var innerWidth = inner.offsetWidth;
        _d.body.removeChild(outer);
        return outerWidth - innerWidth;
    }
    function getBodyScrollTop() {
        return _w.pageYOffset || _d.body.scrollTop || _d.documentElement.scrollTop;
    }
    function getViewportHeight() {
        return _w.innerHeight || _d.documentElement.clientHeight;
    }
    // Argument 1: Required. expansion ID representing the item to expand, collapse, or toggle
    // Argument 2: Optional. int. The state. 0 to collapse, 1 to expand. Pass nothing to toggle.
    sj_evt.bind("expItem.exp", function (args) {
        var item = items[args[1]];
        if (item && !allowExplicitExpansionOnly(item)) {
            if (args.length > 2) {
                var shouldExpand = (args[2] % 2) !== 0;
                if (shouldExpand != isExpanded(item)) {
                    toggle(item);
                    if (!shouldExpand && !item.collapsible) {
                        showItem(item);
                    }
                }
            }
            else {
                toggle(item);
            }
        }
    }, true);
    sj_evt.bind("onP1", wireupAll, true);
})(expitem || (expitem = {}));
;// Expand / Collapse the mobile taskpane on click
///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
(function () {
    var headerElement = _ge("b_header");
    var searchBoxOffset = headerElement ? headerElement.offsetHeight : 0;
    var taskPane = _ge("wpc_tp");
    var taskPaneCollapsedClassName = " tp_collapsed";
    var taskPaneClassName = taskPane.className.replace(taskPaneCollapsedClassName, "");
    var expId = taskPane.getAttribute("data-expId");
    var isCollapse = true;
    var descendentExpansionItems = null;
    function findDescendentExpandableItems(element) {
        var items = new Array();
        var children = element.children;
        for (var i = 0; i < children.length; i++) {
            var child = children[i];
            var id = child.getAttribute("id");
            if (id === expId) {
                continue;
            }
            if (isExpansionItem(child)) {
                items.push(id);
                continue;
            }
            if (child.childElementCount > 0) {
                items = items.concat(findDescendentExpandableItems(child));
            }
        }
        return items;
    }
    function isExpansionItem(item) {
        var id = item.getAttribute("id");
        if (id != null && id.trim().indexOf("expitem_") == 0) {
            return true;
        }
        return false;
    }
    function getDescendentExpansionItems() {
        if (descendentExpansionItems == null) {
            descendentExpansionItems = findDescendentExpandableItems(taskPane);
        }
        return descendentExpansionItems;
    }
    function expandOrCollapseDescendents(isCollapse) {
        var items = getDescendentExpansionItems();
        for (var i = 0; i < items.length; i++) {
            sj_evt.fire('expItem.exp', items[i], isCollapse ? 0 : 1);
        }
    }
    sj_evt.bind("exptoggle", function (args) {
        var id = args[1];
        if (id === expId) {
            isCollapse = args[2];
            var disableAnswerSideScrollBackWhenCollapse = args[3];
            /* Expand or Collapse the TaskPane on click */
            taskPane.className = isCollapse ? taskPaneClassName + taskPaneCollapsedClassName : taskPaneClassName;
            if (isCollapse && !disableAnswerSideScrollBackWhenCollapse) {
                _w.scrollTo(taskPane.offsetLeft, taskPane.offsetTop - searchBoxOffset);
            }
            expandOrCollapseDescendents(isCollapse);
        }
    });
})();
;///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
/*
 * The feedback form often sits on top of a base page, allowing us to capture all of the HTML associated with the feedback.
 * While the form is visible, we do not want the user tabbing out of the feedback form as that can lead to unexpected situations (e.g.,
 * a user tabs onto the Notebook form which is hidden beneath the feedback form.)
 */
var Feedback;
(function (Feedback) {
    var Accessibility;
    (function (Accessibility) {
        "use strict";
        var originalValues = [];
        var ElementAttributeValue = (function () {
            function ElementAttributeValue(id, name, value) {
                this.id = id;
                this.attributeName = name;
                this.originalAttributeValue = value;
            }
            return ElementAttributeValue;
        })();
        function StoreAttributeValue(element, attributeName) {
            var idToStore = element.getAttribute("id");
            if (!idToStore) {
                idToStore = "genId" + originalValues.length;
                element.setAttribute("id", idToStore);
            }
            var toStore = new ElementAttributeValue(idToStore, attributeName, element.getAttribute(attributeName));
            originalValues.push(toStore);
        }
        function SetAttributeValue(element, name, value) {
            if (value === null) {
                element.removeAttribute(name);
            }
            else {
                element.setAttribute(name, value);
            }
        }
        function SetAttr(name, value, selector, excludeMap) {
            var elements = _d.querySelectorAll(selector);
            for (var i = 0; i < elements.length; i++) {
                var element = elements[i];
                if (excludeMap && element.id && excludeMap[element.id]) {
                    continue;
                }
                StoreAttributeValue(element, name);
                SetAttributeValue(element, name, value);
            }
        }
        function BuildElementsMap(selector) {
            var elements = _d.querySelectorAll(selector), idIdx = 1, map = {}, element, newId;
            for (var i = 0; i < elements.length; ++i) {
                element = elements[i];
                // make sure unique id is assigned to the element
                if (!element.id) {
                    while (true) {
                        newId = "fbpgdgelem" + idIdx++;
                        if (!_ge(newId)) {
                            break;
                        }
                    }
                    element.id = newId;
                }
                map[element.id] = element;
            }
            return map;
        }
        function DisableElements() {
            var c_tabindex = "tabindex", c_minus_1 = "-1", exclude = BuildElementsMap("#fbpgdg, #fbpgdg *");
            SetAttr(c_tabindex, c_minus_1, "a", exclude);
            SetAttr(c_tabindex, c_minus_1, "li", exclude);
            SetAttr(c_tabindex, c_minus_1, "input", exclude);
            SetAttr(c_tabindex, c_minus_1, "select", exclude);
            SetAttr("aria-hidden", "true", "body :not(script):not(style)", exclude);
        }
        function EnableElements() {
            for (var i = 0; i < originalValues.length; i++) {
                var element = _d.getElementById(originalValues[i].id);
                if (element) {
                    SetAttributeValue(element, originalValues[i].attributeName, originalValues[i].originalAttributeValue);
                }
            }
            originalValues.length = 0;
        }
        function Init() {
            if (typeof sj_evt !== "undefined") {
                sj_evt.bind("onFeedbackStarting", function () {
                    DisableElements();
                });
                sj_evt.bind("onFeedbackClosing", function () {
                    EnableElements();
                });
            }
        }
        Init();
    })(Accessibility = Feedback.Accessibility || (Feedback.Accessibility = {}));
})(Feedback || (Feedback = {}));
;/*
Client side resource management component
    
Clients can register resources by caling RMS2.RegisterResources.
The resources are fetched in a serial fashion using XMLHttpRequest, thus making sure RMS does not occupy more than 1 available connection 
(out of 2 max connections per domain for some browsers). 
   
Supports simultaneous multiple invocations of RMS.RegisterResources.    
    
*/

RMS2 = new function ()
{
    /*
    _queue is an array of resource objects with the following structure: 
        
    resource = 
    {
    n:namespace, // The "namespace" of the resource, to partition out the cookie ids
    u:url,       // The URL of the resource
    c:cookieId   // The cookie id, which corresponds to the ith bit of the base64url encoded cookie crumb value
    }
    */
    var _queue = [];
    var _initialDocumentDomain = "";

    var _readyState = "readyState";
    var _onReadyStateChange = "onreadystatechange";
    var _handlerRegistered;

    var _startTime;
    var _rmsConfig = _w.RmsConfig || {};
    
    this.RegisterResources = function (resourceUrls, thisParamIsIgnored, namespace, cookieIds)
    {
        _initialDocumentDomain = _d.domain;

        for (var i = 0; i < resourceUrls.length; i++)
        {
            _queue.push({ n: namespace, u: resourceUrls[i], c: cookieIds[i] });
        }

        // We only want to bind the event handler once, since otherwise we would end up prefetching resources twice                 
        if (!_handlerRegistered)
        {
            _handlerRegistered = true;

            // pass 1 (true) for last arg to bind retroactively (which means we'll call the handler if the onHTML event has already fired)
            // binding retroactively so we don't have to be concerned about the rendering endpoint on this script relative to the script that fire the event
            sj_evt.bind("onP1", startPrefetch, 1, 1000); // call prefetch 1000 ms after onP1 fires - fired in OnP1_r.js
        }
    }

    function Base64UrlEncode(bitMapStr, id)
    {
        // NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE 
        // NOTE: If either of the alphabet or the number of bits is changed, then the RMS CookieResourceTracker, 
        //       as well as the PerfPreCheckin tests must also be changed. See bug MSN Search Tracking: PS 499673
        // NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE NOTE 

        var BitsPerChar = 6;
        // It would be great to use _table.split, but IE6 doesn't provide Array.indexOf, which we would then need.
        var _table = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
        // buffer to hold our base32 encoded bitmap
        var _chars = bitMapStr ? bitMapStr.split("") : [];
        var val;

        // Calculate the index of the char that contains (or should contain) the bit representing the given cookie id
        var offset = ~ ~(id / BitsPerChar); // ~~ is equivalent to Math.floor() here

        // Pad out _chars to ensure _chars[offset] exists if required
        while (_chars.length <= offset)
        {
            _chars.push(_table.charAt(0));          // pad out with zero
        }

        // Calculate the new value of _chars[offset] when the bit representing the id is set
        val = _table.indexOf(_chars[offset]) | (1 << (id % BitsPerChar));

        // Set the new value of _chars[offset]
        _chars[offset] = _table.charAt(val);

        return _chars.join("");
    }

    function updateCookie(resource)
    {
        // read the cookie crumb 
        var crumb = sj_cook.get("RMS", resource.n /*namespace used as crumb key name*/);
        
        // save off the bitmap value to the cookie crumb, with the cookieId bit set 
        sj_cook.set("RMS", resource.n, Base64UrlEncode(crumb, resource.c), 0/*isPersistent if > 0*/, "/"/*path*/, 0/*expires: in minute*/);
    }

    function startPrefetch()
    {
        if (_d.domain != _initialDocumentDomain)
        {
            // Certain scopes like books and academic change this property... 
            // when they do so, we can't prefetch via XMLHttpRequest, since this causes an access denied error
            // so we just avoid the prefetch, and rely on network reuse of the files we'd have
            // prefetched to get the same benefits as prefetch. It is likely that most prefetched
            // files will already be in browser cache by the time the user reaches these scopes,
            // and since this is not breaking behavior (instead we're just not as optimal as we could be,
            // should the user not actually have these files in cache), we can avoid the prefetch.
            // Furthermore, if the user has the files in cache during the same browser session that
            // he visits these scopes, this script will not get rendered (since there's no prefetch
            // needed)
            return;
        }

        if (_rmsConfig.P)
        {
            // If persist cookie has been used for RMS, restore RMS session cookie from the persist copy.
            _rmsConfig.P();
        }
        // start fetching
        _startTime = new Date();        
        fetch(0);
    }

    function fetch(i)
    {
        var resource = _queue[i];
        if (resource)
        {
            var xhr = sj_gx();
            if (!xhr) return;
            xhr.open("get", resource.u, true); // async

            var th = sb_st(function ()
            {
                if (xhr[_readyState] != 4)
                {
                    // This is because of a bug in some browsers
                    // where abort() fires onreadystatechange with readyState=4
                    // So setting onreadystatechange to an empty function so that resource i+1
                    // is not fetched twice.
                    xhr[_onReadyStateChange] = function () { };
                    xhr.abort();
                    fetch(i + 1);
                }
            }, 5000); // we wait at most 5 seconds for any one resource

            xhr[_onReadyStateChange] = function ()
            {
                if (xhr[_readyState] == 4)
                {
                    sb_ct(th); // kill the timeout timer
                    
                    updateCookie(_queue[i]);
                    fetch(i + 1);
                }
            };

            xhr.send(null); // null is not optional here for FF
        }
        else
        {
            // Upon the prefetching is completed, send back RMS instrumenation ping-back if the instrumenation is enabled.
            if (_rmsConfig.I)
            {
               _rmsConfig.I(_startTime); 
            }
        }
    }
};
;///<reference path="..\..\..\..\Answers\services\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
var SetForceDesktopCookie = function () {
    sj_cook.set("_UR", "HP", "");
};
;///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
///<reference path="..\..\..\..\Threshold\Src\Content\Script\Declarations\SearchAppWrapper.d.ts" />
///<reference path="Declarations\PackageLoad.d.ts" />
///<reference path="Declarations\FeedbackBootstrap.d.ts" />
/*
 * 'FeedbackBootstrap.ts' is the bootstrap script file that loads the other dependencies when user requests to give feedback.
 * It will load the feedback package (provided as input) when user clicks on an element (also provided as input)
 *
 * Sample code to be added in view that loads this JS (SnR only)
 * BUG: 1147929 - Investigate other options so as to not pollute global namespace

  <rms:Javascript key="rms:answers:Feedback:FeedbackBootstrapBundle" />
  <rms:Javascript endpoint="${JsRenderEndpoint.JsAfterOnLoad}">
    Feedback.Bootstrap.InitializeFeedback({page : true}, "sb_feedback",0,1,0);
  </rms:Javascript>
 *
 */
var Feedback;
(function (Feedback) {
    var Bootstrap;
    (function (Bootstrap) {
        // feedback form requested event name
        var formRequestedEventName = "feedbackformrequested";
        // class used to prevent double binding of feedback handler to an element
        var startFeedbackHandlerBindedClass = "feedback-binded";
        // class used to mark an element as clicked
        var elementClickedClass = "clicked";
        function StartFeedback(scrollToTop, feedbackPackage, checkPackageLoad, feedbackLinkId, highlightSelector) {
            // raise an event to "warn" that the page is entering on "Feedback state"
            sj_evt.fire("onFeedbackStarting");
            //scrolls to the top where the feedback form is visible
            scrollToTop = (typeof scrollToTop === 'undefined') ? false : scrollToTop;
            if (scrollToTop) {
                scrollTo(0, 0);
            }
            // checks for flag if package already present on page or not
            checkPackageLoad = (typeof checkPackageLoad === 'undefined') ? true : checkPackageLoad;
            Feedback.PackageLoad.Load(feedbackPackage, checkPackageLoad, feedbackLinkId, highlightSelector);
        }
        function FindHighlightSelectorValue(element, maxLevel) {
            var level = 0, selector = null;
            while (element && element.getAttribute && (!(maxLevel >= 1) || level < maxLevel)) {
                selector = element.getAttribute("data-fbhlsel");
                if (selector != null) {
                    break;
                }
                level++;
                element = element.parentNode;
            }
            return selector;
        }
        Feedback.Bootstrap.InitializeFeedback = function (feedbackPackage, feedbackLinkId, checkPackageLoad, scrollToTop, disableFeedbackLink, appendFormAfterLink, startOnLoad) {
            var element = _ge(feedbackLinkId);
            // check if feedback handler was already bound to the element
            if (element && element.classList && element.classList.contains(startFeedbackHandlerBindedClass)) {
                return;
            }
            disableFeedbackLink = (typeof disableFeedbackLink === 'undefined') ? false : disableFeedbackLink;
            var highlightSelector = FindHighlightSelectorValue(element, 3);
            // Listen for form show event
            if (typeof sj_evt !== "undefined") {
                sj_evt.bind(formRequestedEventName, function (eventArgs) {
                    var highlightSelectorFromPassedElement = eventArgs && eventArgs.length && eventArgs.length > 1 && FindHighlightSelectorValue(eventArgs[1], 3);
                    StartFeedback(scrollToTop, feedbackPackage, checkPackageLoad, feedbackLinkId, highlightSelectorFromPassedElement);
                }, 1);
            }
            if (typeof SearchAppWrapper !== "undefined" && SearchAppWrapper.CortanaApp && SearchAppWrapper.CortanaApp.addEventListener) {
                SearchAppWrapper.CortanaApp.addEventListener(formRequestedEventName, function (args) {
                    if (typeof args !== "undefined" && args !== null) {
                        args.isHandled = true;
                    }
                    StartFeedback(scrollToTop, feedbackPackage, checkPackageLoad, feedbackLinkId);
                });
            }
            if (element !== null) {
                sj_be(element, 'click', function (e) {
                    // disables feedback link after one click
                    if (disableFeedbackLink && element.classList) {
                        if (element.classList.contains(elementClickedClass)) {
                            return false;
                        }
                        else {
                            element.classList.add(elementClickedClass);
                        }
                    }
                    // prevents default click action
                    sj_pd(e);
                    // stop propagation (example - needed to capture AS feedback)
                    sj_sp(e);
                    StartFeedback(scrollToTop, feedbackPackage, checkPackageLoad, feedbackLinkId, highlightSelector);
                });
                // mark that feedback handler was bound to the element
                if (element.classList) {
                    element.classList.add(startFeedbackHandlerBindedClass);
                }
            }
            else {
                startOnLoad = (typeof startOnLoad === 'undefined') ? false : startOnLoad;
                if (startOnLoad) {
                    StartFeedback(scrollToTop, feedbackPackage, checkPackageLoad, feedbackLinkId, highlightSelector);
                }
            }
        };
    })(Bootstrap = Feedback.Bootstrap || (Feedback.Bootstrap = {}));
})(Feedback || (Feedback = {}));
;///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
///<reference path="Declarations\PackageLoad.d.ts" />
///<reference path="Declarations\SdkInterfaces.d.ts" />
///<reference path="Highlight.njq.ts" />
var Feedback;
(function (Feedback) {
    var PackageLoad;
    (function (PackageLoad) {
        'use strict';
        var cache = {};
        Feedback.PackageLoad.GetHTML = function () {
            return _d.documentElement.outerHTML;
        };
        Feedback.PackageLoad.originalHTML = Feedback.PackageLoad.GetHTML();
        // This call needs to be made from the bootstrap JS
        // Set checkPackageLoad to false for Cortana to make sure you load the package every time the call is made
        Feedback.PackageLoad.Load = function (packages, checkPackageLoad, feedbackLinkId, highlightSelector) {
            var id;
            checkPackageLoad = (typeof checkPackageLoad === "undefined") ? true : checkPackageLoad;
            feedbackLinkId = (typeof feedbackLinkId === "undefined") ? '' : feedbackLinkId;
            for (id in packages) {
                if (checkPackageLoad) {
                    // checks if package was previously loaded
                    if (packages.hasOwnProperty(id) && typeof cache[id] === 'undefined') {
                        LoadPkg(id, feedbackLinkId, highlightSelector);
                    }
                }
                else {
                    LoadPkg(id, feedbackLinkId, highlightSelector);
                }
            }
        };
        // Loads the feedback package
        function LoadPkg(id, feedbackLinkId, highlightSelector) {
            var ig = _G.IG, partner = (typeof _G.V === 'undefined') ? _G.P : _G.V, root = '/feedback/', url, matchResult;
            // 'url' looks like '/feedback/page?ig=abc&p=serp'
            url = root + Feedback.RouteProvider.Provide(id) + '?ig=' + ig + '&p=' + partner;
            if (typeof fbsrc !== 'undefined') {
                url += '&src=' + encodeURIComponent(fbsrc);
            }
            // see if an iid has been defined for the package we're making the request for; if so, add it to the URL
            if (typeof fbpkgiid !== 'undefined' && typeof fbpkgiid[id] !== 'undefined') {
                url += '&iid=' + fbpkgiid[id];
            }
            // add testhooks if present
            if ((matchResult = location.href.match(/[?&]testhooks=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add uncrunched if present
            if ((matchResult = location.href.match(/[?&]uncrunched=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add logjserror if present
            if ((matchResult = location.href.match(/[?&]logjserror=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add addloginsource if present
            if ((matchResult = location.href.match(/[?&]addloginsource=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add Cortana hooks if present
            if ((matchResult = location.href.match(/[?&]hoseassistant=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            if ((matchResult = location.href.match(/[?&]hose=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            if ((matchResult = location.href.match(/[?&]theme=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add client hooks if present
            if ((matchResult = location.href.match(/[?&]client=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            if ((matchResult = location.href.match(/[?&]clientversion=[^?&#]*/i)) && matchResult[0]) {
                url += "&" + matchResult[0].substring(1);
            }
            // add fb link id if present
            if (typeof feedbackLinkId !== 'undefined' && feedbackLinkId !== '') {
                url += '&fid=' + encodeURIComponent(feedbackLinkId);
            }
            sj_ajax(url, {
                callback: function (isSuccess, response) {
                    if (isSuccess) {
                        _ge("sb_feedback").removeAttribute("clicked");
                        response.appendTo(_d.body);
                        if (Feedback.Highlight && Feedback.Highlight.HighlightElements) {
                            Feedback.Highlight.HighlightElements(highlightSelector);
                        }
                    }
                }
            });
            cache[id] = true;
        }
    })(PackageLoad = Feedback.PackageLoad || (Feedback.PackageLoad = {}));
})(Feedback || (Feedback = {}));
;///<reference path="Declarations\SdkInterfaces.d.ts" />
var Feedback;
(function (Feedback) {
    var RouteProvider;
    (function (RouteProvider) {
        "use strict";
        Feedback.RouteProvider.Provide = function (id) {
            return id;
        };
    })(RouteProvider = Feedback.RouteProvider || (Feedback.RouteProvider = {}));
})(Feedback || (Feedback = {}));
;;///<reference path="..\..\..\..\Shared\Content\Content\Script\Declarations\Shared.d.ts" />
///<reference path="Declarations\PageDebug.d.ts" />
/*
 * This module defines methods to set PageDebug properties.
 */
var Feedback;
(function (Feedback) {
    var DebugCollector;
    (function (DebugCollector) {
        'use strict';
        function GetPageDebug() {
            _w["PageDebug"] = (typeof _w["PageDebug"] !== "undefined") ? _w["PageDebug"] : {};
            return _w["PageDebug"];
        }
        function SetFederationDebugInfo(debugInfo) {
            if (debugInfo.length < 1)
                return;
            GetPageDebug().FederationDebugInfo = debugInfo;
        }
        DebugCollector.SetFederationDebugInfo = SetFederationDebugInfo;
    })(DebugCollector = Feedback.DebugCollector || (Feedback.DebugCollector = {}));
})(Feedback || (Feedback = {}));
;Feedback.DebugCollector.SetFederationDebugInfo('QueryID : 44ac45c93e4d43fbb428cb1066c43de8');;
//]]>-->
        </div>
        <div style="display:none">
            <!--//<![CDATA[
///<reference path="..\..\..\..\answers\services\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
/**
*   Parses the content as HTML and attaches it to the given element.
*   The function takes care of attaching styles and scripts as well.
*   !!! For IE8 and below please make sure dom element passed to the
*       function is part of the DOM tree. !!!
*   @private
*   @param elem - The element to which the parsed content is appended
*   @param content - html content that has to be parsed
*   @example - sj_appHTML(_d.body,"<div>hello</div>");
*/
// BUGBUG: TFS 780914: TypeScript throws build error when two ts file declare the same variable
var sj_appHTML = function (elem, content) {
    if (!content) {
        return;
    }
    var innerHtml = "innerHTML", scriptTag = "script", appendChild = "appendChild", length = "length", srcAttribute = "src", createElement = sj_ce;
    var div = createElement('div');
    // In IE9 and below innerHTML removes script and style tags if it is
    // not preceded by a visible node.
    div[innerHtml] = '<br>' + content;
    var childNodes = div.childNodes;
    div.removeChild(childNodes[0]);
    var scripts = div.getElementsByTagName(scriptTag);
    for (var i = 0; i < scripts[length]; i++) {
        var newScript = createElement(scriptTag), oldScript = scripts[i];
        newScript.type = "text/javascript";
        var src = oldScript.getAttribute(srcAttribute);
        if (src) {
            newScript.setAttribute(srcAttribute, src);
        }
        else {
            newScript.text = oldScript[innerHtml];
            newScript.setAttribute("data-bing-script", "1");
        }
        oldScript.parentNode.replaceChild(newScript, oldScript);
    }
    var frag = _d.createDocumentFragment();
    while (childNodes[length]) {
        frag[appendChild](childNodes[0]);
    }
    elem[appendChild](frag);
};
;///<reference path="..\..\..\..\answers\services\Shared\Content\Content\script\Declarations\Shared.d.ts"/>
/**
*   Friendly ajax handler for doing get requests and appending response to dom.
*   @Definition of sj_ajax function
*   @param  url <string>: The url of the site to be ajax loaded
*   @param settings <IAjaxSettings>: Settings defines the callback function
*       and the timeout value for the request.
*   @example sj_ajax("/ajaxload",{
         callback:function(success, response){
*           if(success) response.appendTo(_d.body);
*        },
*        timeout: 1000
*     });
*
*   @Definition of IAjaxSettings object
*   @member Callback <function(success, response)> : This is the function that is called
*               once the request is complete. The functions gets passed two parameters.
*            @param success <bool> - This indicates the sucess of the request.
*            @param response <IAjaxResponse> - A response object that contains the request,
*                a helper fuction to append to dom etc.
*   @member Timeout : Time period in ms to wait before timing out the request.
*
*   @Definition of IAjaxResponse
*   @member request<XMLHttpRequest> : The request object of the current request.
*   @member appendTo<function(domElem)> : If the ajax response is in the form of html then this
*              helper function can be used to attach the html content to the page. This fuction
*              takes care of applying all the style and script tags appropriately.
*              !!! For IE8 and below please make note that scripts would be immediately executed
*                  even if domElem is not in the Dom tree. !!!
*           @param domElem <HTMLElement> - The dom element to attach the html reponse to.
*/
var sj_ajax = function (url, settings) {
    var callback, request = sj_gx(), onreadystatechange = "onreadystatechange", timeout, timeoutHandler = null, setTimeout = sb_st, clearTimeout = sb_ct, empty = function () {
    };
    if (!url || !request) {
        doCallback(callback, false);
        return;
    }
    if (settings) {
        callback = settings.callback;
        timeout = settings.timeout;
    }
    request.open("get", url, true);
    request[onreadystatechange] = function () {
        if (request.readyState === 4) {
            var success = false;
            if (timeoutHandler !== null) {
                clearTimeout(timeoutHandler);
            }
            if (request.status === 200) {
                success = true;
                // Bug on chrome. Multiple onreadystatechange are triggered in debug mode
                request[onreadystatechange] = empty;
            }
            doCallback(callback, success);
        }
    };
    // For ajaxserp we need to cancel this request before loading a new page
    // or else a race condition can do this callback on the next page.
    sj_evt.bind("ajax.unload", cancelRequest);
    request.send();
    function cancelRequest() {
        request[onreadystatechange] = empty;
        if (request.abort) {
            request.abort();
        }
    }
    if (timeout > 0) {
        timeoutHandler = setTimeout(function () {
            cancelRequest();
            doCallback(callback, false);
        }, timeout);
    }
    /**
    *   Executes the callback function by passing it the status message
    *   @private
    *   @param callback - The callbacck function to be executed
    *   @param isSuccess - Bool value indicating if the ajax load was successful
    */
    function doCallback(callback, isSuccess) {
        if (typeof (callback) === "function") {
            callback(isSuccess, {
                request: request,
                appendTo: function (elem) {
                    if (request) {
                        sj_appHTML(elem, request.responseText);
                    }
                }
            });
        }
    }
};
;LoadJQuery=function(){_w.rms.js({'rms:answers:Feedback:FeedbackJQuery':'\/rms\/rms%20answers%20Feedback%20NoJQuery\/nj\/94d206a1\/214104aa.js',d:1});};Feedback.Bootstrap.InitializeFeedback({page:true},"epf",true,false,false,false,false);;
//]]>-->
        </div>
    </div>
    <script type="text/javascript">
    //<![CDATA[
    _G.HT = new Date;
    //]]>
    </script>
</body>

</html>
